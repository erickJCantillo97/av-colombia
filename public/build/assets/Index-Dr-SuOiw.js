import{D as K,E as H,d as o,G as X,q as M,o as c,f as y,a,b,w as N,u as O,g as T,F as B,i as P,n as U,t as D,y as j,H as Y,I as Z,C as ee,W as V,J as L,c as I,k as F,T as te}from"./app-C86xMVSU.js";import{s as se}from"./index-BgxqspMf.js";import{s as ae}from"./index-Cbou1mG2.js";import{_ as oe}from"./Datatable-B-Cwi5KR.js";import{_ as re}from"./AppLayout-DKn0FidD.js";import{a as le}from"./toasts-DoW0LeUK.js";import{S as ne}from"./sweetalert2.esm.all-BkU8I-GU.js";import{_ as ie,a as de}from"./Notas-XSyet2nM.js";import{_ as ce}from"./Modal-D3bYv59T.js";import{_ as ue}from"./Input-BHh1t7Gb.js";import{_ as me}from"./logo-FrpA4ly9.js";import"./index-CBU7g8u-.js";import"./index-DEdYvChs.js";import"./index-CiXZBQ9n.js";import"./index-DVkwFBj2.js";import"./index-CTeOCr-D.js";import"./index-D596n3-y.js";import"./index-BoZNN3v_.js";import"./index-DnxoQoQ5.js";import"./index-BpfycaIt.js";import"./index-jLgi5upc.js";import"./index-Da39xIws.js";import"./index-q6QNEmRt.js";import"./index-BXyyLGlL.js";import"./index-CaTrimY9.js";import"./index-5QKFrISw.js";import"./index-sBbUJC5s.js";import"./index-CJhHfC9e.js";import"./useCommonUtilities-hipAPSUL.js";import"./filepond-plugin-image-preview.min-BG10xqQy.js";import"./postcss-D9Zp8NKu.js";import"./index-bYwvpV6b.js";import"./Loading-COHrBDHU.js";import"./index-DK8qi_UK.js";import"./index-CfAQkpYT.js";import"./index-C83zdgSB.js";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const ve=()=>{};function fe(k,d,m){let u;K(m)?u={evaluating:m}:u={};const{lazy:_=!1,evaluating:r=void 0,shallow:n=!0,onError:l=ve}=u,C=H(!_),g=n?H(d):o(d);let i=0;return X(async h=>{if(!C.value)return;i++;const x=i;let S=!1;r&&Promise.resolve().then(()=>{r.value=!0});try{const A=await k($=>{h(()=>{r&&(r.value=!1),S||$()})});x===i&&(g.value=A)}catch(A){l(A)}finally{r&&x===i&&(r.value=!1),S=!0}}),_?M(()=>(C.value=!0,g.value)):g}const pe={key:0,class:"items-center justify-center flex flex-col"},be={class:"flex flex-col gap-y-3 h-[60vh] overflow-y-auto"},ge={class:"shadow-lg pr-4 rounded-md flex items-center justify-between"},xe={class:"text-xl font-bold"},ye={class:"font-bold text-sm"},_e={__name:"Changes",setup(k){const d=o(!1),m=o(),u=fe(async()=>{var{data:r}=await j.get(route("get.states.change",{date:m.value}));return console.log(r.status),r.status}),_={reservado:"blue","CAMBIO DE FECHA":"gray","NO SHOW":"amber",REUBICADO:"orange",CANCELADA:"green",PROBLEMATICA:"red"};return(r,n)=>(c(),y(B,null,[a("span",{onClick:n[0]||(n[0]=l=>d.value=!0),class:"text-xs font-bold text-blue-800 cursor-pointer"},"Listado de Cambios"),b(ce,{title:"Historial de Cambios",modelValue:d.value,"onUpdate:modelValue":n[2]||(n[2]=l=>d.value=l),"close-on-escape":""},{default:N(()=>[b(ue,{"max-date":new Date,type:"date",class:"my-2",modelValue:m.value,"onUpdate:modelValue":n[1]||(n[1]=l=>m.value=l),dateFormat:"dd/mm/yy"},null,8,["max-date","modelValue"]),O(u)&&O(u).length==0?(c(),y("div",pe,[b(me),n[3]||(n[3]=a("p",null,"Sin Cambio Registrados",-1))])):T("",!0),a("div",be,[(c(!0),y(B,null,P(O(u),l=>(c(),y("div",ge,[a("div",{class:U(["rounded-l-md text-lg font-bold uppercase",`bg-${_[l.state]}-200 p-2`])},D(l.state),3),a("div",null,[a("p",xe,D(l.statable.service),1),a("span",ye,D(l.user.name),1)])]))),256))])]),_:1},8,["modelValue"])],64))}},Ce={class:"h-[92vh]"},he={class:"flex py-2 px-4 justify-between items-center"},Ae={class:"italic flex flex-col"},Ee={class:"flex gap-x-2"},we=["onClick"],ke={class:"text-xs font-bold uppercase"},Se={class:"w-full justify-between flex"},ct={__name:"Index",props:{bookingServices:Array},setup(k){const d=k;Y(1e3*20);const{toast:m}=le(),u=o([]),_=o([]),r=o(!1),n=o(""),l=o([]),C=o(!1),g=o(null),i=o([]),h=o(null),x=o(!1),S=[{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"adults",header:"Pasajeros",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!1,type:"date",sortable:!0},{field:"channel.name",header:"Canal de venta",filter:!0,sortable:!0},{field:"proveedors_names",header:"proveedores",class:"text-center font-semibold text-sm",filter:!0},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"RESERVADO",severity:"info",class:""},{text:"CAMBIO DE FECHA",class:"bg-gray-200 font-bold"},{text:"COMPLETADA",severity:"success",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"REUBICADO",severity:"warn",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"},{text:"PROBLEMATICA",severity:"danger",class:"animate-pulse"},{text:"SIN CONFIRMAR",severity:"danger"}]}],A=[{text:"RESERVADO",color:"blue"},{text:"CAMBIO DE FECHA",color:"gray"},{text:"NO SHOW",color:"amber"},{text:"REUBICADO",color:"orange"},{text:"CANCELADA",color:"green"},{text:"SIN CONFIRMAR",color:"red"}],$={action:()=>{V.get(route("BookingServices.create"))}},E=o(d.bookingServices);Z([i,h,r],async([t,e,v])=>{if(v){i.value=[new Date("2024-11-02"),new Date],r.value=!1;return}if(!t[0]||!t[1])E.value=d.bookingServices;else{const f=await z(t);E.value=f}e&&(E.value=E.value.filter(f=>f.status==e))});const W=t=>{h.value=t};M(()=>{if(!i.value[0])return d.bookingServices;const[t,e]=i.value.map(v=>new Date(v).toISOString().split("T")[0]);return d.bookingServices.filter(v=>{const f=new Date(v.date).toISOString().split("T")[0];return f>=t&&f<=e})});const z=async t=>{const{data:e}=await j.get(route("get.all.booking.services.dates",{dates:t}));return e.bookingServices},G=ee({id:"",service_id:null,date:"",adults:1,time_service:"",boys:0,cliente_name:"",cliente_phone:"",cliente_city:"",cliente_building:"",mascota:0,persona_adicional:0,cobre_transaccion:0,cobro_extra_cliente:0,reserva:0,abono:0,method_id:"",channel_id:"9d99a95f-6c3d-48fd-aa7d-6ef4e6860123",saldo:0,proveedors:[],total:0,total_real:0,percent_channel:0,observations:"",code_booking:"",extras:[]}),q=[{label:"Detalles",action:async t=>{g.value=t,G.service_id=t.service_id,C.value=!0,await getProveedors()},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:async t=>{V.get(route("BookingServices.edit",t.id))},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Notas",severity:"secondary",action:t=>{l.value=t,x.value=!0},badge:t=>t.notes,icon:"fa-solid fa-note-sticky text-sm"},{label:"Eliminar",icon:"fa-solid fa-trash text-sm",severity:"danger",show:L().props.auth.user.rol=="admin"||L().props.auth.user.rol=="superadmin",action:t=>{ne.fire({title:"Estas Seguro?",text:`Eliminar la reservaciÃ³n de ${t.cliente_name}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, Eliminar!"}).then(e=>{e.isConfirmed&&V.delete(route("BookingServices.destroy",t.id),{onSuccess:()=>{m("success","Reserva Eliminada")}})})}}],w=o([]),J=t=>{w.value=t};return(t,e)=>{const v=ae,f=se,R=te;return c(),y(B,null,[b(re,{title:"Reservas"},{default:N(()=>[e[8]||(e[8]=a("div",{class:"hidden bg-amber-200 bg-orange-200 bg-blue-200 !bg-green-200 !bg-gray-200 !bg-orange-200 !bg-amber-200"},null,-1)),a("div",Ce,[a("div",he,[a("div",Ae,[e[6]||(e[6]=a("h1",{class:"text-2xl font-bold"},"Reservas",-1)),b(_e)]),a("div",Ee,[F((c(),y("div",{class:"p-2 bg-black text-white text-center rounded-lg cursor-pointer transition-all duration-300 scale-95 hover:scale-100 border-2",onClick:e[0]||(e[0]=s=>h.value=null)},e[7]||(e[7]=[a("p",{class:"text-sm font-bold uppercase"},"Todos",-1)]))),[[R,`${w.value.length} Reservas
                        ${w.value.reduce((s,p)=>s+p.adults,0)} Pasajeros
                        `,void 0,{bottom:!0}]]),(c(),y(B,null,P(A,s=>F(a("div",{onClick:p=>W(s.text),class:U(["flex items-center transition-all duration-300 py-1 px-4 rounded-lg cursor-pointer hover:scale-105 hover:border-b-4 hover:border-gray-800",[`bg-${s.color}-200`,h.value==s.text?"border-b-4 scale-105 shadow-lg border-gray-800":""]])},[a("p",ke,D(s.text),1)],10,we),[[R,`${w.value.filter(p=>p.status==s.text).length} Reservas
                    ${w.value.filter(p=>p.status==s.text).reduce((p,Q)=>p+Q.adults,0)} Pasajeros
                    `,void 0,{bottom:!0}]])),64))]),F((c(),I(f,{modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=s=>i.value=s),selectionMode:"range",dateFormat:"dd/mm/yy",manualInput:!1},{footer:N(()=>[a("div",Se,[b(v,{onClick:e[1]||(e[1]=s=>i.value=[]),label:"Clear",size:"small",severity:"danger"}),b(v,{onClick:e[2]||(e[2]=s=>r.value=!0),label:"Ver Todos",size:"small",severity:"success"})])]),_:1},8,["modelValue"])),[[R,"Filtrar fecha de Actividad",void 0,{bottom:!0}]])]),b(oe,{actions:q,add:$,showButtonBar:"",columnas:S,data:E.value,routecreate:"services.create",rowClass:!0,onFilterApply:J},null,8,["data"])]),g.value?(c(),I(de,{key:0,modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=s=>C.value=s),service:g.value,proveedors:u.value},null,8,["modelValue","service","proveedors"])):T("",!0)]),_:1}),x.value?(c(),I(ie,{key:0,modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=s=>x.value=s),notes:_.value,note:n.value,service:l.value},null,8,["modelValue","notes","note","service"])):T("",!0)],64)}}};export{ct as default};
