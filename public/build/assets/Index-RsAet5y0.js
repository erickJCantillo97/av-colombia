import{D as ve,E as J,d as u,G as fe,q as T,o as m,f as g,a as s,b as r,w as U,u as a,g as H,F as $,i as M,n as Y,t as f,y as be,H as ge,C as xe,W as N,I as G,c as j,k as Q,h as K,T as ye}from"./app-BYFyvr3E.js";import{s as _e}from"./index-D71VfMiY.js";import{s as Ve}from"./index-DSJKpQEM.js";import{s as we}from"./index-DQyy5WXH.js";import{_ as Ce}from"./Datatable-o2jdjmFJ.js";import{_ as d}from"./Input-DaSTN1uF.js";import{_ as Z}from"./Modal-B4vAMuzU.js";import{_ as he}from"./AppLayout-Du0Y2pHJ.js";import{s as ke}from"./index-CWEC5j9K.js";import{a as Se}from"./toasts-DoW0LeUK.js";import{S as X}from"./sweetalert2.esm.all-BkU8I-GU.js";import{_ as Ae,a as De}from"./Notas-qpKtQl-E.js";import{_ as Ee}from"./logo-B_R7y56X.js";import"./index-jqe700-v.js";import"./index-BmDlCX3_.js";import"./index-1-5AHb7B.js";import"./index-DegnHZq2.js";import"./index-C57Lptg-.js";import"./index-eSOeDyZa.js";import"./index-sWgStCRN.js";import"./index-pr9SFwKf.js";import"./index-DKt0NaSY.js";import"./index-D34THP-u.js";import"./index-D7n8e2OO.js";import"./index-Bc49gxIY.js";import"./index-C7zh6xZY.js";import"./index-zT3DwANM.js";import"./index-JFQNuGYT.js";import"./index-DIK6VfiZ.js";import"./useCommonUtilities-hipAPSUL.js";import"./filepond-plugin-image-preview.min-BG10xqQy.js";import"./postcss-kg-n3Czi.js";import"./index-QWqFjWUU.js";import"./index-CbmC2xAn.js";import"./index-D_cvvbII.js";import"./index-CcuCVfSl.js";import"./Loading-D4bb0eAN.js";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Ue=()=>{};function $e(F,w,h){let x;ve(h)?x={evaluating:h}:x={};const{lazy:D=!1,evaluating:y=void 0,shallow:p=!0,onError:b=Ue}=x,E=J(!D),k=p?J(w):u(w);let _=0;return fe(async L=>{if(!E.value)return;_++;const S=_;let A=!1;y&&Promise.resolve().then(()=>{y.value=!0});try{const V=await F(I=>{L(()=>{y&&(y.value=!1),A||I()})});S===_&&(k.value=V)}catch(V){b(V)}finally{y&&S===_&&(y.value=!1),A=!0}}),D?T(()=>(E.value=!0,k.value)):k}const Be={key:0,class:"items-center justify-center flex flex-col"},Oe={class:"flex flex-col gap-y-3 h-[60vh] overflow-y-auto"},Re={class:"shadow-lg pr-4 rounded-md flex items-center justify-between"},Te={class:"text-xl font-bold"},Fe={class:"font-bold text-sm"},Ie={__name:"Changes",setup(F){const w=u(!1),h=u(),x=$e(async()=>{var{data:y}=await be.get(route("get.states.change",{date:h.value}));return console.log(y.status),y.status}),D={reservado:"blue","CAMBIO DE FECHA":"gray","NO SHOW":"amber",REUBICADO:"orange",CANCELADA:"green",PROBLEMATICA:"red"};return(y,p)=>(m(),g($,null,[s("span",{onClick:p[0]||(p[0]=b=>w.value=!0),class:"text-xs font-bold text-blue-800 cursor-pointer"},"Listado de Cambios"),r(Z,{title:"Historial de Cambios",modelValue:w.value,"onUpdate:modelValue":p[2]||(p[2]=b=>w.value=b),"close-on-escape":""},{default:U(()=>[r(d,{"max-date":new Date,type:"date",class:"my-2",modelValue:h.value,"onUpdate:modelValue":p[1]||(p[1]=b=>h.value=b),dateFormat:"dd/mm/yy"},null,8,["max-date","modelValue"]),a(x)&&a(x).length==0?(m(),g("div",Be,[r(Ee),p[3]||(p[3]=s("p",null,"Sin Cambio Registrados",-1))])):H("",!0),s("div",Oe,[(m(!0),g($,null,M(a(x),b=>(m(),g("div",Re,[s("div",{class:Y(["rounded-l-md text-lg font-bold uppercase",`bg-${D[b.state]}-200 p-2`])},f(b.state),3),s("div",null,[s("p",Te,f(b.statable.service),1),s("span",Fe,f(b.user.name),1)])]))),256))])]),_:1},8,["modelValue"])],64))}},Pe={class:"h-[92vh]"},Ne={class:"flex py-2 px-4 justify-between items-center"},je={class:"italic flex flex-col"},He={class:"flex gap-x-2"},Me={class:"text-xs italic"},Le=["onClick"],We={class:"text-sm font-bold uppercase"},ze={class:"text-xs italic"},Ge={class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-center",novalidate:""},Qe={class:"w-full col-span-1 md:col-span-4 flex justify-between gap-x-2 items-center"},qe={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},Je={class:"text-lg font-mono font-semibold"},Ke={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},Xe={class:"text-lg font-mono font-semibold"},Ye={key:0,class:"mt-4 w-full col-span-1 md:col-span-4 border rounded-lg"},Ze={class:"text-2xl font-mono font-semibold text-center bg-black rounded-t-lg text-white gap-x-3 p-2"},et={class:"flex justify-between gap-x-4 px-2"},tt={key:0},ot={key:1},lt={class:"flex gap-x-2"},at={class:"mt-4 w-full col-span-1 md:col-span-4 border rounded-lg"},st={class:"text-2xl font-mono font-semibold text-center bg-green-800 rounded-t-lg text-white gap-x-3 p-2"},rt={class:"grid grid-cols-6 gap-x-4 px-2"},nt={class:"flex justify-end gap-x-2 mt-4 w-full"},zt={__name:"Index",props:{bookingServices:Array},setup(F){const w=F;ge(1e3*20);const{toast:h}=Se(),x=u([]),D=u([]),y=u(""),p=u(null),b=u([]),E=u(!1),k=u(null),_=u([]),L=u([]),S=u([]),A=u(!1),V=u(null),I=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),P=u(!1),ee=[{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"adults",header:"Pasajeros",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!1,type:"date",sortable:!0},{field:"channel.name",header:"Canal de venta",filter:!0,sortable:!0},{field:"proveedors_names",header:"proveedores",class:"text-center font-semibold text-sm",filter:!0},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"RESERVADO",severity:"info",class:""},{text:"CAMBIO DE FECHA",class:"bg-gray-200 font-bold"},{text:"COMPLETADA",severity:"success",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"REUBICADO",severity:"warn",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"},{text:"PROBLEMATICA",severity:"danger",class:"animate-pulse"},{text:"SIN CONFIRMAR",severity:"danger"}]}],te=[{text:"RESERVADO",color:"blue"},{text:"CAMBIO DE FECHA",color:"gray"},{text:"NO SHOW",color:"amber"},{text:"REUBICADO",color:"orange"},{text:"CANCELADA",color:"green"},{text:"SIN CONFIRMAR",color:"red"}],oe={action:()=>{N.get(route("BookingServices.create"))}},B=u([{proveedor:null,costo:""}]),W=u([{cantidad:0,description:"",unit_price:0}]),le=T(()=>w.bookingServices.filter(l=>{if(_.value[0]==null)return V.value==null||l.status==V.value;var e=new Date(l.date).toISOString().split("T")[0];return e>=new Date(_.value[0]).toISOString().split("T")[0]&&e<=new Date(_.value[1]).toISOString().split("T")[0]&&(V.value==null||l.status==V.value)})),q=T(()=>{if(!_.value[0])return w.bookingServices;const[l,e]=_.value.map(i=>new Date(i).toISOString().split("T")[0]);return w.bookingServices.filter(i=>{const c=new Date(i.date).toISOString().split("T")[0];return c>=l&&c<=e})}),ae=T(()=>o.total/o.adults),se=T(()=>{var l=[],e=S.value.find(t=>t.id==o.service_id);if(!e)return[];for(var i of e.locks)for(var c=parseDate(i.start_date),R=parseDate(i.end_date),C=c;C<=R;C.setDate(C.getDate()+1))l.push(new Date(C));return l}),o=xe({id:"",service_id:null,date:"",adults:1,time_service:"",boys:0,cliente_name:"",cliente_phone:"",cliente_city:"",cliente_building:"",mascota:0,persona_adicional:0,cobre_transaccion:0,cobro_extra_cliente:0,reserva:0,abono:0,method_id:"",channel_id:"9d99a95f-6c3d-48fd-aa7d-6ef4e6860123",saldo:0,proveedors:[],total:0,total_real:0,percent_channel:0,observations:"",code_booking:"",extras:[]}),re=()=>{B.value.push({proveedor:null,costo:""})},ne=l=>{l!=0&&B.value.splice(l,1)},ie=()=>{W.value.push({cantidad:0,description:"",total_cost:0,unit_price:0})},de=l=>{l!=0&&W.value.splice(l,1)},z=async()=>{var l=S.value.find(e=>e.id==o.service_id);p.value=l,B.value=[{proveedor:null,costo:""}],await axios.get(route("get.provedors.service",l.slug)).then(e=>{x.value=e.data.proveedors}).catch(e=>{console.log(e)})},ue=l=>{l.costo=l.proveedor.pivot.value*o.adults},ce=[{label:"Detalles",action:async l=>{k.value=l,o.service_id=l.service_id,E.value=!0,await z()},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:async l=>{N.get(route("BookingServices.edit",l.id)),o.id=l.id;const e=(i,c)=>{const[R,C,t]=i.split("-"),[v,n]=c.split(":");return`${R}-${C}-${t},${v}:${n}`};o.date=e(l.date,l.hour),p.value=S.value.find(i=>i.id==l.service_id),o.service_id=l.service_id,o.cliente_name=l.cliente_name,o.cliente_phone=l.cliente_phone,o.cliente_city=l.cliente_city,o.cliente_building=l.cliente_building,o.adults=l.adults,o.total=l.total,o.method_id=l.method_id,o.channel_id=l.channel_id,o.saldo=l.saldo,o.proveedors=l.proveedors,o.code_booking=l.code_booking,o.time_service=l.time_service,await z(),B.value=l.proveedors.map(i=>({proveedor:x.value.filter(c=>(console.log(c.id,i.proveedor_id,c.pivot.concept,i.concept),c.id==i.proveedor_id&&c.pivot.concept==i.concept))[0],costo:i.cost})),o.observations=l.observations,k.value=l,A.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Notas",severity:"secondary",action:l=>{p.value=l,P.value=!0},badge:l=>l.notes,icon:"fa-solid fa-note-sticky text-sm"},{label:"Problematica",show:G().props.auth.user.rol=="admin",action:l=>{var e=l.problematic?"Desmarcar":"Marcar";X.fire({title:"Estas Seguro?",text:`${e} como problematica esta reservación!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${e}!`}).then(i=>{i.isConfirmed&&N.post(route("booking.problematic",l.id),{onSuccess:()=>{h("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"},{label:"Eliminar",icon:"fa-solid fa-trash text-sm",severity:"danger",show:G().props.auth.user.rol=="admin"||G().props.auth.user.rol=="superadmin",action:l=>{X.fire({title:"Estas Seguro?",text:`Eliminar la reservación de ${l.cliente_name}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, Eliminar!"}).then(e=>{e.isConfirmed&&N.delete(route("BookingServices.destroy",l.id),{onSuccess:()=>{h("success","Reserva Eliminada")}})})}}],me=u(!1),O=u([]),pe=l=>{O.value=l};return(l,e)=>{const i=we,c=Ve,R=_e,C=ye;return m(),g($,null,[r(he,{title:"Reservas"},{default:U(()=>[e[31]||(e[31]=s("div",{class:"hidden bg-amber-200 bg-orange-200 bg-blue-200 !bg-green-200 !bg-gray-200 !bg-orange-200 !bg-amber-200"},null,-1)),s("div",Pe,[s("div",Ne,[s("div",je,[e[23]||(e[23]=s("h1",{class:"text-2xl font-bold"},"Reservas",-1)),r(Ie)]),s("div",He,[s("div",{class:"p-2 bg-black text-white text-center rounded-lg cursor-pointer transition-all duration-300 scale-95 hover:scale-100",onClick:e[0]||(e[0]=t=>V.value=null)},[e[24]||(e[24]=s("p",{class:"text-sm font-bold uppercase"},"Todos",-1)),s("p",Me,f(O.value.length)+" Reservas | "+f(O.value.reduce((t,v)=>t+v.adults,0))+" Pasajeros ",1)]),(m(),g($,null,M(te,t=>s("div",{onClick:v=>q.value.filter(n=>n.status==t.text).length!=0?V.value=t.text:null,class:Y(["flex flex-col items-center transition-all duration-300",[`bg-${t.color}-200 p-2 rounded-lg`,V.value==t.text?"border-2 border-gray-500 scale-105":"border-2 border-transparent scale-95",q.value.filter(v=>v.status==t.text).length==0?"cursor-not-allowed opacity-55":"cursor-pointer hover:scale-105 hover:border-2 hover:border-gray-500"]])},[s("p",We,f(t.text),1),s("p",ze,f(O.value.filter(v=>v.status==t.text).length)+" Reservas | "+f(O.value.filter(v=>v.status==t.text).reduce((v,n)=>v+n.adults,0))+" Pasajeros ",1)],10,Le)),64))]),Q(r(i,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),selectionMode:"range",dateFormat:"dd/mm/yy",manualInput:!1},null,8,["modelValue"]),[[C,"Filtrar fecha de Actividad",void 0,{bottom:!0}]])]),r(Ce,{actions:ce,add:oe,showButtonBar:"",columnas:ee,data:le.value,routecreate:"services.create",rowClass:!0,onFilterApply:pe},null,8,["data"])]),r(Z,{modelValue:A.value,"onUpdate:modelValue":e[20]||(e[20]=t=>A.value=t),title:"Añadir Reserva",width:"70vw"},{footer:U(()=>[s("div",nt,[r(c,{onClick:e[19]||(e[19]=t=>A.value=!1),severity:"danger",label:"Cancelar",loading:me.value},null,8,["loading"]),a(o).id?(m(),j(c,{key:0,type:"submit",label:"Actualizar",severity:"warn",onClick:l.update},null,8,["onClick"])):(m(),j(c,{key:1,type:"submit",severity:"success",label:"Guardar",onClick:l.reservar},null,8,["onClick"]))])]),default:U(()=>[s("form",Ge,[r(d,{class:"col-span-3",type:"dropdown",modelValue:a(o).service_id,"onUpdate:modelValue":e[2]||(e[2]=t=>a(o).service_id=t),"error-message":a(o).errors.service_id,label:"Servicio","option-label":"title","option-value":"id",options:S.value,onValueChange:z},null,8,["modelValue","error-message","options"]),r(d,{label:"Codigo de Reserva",modelValue:a(o).code_booking,"onUpdate:modelValue":e[3]||(e[3]=t=>a(o).code_booking=t),"error-message":a(o).errors.code_booking},null,8,["modelValue","error-message"]),r(d,{label:"Fecha de Reserva",enableTimePicker:!0,"disabled-dates":se.value,modelValue:a(o).date,"onUpdate:modelValue":e[4]||(e[4]=t=>a(o).date=t),required:"",class:"w-full",type:"datetime"},null,8,["disabled-dates","modelValue"]),r(d,{label:"Valor Total",type:"number",mode:"currency",modelValue:a(o).total,"onUpdate:modelValue":e[5]||(e[5]=t=>a(o).total=t)},null,8,["modelValue"]),r(d,{label:"Tiempo del Servicio",type:"dropdown",modelValue:a(o).time_service,"onUpdate:modelValue":e[6]||(e[6]=t=>a(o).time_service=t),options:["20 Minutos","30 Minutos","40 Minutos","1 Hora","2 Horas","6 Horas","12 Horas","24 Horas"]},null,8,["modelValue"]),r(d,{label:"Pasajeros",type:"number",modelValue:a(o).adults,"onUpdate:modelValue":e[7]||(e[7]=t=>a(o).adults=t)},null,8,["modelValue"]),r(d,{label:"Niños",type:"number",modelValue:a(o).boys,"onUpdate:modelValue":e[8]||(e[8]=t=>a(o).boys=t)},null,8,["modelValue"]),r(d,{label:"Nombre del Pasajero",modelValue:a(o).cliente_name,"onUpdate:modelValue":e[9]||(e[9]=t=>a(o).cliente_name=t),"error-message":a(o).errors.cliente_name,class:"w-full"},null,8,["modelValue","error-message"]),r(d,{label:"Telefono",modelValue:a(o).cliente_phone,"onUpdate:modelValue":e[10]||(e[10]=t=>a(o).cliente_phone=t),"error-message":a(o).errors.cliente_phone,class:"w-full",type:"number"},null,8,["modelValue","error-message"]),r(d,{label:"Ciudad de donde Proviene",modelValue:a(o).cliente_city,"onUpdate:modelValue":e[11]||(e[11]=t=>a(o).cliente_city=t),"error-message":a(o).errors.city,class:"w-full"},null,8,["modelValue","error-message"]),r(d,{label:"Edificio u Hotel",class:"w-full",modelValue:a(o).cliente_building,"onUpdate:modelValue":e[12]||(e[12]=t=>a(o).cliente_building=t),"error-message":a(o).errors.cliente_building},null,8,["modelValue","error-message"]),r(d,{class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:L.value,modelValue:a(o).method_id,"onUpdate:modelValue":e[13]||(e[13]=t=>a(o).method_id=t),label:"Medio de Pago"},null,8,["options","modelValue"]),r(d,{class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:b.value,modelValue:a(o).channel_id,"onUpdate:modelValue":e[14]||(e[14]=t=>a(o).channel_id=t),label:"Canal de Venta"},null,8,["options","modelValue"]),r(d,{class:"w-full",label:"Saldo",modelValue:a(o).saldo,"onUpdate:modelValue":e[15]||(e[15]=t=>a(o).saldo=t),"error-message":a(o).errors.saldo,min:"0",type:"number",mode:"currency"},null,8,["modelValue","error-message"]),r(d,{class:"w-full col-span-1 md:col-span-4","rows-textarea":2,label:"Observaciones",modelValue:a(o).observations,"onUpdate:modelValue":e[16]||(e[16]=t=>a(o).observations=t),"error-message":a(o).errors.observations,type:"textarea"},null,8,["modelValue","error-message"]),s("div",Qe,[s("div",qe,[s("p",Je,f(a(I).format(ae.value)),1),e[25]||(e[25]=s("p",{class:"italic text-md"},"Valor Pasajero",-1))]),s("div",Ke,[s("p",Xe,f(a(I).format(l.valorReal)),1),e[26]||(e[26]=s("p",{class:"italic text-md"},"Valor Real",-1))])]),p.value?(m(),g("div",Ye,[s("h1",Ze,[e[27]||(e[27]=K(" Proveedores ")),r(c,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:e[17]||(e[17]=t=>re())})]),e[28]||(e[28]=s("div",{class:"flex justify-between w-full font-bold px-2"},[s("label",{for:""},"Proveedor"),s("label",{for:""},"Costo"),s("label",{for:""},".")],-1)),(m(!0),g($,null,M(B.value,(t,v)=>(m(),g("div",et,[r(R,{options:x.value,onValueChange:n=>ue(t),modelValue:t.proveedor,"onUpdate:modelValue":n=>t.proveedor=n,placeholder:"Selecciona un proveedor",class:"w-full","option-label":"nombre"},{value:U(n=>[n.value?(m(),g("span",tt,f(n.value.nombre)+" - "+f(n.value.pivot.concept),1)):(m(),g("span",ot,f(n.placeholder),1))]),option:U(n=>[s("div",lt,[s("span",null,f(n.option.nombre)+" - ",1),s("span",null,f(n.option.pivot.concept)+" - ",1),s("span",null,f(n.option.pivot.value),1)])]),_:2},1032,["options","onValueChange","modelValue","onUpdate:modelValue"]),r(d,{type:"number",mode:"currency",class:"w-full",modelValue:t.costo,"onUpdate:modelValue":n=>t.costo=n},null,8,["modelValue","onUpdate:modelValue"]),Q(r(c,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:n=>ne(v)},null,8,["onClick"]),[[C,"Quitar"]])]))),256))])):H("",!0),s("div",at,[s("h1",st,[e[29]||(e[29]=K(" Cargos Extras ")),r(c,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:e[18]||(e[18]=t=>ie())})]),e[30]||(e[30]=s("div",{class:"grid grid-cols-6 w-full font-bold px-2 gap-x-4"},[s("label",{for:"",class:"col-span-1"},"Cantidad"),s("label",{for:"",class:"col-span-2"},"Descripción"),s("label",{for:"",class:"col-span-2"},"Precio Unitario"),s("label",{for:""})],-1)),(m(!0),g($,null,M(W.value,(t,v)=>(m(),g("div",rt,[r(d,{type:"number",modelValue:t.cantidad,"onUpdate:modelValue":n=>t.cantidad=n,class:"w-full col-span-1"},null,8,["modelValue","onUpdate:modelValue"]),r(d,{type:"text",class:"w-full col-span-2",modelValue:t.description,"onUpdate:modelValue":n=>t.description=n},null,8,["modelValue","onUpdate:modelValue"]),r(d,{type:"number",mode:"currency",class:"w-full col-span-2",modelValue:t.unit_price,"onUpdate:modelValue":n=>t.unit_price=n},null,8,["modelValue","onUpdate:modelValue"]),Q(r(c,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:n=>de(v)},null,8,["onClick"]),[[C,"Quitar"]])]))),256))])])]),_:1},8,["modelValue"]),r(a(ke)),k.value?(m(),j(De,{key:0,modelValue:E.value,"onUpdate:modelValue":e[21]||(e[21]=t=>E.value=t),service:k.value,proveedors:x.value},null,8,["modelValue","service","proveedors"])):H("",!0)]),_:1}),P.value?(m(),j(Ae,{key:0,modelValue:P.value,"onUpdate:modelValue":e[22]||(e[22]=t=>P.value=t),notes:D.value,note:y.value,service:p.value},null,8,["modelValue","notes","note","service"])):H("",!0)],64)}}};export{zt as default};
