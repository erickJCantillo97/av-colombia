import{d as g,x as Ve,y,z as Z,A as I,Q as Ce,B as H,q as ee,o as u,c as Q,w as D,a as e,b as n,C as b,u as s,D as v,g as _,t as a,f as p,h as te,F as W,i as G,k as $,j as Ae,n as Se,E as ke}from"./app-lYd7fg3N.js";import{_ as De,s as $e}from"./AppLayout-B4P9BEAw.js";import{s as Pe}from"./index-BxFn0FAj.js";import{_ as je}from"./Datatable-CNa7-CFj.js";import{_ as c}from"./Input-DEw2vIwp.js";import{_ as Ee}from"./Modal-xOGPC1hl.js";import{s as Ue}from"./index-LW1hhjLE.js";import{S as J,a as Be}from"./toasts-DRkOXQyQ.js";import{u as Ne}from"./vee-validate-CgPU_Zrd.js";import"./index-xXLvzUNP.js";import"./index-DlIxCV8R.js";import"./index-B1LbuPaw.js";import"./index-BmsI1xlC.js";import"./postcss-BAw0pYSt.js";const Oe={class:"h-[99vh]"},qe={class:""},Fe={class:"text-xl font-mono font-semibold"},Te={key:2,class:"mt-4 w-full col-sapn-1 md:col-span-3 border rounded-lg"},Me={class:"text-2xl font-mono font-semibold text-center bg-black rounded-t-lg text-white gap-x-3 p-2"},Re=e("div",{class:"flex justify-between w-full font-bold px-2"},[e("label",{for:""},"Proveedor"),e("label",{for:""},"Costo"),e("label",{for:""},".")],-1),ze={class:"flex justify-between gap-x-4 px-2"},Le={class:"flex justify-end mt-4 w-full col-sapn-1 md:col-span-3"},Ie={class:"flex items-center gap-2"},He={class:"font-bold text-lg"},Qe={class:"flex flex-col gap-y-1.5 text-sm"},We={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ge=e("strong",null,"Fecha del Servicio:",-1),Je={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ke=e("strong",null,"Hora del Servicio:",-1),Xe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ye=e("strong",null,"Cliente:",-1),Ze={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},et=e("strong",null,"Ciudad:",-1),tt={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},ot=e("strong",null,"Telelfono:",-1),lt=["href"],st={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},rt=e("strong",null,"Edificio:",-1),at={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},nt=e("strong",null,"Adultos:",-1),it={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},dt=e("strong",null,"Niños:",-1),ut={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},ct=e("strong",null,"Valor:",-1),mt={key:0,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},vt=e("strong",null,"Vendedor:",-1),pt={key:1,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},ft=e("strong",null,"Fecha de reserva:",-1),bt={key:2,class:"text-lg flex w-full justify-between mt-2"},gt=e("p",{class:"font-bold"}," Proveedores ",-1),_t={class:"rounded-full bg-black text-white px-2"},ht={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},yt={class:"flex flex-col gap-y-2 mt-2"},xt={class:"flex justify-between"},wt=e("h2",{class:"text-xl font-bold"},"Pagos Realizados ",-1),Vt={class:"bg-blue-600 text-white p-1 rounded-lg"},Ct={class:"flex items-center text-xs justify-between border shadow-xl rounded-md p-1 bg-white"},At={class:"uppercase font-bold"},St=e("div",null,null,-1),kt={class:"flex flex-col items-center gap-2"},Dt={class:"font-bold text-center"},$t={key:0,class:"flex gap-x-2"},Jt={__name:"Index",props:{bookingServices:Array},setup(oe){const{toast:M}=Be(),P=g(!1),r=g({}),x=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),S=g(!1),le={action:()=>{S.value=!0}},K=g([]),se=Ve({service_id:y().required(),date:Z().required(),adults:I().required(),date:Z().required(),adults:I().required(),cliente_name:y().required(),cliente_phone:y().required(),cliente_city:y().required(),cliente_building:y().required(),hour:y().required(),abono:I().required(),method:y().required()}),{values:re,defineField:m,errors:f,meta:Pt}=Ne({validationSchema:se}),[w,ae]=m("service_id"),[j,ne]=m("date"),[V,jt]=m("boys"),[C,Et]=m("adults"),[E,ie]=m("cliente_name"),[U,de]=m("cliente_phone"),[B,ue]=m("cliente_city"),[N,ce]=m("cliente_building"),[O,me]=m("hour"),[R,ve]=m("abono"),[z,pe]=m("method");V.value=0,C.value=1;const q=g([{proveedor:null,costo:""}]),F=g([]),fe=()=>{axios.get(route("get.services")).then(t=>{F.value=t.data.services.slice(0,5)})},be=()=>{q.value.push({proveedor:null,costo:""})},ge=t=>{t!=0&&q.value.splice(t,1)},X=g([]);(()=>{axios.get(route("proveedors.index")).then(t=>{X.value=t.data.proveedors}).catch(t=>{console.log(t)})})(),fe();const _e=[{label:"Detalles",action:t=>{r.value=t,P.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:t=>{j.value=t.date,w.value=t.service_id,C.value=t.adults,V.value=t.boys,E.value=t.cliente_name,U.value=t.cliente_phone,B.value=t.cliente_city,N.value=t.cliente_building,O.value=t.hour,r.value=t,S.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Problematica",show:Ce().props.auth.user.rol=="admin",action:t=>{var o=t.problematic?"Desmarcar":"Marcar";J.fire({title:"Estas Seguro?",text:`${o} como problematica esta reservación!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${o}!`}).then(d=>{d.isConfirmed&&H.post(route("booking.problematic",t.id),{onSuccess:()=>{M("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"}],he=[{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service.title",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!0,sortable:!0,type:"date"},{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"problematic",header:"Problematica",filter:!0,sortable:!0,type:"boolean"},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"COMPLETADA",severity:"success",class:""},{text:"DISEÑO",severity:"info",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"SERVICIO POSTVENTA",severity:"success",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"}]}],ye=ee(()=>{let t=F.value.find(o=>o.id==w.value);return t?t.adult_tarifa*C.value+t.boy_tarifa*V.value:0}),L=g(!1),xe=t=>{t.preventDefault(),L.value=!0,H.post(route("reservar",{proveedors:q.value}),re,{onSuccess:()=>{L.value=!1,S.value=!1,M("success","Reserva creada con exito")}})};(()=>{axios.get(route("paymentMethods.index")).then(t=>{K.value=t.data}).catch(t=>{console.log(t)})})();const Y=t=>{const[o,d,k]=t.split("-");return new Date(o,d-1,k)},we=ee(()=>{var t=[],o=F.value.find(i=>i.id==w.value);if(!o)return[];for(var d of o.locks)for(var k=Y(d.start_date),h=Y(d.end_date),l=k;l<=h;l.setDate(l.getDate()+1))t.push(new Date(l));return t}),T=(t,o)=>{J.fire({title:t,text:"Estas seguro de realizar esta acción?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si"}).then(d=>{d.isConfirmed&&(J.fire({title:t,text:"Esta reserva ha sido "+t+".",icon:"success"}),H.post(route("set.states"),{service:r.value.id,state:t,terminated:o},{onSuccess:()=>{P.value=!1,M("success","Reserva "+t)}}))})};return(t,o)=>{const d=Pe,k=$e,h=ke;return u(),Q(De,{title:"Services"},{default:D(()=>[e("div",Oe,[n(je,{actions:_e,add:le,columnas:he,data:oe.bookingServices,routecreate:"services.create",title:"Reservas"},null,8,["data"])]),n(Ee,{modelValue:S.value,"onUpdate:modelValue":o[12]||(o[12]=l=>S.value=l),title:"Añadir Reserva",width:"70vw"},{default:D(()=>[e("form",{onSubmit:Ae(xe,["prevent"]),class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",novalidate:""},[n(c,b({type:"dropdown",modelValue:s(w),"onUpdate:modelValue":o[0]||(o[0]=l=>v(w)?w.value=l:null),"error-message":s(f).service_id,label:"Servicio","option-label":"title","option-value":"id",options:F.value},s(ae)),null,16,["modelValue","error-message","options"]),n(c,b({label:"Fecha de Reserva","disabled-dates":we.value,modelValue:s(j),"onUpdate:modelValue":o[1]||(o[1]=l=>v(j)?j.value=l:null),required:"","min-date":new Date,class:"w-full",type:"date","error-message":t.errorDate},s(ne)),null,16,["disabled-dates","modelValue","min-date","error-message"]),n(c,{label:"Pasajeros",type:"number",modelValue:s(C),"onUpdate:modelValue":o[2]||(o[2]=l=>v(C)?C.value=l:null)},null,8,["modelValue"]),n(c,{label:"Niños",type:"number",modelValue:s(V),"onUpdate:modelValue":o[3]||(o[3]=l=>v(V)?V.value=l:null)},null,8,["modelValue"]),n(c,b({label:"Nombre del Pasajero"},s(ie),{modelValue:s(E),"onUpdate:modelValue":o[4]||(o[4]=l=>v(E)?E.value=l:null),"error-message":s(f).cliente_name,class:"w-full"}),null,16,["modelValue","error-message"]),n(c,b({label:"Telefono",modelValue:s(U),"onUpdate:modelValue":o[5]||(o[5]=l=>v(U)?U.value=l:null)},s(de),{"error-message":s(f).cliente_phone,class:"w-full",type:"number"}),null,16,["modelValue","error-message"]),n(c,b({label:"Ciudad de donde Proviene"},s(ue),{modelValue:s(B),"onUpdate:modelValue":o[6]||(o[6]=l=>v(B)?B.value=l:null),"error-message":s(f).city,class:"w-full"}),null,16,["modelValue","error-message"]),n(c,b({label:"Edificio u Hotel",class:"w-full"},s(ce),{modelValue:s(N),"onUpdate:modelValue":o[7]||(o[7]=l=>v(N)?N.value=l:null),"error-message":s(f).cliente_building}),null,16,["modelValue","error-message"]),n(c,b({type:"time",label:"Hora de Actividad",class:"w-full"},s(me),{modelValue:s(O),"onUpdate:modelValue":o[8]||(o[8]=l=>v(O)?O.value=l:null),"error-message":s(f).hour}),null,16,["modelValue","error-message"]),t.$page.props.auth.user.rol=="admin"?(u(),Q(c,b({key:0,class:"w-full",label:"Abono"},s(ve),{modelValue:s(R),"onUpdate:modelValue":o[9]||(o[9]=l=>v(R)?R.value=l:null),"error-message":s(f).abono,min:"1",type:"number"}),null,16,["modelValue","error-message"])):_("",!0),t.$page.props.auth.user.rol=="admin"?(u(),Q(c,b({key:1,class:"w-full",min:"0"},s(pe),{type:"dropdown","option-label":"name","option-value":"id",options:K.value,modelValue:s(z),"onUpdate:modelValue":o[10]||(o[10]=l=>v(z)?z.value=l:null),label:"Medio de Pago"}),null,16,["options","modelValue"])):_("",!0),e("div",qe,[e("h1",Fe," Precio total: "+a(s(x).format(ye.value)),1)]),t.$page.props.auth.user.rol=="admin"?(u(),p("div",Te,[e("h1",Me,[te(" Proveedores "),n(d,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:o[11]||(o[11]=l=>be())})]),Re,(u(!0),p(W,null,G(q.value,(l,i)=>(u(),p("div",ze,[n(c,{type:"dropdown",modelValue:l.proveedor,"onUpdate:modelValue":A=>l.proveedor=A,"error-message":s(f).proveedor,"option-label":"nombre","option-value":"id",class:"w-full",options:X.value},null,8,["modelValue","onUpdate:modelValue","error-message","options"]),n(c,{type:"number",mode:"currency",class:"w-full",modelValue:l.costo,"onUpdate:modelValue":A=>l.costo=A,"error-message":s(f).costo},null,8,["modelValue","onUpdate:modelValue","error-message"]),$(n(d,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:A=>ge(i)},null,8,["onClick"]),[[h,"Quitar"]])]))),256))])):_("",!0),e("div",Le,[n(d,{type:"submit",severity:"success",label:"Guardar",loading:L.value},null,8,["loading"])])],32)]),_:1},8,["modelValue"]),n(s(Ue)),n(k,{visible:P.value,"onUpdate:visible":o[17]||(o[17]=l=>P.value=l),"pt:root:class":"!bg-blue-100",header:"Detalles de la actividad",position:"right"},{header:D(()=>[e("div",Ie,[e("span",He,a(r.value.service.title),1)])]),footer:D(()=>[e("div",kt,[e("h1",Dt,"Saldo: "+a(s(x).format(r.value.total_price-r.value.payments.reduce((l,i)=>l+i.amount,0))),1),t.$page.props.auth.user.rol=="admin"?(u(),p("div",$t,[$(n(d,{onClick:o[13]||(o[13]=l=>T("COMPLETADA",!0)),icon:"fa-solid fa-circle-check",text:"",size:"large",class:"flex-auto",severity:"success"},null,512),[[h,"Completar Servicio",void 0,{top:!0}]]),$(n(d,{onClick:o[14]||(o[14]=l=>T("NO SHOW",!0)),icon:"fa-solid fa-eye-slash",text:"",size:"large",class:"flex-auto",severity:"warn"},null,512),[[h,"Servicio No show",void 0,{top:!0}]]),$(n(d,{onClick:o[15]||(o[15]=l=>T("CANCELADA",!0)),icon:"fa-solid fa-xmark-circle",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[h,"Cancelar Servicio",void 0,{top:!0}]]),$(n(d,{onClick:o[16]||(o[16]=l=>T("PROBLEMATICA",!1)),icon:"fa-solid fa-person-dress-burst",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[h,"Servicio Problematico",void 0,{top:!0}]])])):_("",!0)])]),default:D(()=>{var l;return[e("div",Qe,[e("div",We,[Ge,e("p",null,a(r.value.date),1)]),e("div",Je,[Ke,e("p",null,a(r.value.hour),1)]),e("div",Xe,[Ye,e("p",null,a(r.value.cliente_name),1)]),e("div",Ze,[et,e("p",null,a(r.value.cliente_city),1)]),e("div",tt,[ot,e("a",{href:`tel://${r.value.cliente_phone}`},a(r.value.cliente_phone),9,lt)]),e("div",st,[rt,e("p",null,a(r.value.cliente_building),1)]),e("div",at,[nt,e("p",null,a(r.value.adults),1)]),e("div",it,[dt,e("p",null,a(r.value.boys),1)]),e("div",ut,[ct,e("p",null,a(s(x).format(r.value.total_price)),1)]),r.value.user?(u(),p("div",mt,[vt,e("p",null,a((l=r.value.user)==null?void 0:l.name),1)])):_("",!0),r.value.user?(u(),p("div",pt,[ft,e("p",null,a(new Date(r.value.created_at).toLocaleDateString("es-CO")),1)])):_("",!0),t.$page.props.auth.user.rol=="admin"?(u(),p("div",bt,[gt,e("p",_t,a(r.value.proveedors.length),1)])):_("",!0),t.$page.props.auth.user.rol=="admin"?(u(!0),p(W,{key:3},G(r.value.proveedors,i=>(u(),p("div",ht,[e("p",null,a(i.proveedor.nombre),1),e("p",null,a(s(x).format(i.cost)),1)]))),256)):_("",!0),e("div",yt,[e("div",xt,[wt,e("div",Vt,a(s(x).format(r.value.payments.reduce((i,A)=>i+A.amount,0))),1)]),(u(!0),p(W,null,G(r.value.payments,i=>(u(),p("div",Ct,[e("div",null,[e("div",At,a(i.type)+" "+a(s(x).format(i.amount)),1),e("div",null,a(new Date(i.created_at).toLocaleDateString("es-CO"))+" "+a(i.metohd_payment.name),1)]),e("div",{class:Se(["uppercase",i.status=="pendiente"?"bg-red-500 p-1 text-white rounded-lg shadow-md shadow-red-500":""])},[te(a(i.status)+" ",1),St],2)]))),256))])])]}),_:1},8,["visible"])]),_:1})}}};export{Jt as default};
