import{d as f,T as ee,Q as te,x as M,q as A,y as oe,o as c,c as C,w as y,a as e,b as i,u as a,h as U,t as r,g as v,f as m,F as T,i as O,k,n as le,z as se}from"./app-DcKkdd7B.js";import{_ as ae,s as re}from"./AppLayout-CfaWLqnS.js";import{s as ne}from"./index-GIOzZJbj.js";import{_ as ie}from"./Datatable-DtLPD3WH.js";import{_ as p}from"./Input-CFPt19Rw.js";import{_ as de}from"./Modal-B7C0T8B3.js";import{s as ue}from"./index-2v3DTnTT.js";import{S as B,a as ce}from"./toasts-DRkOXQyQ.js";import"./index-CN-yxE0C.js";import"./index-De4NZYjZ.js";import"./index-wHY618X2.js";import"./index-BZka6Sip.js";import"./postcss-D_olGDFz.js";const pe={class:"h-[99vh]"},me={class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-center",novalidate:""},ve={class:"w-full col-span-1 md:col-span-4 flex justify-between gap-x-2 items-center"},fe={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},_e={class:"text-lg font-mono font-semibold"},be=e("p",{class:"italic text-md"}," Valor Pasajero ",-1),ge={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},he={class:"text-lg font-mono font-semibold"},xe=e("p",{class:"italic text-md"}," Valor Real ",-1),ye={key:4,class:"mt-4 w-full col-sapn-1 md:col-span-4 border rounded-lg"},we={class:"text-2xl font-mono font-semibold text-center bg-black rounded-t-lg text-white gap-x-3 p-2"},Ve=e("div",{class:"flex justify-between w-full font-bold px-2"},[e("label",{for:""},"Proveedor"),e("label",{for:""},"Costo"),e("label",{for:""},".")],-1),Ce={class:"flex justify-between gap-x-4 px-2"},ke={class:"flex justify-end gap-x-2 mt-4 w-full"},Se={class:"flex items-center gap-2"},je={class:"font-bold text-lg"},De={class:"flex flex-col gap-y-1.5 text-sm"},Pe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},$e=e("strong",null,"Fecha del Servicio:",-1),Ee={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ae=e("strong",null,"Hora del Servicio:",-1),Ue={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Te=e("strong",null,"Canal de Venta:",-1),Oe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Be=e("strong",null,"Cliente:",-1),Ne={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Re=e("strong",null,"Ciudad:",-1),Fe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Me=e("strong",null,"Telelfono:",-1),ze=["href"],Le={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ie=e("strong",null,"Edificio:",-1),He={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Qe=e("strong",null,"Adultos:",-1),qe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},We=e("strong",null,"Niños:",-1),Ge={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Je=e("strong",null,"Mascota:",-1),Ke={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Xe=e("strong",null,"Total:",-1),Ye={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ze=e("strong",null,"Total Real:",-1),et={key:0,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},tt=e("strong",null,"Vendedor:",-1),ot={key:1,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},lt=e("strong",null,"Fecha de reserva:",-1),st={key:2,class:"text-lg flex w-full justify-between mt-2"},at=e("p",{class:"font-bold"}," Proveedores ",-1),rt={class:"rounded-full bg-black text-white px-2"},nt={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},it={class:"flex flex-col gap-y-2 mt-2"},dt={class:"flex justify-between"},ut=e("h2",{class:"text-xl font-bold"},"Pagos Realizados ",-1),ct={class:"bg-blue-600 text-white p-1 rounded-lg"},pt={class:"flex items-center text-xs justify-between border shadow-xl rounded-md p-1 bg-white"},mt={class:"uppercase font-bold"},vt=e("div",null,null,-1),ft={class:"flex flex-col items-center gap-2"},_t={class:"font-bold text-center"},bt={key:0,class:"flex gap-x-2"},At={__name:"Index",props:{bookingServices:Array},setup(z){const{toast:S}=ce(),j=f(!1),n=f({}),_=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),h=f(!1),L={action:()=>{l.reset(),h.value=!0}},N=f([]),l=ee({service_id:null,date:"",adults:1,boys:0,cliente_name:"",cliente_phone:"",cliente_city:"",cliente_building:"",mascota:0,persona_adicional:0,cobre_transaccion:0,cobro_extra_cliente:0,reserva:0,abono:0,method_id:"",channel_id:"",percent_descuento:0,proveedors:[],total:0,total_real:0,percent_channel:0,observations:""}),x=f([{proveedor:null,costo:""}]),E=f([]),I=()=>{axios.get(route("get.services")).then(t=>{E.value=t.data.services})},H=()=>{x.value.push({proveedor:null,costo:""})},Q=t=>{t!=0&&x.value.splice(t,1)},D=f([]),P=f([]),q=()=>{axios.get(route("get.proveedors",l.service_id)).then(t=>{D.value=t.data.proveedors}).catch(t=>{console.log(t)})},W=t=>{t.costo=D.value.find(o=>o.id==t.proveedor).pivot.value*l.adults},G=()=>{axios.get(route("channels.index")).then(t=>{P.value=t.data}).catch(t=>{console.log(t)})};I(),G();const J=[{label:"Detalles",action:t=>{n.value=t,j.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:t=>{l.service_id=t.service_id,l.cliente_name=t.cliente_name,l.cliente_phone=t.cliente_phone,l.cliente_city=t.cliente_city,l.cliente_building=t.cliente_building,l.adults=t.adults,l.total=t.total,l.method_id=t.method_id,l.channel_id=t.channel_id,l.percent_descuento=t.percent_descuento,l.proveedors=t.proveedors,x.value=t.proveedors,l.observations=t.observations,n.value=t,h.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Problematica",show:te().props.auth.user.rol=="admin",action:t=>{var o=t.problematic?"Desmarcar":"Marcar";B.fire({title:"Estas Seguro?",text:`${o} como problematica esta reservación!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${o}!`}).then(d=>{d.isConfirmed&&M.post(route("booking.problematic",t.id),{onSuccess:()=>{S("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"}],K=[{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service.title",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!0,sortable:!0,type:"date"},{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"problematic",header:"Problematica",filter:!0,sortable:!0,type:"boolean"},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"COMPLETADA",severity:"success",class:""},{text:"DISEÑO",severity:"info",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"SERVICIO POSTVENTA",severity:"success",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"}]}],X=A(()=>l.total/l.adults),R=A(()=>{let t=P.value.find(d=>d.id==l.channel_id),o=t?t.percent/100:0;return l.total-l.total*o}),w=f(!1),Y=t=>{t.preventDefault(),l.total_real=R.value,l.percent_channel=P.value.find(o=>o.id==l.channel_id).percent,w.value=!0,l.proveedors=x.value,l.post(route("reservar"),{onSuccess:()=>{w.value=!1,h.value=!1,S("success","Reserva creada con exito")},onError:()=>{w.value=!1,S("error","Error al crear la reserva")}})};(()=>{axios.get(route("paymentMethods.index")).then(t=>{N.value=t.data}).catch(t=>{console.log(t)})})();const F=t=>{const[o,d,V]=t.split("-");return new Date(o,d-1,V)},Z=A(()=>{var t=[],o=E.value.find(u=>u.id==l.service_id);if(!o)return[];for(var d of o.locks)for(var V=F(d.start_date),b=F(d.end_date),s=V;s<=b;s.setDate(s.getDate()+1))t.push(new Date(s));return t}),$=(t,o)=>{B.fire({title:t,text:"Estas seguro de realizar esta acción?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si"}).then(d=>{d.isConfirmed&&(B.fire({title:t,text:"Esta reserva ha sido "+t+".",icon:"success"}),M.post(route("set.states"),{service:n.value.id,state:t,terminated:o},{onSuccess:()=>{j.value=!1,S("success","Reserva "+t)}}))})};return oe(l.adults,t=>{for(var o of x.value)o.proveedor&&(o.costo=D.value.find(d=>d.id==o.proveedor).pivot.value*t)}),(t,o)=>{const d=ne,V=re,b=se;return c(),C(ae,{title:"Services"},{default:y(()=>[e("div",pe,[i(ie,{actions:J,add:L,columnas:K,data:z.bookingServices,routecreate:"services.create",title:"Reservas"},null,8,["data"])]),i(de,{modelValue:h.value,"onUpdate:modelValue":o[15]||(o[15]=s=>h.value=s),title:"Añadir Reserva",width:"70vw"},{footer:y(()=>[e("div",ke,[i(d,{onClick:o[14]||(o[14]=s=>h.value=!1),severity:"danger",label:"Cancelar",loading:w.value},null,8,["loading"]),i(d,{type:"submit",severity:"success",label:"Guardar",loading:w.value,onClick:Y},null,8,["loading"])])]),default:y(()=>[e("form",me,[i(p,{type:"dropdown",modelValue:a(l).service_id,"onUpdate:modelValue":o[0]||(o[0]=s=>a(l).service_id=s),"error-message":a(l).errors.service_id,label:"Servicio","option-label":"title","option-value":"id",onValueChange:q,options:E.value},null,8,["modelValue","error-message","options"]),i(p,{label:"Fecha de Reserva",enableTimePicker:!0,"disabled-dates":Z.value,modelValue:a(l).date,"onUpdate:modelValue":o[1]||(o[1]=s=>a(l).date=s),required:"","min-date":new Date,class:"w-full",type:"date"},null,8,["disabled-dates","modelValue","min-date"]),i(p,{label:"Valor Total",type:"number",mode:"currency",modelValue:a(l).total,"onUpdate:modelValue":o[2]||(o[2]=s=>a(l).total=s)},null,8,["modelValue"]),i(p,{label:"Pasajeros",type:"number",modelValue:a(l).adults,"onUpdate:modelValue":o[3]||(o[3]=s=>a(l).adults=s)},null,8,["modelValue"]),i(p,{label:"Niños",type:"number",modelValue:a(l).boys,"onUpdate:modelValue":o[4]||(o[4]=s=>a(l).boys=s)},null,8,["modelValue"]),i(p,{label:"Nombre del Pasajero",modelValue:a(l).cliente_name,"onUpdate:modelValue":o[5]||(o[5]=s=>a(l).cliente_name=s),"error-message":a(l).errors.cliente_name,class:"w-full"},null,8,["modelValue","error-message"]),i(p,{label:"Telefono",modelValue:a(l).cliente_phone,"onUpdate:modelValue":o[6]||(o[6]=s=>a(l).cliente_phone=s),"error-message":a(l).errors.cliente_phone,class:"w-full",type:"number"},null,8,["modelValue","error-message"]),i(p,{label:"Ciudad de donde Proviene",modelValue:a(l).cliente_city,"onUpdate:modelValue":o[7]||(o[7]=s=>a(l).cliente_city=s),"error-message":a(l).errors.city,class:"w-full"},null,8,["modelValue","error-message"]),i(p,{label:"Edificio u Hotel",class:"w-full",modelValue:a(l).cliente_building,"onUpdate:modelValue":o[8]||(o[8]=s=>a(l).cliente_building=s),"error-message":a(l).errors.cliente_building},null,8,["modelValue","error-message"]),U(" "+r(a(l).method)+" ",1),t.$page.props.auth.user.rol=="admin"?(c(),C(p,{key:0,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:N.value,modelValue:a(l).method_id,"onUpdate:modelValue":o[9]||(o[9]=s=>a(l).method_id=s),label:"Medio de Pago"},null,8,["options","modelValue"])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(),C(p,{key:1,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:P.value,modelValue:a(l).channel_id,"onUpdate:modelValue":o[10]||(o[10]=s=>a(l).channel_id=s),label:"Canal de Venta"},null,8,["options","modelValue"])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(),C(p,{key:2,class:"w-full",label:"Descuento",modelValue:a(l).percent_descuento,"onUpdate:modelValue":o[11]||(o[11]=s=>a(l).percent_descuento=s),"error-message":a(l).errors.percent_descuento,min:"0",max:"100",type:"number",suffix:" %"},null,8,["modelValue","error-message"])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(),C(p,{key:3,class:"w-full col-span-1 md:col-span-4","rows-textarea":2,label:"Observaciones",modelValue:a(l).observations,"onUpdate:modelValue":o[12]||(o[12]=s=>a(l).observations=s),"error-message":a(l).errors.observations,type:"textarea"},null,8,["modelValue","error-message"])):v("",!0),e("div",ve,[e("div",fe,[e("p",_e,r(a(_).format(X.value)),1),be]),e("div",ge,[e("p",he,r(a(_).format(R.value)),1),xe])]),t.$page.props.auth.user.rol=="admin"?(c(),m("div",ye,[e("h1",we,[U(" Proveedores "),i(d,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:o[13]||(o[13]=s=>H())})]),Ve,(c(!0),m(T,null,O(x.value,(s,u)=>(c(),m("div",Ce,[i(p,{type:"dropdown",modelValue:s.proveedor,"onUpdate:modelValue":g=>s.proveedor=g,onValueChange:g=>W(s),"option-label":"nombre","option-value":"id",class:"w-full",options:D.value},null,8,["modelValue","onUpdate:modelValue","onValueChange","options"]),i(p,{type:"number",mode:"currency",class:"w-full",modelValue:s.costo,"onUpdate:modelValue":g=>s.costo=g},null,8,["modelValue","onUpdate:modelValue"]),k(i(d,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:g=>Q(u)},null,8,["onClick"]),[[b,"Quitar"]])]))),256))])):v("",!0)])]),_:1},8,["modelValue"]),i(a(ue)),i(V,{visible:j.value,"onUpdate:visible":o[20]||(o[20]=s=>j.value=s),"pt:root:class":"!bg-blue-100",header:"Detalles de la actividad",position:"right"},{header:y(()=>[e("div",Se,[e("span",je,r(n.value.service.title),1)])]),footer:y(()=>[e("div",ft,[e("h1",_t,"Saldo: "+r(a(_).format(n.value.total_price-n.value.payments.reduce((s,u)=>s+u.amount,0))),1),t.$page.props.auth.user.rol=="admin"?(c(),m("div",bt,[k(i(d,{onClick:o[16]||(o[16]=s=>$("COMPLETADA",!0)),icon:"fa-solid fa-circle-check",text:"",size:"large",class:"flex-auto",severity:"success"},null,512),[[b,"Completar Servicio",void 0,{top:!0}]]),k(i(d,{onClick:o[17]||(o[17]=s=>$("NO SHOW",!0)),icon:"fa-solid fa-eye-slash",text:"",size:"large",class:"flex-auto",severity:"warn"},null,512),[[b,"Servicio No show",void 0,{top:!0}]]),k(i(d,{onClick:o[18]||(o[18]=s=>$("CANCELADA",!0)),icon:"fa-solid fa-xmark-circle",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[b,"Cancelar Servicio",void 0,{top:!0}]]),k(i(d,{onClick:o[19]||(o[19]=s=>$("PROBLEMATICA",!1)),icon:"fa-solid fa-person-dress-burst",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[b,"Servicio Problematico",void 0,{top:!0}]])])):v("",!0)])]),default:y(()=>{var s;return[e("div",De,[e("div",Pe,[$e,e("p",null,r(n.value.date),1)]),e("div",Ee,[Ae,e("p",null,r(n.value.hour),1)]),e("div",Ue,[Te,e("p",null,r(n.value.channel.name),1)]),e("div",Oe,[Be,e("p",null,r(n.value.cliente_name),1)]),e("div",Ne,[Re,e("p",null,r(n.value.cliente_city),1)]),e("div",Fe,[Me,e("a",{href:`tel://${n.value.cliente_phone}`},r(n.value.cliente_phone),9,ze)]),e("div",Le,[Ie,e("p",null,r(n.value.cliente_building),1)]),e("div",He,[Qe,e("p",null,r(n.value.adults),1)]),e("div",qe,[We,e("p",null,r(n.value.boys),1)]),e("div",Ge,[Je,e("p",null,r(n.value.mascota),1)]),e("div",Ke,[Xe,e("p",null,r(a(_).format(n.value.total)),1)]),e("div",Ye,[Ze,e("p",null,r(a(_).format(n.value.total_real)),1)]),n.value.user?(c(),m("div",et,[tt,e("p",null,r((s=n.value.user)==null?void 0:s.name),1)])):v("",!0),n.value.user?(c(),m("div",ot,[lt,e("p",null,r(new Date(n.value.created_at).toLocaleDateString("es-CO")),1)])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(),m("div",st,[at,e("p",rt,r(n.value.proveedors.length),1)])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(!0),m(T,{key:3},O(n.value.proveedors,u=>(c(),m("div",nt,[e("p",null,r(u.proveedor.nombre),1),e("p",null,r(a(_).format(u.cost)),1)]))),256)):v("",!0),e("div",it,[e("div",dt,[ut,e("div",ct,r(a(_).format(n.value.payments.reduce((u,g)=>u+g.amount,0))),1)]),(c(!0),m(T,null,O(n.value.payments,u=>(c(),m("div",pt,[e("div",null,[e("div",mt,r(u.type)+" "+r(a(_).format(u.amount)),1),e("div",null,r(new Date(u.created_at).toLocaleDateString("es-CO"))+" "+r(u.metohd_payment.name),1)]),e("div",{class:le(["uppercase",u.status=="pendiente"?"bg-red-500 p-1 text-white rounded-lg shadow-md shadow-red-500":""])},[U(r(u.status)+" ",1),vt],2)]))),256))])])]}),_:1},8,["visible"])]),_:1})}}};export{At as default};
