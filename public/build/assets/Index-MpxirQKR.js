import{d as c,C as X,x as Y,W as D,q as U,y as Z,c as p,w as $,o as d,a as i,b as s,u as a,g,t as T,f as h,h as ee,F as le,i as oe,k as te,T as ae}from"./app-BnIwaeVx.js";import{s as re}from"./index-BV_lImjX.js";import{_ as se}from"./Datatable-CrkFhsSZ.js";import{_ as n,a as ne}from"./Modal-Bye-rty-.js";import{_ as ie}from"./AppLayout-DWNK5jzN.js";import{s as de}from"./index-IYbgJ9rk.js";import{S as A,a as ue}from"./toasts-CuGasqAw.js";import{_ as ce}from"./viewBooking-Cq6D0OEO.js";import"./index-DymiIIO-.js";import"./index-BPE0SKkL.js";import"./index-DSlebqly.js";import"./index-YxxCSduK.js";import"./index-CkBxW0Bd.js";import"./index-BN9FwHj5.js";import"./index-C1FMoYn9.js";import"./index-BFl_f64C.js";import"./postcss-JInqyDjh.js";import"./index-DcMPRGcU.js";import"./index-DOtjjeK0.js";import"./index-70nNQ89-.js";import"./index-i_ZqRd8r.js";import"./useCommonUtilities-DO03hYfs.js";import"./moment-Cijl8gKs.js";import"./index-3WXlzuLK.js";import"./index-ocfmd6cV.js";import"./index-Btz6Eo7x.js";import"./index-DhxPkK7B.js";const me={class:"h-[99vh]"},pe={class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-center",novalidate:""},ve={class:"w-full col-span-1 md:col-span-4 flex justify-between gap-x-2 items-center"},fe={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},be={class:"text-lg font-mono font-semibold"},ge={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},Ve={class:"text-lg font-mono font-semibold"},_e={key:4,class:"mt-4 w-full col-span-1 md:col-span-4 rounded-lg"},ye={class:"flex gap-x-2"},xe={key:5,class:"mt-4 w-full col-span-1 md:col-span-4 border rounded-lg"},we={class:"text-2xl font-mono font-semibold text-center bg-black rounded-t-lg text-white gap-x-3 p-2"},he={class:"flex justify-between gap-x-4 px-2"},Ce={class:"flex justify-end gap-x-2 mt-4 w-full"},Ze={__name:"Index",props:{bookingServices:Array},setup(N){const{toast:V}=ue(),C=c(!1),w=c(null),P=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),v=c(!1),j={action:()=>{e.reset(),v.value=!0}},E=c([]),e=X({id:"",service_id:null,date:"",adults:1,time_service:"",boys:0,cliente_name:"",cliente_phone:"",cliente_city:"",cliente_building:"",mascota:0,persona_adicional:0,cobre_transaccion:0,cobro_extra_cliente:0,reserva:0,abono:0,method_id:"",channel_id:"9d99a95f-6c3d-48fd-aa7d-6ef4e6860123",percent_descuento:0,proveedors:[],total:0,total_real:0,percent_channel:0,observations:""}),f=c([{proveedor:null,costo:""}]),k=c([]),R=()=>{axios.get(route("get.services")).then(o=>{k.value=o.data.services})},M=()=>{f.value.push({proveedor:null,costo:""})},O=o=>{o!=0&&f.value.splice(o,1)},_=c([]),y=c([]),H=()=>{axios.get(route("proveedors.index")).then(o=>{_.value=o.data.proveedors}).catch(o=>{console.log(o)})},F=o=>{var l;o.costo=_.value.find(r=>r.id==o.proveedor).services.find(r=>r.id==e.service_id)===void 0?0:((l=_.value.find(r=>r.id==o.proveedor).services.find(r=>r.id==e.service_id))==null?void 0:l.pivot.value)*e.adults,console.log(o)},I=()=>{axios.get(route("channels.index")).then(o=>{y.value=o.data}).catch(o=>{console.log(o)})};R(),I(),H();const L=[{label:"Detalles",action:o=>{w.value=o,C.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:o=>{e.id=o.id;const l=(r,b)=>{const[t,m,u]=r.split("-"),[J,K]=b.split(":");return`${t}-${m}-${u},${J}:${K}`};e.date=l(o.date,o.hour),e.service_id=o.service_id,e.cliente_name=o.cliente_name,e.cliente_phone=o.cliente_phone,e.cliente_city=o.cliente_city,e.cliente_building=o.cliente_building,e.adults=o.adults,e.total=o.total,e.method_id=o.method_id,e.channel_id=o.channel_id,e.percent_descuento=o.percent_descuento,e.proveedors=o.proveedors,f.value=o.proveedors.map(r=>({proveedor:r.proveedor_id,costo:r.cost})),e.observations=o.observations,w.value=o,v.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Problematica",show:Y().props.auth.user.rol=="admin",action:o=>{var l=o.problematic?"Desmarcar":"Marcar";A.fire({title:"Estas Seguro?",text:`${l} como problematica esta reservación!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${l}!`}).then(r=>{r.isConfirmed&&D.post(route("booking.problematic",o.id),{onSuccess:()=>{V("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"},{label:"Eliminar",icon:"fa-solid fa-trash text-sm",severity:"danger",action:o=>{A.fire({title:"Estas Seguro?",text:`Eliminar la reservación de ${o.cliente_name}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, Eliminar!"}).then(l=>{l.isConfirmed&&D.delete(route("BookingServices.destroy",o.id),{onSuccess:()=>{V("success","Reserva Eliminada")}})})}}],z=[{field:"adults",header:"Pasajeros",filter:!0,sortable:!0},{field:"channel.name",header:"Canal de venta",filter:!0,sortable:!0},{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service.title",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!0,sortable:!0},{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"problematic",header:"Problematica",filter:!0,sortable:!0,type:"boolean"},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"COMPLETADA",severity:"success",class:""},{text:"DISEÑO",severity:"info",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"SERVICIO POSTVENTA",severity:"success",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"}]}],W=U(()=>e.total/e.adults),S=U(()=>{let o=y.value.find(r=>r.id==e.channel_id),l=o?o.percent/100:0;return e.total-e.total*l}),x=c(!1),q=o=>{o.preventDefault(),e.total_real=S.value,e.percent_channel=y.value.find(l=>l.id==e.channel_id).percent,x.value=!0,e.proveedors=f.value,e.post(route("reservar"),{onSuccess:()=>{e.reset(),x.value=!1,v.value=!1,V("success","Reserva creada con exito")},onError:()=>{x.value=!1,V("error","Error al crear la reserva")}})},Q=()=>{e.total_real=S.value,e.percent_channel=y.value.find(o=>o.id==e.channel_id).percent,e.proveedors=f.value,e.put(route("BookingServices.update",e.id),{onSuccess:()=>{v.value=!1,V("success","Reserva actualizada con exito")}})};(()=>{axios.get(route("paymentMethods.index")).then(o=>{E.value=o.data}).catch(o=>{console.log(o)})})();const B=o=>{const[l,r,b]=o.split("-");return new Date(l,r-1,b)},G=U(()=>{var o=[],l=k.value.find(u=>u.id==e.service_id);if(!l)return[];for(var r of l.locks)for(var b=B(r.start_date),t=B(r.end_date),m=b;m<=t;m.setDate(m.getDate()+1))o.push(new Date(m));return o});return Z(e.adults,o=>{for(var l of f.value)l.proveedor&&(l.costo=_.value.find(r=>r.id==l.proveedor).pivot.value*o)}),(o,l)=>{const r=re,b=ae;return d(),p(ie,{title:"Reservas"},{default:$(()=>[i("div",me,[s(se,{actions:L,add:j,columnas:z,data:N.bookingServices,routecreate:"services.create",title:"Reservas",rowClass:!0},null,8,["data"])]),s(ne,{modelValue:v.value,"onUpdate:modelValue":l[18]||(l[18]=t=>v.value=t),title:"Añadir Reserva",width:"70vw"},{footer:$(()=>[i("div",Ce,[s(r,{onClick:l[17]||(l[17]=t=>v.value=!1),severity:"danger",label:"Cancelar",loading:x.value},null,8,["loading"]),a(e).id?(d(),p(r,{key:0,type:"submit",label:"Actualizar",severity:"warn",onClick:Q})):(d(),p(r,{key:1,type:"submit",severity:"success",label:"Guardar",loading:x.value,onClick:q},null,8,["loading"]))])]),default:$(()=>[i("form",pe,[s(n,{type:"dropdown",modelValue:a(e).service_id,"onUpdate:modelValue":l[0]||(l[0]=t=>a(e).service_id=t),"error-message":a(e).errors.service_id,label:"Servicio","option-label":"title","option-value":"id",options:k.value},null,8,["modelValue","error-message","options"]),s(n,{label:"Fecha de Reserva",enableTimePicker:!0,"disabled-dates":G.value,modelValue:a(e).date,"onUpdate:modelValue":l[1]||(l[1]=t=>a(e).date=t),required:"",class:"w-full",type:"datetime"},null,8,["disabled-dates","modelValue"]),s(n,{label:"Valor Total",type:"number",mode:"currency",modelValue:a(e).total,"onUpdate:modelValue":l[2]||(l[2]=t=>a(e).total=t)},null,8,["modelValue"]),s(n,{label:"Tiempo del Servicio",type:"dropdown",modelValue:a(e).time_service,"onUpdate:modelValue":l[3]||(l[3]=t=>a(e).time_service=t),options:["20 Minutos","30 Minutos","40 Minutos","1 Hora","2 Horas","6 Horas","12 Horas","24 Horas"]},null,8,["modelValue"]),s(n,{label:"Pasajeros",type:"number",modelValue:a(e).adults,"onUpdate:modelValue":l[4]||(l[4]=t=>a(e).adults=t)},null,8,["modelValue"]),s(n,{label:"Niños",type:"number",modelValue:a(e).boys,"onUpdate:modelValue":l[5]||(l[5]=t=>a(e).boys=t)},null,8,["modelValue"]),s(n,{label:"Nombre del Pasajero",modelValue:a(e).cliente_name,"onUpdate:modelValue":l[6]||(l[6]=t=>a(e).cliente_name=t),"error-message":a(e).errors.cliente_name,class:"w-full"},null,8,["modelValue","error-message"]),s(n,{label:"Telefono",modelValue:a(e).cliente_phone,"onUpdate:modelValue":l[7]||(l[7]=t=>a(e).cliente_phone=t),"error-message":a(e).errors.cliente_phone,class:"w-full",type:"number"},null,8,["modelValue","error-message"]),s(n,{label:"Ciudad de donde Proviene",modelValue:a(e).cliente_city,"onUpdate:modelValue":l[8]||(l[8]=t=>a(e).cliente_city=t),"error-message":a(e).errors.city,class:"w-full"},null,8,["modelValue","error-message"]),s(n,{label:"Edificio u Hotel",class:"w-full",modelValue:a(e).cliente_building,"onUpdate:modelValue":l[9]||(l[9]=t=>a(e).cliente_building=t),"error-message":a(e).errors.cliente_building},null,8,["modelValue","error-message"]),o.$page.props.auth.user.rol=="admin"?(d(),p(n,{key:0,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:E.value,modelValue:a(e).method_id,"onUpdate:modelValue":l[10]||(l[10]=t=>a(e).method_id=t),label:"Medio de Pago"},null,8,["options","modelValue"])):g("",!0),o.$page.props.auth.user.rol=="admin"?(d(),p(n,{key:1,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:y.value,modelValue:a(e).channel_id,"onUpdate:modelValue":l[11]||(l[11]=t=>a(e).channel_id=t),label:"Canal de Venta"},null,8,["options","modelValue"])):g("",!0),o.$page.props.auth.user.rol=="admin"?(d(),p(n,{key:2,class:"w-full",label:"Descuento",modelValue:a(e).percent_descuento,"onUpdate:modelValue":l[12]||(l[12]=t=>a(e).percent_descuento=t),"error-message":a(e).errors.percent_descuento,min:"0",max:"100",type:"number",suffix:" %"},null,8,["modelValue","error-message"])):g("",!0),o.$page.props.auth.user.rol=="admin"?(d(),p(n,{key:3,class:"w-full col-span-1 md:col-span-4","rows-textarea":2,label:"Observaciones",modelValue:a(e).observations,"onUpdate:modelValue":l[13]||(l[13]=t=>a(e).observations=t),"error-message":a(e).errors.observations,type:"textarea"},null,8,["modelValue","error-message"])):g("",!0),i("div",ve,[i("div",fe,[i("p",be,T(a(P).format(W.value)),1),l[20]||(l[20]=i("p",{class:"italic text-md"},"Valor Pasajero",-1))]),i("div",ge,[i("p",Ve,T(a(P).format(S.value)),1),l[21]||(l[21]=i("p",{class:"italic text-md"},"Valor Real",-1))])]),a(e).service_id?(d(),h("div",_e,[i("div",ye,[s(n,{label:"Placa del Vehiculo",modelValue:a(e).vehicle_plate,"onUpdate:modelValue":l[14]||(l[14]=t=>a(e).vehicle_plate=t),class:"w-full"},null,8,["modelValue"]),s(n,{label:"Nombre del Conductor",modelValue:a(e).driver_name,"onUpdate:modelValue":l[15]||(l[15]=t=>a(e).driver_name=t),class:"w-full"},null,8,["modelValue"])])])):g("",!0),o.$page.props.auth.user.rol=="admin"?(d(),h("div",xe,[i("h1",we,[l[22]||(l[22]=ee(" Proveedores ")),s(r,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:l[16]||(l[16]=t=>M())})]),l[23]||(l[23]=i("div",{class:"flex justify-between w-full font-bold px-2"},[i("label",{for:""},"Proveedor"),i("label",{for:""},"Costo"),i("label",{for:""},".")],-1)),(d(!0),h(le,null,oe(f.value,(t,m)=>(d(),h("div",he,[s(n,{type:"dropdown",modelValue:t.proveedor,"onUpdate:modelValue":u=>t.proveedor=u,onValueChange:u=>F(t),"option-label":"nombre","option-value":"id",class:"w-full",options:_.value},null,8,["modelValue","onUpdate:modelValue","onValueChange","options"]),s(n,{type:"number",mode:"currency",class:"w-full",modelValue:t.costo,"onUpdate:modelValue":u=>t.costo=u},null,8,["modelValue","onUpdate:modelValue"]),te(s(r,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:u=>O(m)},null,8,["onClick"]),[[b,"Quitar"]])]))),256))])):g("",!0)])]),_:1},8,["modelValue"]),s(a(de)),w.value?(d(),p(ce,{key:0,modelValue:C.value,"onUpdate:modelValue":l[19]||(l[19]=t=>C.value=t),service:w.value},null,8,["modelValue","service"])):g("",!0)]),_:1})}}};export{Ze as default};
