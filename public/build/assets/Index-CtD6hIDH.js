import{a1 as re,a2 as ee,d,a3 as ge,A as I,f as o,o as a,a as t,b as $,w as ae,g as M,h as S,F as m,j as C,n as h,t as v,a0 as ve,a4 as fe,a5 as me,I as V,B as Q,R as te,e as ye,c as se,E as K,G as be,i as F,a6 as xe,a7 as he,Y as we}from"./app-Bd4kg2on.js";import"./postcss-CD0Wilcx.js";import{_ as _e}from"./AppLayout--ACsu3m6.js";import{a as Ce}from"./toasts-CAnEIL5D.js";import{S as Se}from"./sweetalert2.esm.all-Y6IUEg8t.js";import{V as ke,N as Ae}from"./Notas-Dugr0ygB.js";import{M as Ee}from"./Modal-DXUWfNuh.js";import{_ as Be}from"./Input-DaAyX8EL.js";import{_ as Oe}from"./logo-Db5woyrY.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./postcss-BjKWwIoI.js";import"./marked.esm-BPgSS2IS.js";import"./Auth-Uq-puIff.js";import"./index-BlBq1go3.js";import"./index-DtovvMSx.js";import"./index-DdEWPqPN.js";import"./index-CvFlCwPk.js";import"./index-CodE3uO4.js";import"./index-Bzg3KqZ6.js";import"./index-CCB94tJ8.js";import"./index-DnZzQhKO.js";import"./index-wEpG7mHt.js";import"./index-B853GTxv.js";import"./index-DbqOWTR8.js";import"./index-BK30aI2A.js";import"./index-CC-ORsX9.js";import"./index-L5OJrkhg.js";import"./Service-CDOUBO7Y.js";import"./GeneralService-C95aIgQI.js";import"./Toats-CRqRGqmn.js";import"./searchStore-DP-G0Bm1.js";import"./Loading-DnWocmlZ.js";import"./index-CvsVkahO.js";import"./index-_8k2jUp1.js";import"./index-DRuQhvVy.js";import"./index-JAbLvJmt.js";import"./index-DKvOtviD.js";import"./index-DEwsrme5.js";import"./index-C-5u_qhk.js";import"./index-CChpcK2x.js";import"./useCommonUtilities-BgDhORlD.js";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const De=()=>{};function $e(A,l,w){let b;re(w)?b={evaluating:w}:b={};const{lazy:E=!1,evaluating:f=void 0,shallow:p=!0,onError:u=De}=b,B=ee(!E),_=p?ee(l):d(l);let k=0;return ge(async y=>{if(!B.value)return;k++;const P=k;let x=!1;f&&Promise.resolve().then(()=>{f.value=!0});try{const O=await A(L=>{y(()=>{f&&(f.value=!1),x||L()})});P===k&&(_.value=O)}catch(O){u(O)}finally{f&&P===k&&(f.value=!1),x=!0}}),E?I(()=>(B.value=!0,_.value)):_}const Ne={key:0,class:"items-center justify-center flex flex-col"},Te={class:"flex flex-col gap-y-3 h-[60vh] overflow-y-auto"},Ve={class:"shadow-lg pr-4 rounded-md flex items-center justify-between"},Fe={class:"text-xl font-bold"},Ie={class:"font-bold text-sm"},Me={__name:"Changes",setup(A){const l=d(!1),w=d(),b=$e(async()=>{var{data:f}=await ve.get(route("get.states.change",{date:w.value}));return f.status}),E={reservado:"blue","CAMBIO DE FECHA":"gray","NO SHOW":"amber",REUBICADO:"orange",CANCELADA:"green",PROBLEMATICA:"red"};return(f,p)=>(a(),o(m,null,[t("span",{onClick:p[0]||(p[0]=u=>l.value=!0),class:"text-xs font-bold text-blue-800 cursor-pointer"},"Listado de Cambios"),$(Ee,{title:"Historial de Cambios",modelValue:l.value,"onUpdate:modelValue":p[2]||(p[2]=u=>l.value=u),"close-on-escape":""},{default:ae(()=>[$(Be,{"max-date":new Date,type:"date",class:"my-2",modelValue:w.value,"onUpdate:modelValue":p[1]||(p[1]=u=>w.value=u),dateFormat:"dd/mm/yy"},null,8,["max-date","modelValue"]),S(b)&&S(b).length==0?(a(),o("div",Ne,[$(Oe),p[3]||(p[3]=t("p",null,"Sin Cambio Registrados",-1))])):M("",!0),t("div",Te,[(a(!0),o(m,null,C(S(b),u=>(a(),o("div",Ve,[t("div",{class:h(["rounded-l-md text-lg font-bold uppercase",`bg-${E[u.state]}-200 p-2`])},v(u.state),3),t("div",null,[t("p",Fe,v(u.statable.service),1),t("span",Ie,v(u.user.name),1)])]))),256))])]),_:1},8,["modelValue"])],64))}},Pe=fe("bookingService",()=>{const A=d([]),l=d(null);return{selectDate:A,statusFilter:l}},{persist:{storage:sessionStorage,paths:["selectDate","statusFilter"]}}),H=[{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"adults",header:"Pasajeros",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!1,type:"date",sortable:!0},{field:"channel.name",header:"Canal de venta",filter:!0,sortable:!0},{field:"proveedors_names",header:"proveedores",class:"text-center font-semibold text-sm",filter:!0},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"text",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"RESERVADO",severity:"info",class:""},{text:"CAMBIO DE FECHA",class:"bg-gray-200 font-bold"},{text:"COMPLETADA",severity:"success",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"REUBICADO",severity:"warn",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"},{text:"PROBLEMATICA",severity:"danger",class:"animate-pulse"},{text:"SIN CONFIRMAR",severity:"danger"}]}],Le={class:"h-[92vh]"},Ue={class:"flex py-2 px-4 justify-between items-center"},je={class:"italic flex flex-col"},He={class:"text-2xl font-bold"},ze={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},We={class:"p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-gray-200"},Ge={class:"flex flex-col md:flex-row gap-3 items-center justify-between"},Ye={class:"flex-1 w-full md:w-auto"},Je={class:"relative"},Qe={class:"flex items-center gap-2"},Ke={class:"overflow-x-auto"},Ze={class:"min-w-full divide-y divide-gray-200"},qe={class:"bg-gray-50"},Xe={class:"bg-white divide-y divide-gray-200"},et={key:1},tt=["colspan"],st={key:0},rt={key:2,class:"text-gray-900"},at={class:"px-4 py-3"},ot={class:"flex items-center justify-center gap-1"},lt=["onClick","title"],nt={key:0,class:"px-4 py-3 bg-gray-50 border-t border-gray-200"},it={class:"flex flex-col sm:flex-row items-center justify-between gap-3"},dt={class:"text-sm text-gray-700"},ut={class:"font-semibold text-gray-900"},ct={class:"font-semibold text-gray-900"},pt={class:"font-semibold text-gray-900"},gt={class:"inline-flex rounded-md shadow-sm -space-x-px"},vt=["disabled"],ft=["disabled"],mt=["onClick"],yt={key:1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700"},bt=["disabled"],xt=["disabled"],ht={__name:"Index",props:{bookingServices:Object,serviceType:String,filters:Object},setup(A){const l=A,{toast:w}=Ce(),b=d([]),E=d([]),f=d(""),p=d([]),u=d(!1),B=d(null),_=d(!1),k=I(()=>l.bookingServices.data||[]),y=I(()=>({current_page:l.bookingServices.current_page,last_page:l.bookingServices.last_page,per_page:l.bookingServices.per_page,total:l.bookingServices.total,from:l.bookingServices.from,to:l.bookingServices.to})),P=Pe(),{selectDate:x,statusFilter:O}=me(P),L=s=>`booking_${l.serviceType||"all"}_${s}`,z=(s,e)=>{try{const i=localStorage.getItem(L(s));return i?JSON.parse(i):e}catch{return e}},R=(s,e)=>{try{localStorage.setItem(L(s),JSON.stringify(e))}catch(i){console.warn("Error guardando en cache:",i)}},W=z("search",""),G=z("page",1),Y=z("perPage",10),N=d(l.filters?.search||W),c=d(l.bookingServices.current_page||G),D=d(l.filters?.per_page||Y),J=d(!1),oe=(s,e)=>{let i;return function(...g){const n=()=>{clearTimeout(i),s(...g)};clearTimeout(i),i=setTimeout(n,e)}};if(!l.filters?.search&&!l.filters?.page&&(W||G!==1||Y!==100)){const s={type:l.serviceType,search:W||void 0,dates:x.value||void 0,per_page:Y,page:G};V.get(route("BookingServices.index"),s,{preserveState:!0,preserveScroll:!0,only:["bookingServices"],replace:!0})}const Z=I(()=>({TOUR:"Reservas de Tours",EMBARCACION:"Reservas de Embarcaciones",TRANSFER:"Reservas de Transportes"})[l.serviceType]||"Reservas"),q={action:()=>{V.get(route("BookingServices.create"))}},U=oe(()=>{R("search",N.value),R("page",c.value),R("perPage",D.value);const s={type:l.serviceType,search:N.value||void 0,dates:x.value||void 0,per_page:D.value,page:c.value};J.value=!0,V.get(route("BookingServices.index"),s,{preserveState:!0,preserveScroll:!0,only:["bookingServices"],onFinish:()=>{J.value=!1}})},500);Q([x],()=>{c.value=1,R("page",1),U()}),Q(N,()=>{c.value=1,R("page",1),U()}),Q(D,()=>{c.value=1,R("page",1),U()});const X=I(()=>O.value?k.value.filter(s=>s.status===O.value):k.value),T=s=>{c.value=s,U()},le=[{label:"Detalles",action:async s=>{B.value=s,u.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:async s=>{V.get(route("BookingServices.edit",s.id))},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Notas",severity:"secondary",action:s=>{p.value=s,_.value=!0},icon:"fa-solid fa-note-sticky text-sm"},{label:"Eliminar",icon:"fa-solid fa-trash text-sm",severity:"danger",show:te().props.auth.user.rol=="admin"||te().props.auth.user.rol=="superadmin",action:s=>{Se.fire({title:"Estas Seguro?",text:`Eliminar la reservación de ${s.cliente_name}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, Eliminar!"}).then(e=>{e.isConfirmed&&V.delete(route("BookingServices.destroy",s.id),{onSuccess:()=>{w("success","Reserva Eliminada")}})})}}];d([]);const ne=s=>{const e=s[0].getDate(),i=s[0].getMonth()+1,r=s[0].getFullYear(),g=n=>n<10?`0${n}`:n;return`${g(e)}/${g(i)}/${r} - ${g(s[1].getDate())}/${g(s[1].getMonth()+1)}/${s[1].getFullYear()}`},ie=()=>{const s=[],e=y.value.last_page,i=c.value;if(e<=7)for(let r=1;r<=e;r++)s.push(r);else if(i<=3){for(let r=1;r<=5;r++)s.push(r);s.push("..."),s.push(e)}else if(i>=e-2){s.push(1),s.push("...");for(let r=e-4;r<=e;r++)s.push(r)}else{s.push(1),s.push("...");for(let r=i-1;r<=i+1;r++)s.push(r);s.push("..."),s.push(e)}return s},j=(s,e)=>e.split(".").reduce((i,r)=>i?.[r],s),de=s=>s?new Date(new Date(s).getTime()+new Date(s).getTimezoneOffset()*6e4).toLocaleString("es-CO",{day:"2-digit",month:"2-digit",year:"numeric"}):"Sin definir",ue=s=>s.problematic?"bg-red-100":{"CAMBIO DE FECHA":"bg-gray-50",CANCELADA:"bg-green-50","NO SHOW":"bg-yellow-50",REUBICADO:"bg-orange-50",PROBLEMATICA:"bg-red-100","SIN CONFIRMAR":"bg-purple-50",RESERVADO:"bg-blue-50"}[s.status]||"",ce=s=>({RESERVADO:"bg-blue-100 text-blue-800","CAMBIO DE FECHA":"bg-gray-100 text-gray-800",COMPLETADA:"bg-green-100 text-green-800","NO SHOW":"bg-yellow-100 text-yellow-800",REUBICADO:"bg-orange-100 text-orange-800",CANCELADA:"bg-green-100 text-green-800",PROBLEMATICA:"bg-red-200 text-red-900 animate-pulse","SIN CONFIRMAR":"bg-purple-100 text-purple-800"})[s]||"bg-gray-100 text-gray-800",pe=s=>({info:"text-blue-600 hover:bg-blue-100",warn:"text-yellow-600 hover:bg-yellow-100",secondary:"text-gray-600 hover:bg-gray-100",danger:"text-red-600 hover:bg-red-100"})[s]||"text-gray-600 hover:bg-gray-100";return(s,e)=>{const i=ye("VueDatePicker");return a(),o(m,null,[$(_e,{title:Z.value},{default:ae(()=>[t("div",Le,[t("div",Ue,[t("div",je,[t("h1",He,v(Z.value),1),$(Me)]),t("div",null,[$(i,{"hide-offset-dates":"",modelValue:S(x),"onUpdate:modelValue":e[0]||(e[0]=r=>re(x)?x.value=r:null),teleport:!0,format:ne,"model-type":"yyyy-MM-dd",range:"","enable-time-picker":!1,locale:"es","multi-calendars":{solo:!0},timezone:"America/Bogota"},null,8,["modelValue"])])]),t("div",ze,[t("div",We,[t("div",Ge,[t("div",Ye,[t("div",Je,[e[10]||(e[10]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("i",{class:"fa-solid fa-magnifying-glass text-gray-400"})],-1)),K(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>N.value=r),type:"text",placeholder:"Buscar por nombre, teléfono, servicio, estado...",class:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"},null,512),[[be,N.value]])])]),t("div",Qe,[q?(a(),o("button",{key:0,onClick:e[2]||(e[2]=r=>q.action()),class:"inline-flex items-center px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200 shadow-sm"},[...e[11]||(e[11]=[t("i",{class:"fa-solid fa-plus mr-2"},null,-1),F(" Nueva Reserva ",-1)])])):M("",!0),K(t("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>D.value=r),class:"px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all duration-200"},[...e[12]||(e[12]=[t("option",{value:10},"10",-1),t("option",{value:50},"50",-1),t("option",{value:100},"100",-1),t("option",{value:200},"200",-1),t("option",{value:500},"500",-1)])],512),[[xe,D.value]])])])]),t("div",Ke,[t("table",Ze,[t("thead",qe,[t("tr",null,[(a(!0),o(m,null,C(S(H),r=>(a(),o("th",{key:r.field,class:h(["px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",r.class])},v(r.header),3))),128)),e[13]||(e[13]=t("th",{class:"px-4 py-3 text-center text-xs font-bold text-gray-700 uppercase tracking-wider"}," Acciones ",-1))])]),t("tbody",Xe,[J.value?(a(!0),o(m,{key:0},C(D.value,r=>(a(),o("tr",{key:`skeleton-${r}`,class:"animate-pulse"},[(a(!0),o(m,null,C(S(H),g=>(a(),o("td",{key:`skeleton-col-${g.field}`,class:h(["px-4 py-3",g.class])},[...e[14]||(e[14]=[t("div",{class:"h-4 bg-gray-200 rounded w-3/4"},null,-1)])],2))),128)),e[15]||(e[15]=t("td",{class:"px-4 py-3"},[t("div",{class:"flex items-center justify-center gap-1"},[t("div",{class:"h-8 w-8 bg-gray-200 rounded-md"}),t("div",{class:"h-8 w-8 bg-gray-200 rounded-md"}),t("div",{class:"h-8 w-8 bg-gray-200 rounded-md"}),t("div",{class:"h-8 w-8 bg-gray-200 rounded-md"})])],-1))]))),128)):X.value.length===0?(a(),o("tr",et,[t("td",{colspan:S(H).length+1,class:"px-4 py-8 text-center text-gray-500"},[...e[16]||(e[16]=[t("i",{class:"fa-solid fa-inbox text-4xl mb-2 text-gray-300 animate-bounce"},null,-1),t("p",{class:"font-medium"},"No se encontraron resultados",-1)])],8,tt)])):(a(!0),o(m,{key:2},C(X.value,(r,g)=>(a(),o("tr",{key:r.id,class:h([ue(r),"hover:bg-gray-50 transition-all duration-200 animate-fade-in"]),style:he({animationDelay:`${g*30}ms`})},[(a(!0),o(m,null,C(S(H),n=>(a(),o("td",{key:n.field,class:h(["px-4 py-3 text-sm",n.class])},[n.type==="date"?(a(),o("span",st,v(de(j(r,n.field))),1)):n.type==="tag"||n.type==="customtag"?(a(),o("span",{key:1,class:h([ce(j(r,n.field)),"inline-flex px-2 py-1 text-xs font-semibold rounded-full"])},v(j(r,n.field)),3)):(a(),o("span",rt,v(j(r,n.field)),1))],2))),128)),t("td",at,[t("div",ot,[(a(),o(m,null,C(le,n=>K(t("button",{key:n.label,onClick:_t=>n.action(r),class:h([pe(n.severity),"p-2 rounded-md transition-all duration-200 hover:scale-110"]),title:n.label},[t("i",{class:h(n.icon)},null,2)],10,lt),[[we,typeof n.show=="function"?n.show(r):n.show!==!1]])),64))])])],6))),128))])])]),y.value.total>0?(a(),o("div",nt,[t("div",it,[t("div",dt,[e[17]||(e[17]=F(" Mostrando ",-1)),t("span",ut,v(y.value.from),1),e[18]||(e[18]=F(" a ",-1)),t("span",ct,v(y.value.to),1),e[19]||(e[19]=F(" de ",-1)),t("span",pt,v(y.value.total),1),e[20]||(e[20]=F(" resultados ",-1))]),t("nav",gt,[t("button",{onClick:e[4]||(e[4]=r=>T(1)),disabled:c.value===1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[...e[21]||(e[21]=[t("i",{class:"fa-solid fa-angles-left"},null,-1)])],8,vt),t("button",{onClick:e[5]||(e[5]=r=>T(c.value-1)),disabled:c.value===1,class:"relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[...e[22]||(e[22]=[t("i",{class:"fa-solid fa-angle-left"},null,-1)])],8,ft),(a(!0),o(m,null,C(ie(),r=>(a(),o(m,{key:r},[r!=="..."?(a(),o("button",{key:0,onClick:g=>T(r),class:h([r===c.value?"z-10 bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50","relative inline-flex items-center px-4 py-2 border text-sm font-medium transition-colors duration-200"])},v(r),11,mt)):(a(),o("span",yt," ... "))],64))),128)),t("button",{onClick:e[6]||(e[6]=r=>T(c.value+1)),disabled:c.value===y.value.last_page,class:"relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[...e[23]||(e[23]=[t("i",{class:"fa-solid fa-angle-right"},null,-1)])],8,bt),t("button",{onClick:e[7]||(e[7]=r=>T(y.value.last_page)),disabled:c.value===y.value.last_page,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[...e[24]||(e[24]=[t("i",{class:"fa-solid fa-angles-right"},null,-1)])],8,xt)])])])):M("",!0)])]),B.value?(a(),se(ke,{key:0,modelValue:u.value,"onUpdate:modelValue":e[8]||(e[8]=r=>u.value=r),service:B.value,proveedors:b.value},null,8,["modelValue","service","proveedors"])):M("",!0)]),_:1},8,["title"]),_.value?(a(),se(Ae,{key:0,modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=r=>_.value=r),notes:E.value,note:f.value,service:p.value},null,8,["modelValue","notes","note","service"])):M("",!0)],64)}}},us=Re(ht,[["__scopeId","data-v-139044a3"]]);export{us as default};
