import{s as M}from"./index-CIxof-4Z.js";import{s as J}from"./index-331WfBHm.js";import{_ as K}from"./Datatable-CzZw7EWm.js";import{a as Q,_ as N}from"./Modal-CO0ZYr_7.js";import{_ as X}from"./AppLayout-kZpBgmXd.js";import{d as r,C as Y,f as d,b as m,w as F,F as h,o as i,a as t,i as C,n as T,t as s,u as _,g as V,A as Z,W as R}from"./app-u36ABimC.js";import{a as ee}from"./toasts-CuGasqAw.js";import"./index-DC6m4heF.js";import"./index-BKjCVrWM.js";import"./index-Ch2oqB69.js";import"./index-CfkkZtrq.js";import"./index-25YTJBqO.js";import"./index-BOwynYl9.js";import"./index-CXn7_P1F.js";import"./index-QIm8Q5Lq.js";import"./index-Cd4fwKTK.js";import"./index-CeOzNZ_V.js";import"./index-BURJcFHq.js";import"./index-CQKNzLkq.js";import"./index-CV0XSJ2K.js";import"./index-CsT_ukeg.js";import"./index-DvyzyBfm.js";import"./useCommonUtilities-DO03hYfs.js";import"./moment-Cijl8gKs.js";import"./filepond-plugin-image-preview.min-BG10xqQy.js";import"./postcss-DqleN6kc.js";import"./index-EVIzkOMZ.js";import"./index-D9nkCK4c.js";import"./index-iCkGUh0A.js";import"./index-DaoEXPOh.js";const te={class:"h-[99vh]"},oe={class:"gap-y-2 flex flex-col"},ae={class:"flex flex-col w-full justify-between font-bold"},le={key:0,class:"flex flex-col gap-y-2"},se={class:"flex justify-between gap-x-4"},ne=["onClick"],re={class:"flex gap-2 divide-x-4 divide-white items-center"},de={class:"p-1"},ie={class:"p-1 pl-3"},ue={class:"flex flex-col w-full justify-between font-bold"},pe={class:"flex justify-end gap-x-2"},ce=["loading"],me={class:"flex flex-col gap-4"},ve={class:"font-medium block mb-2"},fe={class:"w-full bg-gray-200 rounded-md p-2 grid grid-cols-2 divide-y-2 md:flex space-x-2"},_e=["onClick"],ge={class:"flex flex-col gap-y-2 h-64 overflow-auto"},xe={key:0},he={class:"flex items-center gap-x-8 border-b shadow-md justify-between p-3 rounded-md hover:bg-gray-300"},ye={class:"flex flex-col"},be={class:"font-bold flex items-center gap-x-2"},we={class:"text-xs"},De={class:"flex flex-col"},Ce={class:"text-sm"},Ve={class:"font-bold"},ke={key:1},Pe={class:"flex items-center gap-x-8 border-b shadow-md justify-between p-3 rounded-md hover:bg-gray-300"},Se={class:"flex flex-col"},Fe={class:"font-bold flex items-center gap-x-2"},je={class:"text-xs"},Ie={class:"text-xs"},Oe={class:"flex flex-col"},$e={class:"text-sm"},Ae={class:"font-bold"},pt={__name:"Index",props:{payments:Array},setup(U){const v=r(!1),{toast:j}=ee(),y=r(1),z=[{name:"Agrupados",value:1},{name:"Detalles",value:2}],k=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),b=r(!1),n=Y({date:new Date,startDate:new Date,endDate:new Date,amount:0,proveedor_id:"",file:"",description:""}),I=r([]),c=r([new Date,new Date]),x=r(),O=r([]),p=r(),w=r(null),W={action:()=>{w.value=null,c.value=[new Date,new Date],n.reset(),D(),v.value=!0}},B=[{name:"Ver",icon:"fa-solid fa-pencil",severity:"info",action:a=>{v.value=!0,w.value=a.id,n.date=a.date,c.value=[a.startDate,a.endDate],n.amount=a.amount,p.value=a.proveedor_id,D()}}],E=[{header:"Proveedor",field:"proveedor.nombre",filter:!0},{header:"Fecha de Pago",field:"date",type:"date",filter:!0},{header:"Valor",field:"amount",type:"currency"},{header:"Fecha Inicio",field:"startDate",field:"date",type:"date",filter:!0},{header:"Fecha Fin",field:"endDate",field:"date",type:"date",filter:!0},{header:"Comprobante",field:"comprobante",type:"html-custom",renderer:a=>`<a href="${a.comprobante}" class="text-sky-600 underline" target="_blank">Ver Comprobante</a>`}],D=()=>{Z.get(route("get.booking.time.range"),{params:{start_date:new Date(c.value[0]).toISOString().split("T")[0],end_date:new Date(c.value[1]).toISOString().split("T")[0]}}).then(a=>{I.value=a.data.proveedores,x.value=a.data.bookingTimeRange.filter(o=>{let u=p.value;return o.proveedors.map(e=>e.proveedor_id).includes(u)}),O.value=[{name:"Reservado",value:x.value.filter(o=>o.status=="reservado"),color:"bg-blue-200"},{name:"Completado",value:x.value.filter(o=>o.status=="completado"),color:"bg-green-200"},{name:"Cancelado",value:x.value.filter(o=>o.status=="CANCELADA"),color:"bg-red-200"},{name:"NO SHOW",value:x.value.filter(o=>o.status=="NO SHOW"),color:"bg-yellow-200"}]})},$=r(),P=r([]),A=r([]),H=(a,o)=>{A.value=o.value.reduce((u,g)=>{const e=g.title;return u[e]||(u[e]={count:0,pasajeros:0,total:0}),u[e].count+=1,u[e].pasajeros+=g.adults,u[e].total+=g.proveedors.filter(l=>l.proveedor_id==p.value).reduce((l,f)=>l+f.cost,0),u},{}),P.value=o,$.value.toggle(a)};function L(a){n.file=a.target.files[0]}const q=()=>{b.value=!0;let a=new FormData;if(a.append("proveedor_id",p.value),a.append("amount",n.amount),a.append("comprobante",n.file),a.append("date",new Date(n.date).toISOString().split("T")[0]),a.append("startDate",new Date(c.value[0]).toISOString().split("T")[0]),a.append("endDate",new Date(c.value[1]).toISOString().split("T")[0]),a.append("description",n.description),w.value){R.post(route("paymentProveedors.update",w.value),a,{onSuccess:()=>{j("success","Pago Actualizado con exito"),b.value=!1,v.value=!1}});return}R.post(route("paymentProveedors.store"),a,{onSuccess:()=>{j("success","Pago Actualizado con exito"),b.value=!1,v.value=!1}})};return(a,o)=>{const u=J,g=M;return i(),d(h,null,[m(X,{title:"Pagos"},{default:F(()=>[t("div",te,[m(K,{add:W,columnas:E,data:U.payments,actions:B,title:"Pagos"},null,8,["data"])]),m(Q,{modelValue:v.value,"onUpdate:modelValue":o[5]||(o[5]=e=>v.value=e),title:"Añadir Pagos"},{default:F(()=>[t("div",oe,[t("div",ae,[o[6]||(o[6]=t("p",null,"Fechas",-1)),m(u,{modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=e=>c.value=e),selectionMode:"range",dateFormat:"dd/mm/yy",class:"w-full",manualInput:!1,onValueChange:D},null,8,["modelValue"])]),m(N,{label:"Proveedor",type:"dropdown","option-label":"proveedor","option-value":"proveedor_id",onValueChange:D,modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=e=>p.value=e),options:I.value},null,8,["modelValue","options"]),p.value?(i(),d("div",le,[t("div",se,[(i(!0),d(h,null,C(O.value,e=>(i(),d("div",{class:T([`${e.color} ${e.value.length>0?"cursor-pointer":"hidden"} `,"rounded-lg py-2 border w-full flex flex-col gap-y-1 items-center font-bold cursor-pointer scale-90 hover:scale-100 shadow-sm hover:shadow-lg transition-all duration-300"]),onClick:l=>H(l,e)},[t("h1",null,s(e.name),1),t("div",re,[t("p",de,s(e.value.length)+" Reservas",1),t("p",ie,s(e.value.reduce((l,f)=>l+f.adults,0))+" Pasajeros ",1)]),t("p",null,s(_(k).format(e.value.reduce((l,f)=>l+f.proveedors.filter(S=>S.proveedor_id==p.value).reduce((S,G)=>S+G.cost,0),0))),1)],10,ne))),256))]),t("div",ue,[o[7]||(o[7]=t("p",null,"Fecha en que realizó el pago",-1)),m(u,{modelValue:_(n).date,"onUpdate:modelValue":o[2]||(o[2]=e=>_(n).date=e),dateFormat:"dd/mm/yy",class:"w-full",manualInput:!1},null,8,["modelValue"])]),m(N,{label:"Valor",type:"number",mode:"currency",modelValue:_(n).amount,"onUpdate:modelValue":o[3]||(o[3]=e=>_(n).amount=e)},null,8,["modelValue"]),t("input",{type:"file",onChange:L,label:"Comprobante"},null,32)])):V("",!0),t("div",pe,[t("button",{onClick:o[4]||(o[4]=e=>v.value=!1),class:"bg-red-500 text-white px-4 py-2 rounded-md"}," Cancelar "),p.value?(i(),d("button",{key:0,loading:b.value,onClick:q,class:"bg-green-500 text-white px-4 py-2 rounded-md"}," Guardar ",8,ce)):V("",!0)])])]),_:1},8,["modelValue"])]),_:1}),m(g,{ref_key:"op",ref:$},{default:F(()=>[t("div",me,[t("div",null,[t("span",ve,s(P.value.name),1),t("div",fe,[(i(),d(h,null,C(z,e=>t("div",{onClick:l=>y.value=e.value,class:T(["w-full rounded-lg text-center py-2 text-sm md:text-md cursor-pointer",y.value==e.value?"bg-white":"hover:bg-white/30"])},s(e.name),11,_e)),64))]),t("div",ge,[y.value==1?(i(),d("div",xe,[(i(!0),d(h,null,C(A.value,(e,l)=>(i(),d("div",he,[t("div",ye,[t("span",be,[t("p",null,s(l),1)]),t("span",we,s(e.count)+" Reservas",1)]),t("div",De,[t("span",Ce,s(e.pasajeros)+" Pasajeros",1),t("span",Ve,s(_(k).format(e.total)),1)])]))),256))])):V("",!0),y.value==2?(i(),d("div",ke,[(i(!0),d(h,null,C(P.value.value,e=>(i(),d("div",Pe,[t("div",Se,[t("span",Fe,[t("p",null,s(e.title),1)]),t("span",je,s(e.cliente_name),1),t("span",Ie,s(e.fecha),1)]),t("div",Oe,[t("span",$e,s(e.adults)+" Pasajeros",1),t("span",Ae,s(_(k).format(e.proveedors.filter(l=>l.proveedor_id==p.value).reduce((l,f)=>l+f.cost,0))),1)])]))),256))])):V("",!0)])])])]),_:1},512)],64)}}};export{pt as default};
