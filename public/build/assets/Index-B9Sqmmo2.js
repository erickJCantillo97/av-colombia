import{d as _,x as fe,y as p,z as W,A as M,q as G,o as C,c as pe,w as A,a as e,b as r,B as v,u as l,C as c,t as i,j as be,k as j,f as P,g as Q,i as _e,n as ge,h as he,F as xe,D as L,E as ye}from"./app-Bw1QxyUr.js";import{_ as we,s as Ve}from"./AppLayout-BAegSQZh.js";import{s as Ce}from"./index-CPC1N9sC.js";import{_ as Ae}from"./Datatable-CBEkY5NZ.js";import{_ as m}from"./Input-BVBp2Wt_.js";import{_ as Se}from"./Modal-DkHJxb2r.js";import{s as De}from"./index-x0v5pKDl.js";import{S as z,a as Ee}from"./toasts-DRkOXQyQ.js";import{u as je}from"./vee-validate-n9DH5arT.js";import"./index-DA57veQI.js";import"./index-Dh9dM5uK.js";import"./index-w8KSXmIg.js";import"./index-ukab-bIO.js";import"./postcss-BghQxMgL.js";const Pe={class:"h-[99vh]"},$e={class:""},Be={class:"text-xl font-mono font-semibold"},ke={class:"flex justify-end mt-4"},Ne={class:"flex items-center gap-2"},Oe={class:"font-bold text-lg"},qe={class:"flex flex-col gap-y-1.5 text-sm"},Ue={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Fe=e("strong",null,"Fecha del Servicio:",-1),Te={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Re=e("strong",null,"Hora del Servicio:",-1),Me={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Le=e("strong",null,"Cliente:",-1),ze={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ie=e("strong",null,"Ciudad:",-1),He={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},We=e("strong",null,"Telelfono:",-1),Ge=["href"],Qe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Je=e("strong",null,"Edificio:",-1),Ke={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Xe=e("strong",null,"Adultos:",-1),Ye={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ze=e("strong",null,"Niños:",-1),et={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},tt=e("strong",null,"Valor:",-1),st={key:0,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},lt=e("strong",null,"Vendedor:",-1),ot={key:1,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},at=e("strong",null,"Fecha de reserva:",-1),rt={class:"flex flex-col gap-y-2 mt-2"},it={class:"flex justify-between"},nt=e("h2",{class:"text-xl font-bold"},"Pagos Realizados ",-1),dt={class:"bg-blue-600 text-white p-1 rounded-lg"},ut={class:"flex items-center text-xs justify-between border shadow-xl rounded-md p-1 bg-white"},ct={class:"uppercase font-bold"},mt=e("div",null,null,-1),vt={class:"flex flex-col items-center gap-2"},ft={class:"font-bold text-center"},pt={class:"flex gap-x-2"},Ot={__name:"Index",props:{bookingServices:Array},setup(J){const{toast:$}=Ee(),S=_(!1),a=_({}),g=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),h=_(!1),K={action:()=>{h.value=!0}},I=_([]),X=fe({service_id:p().required(),date:W().required(),adults:M().required(),date:W().required(),adults:M().required(),cliente_name:p().required(),cliente_phone:p().required(),cliente_city:p().required(),cliente_building:p().required(),hour:p().required(),abono:M().required(),method:p().required()}),{values:Y,defineField:u,errors:f,meta:bt}=je({validationSchema:X}),[x,Z]=u("service_id"),[B,ee]=u("date"),[y,_t]=u("boys"),[w,gt]=u("adults"),[k,te]=u("cliente_name"),[N,se]=u("cliente_phone"),[O,le]=u("cliente_city"),[q,oe]=u("cliente_building"),[U,ae]=u("hour"),[F,re]=u("abono"),[T,ie]=u("method");y.value=0,w.value=1;const D=_([]);(()=>{axios.get(route("get.services")).then(o=>{D.value=o.data.services.slice(0,5)})})();const ne=[{label:"Detalles",action:o=>{a.value=o,S.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Registrar Pago",action:o=>{form.service_id=o.id,h.value=!0},icon:"fa-solid fa-dollar text-sm",severity:"success"},{label:"Problematica",action:o=>{var t=o.problematic?"Desmarcar":"Marcar";z.fire({title:"Estas Seguro?",text:`${t} como problematica esta reservación!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${t}!`}).then(n=>{n.isConfirmed&&L.post(route("booking.problematic",o.id),{onSuccess:()=>{$("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"}],de=[{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service.title",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!0,sortable:!0,type:"date"},{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"problematic",header:"Problematica",filter:!0,sortable:!0,type:"boolean"},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"COMPLETADA",severity:"success",class:""},{text:"DISEÑO",severity:"info",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"SERVICIO POSTVENTA",severity:"success",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"}]}],ue=G(()=>{let o=D.value.find(t=>t.id==x.value);return o?o.adult_tarifa*w.value+o.boy_tarifa*y.value:0}),R=_(!1),ce=o=>{o.preventDefault(),R.value=!0,L.post(route("reservar"),Y,{onSuccess:()=>{$("success","Reserva creada con exito"),R.value=!1,h.value=!1}})};(()=>{axios.get(route("paymentMethods.index")).then(o=>{I.value=o.data}).catch(o=>{console.log(o)})})();const H=o=>{const[t,n,V]=o.split("-");return new Date(t,n-1,V)},me=G(()=>{var o=[],t=D.value.find(d=>d.id==x.value);if(!t)return[];for(var n of t.locks)for(var V=H(n.start_date),b=H(n.end_date),s=V;s<=b;s.setDate(s.getDate()+1))o.push(new Date(s));return o}),E=(o,t)=>{z.fire({title:o,text:"Estas seguro de realizar esta acción?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si"}).then(n=>{n.isConfirmed&&(z.fire({title:o,text:"Esta reserva ha sido "+o+".",icon:"success"}),L.post(route("set.states"),{service:a.value.id,state:o,terminated:t},{onSuccess:()=>{S.value=!1,$("success","Reserva "+o)}}))})};return(o,t)=>{const n=Ce,V=Ve,b=ye;return C(),pe(we,{title:"Services"},{default:A(()=>[e("div",Pe,[r(Ae,{actions:ne,add:K,columnas:de,data:J.bookingServices,routecreate:"services.create",title:"Reservas"},null,8,["data"])]),r(Se,{modelValue:h.value,"onUpdate:modelValue":t[11]||(t[11]=s=>h.value=s),title:"Añadir Reserva",width:"70vw"},{default:A(()=>[e("form",{onSubmit:be(ce,["prevent"]),class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",novalidate:""},[r(m,v({type:"dropdown",modelValue:l(x),"onUpdate:modelValue":t[0]||(t[0]=s=>c(x)?x.value=s:null),"error-message":l(f).service_id,label:"Servicio","option-label":"title","option-value":"id",options:D.value},l(Z)),null,16,["modelValue","error-message","options"]),r(m,v({label:"Fecha de Reserva","disabled-dates":me.value,modelValue:l(B),"onUpdate:modelValue":t[1]||(t[1]=s=>c(B)?B.value=s:null),required:"","min-date":new Date,class:"w-full",type:"date","error-message":o.errorDate},l(ee)),null,16,["disabled-dates","modelValue","min-date","error-message"]),r(m,{label:"Pasajeros",type:"number",modelValue:l(w),"onUpdate:modelValue":t[2]||(t[2]=s=>c(w)?w.value=s:null)},null,8,["modelValue"]),r(m,{label:"Niños",type:"number",modelValue:l(y),"onUpdate:modelValue":t[3]||(t[3]=s=>c(y)?y.value=s:null)},null,8,["modelValue"]),r(m,v({label:"Nombre del Pasajero"},l(te),{modelValue:l(k),"onUpdate:modelValue":t[4]||(t[4]=s=>c(k)?k.value=s:null),"error-message":l(f).cliente_name,class:"w-full"}),null,16,["modelValue","error-message"]),r(m,v({label:"Telefono",modelValue:l(N),"onUpdate:modelValue":t[5]||(t[5]=s=>c(N)?N.value=s:null)},l(se),{"error-message":l(f).cliente_phone,class:"w-full",type:"number"}),null,16,["modelValue","error-message"]),r(m,v({label:"Ciudad de donde Proviene"},l(le),{modelValue:l(O),"onUpdate:modelValue":t[6]||(t[6]=s=>c(O)?O.value=s:null),"error-message":l(f).city,class:"w-full"}),null,16,["modelValue","error-message"]),r(m,v({label:"Edificio u Hotel",class:"w-full"},l(oe),{modelValue:l(q),"onUpdate:modelValue":t[7]||(t[7]=s=>c(q)?q.value=s:null),"error-message":l(f).cliente_building}),null,16,["modelValue","error-message"]),r(m,v({type:"time",label:"Hora de Actividad",class:"w-full"},l(ae),{modelValue:l(U),"onUpdate:modelValue":t[8]||(t[8]=s=>c(U)?U.value=s:null),"error-message":l(f).hour}),null,16,["modelValue","error-message"]),r(m,v({class:"w-full",label:"Abono"},l(re),{modelValue:l(F),"onUpdate:modelValue":t[9]||(t[9]=s=>c(F)?F.value=s:null),"error-message":l(f).abono,min:"1",type:"number"}),null,16,["modelValue","error-message"]),r(m,v({class:"w-full",min:"0"},l(ie),{type:"dropdown","option-label":"name","option-value":"id",options:I.value,modelValue:l(T),"onUpdate:modelValue":t[10]||(t[10]=s=>c(T)?T.value=s:null),label:"Medio de Pago"}),null,16,["options","modelValue"]),e("div",$e,[e("h1",Be," Precio total: "+i(l(g).format(ue.value)),1)]),e("div",ke,[r(n,{type:"submit",severity:"success",label:"Guardar",loading:R.value},null,8,["loading"])])],32)]),_:1},8,["modelValue"]),r(l(De)),r(V,{visible:S.value,"onUpdate:visible":t[16]||(t[16]=s=>S.value=s),"pt:root:class":"!bg-blue-100",header:"Detalles de la actividad",position:"right"},{header:A(()=>[e("div",Ne,[e("span",Oe,i(a.value.service.title),1)])]),footer:A(()=>[e("div",vt,[e("h1",ft,"Saldo: "+i(l(g).format(a.value.total_price-a.value.payment.reduce((s,d)=>s+d.amount,0))),1),e("div",pt,[j(r(n,{onClick:t[12]||(t[12]=s=>E("COMPLETADA",!0)),icon:"fa-solid fa-circle-check",text:"",size:"large",class:"flex-auto",severity:"success"},null,512),[[b,"Completar Servicio",void 0,{top:!0}]]),j(r(n,{onClick:t[13]||(t[13]=s=>E("NO SHOW",!0)),icon:"fa-solid fa-eye-slash",text:"",size:"large",class:"flex-auto",severity:"warn"},null,512),[[b,"Servicio No show",void 0,{top:!0}]]),j(r(n,{onClick:t[14]||(t[14]=s=>E("CANCELADA",!0)),icon:"fa-solid fa-xmark-circle",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[b,"Cancelar Servicio",void 0,{top:!0}]]),j(r(n,{onClick:t[15]||(t[15]=s=>E("PROBLEMATICA",!1)),icon:"fa-solid fa-person-dress-burst",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[b,"Servicio Problematico",void 0,{top:!0}]])])])]),default:A(()=>{var s;return[e("div",qe,[e("div",Ue,[Fe,e("p",null,i(a.value.date),1)]),e("div",Te,[Re,e("p",null,i(a.value.hour),1)]),e("div",Me,[Le,e("p",null,i(a.value.cliente_name),1)]),e("div",ze,[Ie,e("p",null,i(a.value.cliente_city),1)]),e("div",He,[We,e("a",{href:`tel://${a.value.cliente_phone}`},i(a.value.cliente_phone),9,Ge)]),e("div",Qe,[Je,e("p",null,i(a.value.cliente_building),1)]),e("div",Ke,[Xe,e("p",null,i(a.value.adults),1)]),e("div",Ye,[Ze,e("p",null,i(a.value.boys),1)]),e("div",et,[tt,e("p",null,i(l(g).format(a.value.total_price)),1)]),a.value.user?(C(),P("div",st,[lt,e("p",null,i((s=a.value.user)==null?void 0:s.name),1)])):Q("",!0),a.value.user?(C(),P("div",ot,[at,e("p",null,i(new Date(a.value.created_at).toLocaleDateString("es-CO")),1)])):Q("",!0),e("div",rt,[e("div",it,[nt,e("div",dt,i(l(g).format(a.value.payment.reduce((d,ve)=>d+ve.amount,0))),1)]),(C(!0),P(xe,null,_e(a.value.payment,d=>(C(),P("div",ut,[e("div",null,[e("div",ct,i(d.type)+" "+i(l(g).format(d.amount)),1),e("div",null,i(new Date(d.created_at).toLocaleDateString("es-CO"))+" "+i(d.metohd_payment.name),1)]),e("div",{class:ge(["uppercase",d.status=="pendiente"?"bg-red-500 p-1 text-white rounded-lg shadow-md shadow-red-500":""])},[he(i(d.status)+" ",1),mt],2)]))),256))])])]}),_:1},8,["visible"])]),_:1})}}};export{Ot as default};
