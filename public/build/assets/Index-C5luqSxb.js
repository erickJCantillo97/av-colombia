import{x as fe,y as K,d as m,z as be,q as U,o as f,f as y,a as s,b as r,w as I,u as a,g as M,F as E,i as N,n as ee,t as w,A as ge,C as xe,B as L,W as X,D as ye,c as j,k as z,h as Y,T as _e}from"./app-EWOmaCfw.js";import{s as Ve}from"./index-BoyA2nwV.js";import{s as we}from"./index-BqdYiAOx.js";import{_ as he}from"./Datatable-BP9IoItN.js";import{_ as i,a as te}from"./Modal-Cir0YHi9.js";import{_ as Ce}from"./AppLayout-TXu6EnvV.js";import{s as ke}from"./index-BRgVC0xQ.js";import{S as Z,a as Se}from"./toasts-CuGasqAw.js";import{_ as Ae,a as De}from"./Notas-DHjhqGAk.js";import{_ as $e}from"./logo-BPQn4H7U.js";import"./index-BmVByocl.js";import"./index-CvFEXdRP.js";import"./index-m8RaFb6R.js";import"./index-BwCIGKPP.js";import"./index-D3ZEhRao.js";import"./index-qp8OlEhm.js";import"./index-CutyXYEI.js";import"./index-Bto1JRKd.js";import"./postcss-wcqKN7rU.js";import"./index-B4UeSfF6.js";import"./index-CaCqVJwF.js";import"./index-CVTfU2ty.js";import"./index-DpyPSFjA.js";import"./index-B-UIwk68.js";import"./index-BpNHCGG3.js";import"./useCommonUtilities-DO03hYfs.js";import"./moment-Cijl8gKs.js";import"./index-DvgpiVU2.js";import"./index-G6IgJ5YK.js";import"./index-BbpZh-tz.js";import"./index-xfeo0sML.js";import"./Loading-BrNFrBfB.js";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Ue=()=>{};function Ee(T,_,b){let x;fe(b)?x={evaluating:b}:x={};const{lazy:h=!1,evaluating:d=void 0,shallow:u=!0,onError:g=Ue}=x,C=K(!h),S=u?K(_):m(_);let A=0;return be(async k=>{if(!C.value)return;A++;const R=A;let B=!1;d&&Promise.resolve().then(()=>{d.value=!0});try{const t=await T(V=>{k(()=>{d&&(d.value=!1),B||V()})});R===A&&(S.value=t)}catch(t){g(t)}finally{d&&R===A&&(d.value=!1),B=!0}}),h?U(()=>(C.value=!0,S.value)):S}const Be={key:0,class:"items-center justify-center flex flex-col"},Pe={class:"flex flex-col gap-y-3 h-[60vh] overflow-y-auto"},Oe={class:"shadow-lg pr-4 rounded-md flex items-center justify-between"},Te={class:"text-xl font-bold"},Re={class:"font-bold text-sm"},je={__name:"Changes",setup(T){const _=m(!1),b=m(),x=Ee(async()=>{var{data:d}=await ge.get(route("get.states.change",{date:b.value}));return console.log(d.status),d.status}),h={reservado:"blue","CAMBIO DE FECHA":"gray","NO SHOW":"amber",REUBICADO:"orange",CANCELADA:"green",PROBLEMATICA:"red"};return(d,u)=>(f(),y(E,null,[s("span",{onClick:u[0]||(u[0]=g=>_.value=!0),class:"text-xs font-bold text-blue-800 cursor-pointer"},"Listado de Cambios"),r(te,{title:"Historial de Cambios",modelValue:_.value,"onUpdate:modelValue":u[2]||(u[2]=g=>_.value=g),"close-on-escape":""},{default:I(()=>[r(i,{"max-date":new Date,type:"date",class:"my-2",modelValue:b.value,"onUpdate:modelValue":u[1]||(u[1]=g=>b.value=g),dateFormat:"dd/mm/yy"},null,8,["max-date","modelValue"]),a(x)&&a(x).length==0?(f(),y("div",Be,[r($e),u[3]||(u[3]=s("p",null,"Sin Cambio Registrados",-1))])):M("",!0),s("div",Pe,[(f(!0),y(E,null,N(a(x),g=>(f(),y("div",Oe,[s("div",{class:ee(["rounded-l-md text-lg font-bold uppercase",`bg-${h[g.state]}-200 p-2`])},w(g.state),3),s("div",null,[s("p",Te,w(g.statable.service),1),s("span",Re,w(g.user.name),1)])]))),256))])]),_:1},8,["modelValue"])],64))}},Ie={class:"h-[92vh]"},Me={class:"flex py-2 px-4 justify-between items-center"},Ne={class:"italic flex flex-col"},Fe={class:"flex gap-x-2"},He={class:"text-xs italic"},Le=["onClick"],ze={class:"text-sm font-bold uppercase"},We={class:"text-xs italic"},Ge={class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-center",novalidate:""},Qe={class:"w-full col-span-1 md:col-span-4 flex justify-between gap-x-2 items-center"},qe={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},Je={class:"text-lg font-mono font-semibold"},Ke={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},Xe={class:"text-lg font-mono font-semibold"},Ye={key:0,class:"mt-4 w-full col-span-1 md:col-span-4 rounded-lg"},Ze={class:"flex gap-x-2"},et={class:"mt-4 w-full col-span-1 md:col-span-4 border rounded-lg"},tt={class:"text-2xl font-mono font-semibold text-center bg-black rounded-t-lg text-white gap-x-3 p-2"},lt={class:"flex justify-between gap-x-4 px-2"},ot={class:"mt-4 w-full col-span-1 md:col-span-4 border rounded-lg"},at={class:"text-2xl font-mono font-semibold text-center bg-green-800 rounded-t-lg text-white gap-x-3 p-2"},st={class:"flex justify-between gap-x-4 px-2"},rt={class:"flex justify-end gap-x-2 mt-4 w-full"},Nt={__name:"Index",props:{bookingServices:Array},setup(T){const _=T,{toast:b}=Se(),x=m(!1),h=m(null),d=m([]),u=m(null),g=U(()=>_.bookingServices.filter(l=>{if(d.value[0]==null)return u.value==null||l.status==u.value;var e=new Date(l.date).toISOString().split("T")[0];return e>=new Date(d.value[0]).toISOString().split("T")[0]&&e<=new Date(d.value[1]).toISOString().split("T")[0]&&(u.value==null||l.status==u.value)})),C=U(()=>{if(!d.value[0])return _.bookingServices;const[l,e]=d.value.map(n=>new Date(n).toISOString().split("T")[0]);return _.bookingServices.filter(n=>{const p=new Date(n.date).toISOString().split("T")[0];return p>=l&&p<=e})}),S=m(!1),A=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),k=m(!1),R={action:()=>{t.reset(),k.value=!0}},B=m([]),t=xe({id:"",service_id:null,date:"",adults:1,time_service:"",boys:0,cliente_name:"",cliente_phone:"",cliente_city:"",cliente_building:"",mascota:0,persona_adicional:0,cobre_transaccion:0,cobro_extra_cliente:0,reserva:0,abono:0,method_id:"",channel_id:"9d99a95f-6c3d-48fd-aa7d-6ef4e6860123",percent_descuento:0,proveedors:[],total:0,total_real:0,percent_channel:0,observations:""}),V=m([{proveedor:null,costo:""}]),F=m([]),le=()=>{axios.get(route("get.services")).then(l=>{F.value=l.data.services})},W=()=>{V.value.push({proveedor:null,costo:""})},G=l=>{l!=0&&V.value.splice(l,1)},D=m([]),P=m([]),oe=()=>{axios.get(route("proveedors.index")).then(l=>{D.value=l.data.proveedors}).catch(l=>{console.log(l)})},Q=l=>{var e;l.costo=D.value.find(n=>n.id==l.proveedor).services.find(n=>n.id==t.service_id)===void 0?0:((e=D.value.find(n=>n.id==l.proveedor).services.find(n=>n.id==t.service_id))==null?void 0:e.pivot.value)*t.adults,console.log(l)},ae=()=>{axios.get(route("channels.index")).then(l=>{P.value=l.data}).catch(l=>{console.log(l)})};le(),ae(),oe();const q=m(null),se=m([]),re=m(""),ne=[{label:"Detalles",action:l=>{h.value=l,x.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:l=>{t.id=l.id;const e=(n,p)=>{const[$,o,c]=n.split("-"),[v,pe]=p.split(":");return`${$}-${o}-${c},${v}:${pe}`};t.date=e(l.date,l.hour),t.service_id=l.service_id,t.cliente_name=l.cliente_name,t.cliente_phone=l.cliente_phone,t.cliente_city=l.cliente_city,t.cliente_building=l.cliente_building,t.adults=l.adults,t.total=l.total,t.method_id=l.method_id,t.channel_id=l.channel_id,t.percent_descuento=l.percent_descuento,t.proveedors=l.proveedors,t.time_service=l.time_service,V.value=l.proveedors.map(n=>({proveedor:n.proveedor_id,costo:n.cost})),t.observations=l.observations,h.value=l,k.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Notas",severity:"secondary",action:l=>{q.value=l,S.value=!0},badge:l=>l.notes,icon:"fa-solid fa-note-sticky text-sm"},{label:"Problematica",show:L().props.auth.user.rol=="admin",action:l=>{var e=l.problematic?"Desmarcar":"Marcar";Z.fire({title:"Estas Seguro?",text:`${e} como problematica esta reservaci칩n!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${e}!`}).then(n=>{n.isConfirmed&&X.post(route("booking.problematic",l.id),{onSuccess:()=>{b("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"},{label:"Eliminar",icon:"fa-solid fa-trash text-sm",severity:"danger",show:L().props.auth.user.rol=="SUPER ADMINISTRADOR"||L().props.auth.user.rol=="admin",action:l=>{Z.fire({title:"Estas Seguro?",text:`Eliminar la reservaci칩n de ${l.cliente_name}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, Eliminar!"}).then(e=>{e.isConfirmed&&X.delete(route("BookingServices.destroy",l.id),{onSuccess:()=>{b("success","Reserva Eliminada")}})})}}],ie=[{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"adults",header:"Pasajeros",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!1,type:"date",sortable:!0},{field:"channel.name",header:"Canal de venta",filter:!0,sortable:!0},{field:"proveedors_names",header:"proveedores",class:"text-center font-semibold text-sm",filter:!0},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"CAMBIO DE FECHA",class:"bg-gray-200 font-bold"},{text:"COMPLETADA",severity:"success",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"REUBICADO",severity:"warn",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"},{text:"PROBLEMATICA",severity:"danger",class:"animate-pulse"}]}],de=[{text:"reservado",color:"blue"},{text:"CAMBIO DE FECHA",color:"gray"},{text:"NO SHOW",color:"amber"},{text:"REUBICADO",color:"orange"},{text:"CANCELADA",color:"green"}],ue=U(()=>t.total/t.adults),H=U(()=>{let l=P.value.find(n=>n.id==t.channel_id),e=l?l.percent/100:0;return t.total-t.total*e}),O=m(!1),ce=l=>{if(l.preventDefault(),!t.cliente_building)return b("error","Rellene Todos los Campos"),0;t.total_real=H.value,t.percent_channel=P.value.find(e=>e.id==t.channel_id).percent,O.value=!0,t.proveedors=V.value,t.post(route("reservar"),{onSuccess:()=>{t.reset(),O.value=!1,k.value=!1,b("success","Reserva creada con exito")},onError:()=>{O.value=!1,b("error","Error al crear la reserva")}})},me=()=>{t.total_real=H.value,t.percent_channel=P.value.find(l=>l.id==t.channel_id).percent,t.proveedors=V.value,t.put(route("BookingServices.update",t.id),{onSuccess:()=>{k.value=!1,b("success","Reserva actualizada con exito")}})};(()=>{axios.get(route("paymentMethods.index")).then(l=>{B.value=l.data}).catch(l=>{console.log(l)})})();const J=l=>{const[e,n,p]=l.split("-");return new Date(e,n-1,p)},ve=U(()=>{var l=[],e=F.value.find(c=>c.id==t.service_id);if(!e)return[];for(var n of e.locks)for(var p=J(n.start_date),$=J(n.end_date),o=p;o<=$;o.setDate(o.getDate()+1))l.push(new Date(o));return l});return ye(t.adults,l=>{for(var e of V.value)e.proveedor&&(e.costo=D.value.find(n=>n.id==e.proveedor).pivot.value*l)}),(l,e)=>{const n=we,p=Ve,$=_e;return f(),y(E,null,[r(Ce,{title:"Reservas"},{default:I(()=>[e[32]||(e[32]=s("div",{class:"hidden bg-amber-200 bg-orange-200"},null,-1)),s("div",Ie,[s("div",Me,[s("div",Ne,[e[24]||(e[24]=s("h1",{class:"text-2xl font-bold"},"Reservas",-1)),r(je)]),s("div",Fe,[s("div",{class:"p-2 bg-black text-white text-center rounded-lg cursor-pointer transition-all duration-300 scale-95 hover:scale-100",onClick:e[0]||(e[0]=o=>u.value=null)},[e[25]||(e[25]=s("p",{class:"text-sm font-bold uppercase"},"Todos",-1)),s("p",He,w(C.value.length)+" Reservas | "+w(C.value.reduce((o,c)=>o+c.adults,0))+" Pasajeros ",1)]),(f(),y(E,null,N(de,o=>s("div",{onClick:c=>C.value.filter(v=>v.status==o.text).length!=0?u.value=o.text:null,class:ee(["flex flex-col items-center transition-all duration-300",[`bg-${o.color}-200 p-2 rounded-lg`,u.value==o.text?"border-2 border-gray-500 scale-105":"border-2 border-transparent scale-95",C.value.filter(c=>c.status==o.text).length==0?"cursor-not-allowed opacity-55":"cursor-pointer hover:scale-105 hover:border-2 hover:border-gray-500"]])},[s("p",ze,w(o.text),1),s("p",We,w(C.value.filter(c=>c.status==o.text).length)+" Reservas | "+w(C.value.filter(c=>c.status==o.text).reduce((c,v)=>c+v.adults,0))+" Pasajeros ",1)],10,Le)),64))]),z(r(n,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=o=>d.value=o),selectionMode:"range",dateFormat:"dd/mm/yy",manualInput:!1},null,8,["modelValue"]),[[$,"Filtrar fecha de Actividad",void 0,{bottom:!0}]])]),r(he,{actions:ne,add:R,showButtonBar:"",columnas:ie,data:g.value,routecreate:"services.create",rowClass:!0},null,8,["data"])]),r(te,{modelValue:k.value,"onUpdate:modelValue":e[21]||(e[21]=o=>k.value=o),title:"A침adir Reserva",width:"70vw"},{footer:I(()=>[s("div",rt,[r(p,{onClick:e[20]||(e[20]=o=>k.value=!1),severity:"danger",label:"Cancelar",loading:O.value},null,8,["loading"]),a(t).id?(f(),j(p,{key:0,type:"submit",label:"Actualizar",severity:"warn",onClick:me})):(f(),j(p,{key:1,type:"submit",severity:"success",label:"Guardar",loading:O.value,onClick:ce},null,8,["loading"]))])]),default:I(()=>[s("form",Ge,[r(i,{class:"col-span-4",type:"dropdown",modelValue:a(t).service_id,"onUpdate:modelValue":e[2]||(e[2]=o=>a(t).service_id=o),"error-message":a(t).errors.service_id,label:"Servicio","option-label":"title","option-value":"id",options:F.value},null,8,["modelValue","error-message","options"]),r(i,{label:"Fecha de Reserva",enableTimePicker:!0,"disabled-dates":ve.value,modelValue:a(t).date,"onUpdate:modelValue":e[3]||(e[3]=o=>a(t).date=o),required:"",class:"w-full",type:"datetime"},null,8,["disabled-dates","modelValue"]),r(i,{label:"Valor Total",type:"number",mode:"currency",modelValue:a(t).total,"onUpdate:modelValue":e[4]||(e[4]=o=>a(t).total=o)},null,8,["modelValue"]),r(i,{label:"Tiempo del Servicio",type:"dropdown",modelValue:a(t).time_service,"onUpdate:modelValue":e[5]||(e[5]=o=>a(t).time_service=o),options:["20 Minutos","30 Minutos","40 Minutos","1 Hora","2 Horas","6 Horas","12 Horas","24 Horas"]},null,8,["modelValue"]),r(i,{label:"Pasajeros",type:"number",modelValue:a(t).adults,"onUpdate:modelValue":e[6]||(e[6]=o=>a(t).adults=o)},null,8,["modelValue"]),r(i,{label:"Ni침os",type:"number",modelValue:a(t).boys,"onUpdate:modelValue":e[7]||(e[7]=o=>a(t).boys=o)},null,8,["modelValue"]),r(i,{label:"Nombre del Pasajero",modelValue:a(t).cliente_name,"onUpdate:modelValue":e[8]||(e[8]=o=>a(t).cliente_name=o),"error-message":a(t).errors.cliente_name,class:"w-full"},null,8,["modelValue","error-message"]),r(i,{label:"Telefono",modelValue:a(t).cliente_phone,"onUpdate:modelValue":e[9]||(e[9]=o=>a(t).cliente_phone=o),"error-message":a(t).errors.cliente_phone,class:"w-full",type:"number"},null,8,["modelValue","error-message"]),r(i,{label:"Ciudad de donde Proviene",modelValue:a(t).cliente_city,"onUpdate:modelValue":e[10]||(e[10]=o=>a(t).cliente_city=o),"error-message":a(t).errors.city,class:"w-full"},null,8,["modelValue","error-message"]),r(i,{label:"Edificio u Hotel",class:"w-full",modelValue:a(t).cliente_building,"onUpdate:modelValue":e[11]||(e[11]=o=>a(t).cliente_building=o),"error-message":a(t).errors.cliente_building},null,8,["modelValue","error-message"]),r(i,{class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:B.value,modelValue:a(t).method_id,"onUpdate:modelValue":e[12]||(e[12]=o=>a(t).method_id=o),label:"Medio de Pago"},null,8,["options","modelValue"]),r(i,{class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:P.value,modelValue:a(t).channel_id,"onUpdate:modelValue":e[13]||(e[13]=o=>a(t).channel_id=o),label:"Canal de Venta"},null,8,["options","modelValue"]),r(i,{class:"w-full",label:"Descuento",modelValue:a(t).percent_descuento,"onUpdate:modelValue":e[14]||(e[14]=o=>a(t).percent_descuento=o),"error-message":a(t).errors.percent_descuento,min:"0",max:"100",type:"number",suffix:" %"},null,8,["modelValue","error-message"]),r(i,{class:"w-full col-span-1 md:col-span-4","rows-textarea":2,label:"Observaciones",modelValue:a(t).observations,"onUpdate:modelValue":e[15]||(e[15]=o=>a(t).observations=o),"error-message":a(t).errors.observations,type:"textarea"},null,8,["modelValue","error-message"]),s("div",Qe,[s("div",qe,[s("p",Je,w(a(A).format(ue.value)),1),e[26]||(e[26]=s("p",{class:"italic text-md"},"Valor Pasajero",-1))]),s("div",Ke,[s("p",Xe,w(a(A).format(H.value)),1),e[27]||(e[27]=s("p",{class:"italic text-md"},"Valor Real",-1))])]),a(t).service_id?(f(),y("div",Ye,[s("div",Ze,[r(i,{label:"Placa del Vehiculo",modelValue:a(t).vehicle_plate,"onUpdate:modelValue":e[16]||(e[16]=o=>a(t).vehicle_plate=o),class:"w-full"},null,8,["modelValue"]),r(i,{label:"Nombre del Conductor",modelValue:a(t).driver_name,"onUpdate:modelValue":e[17]||(e[17]=o=>a(t).driver_name=o),class:"w-full"},null,8,["modelValue"])])])):M("",!0),s("div",et,[s("h1",tt,[e[28]||(e[28]=Y(" Proveedores ")),r(p,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:e[18]||(e[18]=o=>W())})]),e[29]||(e[29]=s("div",{class:"flex justify-between w-full font-bold px-2"},[s("label",{for:""},"Proveedor"),s("label",{for:""},"Costo"),s("label",{for:""},".")],-1)),(f(!0),y(E,null,N(V.value,(o,c)=>(f(),y("div",lt,[r(i,{type:"dropdown",modelValue:o.proveedor,"onUpdate:modelValue":v=>o.proveedor=v,onValueChange:v=>Q(o),"option-label":"nombre","option-value":"id",class:"w-full",options:D.value},null,8,["modelValue","onUpdate:modelValue","onValueChange","options"]),r(i,{type:"number",mode:"currency",class:"w-full",modelValue:o.costo,"onUpdate:modelValue":v=>o.costo=v},null,8,["modelValue","onUpdate:modelValue"]),z(r(p,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:v=>G(c)},null,8,["onClick"]),[[$,"Quitar"]])]))),256))]),s("div",ot,[s("h1",at,[e[30]||(e[30]=Y(" Cargos Extras ")),r(p,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:e[19]||(e[19]=o=>W())})]),e[31]||(e[31]=s("div",{class:"flex justify-between w-full font-bold px-2"},[s("label",{for:""},"Proveedor"),s("label",{for:""},"Costo"),s("label",{for:""},".")],-1)),(f(!0),y(E,null,N(V.value,(o,c)=>(f(),y("div",st,[r(i,{type:"dropdown",modelValue:o.proveedor,"onUpdate:modelValue":v=>o.proveedor=v,onValueChange:v=>Q(o),"option-label":"nombre","option-value":"id",class:"w-full",options:D.value},null,8,["modelValue","onUpdate:modelValue","onValueChange","options"]),r(i,{type:"number",mode:"currency",class:"w-full",modelValue:o.costo,"onUpdate:modelValue":v=>o.costo=v},null,8,["modelValue","onUpdate:modelValue"]),z(r(p,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:v=>G(c)},null,8,["onClick"]),[[$,"Quitar"]])]))),256))])])]),_:1},8,["modelValue"]),r(a(ke)),h.value?(f(),j(De,{key:0,modelValue:x.value,"onUpdate:modelValue":e[22]||(e[22]=o=>x.value=o),service:h.value,proveedors:D.value},null,8,["modelValue","service","proveedors"])):M("",!0)]),_:1}),S.value?(f(),j(Ae,{key:0,modelValue:S.value,"onUpdate:modelValue":e[23]||(e[23]=o=>S.value=o),notes:se.value,note:re.value,service:q.value},null,8,["modelValue","notes","note","service"])):M("",!0)],64)}}};export{Nt as default};
