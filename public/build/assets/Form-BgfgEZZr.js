import{Q as N,d as S,u as U,A as g,p as O,B as F,c as R,o as u,w as B,a as e,i as m,b as i,h as o,k as $,f as c,g as x,V as I,t as l,F as A,j as H,n as z}from"./app-Daz5hQqP.js";import{_ as M}from"./AppLayout-GG1o9e9g.js";import{_ as p}from"./Input-2c0UPahG.js";import{_ as w}from"./InputError-DwTk9wVQ.js";import{s as E}from"./index-B0UQXbCX.js";import{b as G}from"./postcss-CKKfy64Q.js";import{s as L}from"./index-C8hdP8cj.js";import"./marked.esm-BPgSS2IS.js";import"./Auth-BSRt_T7d.js";import"./index-BwsTNDEX.js";import"./index-DdayreIq.js";import"./index-CgLYefFZ.js";import"./index-BRFLvT6g.js";import"./index-FJewQ5Kq.js";import"./index-CgZwvQSx.js";import"./index-CUhoAKgl.js";import"./index-BGM17kiH.js";import"./index-CIangVzy.js";import"./index-Bx_4kJFn.js";import"./index-B_6te62D.js";import"./index-VK-jRE3F.js";import"./index-D2D_5DhT.js";import"./index-oybTknhm.js";import"./index-D57tIMx8.js";import"./index-Cf8uqb4F.js";import"./index-DY3VNik6.js";import"./index-CCo-F7CA.js";import"./useCommonUtilities-BgDhORlD.js";import"./postcss-C6hvmFKL.js";const Q={class:"h-[90vh] md:h-[99vh] overflow-y-auto"},J={class:"p-6"},K={class:"bg-white rounded-lg shadow-lg p-6 mb-6"},W={class:"bg-white rounded-lg shadow p-6"},X={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Y={key:0,class:"mt-4 p-3 bg-blue-50 rounded"},Z={class:"text-sm text-blue-700"},ee={class:"bg-white rounded-lg shadow p-6"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},te={class:"bg-white rounded-lg shadow p-6"},oe={key:0,class:"text-center py-8"},ae={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},le=["onClick"],re={class:"flex justify-between items-start mb-2"},ie={class:"font-semibold"},ne={class:"text-sm text-gray-600 mb-3"},de={class:"space-y-1 text-sm"},ue={class:"flex justify-between"},me={class:"flex justify-between"},ce={class:"flex justify-between font-semibold text-green-600"},pe={key:0,class:"border-t pt-2 mt-2"},_e={class:"flex justify-between font-bold"},fe={class:"text-green-600"},ge={class:"bg-white rounded-lg shadow p-6"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ve={class:"bg-white rounded-lg shadow p-6"},he={key:0,class:"bg-white rounded-lg shadow p-6 border-l-4 border-green-500"},ye={class:"space-y-2"},ke={class:"flex justify-between"},xe={class:"flex justify-between"},we={class:"flex justify-between"},Ve={class:"flex justify-between text-lg font-bold text-green-600"},Pe={class:"flex justify-between space-x-4"},ss={__name:"Form",props:{accommodation:Object,rooms:Array,searchParams:{type:Object,default:()=>({})}},setup(b){const d=b,v=N(),h=S([]),s=U({accommodation_id:null,room_id:null,check_in_date:null,check_out_date:null,guests_adults:2,guests_children:0,guest_name:"",guest_email:"",guest_phone:"",guest_document:"",special_requests:"",total_price:0}),T=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),f=r=>T.format(r),n=g(()=>{if(!s.check_in_date||!s.check_out_date)return 0;const r=new Date(s.check_in_date),a=new Date(s.check_out_date).getTime()-r.getTime();return Math.ceil(a/(1e3*3600*24))}),k=g(()=>parseInt(s.guests_adults)+parseInt(s.guests_children)),_=g(()=>h.value.find(r=>r.id===s.room_id)),V=g(()=>!_.value||n.value<=0?0:_.value.price*n.value),P=g(()=>s.check_in_date&&s.check_out_date&&s.room_id&&s.guest_name&&s.guest_email&&s.guest_phone&&s.guest_document&&n.value>0);O(()=>{d.searchParams.check_in&&(s.check_in_date=new Date(d.searchParams.check_in)),d.searchParams.check_out&&(s.check_out_date=new Date(d.searchParams.check_out)),d.searchParams.adults&&(s.guests_adults=d.searchParams.adults),d.searchParams.children&&(s.guests_children=d.searchParams.children),h.value=d.rooms||[],s.check_in_date&&s.check_out_date&&C()});const C=async()=>{if(!(!s.check_in_date||!s.check_out_date))try{const r=await axios.get(route("api.accommodations.availability",d.accommodation.id),{params:{check_in:s.check_in_date.toISOString().split("T")[0],check_out:s.check_out_date.toISOString().split("T")[0],guests:k.value}});h.value=r.data.available_rooms||[],s.room_id&&!h.value.find(t=>t.id===s.room_id)&&(s.room_id=null)}catch(r){console.error("Error checking availability:",r),v.add({severity:"error",summary:"Error",detail:"Error al verificar disponibilidad",life:3e3})}},y=()=>{setTimeout(()=>{C()},100)},q=r=>{s.room_id=r.id};F(()=>V.value,r=>{s.total_price=r});const D=()=>{if(!P.value){v.add({severity:"warn",summary:"Datos Incompletos",detail:"Por favor completa todos los campos requeridos",life:3e3});return}s.post(route("booking-accommodations.store"),{onSuccess:()=>{v.add({severity:"success",summary:"Reserva Creada",detail:"Tu reserva ha sido confirmada exitosamente",life:5e3})},onError:()=>{v.add({severity:"error",summary:"Error",detail:"Error al crear la reserva. Verifica los datos e intenta nuevamente.",life:3e3})}})};return(r,t)=>(u(),R(M,{title:"Nueva Reserva"},{default:B(()=>[e("div",Q,[e("div",J,[t[29]||(t[29]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold mb-2"},"Nueva Reserva"),e("p",{class:"text-gray-600"},"Completa los datos para crear tu reserva")],-1)),e("div",K,[t[12]||(t[12]=e("h2",{class:"text-lg font-semibold mb-4 flex items-center"},[e("i",{class:"fa-solid fa-building mr-2"}),m(" Seleccione el Alojamiento ")],-1)),e("div",null,[i(p,{modelValue:o(s).accommodation_id,"onUpdate:modelValue":t[0]||(t[0]=a=>o(s).accommodation_id=a),type:"dropdown",options:b.rooms,"option-label":"name","option-value":"id"},null,8,["modelValue","options"])])]),e("form",{onSubmit:$(D,["prevent"]),class:"space-y-6"},[e("div",W,[t[16]||(t[16]=e("h3",{class:"text-lg font-semibold mb-4 flex items-center"},[e("i",{class:"fa-solid fa-calendar mr-2"}),m(" Fechas de Estadía ")],-1)),e("div",X,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Check-in",-1)),i(o(I),{modelValue:o(s).check_in_date,"onUpdate:modelValue":[t[1]||(t[1]=a=>o(s).check_in_date=a),y],"min-date":new Date,teleport:!0,"auto-apply":"","enable-time-picker":!1,timezone:"America/Bogota",placeholder:"Fecha de entrada"},null,8,["modelValue","min-date"]),i(w,{class:"mt-2",message:o(s).errors.check_in_date},null,8,["message"])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Check-out",-1)),i(o(I),{modelValue:o(s).check_out_date,"onUpdate:modelValue":[t[2]||(t[2]=a=>o(s).check_out_date=a),y],"min-date":o(s).check_in_date||new Date,teleport:!0,"auto-apply":"","enable-time-picker":!1,timezone:"America/Bogota",placeholder:"Fecha de salida"},null,8,["modelValue","min-date"]),i(w,{class:"mt-2",message:o(s).errors.check_out_date},null,8,["message"])])]),n.value>0?(u(),c("div",Y,[e("div",Z,[t[15]||(t[15]=e("i",{class:"fa-solid fa-info-circle mr-1"},null,-1)),m(" Estadía de "+l(n.value)+" "+l(n.value===1?"noche":"noches"),1)])])):x("",!0)]),e("div",ee,[t[17]||(t[17]=e("h3",{class:"text-lg font-semibold mb-4 flex items-center"},[e("i",{class:"fa-solid fa-users mr-2"}),m(" Número de Huéspedes ")],-1)),e("div",se,[i(p,{label:"Adultos",modelValue:o(s).guests_adults,"onUpdate:modelValue":t[3]||(t[3]=a=>o(s).guests_adults=a),type:"number",min:"1",required:"",error:o(s).errors.guests_adults,onInput:y},null,8,["modelValue","error"]),i(p,{label:"Niños",modelValue:o(s).guests_children,"onUpdate:modelValue":t[4]||(t[4]=a=>o(s).guests_children=a),type:"number",min:"0",error:o(s).errors.guests_children,onInput:y},null,8,["modelValue","error"])])]),e("div",te,[t[22]||(t[22]=e("h3",{class:"text-lg font-semibold mb-4 flex items-center"},[e("i",{class:"fa-solid fa-bed mr-2"}),m(" Seleccionar Habitación ")],-1)),b.rooms.find(a=>a.id===o(s).accommodation_id)?.rooms.length===0?(u(),c("div",oe,[...t[18]||(t[18]=[e("div",{class:"text-gray-500 mb-2"},[e("i",{class:"fa-solid fa-exclamation-triangle text-2xl"})],-1),e("p",{class:"text-gray-600"},"No hay habitaciones disponibles para las fechas seleccionadas",-1)])])):(u(),c("div",ae,[(u(!0),c(A,null,H(b.rooms.find(a=>a.id===o(s).accommodation_id)?.rooms,a=>(u(),c("div",{key:a.id,class:z(["border rounded-lg p-4 cursor-pointer transition-all hover:shadow-md",o(s).room_id===a.id?"border-blue-500 bg-blue-50":"border-gray-200"]),onClick:j=>q(a)},[e("div",re,[e("h4",ie,l(a.name),1),i(o(G),{modelValue:o(s).room_id,"onUpdate:modelValue":t[5]||(t[5]=j=>o(s).room_id=j),inputId:"room-"+a.id,value:a.id},null,8,["modelValue","inputId","value"])]),e("p",ne,l(a.description),1),e("div",de,[e("div",ue,[t[19]||(t[19]=e("span",null,"Capacidad:",-1)),e("span",null,l(a.capacity)+" personas",1)]),e("div",me,[t[20]||(t[20]=e("span",null,"Tipo:",-1)),e("span",null,l(a.type),1)]),e("div",ce,[t[21]||(t[21]=e("span",null,"Precio por noche:",-1)),e("span",null,l(f(a.price)),1)]),n.value>0&&o(s).room_id===a.id?(u(),c("div",pe,[e("div",_e,[e("span",null,"Total ("+l(n.value)+" "+l(n.value===1?"noche":"noches")+"):",1),e("span",fe,l(f(a.price*n.value)),1)])])):x("",!0)])],10,le))),128))])),i(w,{class:"mt-2",message:o(s).errors.room_id},null,8,["message"])]),e("div",ge,[t[23]||(t[23]=e("h3",{class:"text-lg font-semibold mb-4 flex items-center"},[e("i",{class:"fa-solid fa-user mr-2"}),m(" Información del Huésped Principal ")],-1)),e("div",be,[i(p,{label:"Nombre Completo",modelValue:o(s).guest_name,"onUpdate:modelValue":t[6]||(t[6]=a=>o(s).guest_name=a),required:"",error:o(s).errors.guest_name},null,8,["modelValue","error"]),i(p,{label:"Correo Electrónico",modelValue:o(s).guest_email,"onUpdate:modelValue":t[7]||(t[7]=a=>o(s).guest_email=a),type:"email",required:"",error:o(s).errors.guest_email},null,8,["modelValue","error"]),i(p,{label:"Teléfono",modelValue:o(s).guest_phone,"onUpdate:modelValue":t[8]||(t[8]=a=>o(s).guest_phone=a),type:"tel",required:"",error:o(s).errors.guest_phone},null,8,["modelValue","error"]),i(p,{label:"Documento de Identificación",modelValue:o(s).guest_document,"onUpdate:modelValue":t[9]||(t[9]=a=>o(s).guest_document=a),required:"",error:o(s).errors.guest_document},null,8,["modelValue","error"])])]),e("div",ve,[t[24]||(t[24]=e("h3",{class:"text-lg font-semibold mb-4 flex items-center"},[e("i",{class:"fa-solid fa-comment mr-2"}),m(" Solicitudes Especiales (Opcional) ")],-1)),i(o(L),{modelValue:o(s).special_requests,"onUpdate:modelValue":t[10]||(t[10]=a=>o(s).special_requests=a),placeholder:"Ej: Habitación en planta baja, cama extra, llegada tardía, etc.",rows:"3",class:"w-full",error:o(s).errors.special_requests},null,8,["modelValue","error"])]),_.value&&n.value>0?(u(),c("div",he,[t[28]||(t[28]=e("h3",{class:"text-lg font-semibold mb-4 flex items-center"},[e("i",{class:"fa-solid fa-calculator mr-2"}),m(" Resumen de la Reserva ")],-1)),e("div",ye,[e("div",ke,[e("span",null,l(_.value.name),1),e("span",null,l(f(_.value.price))+" / noche",1)]),e("div",xe,[e("span",null,l(n.value)+" "+l(n.value===1?"noche":"noches"),1),e("span",null,l(f(_.value.price*n.value)),1)]),e("div",we,[e("span",null,l(k.value)+" "+l(k.value===1?"huésped":"huéspedes"),1),t[25]||(t[25]=e("span",null,"-",-1))]),t[27]||(t[27]=e("hr",null,null,-1)),e("div",Ve,[t[26]||(t[26]=e("span",null,"Total a Pagar:",-1)),e("span",null,l(f(V.value)),1)])])])):x("",!0),e("div",Pe,[i(o(E),{onClick:t[11]||(t[11]=a=>r.$inertia.visit(r.route("booking-accommodations.search"))),icon:"fa-solid fa-arrow-left",label:"Volver a Búsqueda",severity:"secondary",type:"button"}),i(o(E),{type:"submit",icon:"fa-solid fa-calendar-check",label:"Confirmar Reserva",loading:o(s).processing,disabled:!P.value},null,8,["loading","disabled"])])],32)])])]),_:1}))}};export{ss as default};
