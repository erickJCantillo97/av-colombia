import{d as h,x as Le,y as g,z as ie,A as y,Q as Ie,B as le,q as de,C as He,o as p,c as P,w as j,a as l,b as a,D as v,u as s,E as c,g as _,t as n,f as b,h as ue,F as te,i as oe,k as E,j as Qe,n as Ge,G as We}from"./app-5GMh4swJ.js";import{_ as Je,s as Ke}from"./AppLayout-BGxvO-0s.js";import{s as Xe}from"./index-Bdi0vjHo.js";import{_ as Ye}from"./Datatable-nuBefEWi.js";import{_ as i}from"./Input-CXy_KIQR.js";import{_ as Ze}from"./Modal-CYxa3PLw.js";import{s as el}from"./index-Dx_N4plT.js";import{S as se,a as ll}from"./toasts-DRkOXQyQ.js";import{u as tl}from"./vee-validate-ooKh2VgO.js";import"./index-D_JHaavE.js";import"./index-BbHWYXcQ.js";import"./index-DwP6cAGS.js";import"./index-DeqvkkC5.js";import"./postcss-D9XaE9Kc.js";const ol={class:"h-[99vh]"},sl={class:""},al={class:"text-xl font-mono font-semibold"},rl={key:4,class:"mt-4 w-full col-sapn-1 md:col-span-4 border rounded-lg"},nl={class:"text-2xl font-mono font-semibold text-center bg-black rounded-t-lg text-white gap-x-3 p-2"},il=l("div",{class:"flex justify-between w-full font-bold px-2"},[l("label",{for:""},"Proveedor"),l("label",{for:""},"Costo"),l("label",{for:""},".")],-1),dl={class:"flex justify-between gap-x-4 px-2"},ul={class:"flex justify-end mt-4 w-full col-sapn-1 md:col-span-3"},cl={class:"flex items-center gap-2"},ml={class:"font-bold text-lg"},vl={class:"flex flex-col gap-y-1.5 text-sm"},pl={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},fl=l("strong",null,"Fecha del Servicio:",-1),bl={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},gl=l("strong",null,"Hora del Servicio:",-1),_l={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},hl=l("strong",null,"Canal de Venta:",-1),yl={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},xl=l("strong",null,"Cliente:",-1),wl={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Vl=l("strong",null,"Ciudad:",-1),Cl={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Al=l("strong",null,"Telelfono:",-1),Sl=["href"],kl={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Dl=l("strong",null,"Edificio:",-1),$l={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ul=l("strong",null,"Adultos:",-1),Pl={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},jl=l("strong",null,"Niños:",-1),El={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},ql=l("strong",null,"Mascota:",-1),Bl={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Nl=l("strong",null,"Valor:",-1),Ol={key:0,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Tl=l("strong",null,"Vendedor:",-1),Fl={key:1,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ml=l("strong",null,"Fecha de reserva:",-1),Rl={key:2,class:"text-lg flex w-full justify-between mt-2"},zl=l("p",{class:"font-bold"}," Proveedores ",-1),Ll={class:"rounded-full bg-black text-white px-2"},Il={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Hl={class:"flex flex-col gap-y-2 mt-2"},Ql={class:"flex justify-between"},Gl=l("h2",{class:"text-xl font-bold"},"Pagos Realizados ",-1),Wl={class:"bg-blue-600 text-white p-1 rounded-lg"},Jl={class:"flex items-center text-xs justify-between border shadow-xl rounded-md p-1 bg-white"},Kl={class:"uppercase font-bold"},Xl=l("div",null,null,-1),Yl={class:"flex flex-col items-center gap-2"},Zl={class:"font-bold text-center"},et={key:0,class:"flex gap-x-2"},ht={__name:"Index",props:{bookingServices:Array},setup(ce){const{toast:q}=ll(),B=h(!1),r=h({}),S=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),D=h(!1),me={action:()=>{D.value=!0}},ae=h([]),ve=Le({service_id:g().required(),date:ie().required(),adults:y().required(),date:ie().required(),adults:y().required(),cliente_name:g().required(),cliente_phone:g().required(),cliente_city:g().required(),cliente_building:g().required(),hour:g().required(),abono:y().required(),method:g().required(),channel_id:g().required(),mascota:g(),persona_adicional:g(),cobre_transaccion:y(),cobro_extra_cliente:y(),alimentacion:y(),reserva:y().required(),saldo:y().required(),percent_descuento:y()}),{values:pe,defineField:u,errors:f,meta:lt}=tl({validationSchema:ve}),[w,fe]=u("service_id"),[N,be]=u("date"),[k,tt]=u("boys"),[x,ot]=u("adults"),[O,ge]=u("cliente_name"),[T,_e]=u("cliente_phone"),[F,he]=u("cliente_city"),[M,ye]=u("cliente_building"),[R,xe]=u("hour"),[Q,we]=u("abono"),[G,Ve]=u("channel_id"),[W,Ce]=u("method"),[J,Ae]=u("mascota"),[K,Se]=u("persona_adicional"),[X,ke]=u("cobre_transaccion"),[Y,De]=u("cobro_extra_cliente"),[Z,$e]=u("alimentacion"),[ee,Ue]=u("reserva"),[$,Pe]=u("percent_descuento");k.value=0,x.value=1;const U=h([{proveedor:null,costo:""}]),z=h([]),je=()=>{axios.get(route("get.services")).then(t=>{z.value=t.data.services})},Ee=()=>{U.value.push({proveedor:null,costo:""})},qe=t=>{t!=0&&U.value.splice(t,1)},L=h([]),re=h([]),Be=()=>{axios.get(route("get.proveedors",w.value)).then(t=>{L.value=t.data.proveedors}).catch(t=>{console.log(t)})},Ne=t=>{t.costo=L.value.find(e=>e.id==t.proveedor).pivot.value*x.value},Oe=()=>{axios.get(route("channels.index")).then(t=>{re.value=t.data}).catch(t=>{console.log(t)})};je(),Oe();const Te=[{label:"Detalles",action:t=>{r.value=t,B.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:t=>{N.value=t.date,w.value=t.service_id,x.value=t.adults,k.value=t.boys,O.value=t.cliente_name,T.value=t.cliente_phone,F.value=t.cliente_city,M.value=t.cliente_building,R.value=t.hour,r.value=t,D.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Problematica",show:Ie().props.auth.user.rol=="admin",action:t=>{var e=t.problematic?"Desmarcar":"Marcar";se.fire({title:"Estas Seguro?",text:`${e} como problematica esta reservación!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${e}!`}).then(d=>{d.isConfirmed&&le.post(route("booking.problematic",t.id),{onSuccess:()=>{q("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"}],Fe=[{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service.title",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!0,sortable:!0,type:"date"},{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"problematic",header:"Problematica",filter:!0,sortable:!0,type:"boolean"},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"COMPLETADA",severity:"success",class:""},{text:"DISEÑO",severity:"info",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"SERVICIO POSTVENTA",severity:"success",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"}]}],Me=de(()=>{let t=z.value.find(V=>V.id==w.value);if(!t)return 0;let e=t.adult_tarifa*x.value+t.boy_tarifa*k.value,d=$.value?$.value/100:0;return e-d*e}),I=h(!1),Re=t=>{t.preventDefault(),I.value=!0,le.post(route("reservar",{proveedors:U.value}),pe,{onSuccess:()=>{I.value=!1,D.value=!1,q("success","Reserva creada con exito")},onError:()=>{I.value=!1,q("error","Error al crear la reserva")}})};(()=>{axios.get(route("paymentMethods.index")).then(t=>{ae.value=t.data}).catch(t=>{console.log(t)})})();const ne=t=>{const[e,d,V]=t.split("-");return new Date(e,d-1,V)},ze=de(()=>{var t=[],e=z.value.find(m=>m.id==w.value);if(!e)return[];for(var d of e.locks)for(var V=ne(d.start_date),C=ne(d.end_date),o=V;o<=C;o.setDate(o.getDate()+1))t.push(new Date(o));return t}),H=(t,e)=>{se.fire({title:t,text:"Estas seguro de realizar esta acción?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si"}).then(d=>{d.isConfirmed&&(se.fire({title:t,text:"Esta reserva ha sido "+t+".",icon:"success"}),le.post(route("set.states"),{service:r.value.id,state:t,terminated:e},{onSuccess:()=>{B.value=!1,q("success","Reserva "+t)}}))})};return He(x,t=>{for(var e of U.value)e.proveedor&&(e.costo=L.value.find(d=>d.id==e.proveedor).pivot.value*t)}),(t,e)=>{const d=Xe,V=Ke,C=We;return p(),P(Je,{title:"Services"},{default:j(()=>[l("div",ol,[a(Ye,{actions:Te,add:me,columnas:Fe,data:ce.bookingServices,routecreate:"services.create",title:"Reservas"},null,8,["data"])]),a(Ze,{modelValue:D.value,"onUpdate:modelValue":e[20]||(e[20]=o=>D.value=o),title:"Añadir Reserva",width:"70vw"},{default:j(()=>[l("form",{onSubmit:Qe(Re,["prevent"]),class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-center",novalidate:""},[a(i,v({type:"dropdown",modelValue:s(w),"onUpdate:modelValue":e[0]||(e[0]=o=>c(w)?w.value=o:null),"error-message":s(f).service_id,label:"Servicio","option-label":"title","option-value":"id",onValueChange:Be,options:z.value},s(fe)),null,16,["modelValue","error-message","options"]),a(i,v({label:"Fecha de Reserva","disabled-dates":ze.value,modelValue:s(N),"onUpdate:modelValue":e[1]||(e[1]=o=>c(N)?N.value=o:null),required:"","min-date":new Date,class:"w-full",type:"date","error-message":t.errorDate},s(be)),null,16,["disabled-dates","modelValue","min-date","error-message"]),a(i,{label:"Pasajeros",type:"number",modelValue:s(x),"onUpdate:modelValue":e[2]||(e[2]=o=>c(x)?x.value=o:null)},null,8,["modelValue"]),a(i,{label:"Niños",type:"number",modelValue:s(k),"onUpdate:modelValue":e[3]||(e[3]=o=>c(k)?k.value=o:null)},null,8,["modelValue"]),a(i,v({label:"Nombre del Pasajero"},s(ge),{modelValue:s(O),"onUpdate:modelValue":e[4]||(e[4]=o=>c(O)?O.value=o:null),"error-message":s(f).cliente_name,class:"w-full"}),null,16,["modelValue","error-message"]),a(i,v({label:"Telefono",modelValue:s(T),"onUpdate:modelValue":e[5]||(e[5]=o=>c(T)?T.value=o:null)},s(_e),{"error-message":s(f).cliente_phone,class:"w-full",type:"number"}),null,16,["modelValue","error-message"]),a(i,v({label:"Ciudad de donde Proviene"},s(he),{modelValue:s(F),"onUpdate:modelValue":e[6]||(e[6]=o=>c(F)?F.value=o:null),"error-message":s(f).city,class:"w-full"}),null,16,["modelValue","error-message"]),a(i,v({label:"Edificio u Hotel",class:"w-full"},s(ye),{modelValue:s(M),"onUpdate:modelValue":e[7]||(e[7]=o=>c(M)?M.value=o:null),"error-message":s(f).cliente_building}),null,16,["modelValue","error-message"]),a(i,v({label:"Mascota",class:"w-full"},s(Ae),{modelValue:s(J),"onUpdate:modelValue":e[8]||(e[8]=o=>c(J)?J.value=o:null),"error-message":s(f).mascota}),null,16,["modelValue","error-message"]),a(i,v({label:"Persona Adicional",class:"w-full"},s(Se),{modelValue:s(K),"onUpdate:modelValue":e[9]||(e[9]=o=>c(K)?K.value=o:null),"error-message":s(f).persona_adicional}),null,16,["modelValue","error-message"]),a(i,v({label:"Cobro por transacción",type:"number",class:"w-full"},s(ke),{modelValue:s(X),"onUpdate:modelValue":e[10]||(e[10]=o=>c(X)?X.value=o:null),"error-message":s(f).cobre_transaccion}),null,16,["modelValue","error-message"]),a(i,v({label:"Extra por Daños cobrados al cliente",type:"number",class:"w-full"},s(De),{modelValue:s(Y),"onUpdate:modelValue":e[11]||(e[11]=o=>c(Y)?Y.value=o:null),"error-message":s(f).cobro_extra_cliente}),null,16,["modelValue","error-message"]),a(i,v({label:"Alimentación",type:"number",class:"w-full"},s($e),{modelValue:s(Z),"onUpdate:modelValue":e[12]||(e[12]=o=>c(Z)?Z.value=o:null),"error-message":s(f).alimentacion}),null,16,["modelValue","error-message"]),a(i,v({label:"Reserva",type:"number",class:"w-full"},s(Ue),{modelValue:s(ee),"onUpdate:modelValue":e[13]||(e[13]=o=>c(ee)?ee.value=o:null)}),null,16,["modelValue"]),a(i,v({type:"time",label:"Hora de Actividad",class:"w-full"},s(xe),{modelValue:s(R),"onUpdate:modelValue":e[14]||(e[14]=o=>c(R)?R.value=o:null),"error-message":s(f).hour}),null,16,["modelValue","error-message"]),t.$page.props.auth.user.rol=="admin"?(p(),P(i,v({key:0,class:"w-full",label:"Saldo"},s(we),{modelValue:s(Q),"onUpdate:modelValue":e[15]||(e[15]=o=>c(Q)?Q.value=o:null),"error-message":s(f).abono,min:"1",type:"number"}),null,16,["modelValue","error-message"])):_("",!0),t.$page.props.auth.user.rol=="admin"?(p(),P(i,v({key:1,class:"w-full",min:"0"},s(Ce),{type:"dropdown","option-label":"name","option-value":"id",options:ae.value,modelValue:s(W),"onUpdate:modelValue":e[16]||(e[16]=o=>c(W)?W.value=o:null),label:"Medio de Pago"}),null,16,["options","modelValue"])):_("",!0),t.$page.props.auth.user.rol=="admin"?(p(),P(i,v({key:2,class:"w-full",min:"0"},s(Ve),{type:"dropdown","option-label":"name","option-value":"id",options:re.value,modelValue:s(G),"onUpdate:modelValue":e[17]||(e[17]=o=>c(G)?G.value=o:null),label:"Canal de Venta"}),null,16,["options","modelValue"])):_("",!0),t.$page.props.auth.user.rol=="admin"?(p(),P(i,v({key:3,class:"w-full",label:"Descuento"},s(Pe),{modelValue:s($),"onUpdate:modelValue":e[18]||(e[18]=o=>c($)?$.value=o:null),"error-message":s(f).percent_descuento,min:"0",max:"100",type:"number",suffix:" %"}),null,16,["modelValue","error-message"])):_("",!0),l("div",sl,[l("h1",al," Precio total: "+n(s(S).format(Me.value)),1)]),t.$page.props.auth.user.rol=="admin"?(p(),b("div",rl,[l("h1",nl,[ue(" Proveedores "),a(d,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:e[19]||(e[19]=o=>Ee())})]),il,(p(!0),b(te,null,oe(U.value,(o,m)=>(p(),b("div",dl,[a(i,{type:"dropdown",modelValue:o.proveedor,"onUpdate:modelValue":A=>o.proveedor=A,onValueChange:A=>Ne(o),"error-message":s(f).proveedor,"option-label":"nombre","option-value":"id",class:"w-full",options:L.value},null,8,["modelValue","onUpdate:modelValue","onValueChange","error-message","options"]),a(i,{type:"number",mode:"currency",class:"w-full",modelValue:o.costo,"onUpdate:modelValue":A=>o.costo=A,"error-message":s(f).costo},null,8,["modelValue","onUpdate:modelValue","error-message"]),E(a(d,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:A=>qe(m)},null,8,["onClick"]),[[C,"Quitar"]])]))),256))])):_("",!0),l("div",ul,[a(d,{type:"submit",severity:"success",label:"Guardar",loading:I.value},null,8,["loading"])])],32)]),_:1},8,["modelValue"]),a(s(el)),a(V,{visible:B.value,"onUpdate:visible":e[25]||(e[25]=o=>B.value=o),"pt:root:class":"!bg-blue-100",header:"Detalles de la actividad",position:"right"},{header:j(()=>[l("div",cl,[l("span",ml,n(r.value.service.title),1)])]),footer:j(()=>[l("div",Yl,[l("h1",Zl,"Saldo: "+n(s(S).format(r.value.total_price-r.value.payments.reduce((o,m)=>o+m.amount,0))),1),t.$page.props.auth.user.rol=="admin"?(p(),b("div",et,[E(a(d,{onClick:e[21]||(e[21]=o=>H("COMPLETADA",!0)),icon:"fa-solid fa-circle-check",text:"",size:"large",class:"flex-auto",severity:"success"},null,512),[[C,"Completar Servicio",void 0,{top:!0}]]),E(a(d,{onClick:e[22]||(e[22]=o=>H("NO SHOW",!0)),icon:"fa-solid fa-eye-slash",text:"",size:"large",class:"flex-auto",severity:"warn"},null,512),[[C,"Servicio No show",void 0,{top:!0}]]),E(a(d,{onClick:e[23]||(e[23]=o=>H("CANCELADA",!0)),icon:"fa-solid fa-xmark-circle",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[C,"Cancelar Servicio",void 0,{top:!0}]]),E(a(d,{onClick:e[24]||(e[24]=o=>H("PROBLEMATICA",!1)),icon:"fa-solid fa-person-dress-burst",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[C,"Servicio Problematico",void 0,{top:!0}]])])):_("",!0)])]),default:j(()=>{var o;return[l("div",vl,[l("div",pl,[fl,l("p",null,n(r.value.date),1)]),l("div",bl,[gl,l("p",null,n(r.value.hour),1)]),l("div",_l,[hl,l("p",null,n(r.value.channel.name),1)]),l("div",yl,[xl,l("p",null,n(r.value.cliente_name),1)]),l("div",wl,[Vl,l("p",null,n(r.value.cliente_city),1)]),l("div",Cl,[Al,l("a",{href:`tel://${r.value.cliente_phone}`},n(r.value.cliente_phone),9,Sl)]),l("div",kl,[Dl,l("p",null,n(r.value.cliente_building),1)]),l("div",$l,[Ul,l("p",null,n(r.value.adults),1)]),l("div",Pl,[jl,l("p",null,n(r.value.boys),1)]),l("div",El,[ql,l("p",null,n(r.value.mascota),1)]),l("div",Bl,[Nl,l("p",null,n(s(S).format(r.value.total_price)),1)]),r.value.user?(p(),b("div",Ol,[Tl,l("p",null,n((o=r.value.user)==null?void 0:o.name),1)])):_("",!0),r.value.user?(p(),b("div",Fl,[Ml,l("p",null,n(new Date(r.value.created_at).toLocaleDateString("es-CO")),1)])):_("",!0),t.$page.props.auth.user.rol=="admin"?(p(),b("div",Rl,[zl,l("p",Ll,n(r.value.proveedors.length),1)])):_("",!0),t.$page.props.auth.user.rol=="admin"?(p(!0),b(te,{key:3},oe(r.value.proveedors,m=>(p(),b("div",Il,[l("p",null,n(m.proveedor.nombre),1),l("p",null,n(s(S).format(m.cost)),1)]))),256)):_("",!0),l("div",Hl,[l("div",Ql,[Gl,l("div",Wl,n(s(S).format(r.value.payments.reduce((m,A)=>m+A.amount,0))),1)]),(p(!0),b(te,null,oe(r.value.payments,m=>(p(),b("div",Jl,[l("div",null,[l("div",Kl,n(m.type)+" "+n(s(S).format(m.amount)),1),l("div",null,n(new Date(m.created_at).toLocaleDateString("es-CO"))+" "+n(m.metohd_payment.name),1)]),l("div",{class:Ge(["uppercase",m.status=="pendiente"?"bg-red-500 p-1 text-white rounded-lg shadow-md shadow-red-500":""])},[ue(n(m.status)+" ",1),Xl],2)]))),256))])])]}),_:1},8,["visible"])]),_:1})}}};export{ht as default};
