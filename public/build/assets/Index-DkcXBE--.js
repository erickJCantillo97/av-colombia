import{d as g,C as le,x as oe,G as A,q as T,y as se,c as h,w as C,o as c,a as o,b as d,u as r,g as v,t as i,f as m,h as M,F as N,i as O,l as j,n as re,T as ae}from"./app-BmqNjCpi.js";import{_ as ne,s as ie}from"./AppLayout-CFNXBg1d.js";import{s as de}from"./index-BnmO2Xmz.js";import{_ as ue}from"./Datatable-CHj41mEH.js";import{_ as p}from"./Input-Dn_OKqbx.js";import{_ as ce}from"./Modal-BJXvkK9a.js";import{s as pe}from"./index-CPaI7bo5.js";import{a as me}from"./toasts-Bx7BVBCF.js";import{S as D}from"./sweetalert2.esm.all-IRYXxR_Z.js";import"./index-C1Ke976o.js";import"./index-BEqa_D1o.js";import"./index-_oTPNZWu.js";import"./index-DgKZU6V9.js";import"./index-DHeFY0-O.js";import"./index-DdlhNJkM.js";import"./index-DgNXCN0N.js";import"./index-qyya819Y.js";import"./index-BT9svzPn.js";import"./index-BHOAS9U_.js";import"./useCommonUtilities-NbiuDOAU.js";import"./postcss-DsaQvJ63.js";const ve={class:"h-[99vh]"},fe={class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-center",novalidate:""},be={class:"w-full col-span-1 md:col-span-4 flex justify-between gap-x-2 items-center"},ge={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},xe={class:"text-lg font-mono font-semibold"},ye={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},we={class:"text-lg font-mono font-semibold"},_e={key:4,class:"mt-4 w-full col-span-1 md:col-span-4 rounded-lg"},he={class:"flex gap-x-2"},Ve={key:5,class:"mt-4 w-full col-span-1 md:col-span-4 border rounded-lg"},Ce={class:"text-2xl font-mono font-semibold text-center bg-black rounded-t-lg text-white gap-x-3 p-2"},ke={class:"flex justify-between gap-x-4 px-2"},Se={class:"flex justify-end gap-x-2 mt-4 w-full"},$e={class:"flex items-center gap-2"},je={class:"font-bold text-lg"},Ee={class:"flex flex-col gap-y-1.5 text-sm"},Pe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},De={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Be={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ue={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ae={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Te={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ne=["href"],Oe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Re={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},ze={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Me={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Fe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Le={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ie={key:0,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},He={key:1,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ge={key:2,class:"text-lg flex w-full justify-between mt-2"},qe={class:"rounded-full bg-black text-white px-2"},Qe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},We={class:"flex flex-col gap-y-2 mt-2"},Je={class:"flex justify-between"},Ke={class:"bg-blue-600 text-white p-1 rounded-lg"},Xe={class:"flex items-center text-xs justify-between border shadow-xl rounded-md p-1 bg-white"},Ye={class:"uppercase font-bold"},Ze={class:"flex flex-col items-center gap-2"},et={class:"font-bold text-center"},tt={key:0,class:"flex gap-x-2"},Ct={__name:"Index",props:{bookingServices:Array},setup(F){const{toast:V}=me(),E=g(!1),n=g({}),x=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),y=g(!1),L={action:()=>{l.reset(),y.value=!0}},R=g([]),l=le({id:"",service_id:null,date:"",adults:1,boys:0,cliente_name:"",cliente_phone:"",cliente_city:"",cliente_building:"",mascota:0,persona_adicional:0,cobre_transaccion:0,cobro_extra_cliente:0,reserva:0,abono:0,method_id:"",channel_id:"9d99a95f-6c3d-48fd-aa7d-6ef4e6860123",percent_descuento:0,proveedors:[],total:0,total_real:0,percent_channel:0,observations:""}),w=g([{proveedor:null,costo:""}]),B=g([]),I=()=>{axios.get(route("get.services")).then(t=>{B.value=t.data.services})},H=()=>{w.value.push({proveedor:null,costo:""})},G=t=>{t!=0&&w.value.splice(t,1)},k=g([]),S=g([]),q=()=>{axios.get(route("proveedors.index")).then(t=>{k.value=t.data.proveedors}).catch(t=>{console.log(t)})},Q=t=>{var e;t.costo=k.value.find(a=>a.id==t.proveedor).services.find(a=>a.id==l.service_id)===void 0?0:((e=k.value.find(a=>a.id==t.proveedor).services.find(a=>a.id==l.service_id))==null?void 0:e.pivot.value)*l.adults,console.log(t)},W=()=>{axios.get(route("channels.index")).then(t=>{S.value=t.data}).catch(t=>{console.log(t)})};I(),W(),q();const J=[{label:"Detalles",action:t=>{n.value=t,E.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:t=>{l.id=t.id;const e=(a,_)=>{const[f,s,u]=a.split("-"),[b,te]=_.split(":");return`${f}-${s}-${u},${b}:${te}`};l.date=e(t.date,t.hour),l.service_id=t.service_id,l.cliente_name=t.cliente_name,l.cliente_phone=t.cliente_phone,l.cliente_city=t.cliente_city,l.cliente_building=t.cliente_building,l.adults=t.adults,l.total=t.total,l.method_id=t.method_id,l.channel_id=t.channel_id,l.percent_descuento=t.percent_descuento,l.proveedors=t.proveedors,w.value=t.proveedors.map(a=>({proveedor:a.proveedor_id,costo:a.cost})),l.observations=t.observations,console.log(t),n.value=t,y.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Problematica",show:oe().props.auth.user.rol=="admin",action:t=>{var e=t.problematic?"Desmarcar":"Marcar";D.fire({title:"Estas Seguro?",text:`${e} como problematica esta reservación!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${e}!`}).then(a=>{a.isConfirmed&&A.post(route("booking.problematic",t.id),{onSuccess:()=>{V("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"},{label:"Eliminar",icon:"fa-solid fa-trash text-sm",severity:"danger",action:t=>{D.fire({title:"Estas Seguro?",text:`Eliminar la reservación de ${t.cliente_name}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, Eliminar!"}).then(e=>{e.isConfirmed&&A.delete(route("BookingServices.destroy",t.id),{onSuccess:()=>{V("success","Reserva Eliminada")}})})}}],K=[{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service.title",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!0,sortable:!0},{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"problematic",header:"Problematica",filter:!0,sortable:!0,type:"boolean"},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"COMPLETADA",severity:"success",class:""},{text:"DISEÑO",severity:"info",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"SERVICIO POSTVENTA",severity:"success",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"}]}],X=T(()=>l.total/l.adults),U=T(()=>{let t=S.value.find(a=>a.id==l.channel_id),e=t?t.percent/100:0;return l.total-l.total*e}),$=g(!1),Y=t=>{t.preventDefault(),l.total_real=U.value,l.percent_channel=S.value.find(e=>e.id==l.channel_id).percent,$.value=!0,l.proveedors=w.value,l.post(route("reservar"),{onSuccess:()=>{l.reset(),$.value=!1,y.value=!1,V("success","Reserva creada con exito")},onError:()=>{$.value=!1,V("error","Error al crear la reserva")}})},Z=()=>{l.total_real=U.value,l.percent_channel=S.value.find(t=>t.id==l.channel_id).percent,l.proveedors=w.value,l.put(route("BookingServices.update",l.id),{onSuccess:()=>{y.value=!1,V("success","Reserva actualizada con exito")}})};(()=>{axios.get(route("paymentMethods.index")).then(t=>{R.value=t.data}).catch(t=>{console.log(t)})})();const z=t=>{const[e,a,_]=t.split("-");return new Date(e,a-1,_)},ee=T(()=>{var t=[],e=B.value.find(u=>u.id==l.service_id);if(!e)return[];for(var a of e.locks)for(var _=z(a.start_date),f=z(a.end_date),s=_;s<=f;s.setDate(s.getDate()+1))t.push(new Date(s));return t}),P=(t,e)=>{D.fire({title:t,text:"Estas seguro de realizar esta acción?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si"}).then(a=>{a.isConfirmed&&(D.fire({title:t,text:"Esta reserva ha sido "+t+".",icon:"success"}),A.post(route("set.states"),{service:n.value.id,state:t,terminated:e},{onSuccess:()=>{E.value=!1,V("success","Reserva "+t)}}))})};return se(l.adults,t=>{for(var e of w.value)e.proveedor&&(e.costo=k.value.find(a=>a.id==e.proveedor).pivot.value*t)}),(t,e)=>{const a=de,_=ie,f=ae;return c(),h(ne,{title:"Services"},{default:C(()=>[o("div",ve,[d(ue,{actions:J,add:L,columnas:K,data:F.bookingServices,routecreate:"services.create",title:"Reservas"},null,8,["data"])]),d(ce,{modelValue:y.value,"onUpdate:modelValue":e[17]||(e[17]=s=>y.value=s),title:"Añadir Reserva",width:"70vw"},{footer:C(()=>[o("div",Se,[d(a,{onClick:e[16]||(e[16]=s=>y.value=!1),severity:"danger",label:"Cancelar",loading:$.value},null,8,["loading"]),r(l).id?(c(),h(a,{key:0,type:"submit",label:"Actualizar",severity:"warn",onClick:Z})):(c(),h(a,{key:1,type:"submit",severity:"success",label:"Guardar",loading:$.value,onClick:Y},null,8,["loading"]))])]),default:C(()=>[o("form",fe,[d(p,{type:"dropdown",modelValue:r(l).service_id,"onUpdate:modelValue":e[0]||(e[0]=s=>r(l).service_id=s),"error-message":r(l).errors.service_id,label:"Servicio","option-label":"title","option-value":"id",options:B.value},null,8,["modelValue","error-message","options"]),d(p,{label:"Fecha de Reserva",enableTimePicker:!0,"disabled-dates":ee.value,modelValue:r(l).date,"onUpdate:modelValue":e[1]||(e[1]=s=>r(l).date=s),required:"",class:"w-full",type:"datetime"},null,8,["disabled-dates","modelValue"]),d(p,{label:"Valor Total",type:"number",mode:"currency",modelValue:r(l).total,"onUpdate:modelValue":e[2]||(e[2]=s=>r(l).total=s)},null,8,["modelValue"]),d(p,{label:"Pasajeros",type:"number",modelValue:r(l).adults,"onUpdate:modelValue":e[3]||(e[3]=s=>r(l).adults=s)},null,8,["modelValue"]),d(p,{label:"Niños",type:"number",modelValue:r(l).boys,"onUpdate:modelValue":e[4]||(e[4]=s=>r(l).boys=s)},null,8,["modelValue"]),d(p,{label:"Nombre del Pasajero",modelValue:r(l).cliente_name,"onUpdate:modelValue":e[5]||(e[5]=s=>r(l).cliente_name=s),"error-message":r(l).errors.cliente_name,class:"w-full"},null,8,["modelValue","error-message"]),d(p,{label:"Telefono",modelValue:r(l).cliente_phone,"onUpdate:modelValue":e[6]||(e[6]=s=>r(l).cliente_phone=s),"error-message":r(l).errors.cliente_phone,class:"w-full",type:"number"},null,8,["modelValue","error-message"]),d(p,{label:"Ciudad de donde Proviene",modelValue:r(l).cliente_city,"onUpdate:modelValue":e[7]||(e[7]=s=>r(l).cliente_city=s),"error-message":r(l).errors.city,class:"w-full"},null,8,["modelValue","error-message"]),d(p,{label:"Edificio u Hotel",class:"w-full",modelValue:r(l).cliente_building,"onUpdate:modelValue":e[8]||(e[8]=s=>r(l).cliente_building=s),"error-message":r(l).errors.cliente_building},null,8,["modelValue","error-message"]),t.$page.props.auth.user.rol=="admin"?(c(),h(p,{key:0,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:R.value,modelValue:r(l).method_id,"onUpdate:modelValue":e[9]||(e[9]=s=>r(l).method_id=s),label:"Medio de Pago"},null,8,["options","modelValue"])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(),h(p,{key:1,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:S.value,modelValue:r(l).channel_id,"onUpdate:modelValue":e[10]||(e[10]=s=>r(l).channel_id=s),label:"Canal de Venta"},null,8,["options","modelValue"])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(),h(p,{key:2,class:"w-full",label:"Descuento",modelValue:r(l).percent_descuento,"onUpdate:modelValue":e[11]||(e[11]=s=>r(l).percent_descuento=s),"error-message":r(l).errors.percent_descuento,min:"0",max:"100",type:"number",suffix:" %"},null,8,["modelValue","error-message"])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(),h(p,{key:3,class:"w-full col-span-1 md:col-span-4","rows-textarea":2,label:"Observaciones",modelValue:r(l).observations,"onUpdate:modelValue":e[12]||(e[12]=s=>r(l).observations=s),"error-message":r(l).errors.observations,type:"textarea"},null,8,["modelValue","error-message"])):v("",!0),o("div",be,[o("div",ge,[o("p",xe,i(r(x).format(X.value)),1),e[23]||(e[23]=o("p",{class:"italic text-md"}," Valor Pasajero ",-1))]),o("div",ye,[o("p",we,i(r(x).format(U.value)),1),e[24]||(e[24]=o("p",{class:"italic text-md"}," Valor Real ",-1))])]),r(l).service_id?(c(),m("div",_e,[o("div",he,[d(p,{label:"Placa del Vehiculo",modelValue:r(l).vehicle_plate,"onUpdate:modelValue":e[13]||(e[13]=s=>r(l).vehicle_plate=s),class:"w-full"},null,8,["modelValue"]),d(p,{label:"Nombre del Conductor",modelValue:r(l).driver_name,"onUpdate:modelValue":e[14]||(e[14]=s=>r(l).driver_name=s),class:"w-full"},null,8,["modelValue"])])])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(),m("div",Ve,[o("h1",Ce,[e[25]||(e[25]=M(" Proveedores ")),d(a,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:e[15]||(e[15]=s=>H())})]),e[26]||(e[26]=o("div",{class:"flex justify-between w-full font-bold px-2"},[o("label",{for:""},"Proveedor"),o("label",{for:""},"Costo"),o("label",{for:""},".")],-1)),(c(!0),m(N,null,O(w.value,(s,u)=>(c(),m("div",ke,[d(p,{type:"dropdown",modelValue:s.proveedor,"onUpdate:modelValue":b=>s.proveedor=b,onValueChange:b=>Q(s),"option-label":"nombre","option-value":"id",class:"w-full",options:k.value},null,8,["modelValue","onUpdate:modelValue","onValueChange","options"]),d(p,{type:"number",mode:"currency",class:"w-full",modelValue:s.costo,"onUpdate:modelValue":b=>s.costo=b},null,8,["modelValue","onUpdate:modelValue"]),j(d(a,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:b=>G(u)},null,8,["onClick"]),[[f,"Quitar"]])]))),256))])):v("",!0)])]),_:1},8,["modelValue"]),d(r(pe)),d(_,{visible:E.value,"onUpdate:visible":e[22]||(e[22]=s=>E.value=s),"pt:root:class":"!bg-blue-100",header:"Detalles de la actividad",position:"right"},{header:C(()=>[o("div",$e,[o("span",je,i(n.value.service.title),1)])]),footer:C(()=>[o("div",Ze,[o("h1",et,"Saldo: "+i(r(x).format(n.value.total_price-n.value.payments.reduce((s,u)=>s+u.amount,0))),1),t.$page.props.auth.user.rol=="admin"?(c(),m("div",tt,[j(d(a,{onClick:e[18]||(e[18]=s=>P("COMPLETADA",!0)),icon:"fa-solid fa-circle-check",text:"",size:"large",class:"flex-auto",severity:"success"},null,512),[[f,"Completar Servicio",void 0,{top:!0}]]),j(d(a,{onClick:e[19]||(e[19]=s=>P("NO SHOW",!0)),icon:"fa-solid fa-eye-slash",text:"",size:"large",class:"flex-auto",severity:"warn"},null,512),[[f,"Servicio No show",void 0,{top:!0}]]),j(d(a,{onClick:e[20]||(e[20]=s=>P("CANCELADA",!0)),icon:"fa-solid fa-xmark-circle",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[f,"Cancelar Servicio",void 0,{top:!0}]]),j(d(a,{onClick:e[21]||(e[21]=s=>P("PROBLEMATICA",!1)),icon:"fa-solid fa-person-dress-burst",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[f,"Servicio Problematico",void 0,{top:!0}]])])):v("",!0)])]),default:C(()=>{var s;return[o("div",Ee,[o("div",Pe,[e[27]||(e[27]=o("strong",null,"Fecha del Servicio:",-1)),o("p",null,i(n.value.date),1)]),o("div",De,[e[28]||(e[28]=o("strong",null,"Hora del Servicio:",-1)),o("p",null,i(n.value.hour),1)]),o("div",Be,[e[29]||(e[29]=o("strong",null,"Canal de Venta:",-1)),o("p",null,i(n.value.channel.name),1)]),o("div",Ue,[e[30]||(e[30]=o("strong",null,"Cliente:",-1)),o("p",null,i(n.value.cliente_name),1)]),o("div",Ae,[e[31]||(e[31]=o("strong",null,"Ciudad:",-1)),o("p",null,i(n.value.cliente_city),1)]),o("div",Te,[e[32]||(e[32]=o("strong",null,"Telelfono:",-1)),o("a",{href:`tel://${n.value.cliente_phone}`},i(n.value.cliente_phone),9,Ne)]),o("div",Oe,[e[33]||(e[33]=o("strong",null,"Edificio:",-1)),o("p",null,i(n.value.cliente_building),1)]),o("div",Re,[e[34]||(e[34]=o("strong",null,"Adultos:",-1)),o("p",null,i(n.value.adults),1)]),o("div",ze,[e[35]||(e[35]=o("strong",null,"Niños:",-1)),o("p",null,i(n.value.boys),1)]),o("div",Me,[e[36]||(e[36]=o("strong",null,"Mascota:",-1)),o("p",null,i(n.value.mascota),1)]),o("div",Fe,[e[37]||(e[37]=o("strong",null,"Total:",-1)),o("p",null,i(r(x).format(n.value.total)),1)]),o("div",Le,[e[38]||(e[38]=o("strong",null,"Total Real:",-1)),o("p",null,i(r(x).format(n.value.total_real)),1)]),n.value.user?(c(),m("div",Ie,[e[39]||(e[39]=o("strong",null,"Vendedor:",-1)),o("p",null,i((s=n.value.user)==null?void 0:s.name),1)])):v("",!0),n.value.user?(c(),m("div",He,[e[40]||(e[40]=o("strong",null,"Fecha de reserva:",-1)),o("p",null,i(new Date(n.value.created_at).toLocaleDateString("es-CO")),1)])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(),m("div",Ge,[e[41]||(e[41]=o("p",{class:"font-bold"}," Proveedores ",-1)),o("p",qe,i(n.value.proveedors.length),1)])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(!0),m(N,{key:3},O(n.value.proveedors,u=>(c(),m("div",Qe,[o("p",null,i(u.proveedor.nombre),1),o("p",null,i(r(x).format(u.cost)),1)]))),256)):v("",!0),o("div",We,[o("div",Je,[e[42]||(e[42]=o("h2",{class:"text-xl font-bold"},"Pagos Realizados ",-1)),o("div",Ke,i(r(x).format(n.value.payments.reduce((u,b)=>u+b.amount,0))),1)]),(c(!0),m(N,null,O(n.value.payments,u=>(c(),m("div",Xe,[o("div",null,[o("div",Ye,i(u.type)+" "+i(r(x).format(u.amount)),1),o("div",null,i(new Date(u.created_at).toLocaleDateString("es-CO"))+" "+i(u.metohd_payment.name),1)]),o("div",{class:re(["uppercase",u.status=="pendiente"?"bg-red-500 p-1 text-white rounded-lg shadow-md shadow-red-500":""])},[M(i(u.status)+" ",1),e[43]||(e[43]=o("div",null,null,-1))],2)]))),256))])])]}),_:1},8,["visible"])]),_:1})}}};export{Ct as default};
