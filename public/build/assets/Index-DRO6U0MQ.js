import{s as J}from"./index-CJXchWVB.js";import{s as K}from"./index-DUsRI_u8.js";import{_ as Q}from"./Datatable-BPqfvGkH.js";import{_ as $}from"./Input-GLF9ye07.js";import{_ as X}from"./Modal-C7bLnv_U.js";import{_ as Y}from"./AppLayout-BafNKFf3.js";import{d as r,x as Z,f as d,o as i,b as m,w as k,a as t,g as C,F as h,i as V,n as R,t as s,u as g,A as ee,y as N}from"./app-BrvBLLRG.js";import"./sweetalert2.esm.all-DV3w3JmD.js";import{a as te}from"./toasts-Bf1FAz7R.js";import"./index-BRDboxWO.js";import"./index-B32aHq1H.js";import"./index-CnB2OUc3.js";import"./index-BPnW35Gw.js";import"./index-BqsjpMtl.js";import"./index-pU2otzce.js";import"./index-CqSrpNZq.js";import"./index-gZr9gyW3.js";import"./index-j2u4dgcw.js";import"./index-BHO-GB5o.js";import"./index-Cgfk1mD_.js";import"./index-4lsjsHG5.js";import"./index-DgKLnLYL.js";import"./index-HmENLh7A.js";import"./index-DwX7eK_M.js";import"./index-BsZvusAy.js";import"./index-DBE9YPNi.js";import"./index-DA7wkOWS.js";import"./useCommonUtilities-hipAPSUL.js";import"./filepond-plugin-image-preview.min-CU6i9RuF.js";import"./postcss-Bhxs4AXy.js";import"./index-DE5ePisU.js";import"./index-CilNjsHf.js";import"./index-C8KIOe_-.js";import"./index-eNLZlfc9.js";import"./index-D8Wq_xRn.js";const oe={class:"h-[99vh]"},ae={class:"gap-y-2 flex flex-col"},le={class:"flex flex-col w-full justify-between font-bold"},se={key:0,class:"flex flex-col gap-y-2"},ne={class:"flex justify-between gap-x-4"},re=["onClick"],de={class:"flex gap-2 divide-x-4 divide-white items-center"},ie={class:"p-1"},ue={class:"p-1 pl-3"},pe={class:"flex flex-col w-full justify-between font-bold"},ce={class:"flex justify-end gap-x-2"},me=["loading"],ve={class:"flex flex-col gap-4"},fe={class:"font-medium block mb-2"},_e={class:"w-full bg-gray-200 rounded-md p-2 grid grid-cols-2 divide-y-2 md:flex space-x-2"},ge=["onClick"],xe={class:"flex flex-col gap-y-2 h-64 overflow-auto"},he={key:0},ye={class:"flex items-center gap-x-8 border-b shadow-md justify-between p-3 rounded-md hover:bg-gray-300"},be={class:"flex flex-col"},we={class:"font-bold flex items-center gap-x-2"},De={class:"text-xs"},Ce={class:"flex flex-col"},Ve={class:"text-sm"},Ae={class:"font-bold"},Oe={key:1},Se={class:"flex items-center gap-x-8 border-b shadow-md justify-between p-3 rounded-md hover:bg-gray-300"},ke={class:"flex flex-col"},Ie={class:"font-bold flex items-center gap-x-2"},Pe={class:"text-xs"},Fe={class:"text-xs"},je={class:"flex flex-col"},Ee={class:"text-sm"},Te={class:"font-bold"},gt={__name:"Index",props:{payments:Array},setup(B){const v=r(!1),{toast:I}=te(),y=r(1),U=[{name:"Agrupados",value:1},{name:"Detalles",value:2}],A=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),P=a=>{if(a==null||a==null)return"Sin definir";var o=new Date(new Date(a).getTime()+new Date(a).getTimezoneOffset()*6e4);return o},b=r(!1),n=Z({date:new Date,startDate:new Date,endDate:new Date,amount:0,proveedor_id:"",file:"",description:""}),F=r([]),p=r([new Date,new Date]),f=r(),j=r([]),c=r(),w=r(null),z={action:()=>{w.value=null,p.value=[new Date,new Date],n.reset(),D(),v.value=!0}},H=[{name:"Ver",icon:"fa-solid fa-pencil",severity:"info",action:a=>{v.value=!0,w.value=a.id,n.date=a.date,p.value=[P(a.startDate),P(a.endDate)],n.amount=a.amount,c.value=a.proveedor_id,D()}}],L=[{header:"Proveedor",field:"proveedor.nombre",filter:!0},{header:"Fecha de Pago",field:"date",type:"date",filter:!0},{header:"Valor",field:"amount",type:"currency"},{header:"Fecha Inicio",field:"startDate",type:"date",filter:!0},{header:"Fecha Fin",field:"endDate",type:"date",filter:!0},{header:"Comprobante",field:"comprobante",type:"html-custom",renderer:a=>`<a href="${a.comprobante}" class="text-sky-600 underline" target="_blank">Ver Comprobante</a>`}],D=()=>{ee.get(route("get.booking.time.range"),{params:{start_date:new Date(p.value[0]).toISOString().split("T")[0],end_date:new Date(p.value[1]).toISOString().split("T")[0]}}).then(a=>{F.value=a.data.proveedores,f.value=a.data.bookingTimeRange.filter(o=>{let u=c.value;return o.proveedors.map(e=>e.proveedor_id).includes(u)}),j.value=[{name:"RESERVADO",value:f.value.filter(o=>o.status=="reservado"),color:"bg-blue-200"},{name:"COMPLETADA",value:f.value.filter(o=>o.status=="completado"),color:"bg-green-200"},{name:"CANCELADA",value:f.value.filter(o=>o.status=="CANCELADA"),color:"bg-red-200"},{name:"NO SHOW",value:f.value.filter(o=>o.status=="NO SHOW"),color:"bg-yellow-200"},{name:"CAMBIO DE FECHA",value:f.value.filter(o=>o.status=="CAMBIO DE FECHA"),color:"bg-gray-200"},{name:"REUBICADO",value:f.value.filter(o=>o.status=="REUBICADO"),color:"bg-yellow-200"}]})},E=r(),O=r([]),T=r([]),M=(a,o)=>{T.value=o.value.reduce((u,x)=>{const e=x.title;return u[e]||(u[e]={count:0,pasajeros:0,total:0}),u[e].count+=1,u[e].pasajeros+=x.adults,u[e].total+=x.proveedors.filter(l=>l.proveedor_id==c.value).reduce((l,_)=>l+_.cost,0),u},{}),O.value=o,E.value.toggle(a)};function W(a){n.file=a.target.files[0]}const q=()=>{b.value=!0;let a=new FormData;if(a.append("proveedor_id",c.value),a.append("amount",n.amount),a.append("comprobante",n.file),a.append("date",new Date(n.date).toISOString().split("T")[0]),console.log(new Date(p.value[0]).toISOString().split("T")[0],new Date(p.value[1]).toISOString().split("T")[0]),a.append("startDate",new Date(p.value[0]).toISOString().split("T")[0]),a.append("endDate",new Date(p.value[1]).toISOString().split("T")[0]),a.append("description",n.description),w.value){N.post(route("paymentProveedors.update",w.value),a,{onSuccess:()=>{I("success","Pago Actualizado con exito"),b.value=!1,v.value=!1}});return}N.post(route("paymentProveedors.store"),a,{onSuccess:()=>{I("success","Pago Actualizado con exito"),b.value=!1,v.value=!1}})};return(a,o)=>{const u=K,x=J;return i(),d(h,null,[m(Y,{title:"Pagos"},{default:k(()=>[t("div",oe,[m(Q,{add:z,columnas:L,data:B.payments,actions:H,title:"Pagos"},null,8,["data"])]),m(X,{modelValue:v.value,"onUpdate:modelValue":o[5]||(o[5]=e=>v.value=e),title:"Añadir Pagos"},{default:k(()=>[t("div",ae,[t("div",le,[o[6]||(o[6]=t("p",null,"Fechas",-1)),m(u,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=e=>p.value=e),selectionMode:"range",dateFormat:"dd/mm/yy",class:"w-full",manualInput:!1,onValueChange:D},null,8,["modelValue"])]),m($,{label:"Proveedor",type:"dropdown","option-label":"proveedor","option-value":"proveedor_id",onValueChange:D,modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=e=>c.value=e),options:F.value},null,8,["modelValue","options"]),c.value?(i(),d("div",se,[t("div",ne,[(i(!0),d(h,null,V(j.value,e=>(i(),d("div",{class:R([`${e.color} ${e.value.length>0?"cursor-pointer":"hidden"} `,"rounded-lg py-2 border w-full flex flex-col gap-y-1 items-center font-bold cursor-pointer scale-90 hover:scale-100 shadow-sm hover:shadow-lg transition-all duration-300"]),onClick:l=>M(l,e)},[t("h1",null,s(e.name),1),t("div",de,[t("p",ie,s(e.value.length)+" Reservas",1),t("p",ue,s(e.value.reduce((l,_)=>l+_.adults,0))+" Pasajeros ",1)]),t("p",null,s(g(A).format(e.value.reduce((l,_)=>l+_.proveedors.filter(S=>S.proveedor_id==c.value).reduce((S,G)=>S+G.cost,0),0))),1)],10,re))),256))]),t("div",pe,[o[7]||(o[7]=t("p",null,"Fecha en que realizó el pago",-1)),m(u,{modelValue:g(n).date,"onUpdate:modelValue":o[2]||(o[2]=e=>g(n).date=e),dateFormat:"dd/mm/yy",class:"w-full",manualInput:!1},null,8,["modelValue"])]),m($,{label:"Valor",type:"number",mode:"currency",modelValue:g(n).amount,"onUpdate:modelValue":o[3]||(o[3]=e=>g(n).amount=e)},null,8,["modelValue"]),t("input",{type:"file",onChange:W,label:"Comprobante"},null,32)])):C("",!0),t("div",ce,[t("button",{onClick:o[4]||(o[4]=e=>v.value=!1),class:"bg-red-500 text-white px-4 py-2 rounded-md"}," Cancelar "),c.value?(i(),d("button",{key:0,loading:b.value,onClick:q,class:"bg-green-500 text-white px-4 py-2 rounded-md"}," Guardar ",8,me)):C("",!0)])])]),_:1},8,["modelValue"])]),_:1}),m(x,{ref_key:"op",ref:E},{default:k(()=>[t("div",ve,[t("div",null,[t("span",fe,s(O.value.name),1),t("div",_e,[(i(),d(h,null,V(U,e=>t("div",{onClick:l=>y.value=e.value,class:R(["w-full rounded-lg text-center py-2 text-sm md:text-md cursor-pointer",y.value==e.value?"bg-white":"hover:bg-white/30"])},s(e.name),11,ge)),64))]),t("div",xe,[y.value==1?(i(),d("div",he,[(i(!0),d(h,null,V(T.value,(e,l)=>(i(),d("div",ye,[t("div",be,[t("span",we,[t("p",null,s(l),1)]),t("span",De,s(e.count)+" Reservas",1)]),t("div",Ce,[t("span",Ve,s(e.pasajeros)+" Pasajeros",1),t("span",Ae,s(g(A).format(e.total)),1)])]))),256))])):C("",!0),y.value==2?(i(),d("div",Oe,[(i(!0),d(h,null,V(O.value.value,e=>(i(),d("div",Se,[t("div",ke,[t("span",Ie,[t("p",null,s(e.title),1)]),t("span",Pe,s(e.cliente_name),1),t("span",Fe,s(e.fecha),1)]),t("div",je,[t("span",Ee,s(e.adults)+" Pasajeros",1),t("span",Te,s(g(A).format(e.proveedors.filter(l=>l.proveedor_id==c.value).reduce((l,_)=>l+_.cost,0))),1)])]))),256))])):C("",!0)])])])]),_:1},512)],64)}}};export{gt as default};
