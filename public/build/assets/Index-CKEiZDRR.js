import{d as g,C as oe,x as se,G as D,q as T,y as re,c as V,w as C,o as u,a as o,b as d,u as r,g as v,t as i,f as m,h as F,F as O,i as N,l as E,n as ae,T as ne}from"./app-DRkRqkwG.js";import{s as ie}from"./index-CDtKKyv6.js";import{s as de}from"./index-DE782MAc.js";import{_ as ue}from"./Datatable-Cv3t4EE3.js";import{_ as p}from"./Input-Cxi87LrH.js";import{_ as ce}from"./Modal-C52w6FX6.js";import{_ as pe}from"./AppLayout-BUuxwL2O.js";import{s as me}from"./index-pSuy63aG.js";import{a as ve}from"./toasts-Bx7BVBCF.js";import{S as k}from"./sweetalert2.esm.all-IRYXxR_Z.js";import"./index-DQQ5oXDt.js";import"./index-CeKsyasn.js";import"./index-Dcbi4Hs_.js";import"./index-DMeEwott.js";import"./index-7TZvAfzn.js";import"./index-Caaoeedy.js";import"./index-Zy40_dU8.js";import"./index-CZFkNNTB.js";import"./index-OVm9JtG9.js";import"./postcss-DhGFDzXv.js";import"./index-DhskN_1M.js";import"./index-CWZaTrJ8.js";import"./useCommonUtilities-DO03hYfs.js";import"./moment-Cijl8gKs.js";import"./index-Dat1gAix.js";import"./index-Bim3i6tw.js";import"./index-C_Fr-5tB.js";const fe={class:"h-[99vh]"},be={class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-center",novalidate:""},ge={class:"w-full col-span-1 md:col-span-4 flex justify-between gap-x-2 items-center"},xe={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},ye={class:"text-lg font-mono font-semibold"},we={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},_e={class:"text-lg font-mono font-semibold"},he={key:4,class:"mt-4 w-full col-span-1 md:col-span-4 rounded-lg"},Ve={class:"flex gap-x-2"},Ce={key:5,class:"mt-4 w-full col-span-1 md:col-span-4 border rounded-lg"},ke={class:"text-2xl font-mono font-semibold text-center bg-black rounded-t-lg text-white gap-x-3 p-2"},Se={class:"flex justify-between gap-x-4 px-2"},$e={class:"flex justify-end gap-x-2 mt-4 w-full"},je={class:"flex items-center gap-2"},Ee={class:"font-bold text-lg"},Pe={class:"flex flex-col gap-y-1.5 text-sm"},De={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Be={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ue={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ae={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Te={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Oe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ne=["href"],Re={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Le={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Fe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},ze={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Me={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ie={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},He={key:0,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ge={key:1,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},qe={key:2,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Qe={key:3,class:"text-lg flex w-full justify-between mt-2"},We={class:"rounded-full bg-black text-white px-2"},Je={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ke={class:"flex flex-col gap-y-2 mt-2"},Xe={class:"flex justify-between"},Ye={class:"bg-blue-600 text-white p-1 rounded-lg"},Ze={class:"flex items-center text-xs justify-between border shadow-xl rounded-md p-1 bg-white"},et={class:"uppercase font-bold"},tt={class:"flex flex-col items-center gap-2"},lt={class:"font-bold text-center"},ot={key:0,class:"flex gap-x-2"},Bt={__name:"Index",props:{bookingServices:Array},setup(z){const{toast:y}=ve(),P=g(!1),n=g({}),x=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),w=g(!1),M={action:()=>{l.reset(),w.value=!0}},R=g([]),l=oe({id:"",service_id:null,date:"",adults:1,boys:0,cliente_name:"",cliente_phone:"",cliente_city:"",cliente_building:"",mascota:0,persona_adicional:0,cobre_transaccion:0,cobro_extra_cliente:0,reserva:0,abono:0,method_id:"",channel_id:"9d99a95f-6c3d-48fd-aa7d-6ef4e6860123",percent_descuento:0,proveedors:[],total:0,total_real:0,percent_channel:0,observations:""}),_=g([{proveedor:null,costo:""}]),B=g([]),I=()=>{axios.get(route("get.services")).then(t=>{B.value=t.data.services})},H=()=>{_.value.push({proveedor:null,costo:""})},G=t=>{t!=0&&_.value.splice(t,1)},S=g([]),$=g([]),q=()=>{axios.get(route("proveedors.index")).then(t=>{S.value=t.data.proveedors}).catch(t=>{console.log(t)})},Q=t=>{var e;t.costo=S.value.find(a=>a.id==t.proveedor).services.find(a=>a.id==l.service_id)===void 0?0:((e=S.value.find(a=>a.id==t.proveedor).services.find(a=>a.id==l.service_id))==null?void 0:e.pivot.value)*l.adults,console.log(t)},W=()=>{axios.get(route("channels.index")).then(t=>{$.value=t.data}).catch(t=>{console.log(t)})};I(),W(),q();const J=[{label:"Detalles",action:t=>{n.value=t,P.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:t=>{l.id=t.id;const e=(a,h)=>{const[f,s,c]=a.split("-"),[b,le]=h.split(":");return`${f}-${s}-${c},${b}:${le}`};l.date=e(t.date,t.hour),l.service_id=t.service_id,l.cliente_name=t.cliente_name,l.cliente_phone=t.cliente_phone,l.cliente_city=t.cliente_city,l.cliente_building=t.cliente_building,l.adults=t.adults,l.total=t.total,l.method_id=t.method_id,l.channel_id=t.channel_id,l.percent_descuento=t.percent_descuento,l.proveedors=t.proveedors,_.value=t.proveedors.map(a=>({proveedor:a.proveedor_id,costo:a.cost})),l.observations=t.observations,n.value=t,w.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Problematica",show:se().props.auth.user.rol=="admin",action:t=>{var e=t.problematic?"Desmarcar":"Marcar";k.fire({title:"Estas Seguro?",text:`${e} como problematica esta reservación!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${e}!`}).then(a=>{a.isConfirmed&&D.post(route("booking.problematic",t.id),{onSuccess:()=>{y("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"},{label:"Eliminar",icon:"fa-solid fa-trash text-sm",severity:"danger",action:t=>{k.fire({title:"Estas Seguro?",text:`Eliminar la reservación de ${t.cliente_name}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, Eliminar!"}).then(e=>{e.isConfirmed&&D.delete(route("BookingServices.destroy",t.id),{onSuccess:()=>{y("success","Reserva Eliminada")}})})}}],K=[{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service.title",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!0,sortable:!0},{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"problematic",header:"Problematica",filter:!0,sortable:!0,type:"boolean"},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"COMPLETADA",severity:"success",class:""},{text:"DISEÑO",severity:"info",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"SERVICIO POSTVENTA",severity:"success",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"}]}],X=T(()=>l.total/l.adults),U=T(()=>{let t=$.value.find(a=>a.id==l.channel_id),e=t?t.percent/100:0;return l.total-l.total*e}),j=g(!1),Y=t=>{t.preventDefault(),l.total_real=U.value,l.percent_channel=$.value.find(e=>e.id==l.channel_id).percent,j.value=!0,l.proveedors=_.value,l.post(route("reservar"),{onSuccess:()=>{l.reset(),j.value=!1,w.value=!1,y("success","Reserva creada con exito")},onError:()=>{j.value=!1,y("error","Error al crear la reserva")}})},Z=()=>{l.total_real=U.value,l.percent_channel=$.value.find(t=>t.id==l.channel_id).percent,l.proveedors=_.value,l.put(route("BookingServices.update",l.id),{onSuccess:()=>{w.value=!1,y("success","Reserva actualizada con exito")}})};(()=>{axios.get(route("paymentMethods.index")).then(t=>{R.value=t.data}).catch(t=>{console.log(t)})})();const L=t=>{const[e,a,h]=t.split("-");return new Date(e,a-1,h)},ee=T(()=>{var t=[],e=B.value.find(c=>c.id==l.service_id);if(!e)return[];for(var a of e.locks)for(var h=L(a.start_date),f=L(a.end_date),s=h;s<=f;s.setDate(s.getDate()+1))t.push(new Date(s));return t}),te=()=>{k.fire({title:"Cancelar Servicio",input:"date",inputLabel:"Fecha de Cancelación",showCancelButton:!0,confirmButtonText:"Cancelar Servicio",showLoaderOnConfirm:!0,preConfirm:async t=>{await D.post(route("set.states"),{service:n.value.id,state:"CANCELADA",date:t,terminated:!0})},allowOutsideClick:()=>!k.isLoading()}).then(t=>{t.isConfirmed&&y("success","Reserva Cancelada")})},A=(t,e)=>{k.fire({title:t,text:"Estas seguro de realizar esta acción?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si"}).then(a=>{a.isConfirmed&&(k.fire({title:t,text:"Esta reserva ha sido "+t+".",icon:"success"}),D.post(route("set.states"),{service:n.value.id,state:t,terminated:e},{onSuccess:()=>{P.value=!1,y("success","Reserva "+t)}}))})};return re(l.adults,t=>{for(var e of _.value)e.proveedor&&(e.costo=S.value.find(a=>a.id==e.proveedor).pivot.value*t)}),(t,e)=>{const a=de,h=ie,f=ne;return u(),V(pe,{title:"Reservas"},{default:C(()=>[o("div",fe,[d(ue,{actions:J,add:M,columnas:K,data:z.bookingServices,routecreate:"services.create",title:"Reservas"},null,8,["data"])]),d(ce,{modelValue:w.value,"onUpdate:modelValue":e[17]||(e[17]=s=>w.value=s),title:"Añadir Reserva",width:"70vw"},{footer:C(()=>[o("div",$e,[d(a,{onClick:e[16]||(e[16]=s=>w.value=!1),severity:"danger",label:"Cancelar",loading:j.value},null,8,["loading"]),r(l).id?(u(),V(a,{key:0,type:"submit",label:"Actualizar",severity:"warn",onClick:Z})):(u(),V(a,{key:1,type:"submit",severity:"success",label:"Guardar",loading:j.value,onClick:Y},null,8,["loading"]))])]),default:C(()=>[o("form",be,[d(p,{type:"dropdown",modelValue:r(l).service_id,"onUpdate:modelValue":e[0]||(e[0]=s=>r(l).service_id=s),"error-message":r(l).errors.service_id,label:"Servicio","option-label":"title","option-value":"id",options:B.value},null,8,["modelValue","error-message","options"]),d(p,{label:"Fecha de Reserva",enableTimePicker:!0,"disabled-dates":ee.value,modelValue:r(l).date,"onUpdate:modelValue":e[1]||(e[1]=s=>r(l).date=s),required:"",class:"w-full",type:"datetime"},null,8,["disabled-dates","modelValue"]),d(p,{label:"Valor Total",type:"number",mode:"currency",modelValue:r(l).total,"onUpdate:modelValue":e[2]||(e[2]=s=>r(l).total=s)},null,8,["modelValue"]),d(p,{label:"Pasajeros",type:"number",modelValue:r(l).adults,"onUpdate:modelValue":e[3]||(e[3]=s=>r(l).adults=s)},null,8,["modelValue"]),d(p,{label:"Niños",type:"number",modelValue:r(l).boys,"onUpdate:modelValue":e[4]||(e[4]=s=>r(l).boys=s)},null,8,["modelValue"]),d(p,{label:"Nombre del Pasajero",modelValue:r(l).cliente_name,"onUpdate:modelValue":e[5]||(e[5]=s=>r(l).cliente_name=s),"error-message":r(l).errors.cliente_name,class:"w-full"},null,8,["modelValue","error-message"]),d(p,{label:"Telefono",modelValue:r(l).cliente_phone,"onUpdate:modelValue":e[6]||(e[6]=s=>r(l).cliente_phone=s),"error-message":r(l).errors.cliente_phone,class:"w-full",type:"number"},null,8,["modelValue","error-message"]),d(p,{label:"Ciudad de donde Proviene",modelValue:r(l).cliente_city,"onUpdate:modelValue":e[7]||(e[7]=s=>r(l).cliente_city=s),"error-message":r(l).errors.city,class:"w-full"},null,8,["modelValue","error-message"]),d(p,{label:"Edificio u Hotel",class:"w-full",modelValue:r(l).cliente_building,"onUpdate:modelValue":e[8]||(e[8]=s=>r(l).cliente_building=s),"error-message":r(l).errors.cliente_building},null,8,["modelValue","error-message"]),t.$page.props.auth.user.rol=="admin"?(u(),V(p,{key:0,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:R.value,modelValue:r(l).method_id,"onUpdate:modelValue":e[9]||(e[9]=s=>r(l).method_id=s),label:"Medio de Pago"},null,8,["options","modelValue"])):v("",!0),t.$page.props.auth.user.rol=="admin"?(u(),V(p,{key:1,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:$.value,modelValue:r(l).channel_id,"onUpdate:modelValue":e[10]||(e[10]=s=>r(l).channel_id=s),label:"Canal de Venta"},null,8,["options","modelValue"])):v("",!0),t.$page.props.auth.user.rol=="admin"?(u(),V(p,{key:2,class:"w-full",label:"Descuento",modelValue:r(l).percent_descuento,"onUpdate:modelValue":e[11]||(e[11]=s=>r(l).percent_descuento=s),"error-message":r(l).errors.percent_descuento,min:"0",max:"100",type:"number",suffix:" %"},null,8,["modelValue","error-message"])):v("",!0),t.$page.props.auth.user.rol=="admin"?(u(),V(p,{key:3,class:"w-full col-span-1 md:col-span-4","rows-textarea":2,label:"Observaciones",modelValue:r(l).observations,"onUpdate:modelValue":e[12]||(e[12]=s=>r(l).observations=s),"error-message":r(l).errors.observations,type:"textarea"},null,8,["modelValue","error-message"])):v("",!0),o("div",ge,[o("div",xe,[o("p",ye,i(r(x).format(X.value)),1),e[23]||(e[23]=o("p",{class:"italic text-md"}," Valor Pasajero ",-1))]),o("div",we,[o("p",_e,i(r(x).format(U.value)),1),e[24]||(e[24]=o("p",{class:"italic text-md"}," Valor Real ",-1))])]),r(l).service_id?(u(),m("div",he,[o("div",Ve,[d(p,{label:"Placa del Vehiculo",modelValue:r(l).vehicle_plate,"onUpdate:modelValue":e[13]||(e[13]=s=>r(l).vehicle_plate=s),class:"w-full"},null,8,["modelValue"]),d(p,{label:"Nombre del Conductor",modelValue:r(l).driver_name,"onUpdate:modelValue":e[14]||(e[14]=s=>r(l).driver_name=s),class:"w-full"},null,8,["modelValue"])])])):v("",!0),t.$page.props.auth.user.rol=="admin"?(u(),m("div",Ce,[o("h1",ke,[e[25]||(e[25]=F(" Proveedores ")),d(a,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:e[15]||(e[15]=s=>H())})]),e[26]||(e[26]=o("div",{class:"flex justify-between w-full font-bold px-2"},[o("label",{for:""},"Proveedor"),o("label",{for:""},"Costo"),o("label",{for:""},".")],-1)),(u(!0),m(O,null,N(_.value,(s,c)=>(u(),m("div",Se,[d(p,{type:"dropdown",modelValue:s.proveedor,"onUpdate:modelValue":b=>s.proveedor=b,onValueChange:b=>Q(s),"option-label":"nombre","option-value":"id",class:"w-full",options:S.value},null,8,["modelValue","onUpdate:modelValue","onValueChange","options"]),d(p,{type:"number",mode:"currency",class:"w-full",modelValue:s.costo,"onUpdate:modelValue":b=>s.costo=b},null,8,["modelValue","onUpdate:modelValue"]),E(d(a,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:b=>G(c)},null,8,["onClick"]),[[f,"Quitar"]])]))),256))])):v("",!0)])]),_:1},8,["modelValue"]),d(r(me)),d(h,{visible:P.value,"onUpdate:visible":e[22]||(e[22]=s=>P.value=s),"pt:root:class":"!bg-blue-100",header:"Detalles de la actividad",position:"right"},{header:C(()=>[o("div",je,[o("span",Ee,i(n.value.service.title),1)])]),footer:C(()=>[o("div",tt,[o("h1",lt,"Saldo: "+i(r(x).format(n.value.total_price-n.value.payments.reduce((s,c)=>s+c.amount,0))),1),t.$page.props.auth.user.rol=="admin"?(u(),m("div",ot,[E(d(a,{onClick:e[18]||(e[18]=s=>A("COMPLETADA",!0)),icon:"fa-solid fa-circle-check",text:"",size:"large",class:"flex-auto",severity:"success"},null,512),[[f,"Completar Servicio",void 0,{top:!0}]]),E(d(a,{onClick:e[19]||(e[19]=s=>A("NO SHOW",!0)),icon:"fa-solid fa-eye-slash",text:"",size:"large",class:"flex-auto",severity:"warn"},null,512),[[f,"Servicio No show",void 0,{top:!0}]]),E(d(a,{onClick:e[20]||(e[20]=s=>te()),icon:"fa-solid fa-xmark-circle",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[f,"Cancelar Servicio",void 0,{top:!0}]]),E(d(a,{onClick:e[21]||(e[21]=s=>A("PROBLEMATICA",!1)),icon:"fa-solid fa-person-dress-burst",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[f,"Servicio Problematico",void 0,{top:!0}]])])):v("",!0)])]),default:C(()=>{var s;return[o("div",Pe,[o("div",De,[e[27]||(e[27]=o("strong",null,"Fecha del Servicio:",-1)),o("p",null,i(n.value.date),1)]),o("div",Be,[e[28]||(e[28]=o("strong",null,"Hora del Servicio:",-1)),o("p",null,i(n.value.hour),1)]),o("div",Ue,[e[29]||(e[29]=o("strong",null,"Canal de Venta:",-1)),o("p",null,i(n.value.channel.name),1)]),o("div",Ae,[e[30]||(e[30]=o("strong",null,"Cliente:",-1)),o("p",null,i(n.value.cliente_name),1)]),o("div",Te,[e[31]||(e[31]=o("strong",null,"Ciudad:",-1)),o("p",null,i(n.value.cliente_city),1)]),o("div",Oe,[e[32]||(e[32]=o("strong",null,"Telelfono:",-1)),o("a",{href:`tel://${n.value.cliente_phone}`},i(n.value.cliente_phone),9,Ne)]),o("div",Re,[e[33]||(e[33]=o("strong",null,"Edificio:",-1)),o("p",null,i(n.value.cliente_building),1)]),o("div",Le,[e[34]||(e[34]=o("strong",null,"Adultos:",-1)),o("p",null,i(n.value.adults),1)]),o("div",Fe,[e[35]||(e[35]=o("strong",null,"Niños:",-1)),o("p",null,i(n.value.boys),1)]),o("div",ze,[e[36]||(e[36]=o("strong",null,"Mascota:",-1)),o("p",null,i(n.value.mascota),1)]),o("div",Me,[e[37]||(e[37]=o("strong",null,"Total:",-1)),o("p",null,i(r(x).format(n.value.total)),1)]),o("div",Ie,[e[38]||(e[38]=o("strong",null,"Total Real:",-1)),o("p",null,i(r(x).format(n.value.total_real)),1)]),n.value.user?(u(),m("div",He,[e[39]||(e[39]=o("strong",null,"Vendedor:",-1)),o("p",null,i((s=n.value.user)==null?void 0:s.name),1)])):v("",!0),n.value.user?(u(),m("div",Ge,[e[40]||(e[40]=o("strong",null,"Fecha de reserva:",-1)),o("p",null,i(new Date(n.value.created_at).toLocaleDateString("es-CO")),1)])):v("",!0),n.value.fecha_cancelacion?(u(),m("div",qe,[e[41]||(e[41]=o("strong",null,"Fecha de Cancelación:",-1)),o("p",null,i(n.value.fecha_cancelacion),1)])):v("",!0),t.$page.props.auth.user.rol=="admin"?(u(),m("div",Qe,[e[42]||(e[42]=o("p",{class:"font-bold"}," Proveedores ",-1)),o("p",We,i(n.value.proveedors.length),1)])):v("",!0),t.$page.props.auth.user.rol=="admin"?(u(!0),m(O,{key:4},N(n.value.proveedors,c=>(u(),m("div",Je,[o("p",null,i(c.proveedor.nombre),1),o("p",null,i(r(x).format(c.cost)),1)]))),256)):v("",!0),o("div",Ke,[o("div",Xe,[e[43]||(e[43]=o("h2",{class:"text-xl font-bold"},"Pagos Realizados ",-1)),o("div",Ye,i(r(x).format(n.value.payments.reduce((c,b)=>c+b.amount,0))),1)]),(u(!0),m(O,null,N(n.value.payments,c=>(u(),m("div",Ze,[o("div",null,[o("div",et,i(c.type)+" "+i(r(x).format(c.amount)),1),o("div",null,i(new Date(c.created_at).toLocaleDateString("es-CO"))+" "+i(c.metohd_payment.name),1)]),o("div",{class:ae(["uppercase",c.status=="pendiente"?"bg-red-500 p-1 text-white rounded-lg shadow-md shadow-red-500":""])},[F(i(c.status)+" ",1),e[44]||(e[44]=o("div",null,null,-1))],2)]))),256))])])]}),_:1},8,["visible"])]),_:1})}}};export{Bt as default};
