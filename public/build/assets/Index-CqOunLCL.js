import{d as f,T as ee,Q as te,x as M,q as E,y as oe,o as c,c as k,w as y,a as e,b as d,u as a,h as A,t as n,g as v,f as m,F as T,i as N,k as S,n as le,z as se}from"./app-DVpdczqw.js";import{_ as ae,s as re}from"./AppLayout-Dx85EF6U.js";import{s as ne}from"./index-DFpfw_2G.js";import{_ as ie}from"./Datatable-L9XN6D3i.js";import{_ as p}from"./Input-RINFXXvD.js";import{_ as de}from"./Modal-Cbaq9wok.js";import{s as ue}from"./index-BKZLUyx4.js";import{a as ce}from"./toasts-CTe7CkCp.js";import{S as O}from"./sweetalert2.esm.all-DOYwHpwi.js";import"./index-DmB24AAk.js";import"./index-B9W5gkJW.js";import"./index-CUVgbKiM.js";import"./index-B5fVcnNG.js";import"./index-CP_lHnC6.js";import"./index-DyyVcGSN.js";import"./index-DadKD8PZ.js";import"./index-BYA20F9C.js";import"./index-C_jqeKT5.js";import"./index-DNOuHI3s.js";import"./useCommonUtilities-NbiuDOAU.js";import"./postcss-17U0J6nH.js";const pe={class:"h-[99vh]"},me={class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-center",novalidate:""},ve={class:"w-full col-span-1 md:col-span-4 flex justify-between gap-x-2 items-center"},fe={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},_e={class:"text-lg font-mono font-semibold"},be=e("p",{class:"italic text-md"}," Valor Pasajero ",-1),ge={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},he={class:"text-lg font-mono font-semibold"},xe=e("p",{class:"italic text-md"}," Valor Real ",-1),ye={key:4,class:"mt-4 w-full col-span-1 md:col-span-4 rounded-lg"},we={class:"flex gap-x-2"},Ve={key:5,class:"mt-4 w-full col-span-1 md:col-span-4 border rounded-lg"},Ce={class:"text-2xl font-mono font-semibold text-center bg-black rounded-t-lg text-white gap-x-3 p-2"},ke=e("div",{class:"flex justify-between w-full font-bold px-2"},[e("label",{for:""},"Proveedor"),e("label",{for:""},"Costo"),e("label",{for:""},".")],-1),Se={class:"flex justify-between gap-x-4 px-2"},je={class:"flex justify-end gap-x-2 mt-4 w-full"},Pe={class:"flex items-center gap-2"},De={class:"font-bold text-lg"},$e={class:"flex flex-col gap-y-1.5 text-sm"},Ue={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ee=e("strong",null,"Fecha del Servicio:",-1),Ae={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Te=e("strong",null,"Hora del Servicio:",-1),Ne={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Oe=e("strong",null,"Canal de Venta:",-1),Be={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Re=e("strong",null,"Cliente:",-1),Fe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Me=e("strong",null,"Ciudad:",-1),ze={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Le=e("strong",null,"Telelfono:",-1),Ie=["href"],He={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Qe=e("strong",null,"Edificio:",-1),qe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},We=e("strong",null,"Adultos:",-1),Ge={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Je=e("strong",null,"Niños:",-1),Ke={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Xe=e("strong",null,"Mascota:",-1),Ye={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ze=e("strong",null,"Total:",-1),et={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},tt=e("strong",null,"Total Real:",-1),ot={key:0,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},lt=e("strong",null,"Vendedor:",-1),st={key:1,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},at=e("strong",null,"Fecha de reserva:",-1),rt={key:2,class:"text-lg flex w-full justify-between mt-2"},nt=e("p",{class:"font-bold"}," Proveedores ",-1),it={class:"rounded-full bg-black text-white px-2"},dt={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},ut={class:"flex flex-col gap-y-2 mt-2"},ct={class:"flex justify-between"},pt=e("h2",{class:"text-xl font-bold"},"Pagos Realizados ",-1),mt={class:"bg-blue-600 text-white p-1 rounded-lg"},vt={class:"flex items-center text-xs justify-between border shadow-xl rounded-md p-1 bg-white"},ft={class:"uppercase font-bold"},_t=e("div",null,null,-1),bt={class:"flex flex-col items-center gap-2"},gt={class:"font-bold text-center"},ht={key:0,class:"flex gap-x-2"},Lt={__name:"Index",props:{bookingServices:Array},setup(z){const{toast:j}=ce(),P=f(!1),i=f({}),_=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),h=f(!1),L={action:()=>{o.reset(),h.value=!0}},B=f([]),o=ee({service_id:null,date:"",adults:1,boys:0,cliente_name:"",cliente_phone:"",cliente_city:"",cliente_building:"",mascota:0,persona_adicional:0,cobre_transaccion:0,cobro_extra_cliente:0,reserva:0,abono:0,method_id:"",channel_id:"9d99a95f-6c3d-48fd-aa7d-6ef4e6860123",percent_descuento:0,proveedors:[],total:0,total_real:0,percent_channel:0,observations:""}),x=f([{proveedor:null,costo:""}]),U=f([]),I=()=>{axios.get(route("get.services")).then(t=>{U.value=t.data.services})},H=()=>{x.value.push({proveedor:null,costo:""})},Q=t=>{t!=0&&x.value.splice(t,1)},w=f([]),D=f([]),q=()=>{axios.get(route("proveedors.index")).then(t=>{w.value=t.data.proveedors}).catch(t=>{console.log(t)})},W=t=>{var l;t.costo=w.value.find(r=>r.id==t.proveedor).services.find(r=>r.id==o.service_id)===void 0?0:((l=w.value.find(r=>r.id==t.proveedor).services.find(r=>r.id==o.service_id))==null?void 0:l.pivot.value)*o.adults,console.log(t)},G=()=>{axios.get(route("channels.index")).then(t=>{D.value=t.data}).catch(t=>{console.log(t)})};I(),G(),q();const J=[{label:"Detalles",action:t=>{i.value=t,P.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:t=>{o.service_id=t.service_id,o.cliente_name=t.cliente_name,o.cliente_phone=t.cliente_phone,o.cliente_city=t.cliente_city,o.cliente_building=t.cliente_building,o.adults=t.adults,o.total=t.total,o.method_id=t.method_id,o.channel_id=t.channel_id,o.percent_descuento=t.percent_descuento,o.proveedors=t.proveedors,x.value=t.proveedors,o.observations=t.observations,i.value=t,h.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Problematica",show:te().props.auth.user.rol=="admin",action:t=>{var l=t.problematic?"Desmarcar":"Marcar";O.fire({title:"Estas Seguro?",text:`${l} como problematica esta reservación!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${l}!`}).then(r=>{r.isConfirmed&&M.post(route("booking.problematic",t.id),{onSuccess:()=>{j("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"}],K=[{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service.title",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!0,sortable:!0,type:"date"},{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"problematic",header:"Problematica",filter:!0,sortable:!0,type:"boolean"},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"COMPLETADA",severity:"success",class:""},{text:"DISEÑO",severity:"info",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"SERVICIO POSTVENTA",severity:"success",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"}]}],X=E(()=>o.total/o.adults),R=E(()=>{let t=D.value.find(r=>r.id==o.channel_id),l=t?t.percent/100:0;return o.total-o.total*l}),V=f(!1),Y=t=>{t.preventDefault(),o.total_real=R.value,o.percent_channel=D.value.find(l=>l.id==o.channel_id).percent,V.value=!0,o.proveedors=x.value,o.post(route("reservar"),{onSuccess:()=>{V.value=!1,h.value=!1,j("success","Reserva creada con exito")},onError:()=>{V.value=!1,j("error","Error al crear la reserva")}})};(()=>{axios.get(route("paymentMethods.index")).then(t=>{B.value=t.data}).catch(t=>{console.log(t)})})();const F=t=>{const[l,r,C]=t.split("-");return new Date(l,r-1,C)},Z=E(()=>{var t=[],l=U.value.find(u=>u.id==o.service_id);if(!l)return[];for(var r of l.locks)for(var C=F(r.start_date),b=F(r.end_date),s=C;s<=b;s.setDate(s.getDate()+1))t.push(new Date(s));return t}),$=(t,l)=>{O.fire({title:t,text:"Estas seguro de realizar esta acción?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si"}).then(r=>{r.isConfirmed&&(O.fire({title:t,text:"Esta reserva ha sido "+t+".",icon:"success"}),M.post(route("set.states"),{service:i.value.id,state:t,terminated:l},{onSuccess:()=>{P.value=!1,j("success","Reserva "+t)}}))})};return oe(o.adults,t=>{for(var l of x.value)l.proveedor&&(l.costo=w.value.find(r=>r.id==l.proveedor).pivot.value*t)}),(t,l)=>{const r=ne,C=re,b=se;return c(),k(ae,{title:"Services"},{default:y(()=>[e("div",pe,[d(ie,{actions:J,add:L,columnas:K,data:z.bookingServices,routecreate:"services.create",title:"Reservas"},null,8,["data"])]),d(de,{modelValue:h.value,"onUpdate:modelValue":l[17]||(l[17]=s=>h.value=s),title:"Añadir Reserva",width:"70vw"},{footer:y(()=>[e("div",je,[d(r,{onClick:l[16]||(l[16]=s=>h.value=!1),severity:"danger",label:"Cancelar",loading:V.value},null,8,["loading"]),d(r,{type:"submit",severity:"success",label:"Guardar",loading:V.value,onClick:Y},null,8,["loading"])])]),default:y(()=>[e("form",me,[d(p,{type:"dropdown",modelValue:a(o).service_id,"onUpdate:modelValue":l[0]||(l[0]=s=>a(o).service_id=s),"error-message":a(o).errors.service_id,label:"Servicio","option-label":"title","option-value":"id",options:U.value},null,8,["modelValue","error-message","options"]),d(p,{label:"Fecha de Reserva",enableTimePicker:!0,"disabled-dates":Z.value,modelValue:a(o).date,"onUpdate:modelValue":l[1]||(l[1]=s=>a(o).date=s),required:"","min-date":new Date,class:"w-full",type:"datetime"},null,8,["disabled-dates","modelValue","min-date"]),d(p,{label:"Valor Total",type:"number",mode:"currency",modelValue:a(o).total,"onUpdate:modelValue":l[2]||(l[2]=s=>a(o).total=s)},null,8,["modelValue"]),d(p,{label:"Pasajeros",type:"number",modelValue:a(o).adults,"onUpdate:modelValue":l[3]||(l[3]=s=>a(o).adults=s)},null,8,["modelValue"]),d(p,{label:"Niños",type:"number",modelValue:a(o).boys,"onUpdate:modelValue":l[4]||(l[4]=s=>a(o).boys=s)},null,8,["modelValue"]),d(p,{label:"Nombre del Pasajero",modelValue:a(o).cliente_name,"onUpdate:modelValue":l[5]||(l[5]=s=>a(o).cliente_name=s),"error-message":a(o).errors.cliente_name,class:"w-full"},null,8,["modelValue","error-message"]),d(p,{label:"Telefono",modelValue:a(o).cliente_phone,"onUpdate:modelValue":l[6]||(l[6]=s=>a(o).cliente_phone=s),"error-message":a(o).errors.cliente_phone,class:"w-full",type:"number"},null,8,["modelValue","error-message"]),d(p,{label:"Ciudad de donde Proviene",modelValue:a(o).cliente_city,"onUpdate:modelValue":l[7]||(l[7]=s=>a(o).cliente_city=s),"error-message":a(o).errors.city,class:"w-full"},null,8,["modelValue","error-message"]),d(p,{label:"Edificio u Hotel",class:"w-full",modelValue:a(o).cliente_building,"onUpdate:modelValue":l[8]||(l[8]=s=>a(o).cliente_building=s),"error-message":a(o).errors.cliente_building},null,8,["modelValue","error-message"]),A(" "+n(a(o).method)+" ",1),t.$page.props.auth.user.rol=="admin"?(c(),k(p,{key:0,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:B.value,modelValue:a(o).method_id,"onUpdate:modelValue":l[9]||(l[9]=s=>a(o).method_id=s),label:"Medio de Pago"},null,8,["options","modelValue"])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(),k(p,{key:1,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:D.value,modelValue:a(o).channel_id,"onUpdate:modelValue":l[10]||(l[10]=s=>a(o).channel_id=s),label:"Canal de Venta"},null,8,["options","modelValue"])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(),k(p,{key:2,class:"w-full",label:"Descuento",modelValue:a(o).percent_descuento,"onUpdate:modelValue":l[11]||(l[11]=s=>a(o).percent_descuento=s),"error-message":a(o).errors.percent_descuento,min:"0",max:"100",type:"number",suffix:" %"},null,8,["modelValue","error-message"])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(),k(p,{key:3,class:"w-full col-span-1 md:col-span-4","rows-textarea":2,label:"Observaciones",modelValue:a(o).observations,"onUpdate:modelValue":l[12]||(l[12]=s=>a(o).observations=s),"error-message":a(o).errors.observations,type:"textarea"},null,8,["modelValue","error-message"])):v("",!0),e("div",ve,[e("div",fe,[e("p",_e,n(a(_).format(X.value)),1),be]),e("div",ge,[e("p",he,n(a(_).format(R.value)),1),xe])]),a(o).service_id?(c(),m("div",ye,[e("div",we,[d(p,{label:"Placa del Vehiculo",modelValue:a(o).vehicle_plate,"onUpdate:modelValue":l[13]||(l[13]=s=>a(o).vehicle_plate=s),class:"w-full"},null,8,["modelValue"]),d(p,{label:"Nombre del Conductor",modelValue:a(o).driver_name,"onUpdate:modelValue":l[14]||(l[14]=s=>a(o).driver_name=s),class:"w-full"},null,8,["modelValue"])])])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(),m("div",Ve,[e("h1",Ce,[A(" Proveedores "),d(r,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:l[15]||(l[15]=s=>H())})]),ke,(c(!0),m(T,null,N(x.value,(s,u)=>(c(),m("div",Se,[d(p,{type:"dropdown",modelValue:s.proveedor,"onUpdate:modelValue":g=>s.proveedor=g,onValueChange:g=>W(s),"option-label":"nombre","option-value":"id",class:"w-full",options:w.value},null,8,["modelValue","onUpdate:modelValue","onValueChange","options"]),d(p,{type:"number",mode:"currency",class:"w-full",modelValue:s.costo,"onUpdate:modelValue":g=>s.costo=g},null,8,["modelValue","onUpdate:modelValue"]),S(d(r,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:g=>Q(u)},null,8,["onClick"]),[[b,"Quitar"]])]))),256))])):v("",!0)])]),_:1},8,["modelValue"]),d(a(ue)),d(C,{visible:P.value,"onUpdate:visible":l[22]||(l[22]=s=>P.value=s),"pt:root:class":"!bg-blue-100",header:"Detalles de la actividad",position:"right"},{header:y(()=>[e("div",Pe,[e("span",De,n(i.value.service.title),1)])]),footer:y(()=>[e("div",bt,[e("h1",gt,"Saldo: "+n(a(_).format(i.value.total_price-i.value.payments.reduce((s,u)=>s+u.amount,0))),1),t.$page.props.auth.user.rol=="admin"?(c(),m("div",ht,[S(d(r,{onClick:l[18]||(l[18]=s=>$("COMPLETADA",!0)),icon:"fa-solid fa-circle-check",text:"",size:"large",class:"flex-auto",severity:"success"},null,512),[[b,"Completar Servicio",void 0,{top:!0}]]),S(d(r,{onClick:l[19]||(l[19]=s=>$("NO SHOW",!0)),icon:"fa-solid fa-eye-slash",text:"",size:"large",class:"flex-auto",severity:"warn"},null,512),[[b,"Servicio No show",void 0,{top:!0}]]),S(d(r,{onClick:l[20]||(l[20]=s=>$("CANCELADA",!0)),icon:"fa-solid fa-xmark-circle",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[b,"Cancelar Servicio",void 0,{top:!0}]]),S(d(r,{onClick:l[21]||(l[21]=s=>$("PROBLEMATICA",!1)),icon:"fa-solid fa-person-dress-burst",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[b,"Servicio Problematico",void 0,{top:!0}]])])):v("",!0)])]),default:y(()=>{var s;return[e("div",$e,[e("div",Ue,[Ee,e("p",null,n(i.value.date),1)]),e("div",Ae,[Te,e("p",null,n(i.value.hour),1)]),e("div",Ne,[Oe,e("p",null,n(i.value.channel.name),1)]),e("div",Be,[Re,e("p",null,n(i.value.cliente_name),1)]),e("div",Fe,[Me,e("p",null,n(i.value.cliente_city),1)]),e("div",ze,[Le,e("a",{href:`tel://${i.value.cliente_phone}`},n(i.value.cliente_phone),9,Ie)]),e("div",He,[Qe,e("p",null,n(i.value.cliente_building),1)]),e("div",qe,[We,e("p",null,n(i.value.adults),1)]),e("div",Ge,[Je,e("p",null,n(i.value.boys),1)]),e("div",Ke,[Xe,e("p",null,n(i.value.mascota),1)]),e("div",Ye,[Ze,e("p",null,n(a(_).format(i.value.total)),1)]),e("div",et,[tt,e("p",null,n(a(_).format(i.value.total_real)),1)]),i.value.user?(c(),m("div",ot,[lt,e("p",null,n((s=i.value.user)==null?void 0:s.name),1)])):v("",!0),i.value.user?(c(),m("div",st,[at,e("p",null,n(new Date(i.value.created_at).toLocaleDateString("es-CO")),1)])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(),m("div",rt,[nt,e("p",it,n(i.value.proveedors.length),1)])):v("",!0),t.$page.props.auth.user.rol=="admin"?(c(!0),m(T,{key:3},N(i.value.proveedors,u=>(c(),m("div",dt,[e("p",null,n(u.proveedor.nombre),1),e("p",null,n(a(_).format(u.cost)),1)]))),256)):v("",!0),e("div",ut,[e("div",ct,[pt,e("div",mt,n(a(_).format(i.value.payments.reduce((u,g)=>u+g.amount,0))),1)]),(c(!0),m(T,null,N(i.value.payments,u=>(c(),m("div",vt,[e("div",null,[e("div",ft,n(u.type)+" "+n(a(_).format(u.amount)),1),e("div",null,n(new Date(u.created_at).toLocaleDateString("es-CO"))+" "+n(u.metohd_payment.name),1)]),e("div",{class:le(["uppercase",u.status=="pendiente"?"bg-red-500 p-1 text-white rounded-lg shadow-md shadow-red-500":""])},[A(n(u.status)+" ",1),_t],2)]))),256))])])]}),_:1},8,["visible"])]),_:1})}}};export{Lt as default};
