import{d as u,C as se,x as re,W as M,q as T,y as ne,e as ie,f as c,b as n,w as U,F as A,o as d,a as r,u as a,c as g,g as m,t as C,h as de,i as H,k as ue,T as ce}from"./app-CAgEonYK.js";import{s as me}from"./index-Bkag-uyN.js";import{_ as pe}from"./Datatable-BVyDIed_.js";import{_ as F,a as i}from"./Modal-BqLvxGuL.js";import{_ as ve}from"./AppLayout-tuhwBtFy.js";import{s as fe}from"./index-CWj5C1QA.js";import{S as I,a as be}from"./toasts-CuGasqAw.js";import{_ as ge}from"./viewBooking-BYQpWsTm.js";import"./index-Dc0Pr7hI.js";import"./index-Cvfp_s06.js";import"./index-D-DFRv3l.js";import"./index-COneNhM-.js";import"./index-DyZeE01z.js";import"./index-DUcKHlmn.js";import"./index-B19EQvzV.js";import"./index-DEw17l4n.js";import"./postcss-Dlrh4i1X.js";import"./index-CO_8rx0L.js";import"./index-BCierodh.js";import"./index-B0QlgFqi.js";import"./index-IY_USx6-.js";import"./useCommonUtilities-DO03hYfs.js";import"./moment-Cijl8gKs.js";import"./index-BWSqz04E.js";import"./index-6sHMHLnu.js";import"./index-RSQQo-RZ.js";import"./index-6BdoIgvp.js";const _e={class:"h-[99vh]"},ye={class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-center",novalidate:""},xe={class:"w-full col-span-1 md:col-span-4 flex justify-between gap-x-2 items-center"},Ve={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},we={class:"text-lg font-mono font-semibold"},he={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},Ce={class:"text-lg font-mono font-semibold"},ke={key:4,class:"mt-4 w-full col-span-1 md:col-span-4 rounded-lg"},Se={class:"flex gap-x-2"},Ue={key:5,class:"mt-4 w-full col-span-1 md:col-span-4 border rounded-lg"},$e={class:"text-2xl font-mono font-semibold text-center bg-black rounded-t-lg text-white gap-x-3 p-2"},Pe={class:"flex justify-between gap-x-4 px-2"},Ee={class:"flex justify-end gap-x-2 mt-4 w-full"},De={class:"w-full flex flex-col gap-y-5 p-2"},Be={class:"h-[30vh] overflow-y-auto flex flex-col gap-y-2"},Ne=["src"],Te={class:"ml-4 flex flex-col gap-y-2 w-full"},Ae={class:"font-bold text-2xl"},je={class:"w-full flex justify-between"},Oe={key:0,class:"flex justify-center flex-col items-center"},Re={class:"flex gap-x-2"},pl={__name:"Index",props:{bookingServices:Array},setup(L){const{toast:_}=be(),$=u(!1),k=u(null),P=u(!1),j=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),p=u(!1),z={action:()=>{l.reset(),p.value=!0}},O=u([]),l=se({id:"",service_id:null,date:"",adults:1,time_service:"",boys:0,cliente_name:"",cliente_phone:"",cliente_city:"",cliente_building:"",mascota:0,persona_adicional:0,cobre_transaccion:0,cobro_extra_cliente:0,reserva:0,abono:0,method_id:"",channel_id:"9d99a95f-6c3d-48fd-aa7d-6ef4e6860123",percent_descuento:0,proveedors:[],total:0,total_real:0,percent_channel:0,observations:""}),v=u([{proveedor:null,costo:""}]),E=u([]),W=()=>{axios.get(route("get.services")).then(o=>{E.value=o.data.services})},q=()=>{v.value.push({proveedor:null,costo:""})},G=o=>{o!=0&&v.value.splice(o,1)},y=u([]),x=u([]),Q=()=>{axios.get(route("proveedors.index")).then(o=>{y.value=o.data.proveedors}).catch(o=>{console.log(o)})},J=o=>{var e;o.costo=y.value.find(s=>s.id==o.proveedor).services.find(s=>s.id==l.service_id)===void 0?0:((e=y.value.find(s=>s.id==o.proveedor).services.find(s=>s.id==l.service_id))==null?void 0:e.pivot.value)*l.adults,console.log(o)},K=()=>{axios.get(route("channels.index")).then(o=>{x.value=o.data}).catch(o=>{console.log(o)})};W(),K(),Q();const D=u(null),B=u([]),S=u(""),X=[{label:"Detalles",action:o=>{k.value=o,$.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:o=>{l.id=o.id;const e=(s,f)=>{const[w,t,h]=s.split("-"),[b,ae]=f.split(":");return`${w}-${t}-${h},${b}:${ae}`};l.date=e(o.date,o.hour),l.service_id=o.service_id,l.cliente_name=o.cliente_name,l.cliente_phone=o.cliente_phone,l.cliente_city=o.cliente_city,l.cliente_building=o.cliente_building,l.adults=o.adults,l.total=o.total,l.method_id=o.method_id,l.channel_id=o.channel_id,l.percent_descuento=o.percent_descuento,l.proveedors=o.proveedors,v.value=o.proveedors.map(s=>({proveedor:s.proveedor_id,costo:s.cost})),l.observations=o.observations,k.value=o,p.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Notas",action:o=>{D.value=o,P.value=!0},icon:"fa-solid fa-note-sticky text-sm"},{label:"Problematica",show:re().props.auth.user.rol=="admin",action:o=>{var e=o.problematic?"Desmarcar":"Marcar";I.fire({title:"Estas Seguro?",text:`${e} como problematica esta reservación!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${e}!`}).then(s=>{s.isConfirmed&&M.post(route("booking.problematic",o.id),{onSuccess:()=>{_("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"},{label:"Eliminar",icon:"fa-solid fa-trash text-sm",severity:"danger",action:o=>{I.fire({title:"Estas Seguro?",text:`Eliminar la reservación de ${o.cliente_name}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, Eliminar!"}).then(e=>{e.isConfirmed&&M.delete(route("BookingServices.destroy",o.id),{onSuccess:()=>{_("success","Reserva Eliminada")}})})}}],Y=[{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"adults",header:"Pasajeros",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service.title",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!0,sortable:!0},{field:"channel.name",header:"Canal de venta",filter:!0,sortable:!0},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"COMPLETADA",severity:"success",class:""},{text:"DISEÑO",severity:"info",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"SERVICIO POSTVENTA",severity:"success",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"}]}],Z=T(()=>l.total/l.adults),N=T(()=>{let o=x.value.find(s=>s.id==l.channel_id),e=o?o.percent/100:0;return l.total-l.total*e}),V=u(!1),ee=o=>{o.preventDefault(),l.total_real=N.value,l.percent_channel=x.value.find(e=>e.id==l.channel_id).percent,V.value=!0,l.proveedors=v.value,l.post(route("reservar"),{onSuccess:()=>{l.reset(),V.value=!1,p.value=!1,_("success","Reserva creada con exito")},onError:()=>{V.value=!1,_("error","Error al crear la reserva")}})},le=()=>{l.total_real=N.value,l.percent_channel=x.value.find(o=>o.id==l.channel_id).percent,l.proveedors=v.value,l.put(route("BookingServices.update",l.id),{onSuccess:()=>{p.value=!1,_("success","Reserva actualizada con exito")}})};(()=>{axios.get(route("paymentMethods.index")).then(o=>{O.value=o.data}).catch(o=>{console.log(o)})})();const R=o=>{const[e,s,f]=o.split("-");return new Date(e,s-1,f)},oe=T(()=>{var o=[],e=E.value.find(h=>h.id==l.service_id);if(!e)return[];for(var s of e.locks)for(var f=R(s.start_date),w=R(s.end_date),t=f;t<=w;t.setDate(t.getDate()+1))o.push(new Date(t));return o});ne(l.adults,o=>{for(var e of v.value)e.proveedor&&(e.costo=y.value.find(s=>s.id==e.proveedor).pivot.value*o)});const te=()=>{axios.post(route("notes.store"),{note:S.value,booking_service_id:D.value.id}).then(o=>{axios.get(route("notes.index",{booking_service_id:D.value.id})).then(e=>{B.value=e.data.notes,S.value=""})})};return(o,e)=>{const s=me,f=ie("Logo"),w=ce;return d(),c(A,null,[n(ve,{title:"Reservas"},{default:U(()=>[r("div",_e,[n(pe,{actions:X,add:z,columnas:Y,data:L.bookingServices,routecreate:"services.create",title:"Reservas",rowClass:!0},null,8,["data"])]),n(F,{modelValue:p.value,"onUpdate:modelValue":e[18]||(e[18]=t=>p.value=t),title:"Añadir Reserva",width:"70vw"},{footer:U(()=>[r("div",Ee,[n(s,{onClick:e[17]||(e[17]=t=>p.value=!1),severity:"danger",label:"Cancelar",loading:V.value},null,8,["loading"]),a(l).id?(d(),g(s,{key:0,type:"submit",label:"Actualizar",severity:"warn",onClick:le})):(d(),g(s,{key:1,type:"submit",severity:"success",label:"Guardar",loading:V.value,onClick:ee},null,8,["loading"]))])]),default:U(()=>[r("form",ye,[n(i,{type:"dropdown",modelValue:a(l).service_id,"onUpdate:modelValue":e[0]||(e[0]=t=>a(l).service_id=t),"error-message":a(l).errors.service_id,label:"Servicio","option-label":"title","option-value":"id",options:E.value},null,8,["modelValue","error-message","options"]),n(i,{label:"Fecha de Reserva",enableTimePicker:!0,"disabled-dates":oe.value,modelValue:a(l).date,"onUpdate:modelValue":e[1]||(e[1]=t=>a(l).date=t),required:"",class:"w-full",type:"datetime"},null,8,["disabled-dates","modelValue"]),n(i,{label:"Valor Total",type:"number",mode:"currency",modelValue:a(l).total,"onUpdate:modelValue":e[2]||(e[2]=t=>a(l).total=t)},null,8,["modelValue"]),n(i,{label:"Tiempo del Servicio",type:"dropdown",modelValue:a(l).time_service,"onUpdate:modelValue":e[3]||(e[3]=t=>a(l).time_service=t),options:["20 Minutos","30 Minutos","40 Minutos","1 Hora","2 Horas","6 Horas","12 Horas","24 Horas"]},null,8,["modelValue"]),n(i,{label:"Pasajeros",type:"number",modelValue:a(l).adults,"onUpdate:modelValue":e[4]||(e[4]=t=>a(l).adults=t)},null,8,["modelValue"]),n(i,{label:"Niños",type:"number",modelValue:a(l).boys,"onUpdate:modelValue":e[5]||(e[5]=t=>a(l).boys=t)},null,8,["modelValue"]),n(i,{label:"Nombre del Pasajero",modelValue:a(l).cliente_name,"onUpdate:modelValue":e[6]||(e[6]=t=>a(l).cliente_name=t),"error-message":a(l).errors.cliente_name,class:"w-full"},null,8,["modelValue","error-message"]),n(i,{label:"Telefono",modelValue:a(l).cliente_phone,"onUpdate:modelValue":e[7]||(e[7]=t=>a(l).cliente_phone=t),"error-message":a(l).errors.cliente_phone,class:"w-full",type:"number"},null,8,["modelValue","error-message"]),n(i,{label:"Ciudad de donde Proviene",modelValue:a(l).cliente_city,"onUpdate:modelValue":e[8]||(e[8]=t=>a(l).cliente_city=t),"error-message":a(l).errors.city,class:"w-full"},null,8,["modelValue","error-message"]),n(i,{label:"Edificio u Hotel",class:"w-full",modelValue:a(l).cliente_building,"onUpdate:modelValue":e[9]||(e[9]=t=>a(l).cliente_building=t),"error-message":a(l).errors.cliente_building},null,8,["modelValue","error-message"]),o.$page.props.auth.user.rol=="admin"?(d(),g(i,{key:0,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:O.value,modelValue:a(l).method_id,"onUpdate:modelValue":e[10]||(e[10]=t=>a(l).method_id=t),label:"Medio de Pago"},null,8,["options","modelValue"])):m("",!0),o.$page.props.auth.user.rol=="admin"?(d(),g(i,{key:1,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:x.value,modelValue:a(l).channel_id,"onUpdate:modelValue":e[11]||(e[11]=t=>a(l).channel_id=t),label:"Canal de Venta"},null,8,["options","modelValue"])):m("",!0),o.$page.props.auth.user.rol=="admin"?(d(),g(i,{key:2,class:"w-full",label:"Descuento",modelValue:a(l).percent_descuento,"onUpdate:modelValue":e[12]||(e[12]=t=>a(l).percent_descuento=t),"error-message":a(l).errors.percent_descuento,min:"0",max:"100",type:"number",suffix:" %"},null,8,["modelValue","error-message"])):m("",!0),o.$page.props.auth.user.rol=="admin"?(d(),g(i,{key:3,class:"w-full col-span-1 md:col-span-4","rows-textarea":2,label:"Observaciones",modelValue:a(l).observations,"onUpdate:modelValue":e[13]||(e[13]=t=>a(l).observations=t),"error-message":a(l).errors.observations,type:"textarea"},null,8,["modelValue","error-message"])):m("",!0),r("div",xe,[r("div",Ve,[r("p",we,C(a(j).format(Z.value)),1),e[22]||(e[22]=r("p",{class:"italic text-md"},"Valor Pasajero",-1))]),r("div",he,[r("p",Ce,C(a(j).format(N.value)),1),e[23]||(e[23]=r("p",{class:"italic text-md"},"Valor Real",-1))])]),a(l).service_id?(d(),c("div",ke,[r("div",Se,[n(i,{label:"Placa del Vehiculo",modelValue:a(l).vehicle_plate,"onUpdate:modelValue":e[14]||(e[14]=t=>a(l).vehicle_plate=t),class:"w-full"},null,8,["modelValue"]),n(i,{label:"Nombre del Conductor",modelValue:a(l).driver_name,"onUpdate:modelValue":e[15]||(e[15]=t=>a(l).driver_name=t),class:"w-full"},null,8,["modelValue"])])])):m("",!0),o.$page.props.auth.user.rol=="admin"?(d(),c("div",Ue,[r("h1",$e,[e[24]||(e[24]=de(" Proveedores ")),n(s,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:e[16]||(e[16]=t=>q())})]),e[25]||(e[25]=r("div",{class:"flex justify-between w-full font-bold px-2"},[r("label",{for:""},"Proveedor"),r("label",{for:""},"Costo"),r("label",{for:""},".")],-1)),(d(!0),c(A,null,H(v.value,(t,h)=>(d(),c("div",Pe,[n(i,{type:"dropdown",modelValue:t.proveedor,"onUpdate:modelValue":b=>t.proveedor=b,onValueChange:b=>J(t),"option-label":"nombre","option-value":"id",class:"w-full",options:y.value},null,8,["modelValue","onUpdate:modelValue","onValueChange","options"]),n(i,{type:"number",mode:"currency",class:"w-full",modelValue:t.costo,"onUpdate:modelValue":b=>t.costo=b},null,8,["modelValue","onUpdate:modelValue"]),ue(n(s,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:b=>G(h)},null,8,["onClick"]),[[w,"Quitar"]])]))),256))])):m("",!0)])]),_:1},8,["modelValue"]),n(a(fe)),k.value?(d(),g(ge,{key:0,modelValue:$.value,"onUpdate:modelValue":e[19]||(e[19]=t=>$.value=t),service:k.value},null,8,["modelValue","service"])):m("",!0)]),_:1}),n(F,{modelValue:P.value,"onUpdate:modelValue":e[21]||(e[21]=t=>P.value=t),"close-on-escape":"true",title:"Notas",width:"90vw"},{default:U(()=>[r("div",De,[e[27]||(e[27]=r("h3",{class:"text-xl font-bold"},"Notas de la Actividad",-1)),r("div",Be,[(d(!0),c(A,null,H(B.value,t=>(d(),c("div",{class:"flex border shadow-md p-2 rounded-md",key:t.id},[r("img",{src:t.user.profile_photo_url,class:"size-12 rounded-full",alt:""},null,8,Ne),r("div",Te,[r("h2",Ae,C(t.user.name),1),r("div",je,[r("p",null,C(t.note),1),r("p",null,C(new Date(t.created_at).toISOString().split("T")[0]),1)])])]))),128)),B.value.length==0?(d(),c("div",Oe,[n(f),e[26]||(e[26]=r("p",{class:"font-semibold text-xl"},"Serivicio sin notas",-1))])):m("",!0)]),r("div",Re,[n(i,{type:"textarea",class:"w-full shadow-xl",modelValue:S.value,"onUpdate:modelValue":e[20]||(e[20]=t=>S.value=t)},null,8,["modelValue"]),n(s,{label:"Guardar",severity:"info",icon:"pi pi-send",onClick:te})])])]),_:1},8,["modelValue"])],64)}}};export{pl as default};
