import{_ as S}from"./Input-CLZuwqLt.js";import{u as h,A as E,f as c,o as d,a as o,g,b,t as i,h as p,F as T,j,w as N,i as A,I as V}from"./app-CPo0GcCA.js";import{a as l,g as w}from"./Toats-CRqRGqmn.js";import{s as C}from"./index-BkvqpQX3.js";import"./index-D4IEDDPk.js";import"./index-DiTKscUs.js";import"./index-B93ScLtj.js";import"./index-CUsu-i1t.js";import"./index-BOxZvjv3.js";import"./index-CYcwNeWy.js";import"./index-Bg6edAO2.js";import"./index-CaLMoEKX.js";import"./index-BWvwZ1zG.js";import"./index-DMzsIxyf.js";import"./index-BS8M3_Nj.js";import"./index-Bx-gcP9C.js";import"./index-BIKX2mfq.js";import"./index-CQQYC2yn.js";import"./index-BDvJFkWh.js";import"./index-DhNaUGyu.js";import"./index-DFMNJ67N.js";import"./index-SJZ3w2zJ.js";import"./useCommonUtilities-BgDhORlD.js";import"./postcss-UjCxpwta.js";import"./postcss-DmbKbbQR.js";import"./sweetalert2.esm.all-Y6IUEg8t.js";const F={class:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-md mb-4"},M={class:"grid grid-cols-2 gap-2 text-sm"},$={class:"font-bold ml-2"},I={class:"font-bold ml-2"},B={class:"font-bold ml-2"},D={class:"font-bold ml-2"},L={key:0,class:"text-gray-500"},U={class:"bg-white dark:bg-gray-800 p-4 rounded-md shadow-sm border"},G={class:"flex items-center justify-between mb-2"},O={class:"font-semibold"},P={class:"text-sm text-gray-500"},Q={key:0,class:"mt-2 text-xs text-blue-600 dark:text-blue-400"},kt={__name:"Tickets",props:{bookingService:Object},setup(k){const a=k,r=h({ticketType:[],bookingService:a.bookingService.id}),u={"Adultos Nacionales":"adults_nacionales","Adultos Extranjeros":"adults_extranjeros","Niños Nacionales":"boys_nacionales","Niños Extranjeros":"boys_extranjeros"};function x(){axios.get(route("get.ticket.types")).then(s=>{s.data.ticketTypes.filter(t=>t.services.some(e=>e.id===a.bookingService.service_id)).forEach(t=>{const e=f(t.name);r.ticketType.push({type_id:t.id,name:t.name,disponibles:t.disponibles,cant:e,category:u[t.name]||null})})}).catch(s=>{console.error("Error al obtener los tipos de tickets:",s)})}function f(s){const t=u[s];return t&&a.bookingService[t]?a.bookingService[t]:0}function m(s){const t=s.category;if(t&&a.bookingService[t]){const e=a.bookingService[t];return Math.min(e,s.disponibles)}return s.disponibles}function y(s){const t=m(s);s.cant>t&&(s.cant=t,l(`La cantidad máxima para ${s.name} es ${t}`))}const _=E(()=>r.ticketType.some(s=>s.cant>0));x();const v=()=>{let s=!1;if(r.ticketType.forEach(e=>{if(e.cant>0){const n=m(e);e.cant>n&&(s=!0,l(`La cantidad de ${e.name} excede el número de pasajeros`))}}),s)return;const t=r.ticketType.filter(e=>e.cant>0);if(t.length===0){l("Debe asignar al menos un ticket");return}t.forEach(e=>{V.post(route("pagoEntradas.storeTicket"),{ticket_type_id:e.type_id,cantidad:e.cant,costo_total:0,tipo_movimiento:"salida",booking_service_id:a.bookingService.id},{onSuccess:()=>{w("Tickets asignados correctamente")},onError:n=>{console.error("Error al asignar tickets:",n),l("Error al asignar los tickets")}})})};return(s,t)=>(d(),c("div",null,[t[6]||(t[6]=o("h2",{class:"text-lg font-bold mb-4"},"Tickets Asociados",-1)),o("div",F,[t[4]||(t[4]=o("h3",{class:"font-semibold mb-2 text-blue-900 dark:text-blue-100"},"Resumen de Pasajeros",-1)),o("div",M,[o("div",null,[t[0]||(t[0]=o("span",{class:"text-gray-600 dark:text-gray-400"},"Adultos Nacionales:",-1)),o("span",$,i(a.bookingService.adults_nacionales||0),1)]),o("div",null,[t[1]||(t[1]=o("span",{class:"text-gray-600 dark:text-gray-400"},"Adultos Extranjeros:",-1)),o("span",I,i(a.bookingService.adults_extranjeros||0),1)]),o("div",null,[t[2]||(t[2]=o("span",{class:"text-gray-600 dark:text-gray-400"},"Niños Nacionales:",-1)),o("span",B,i(a.bookingService.boys_nacionales||0),1)]),o("div",null,[t[3]||(t[3]=o("span",{class:"text-gray-600 dark:text-gray-400"},"Niños Extranjeros:",-1)),o("span",D,i(a.bookingService.boys_extranjeros||0),1)])])]),p(r).ticketType.length===0?(d(),c("div",L," No hay tickets asociados a esta reserva. ")):g("",!0),(d(!0),c(T,null,j(p(r).ticketType,e=>(d(),c("div",{key:e.type_id,class:"mb-4"},[o("div",U,[o("div",G,[o("span",O,i(e.name),1),o("span",P,"Disponibles: "+i(e.disponibles),1)]),b(S,{modelValue:e.cant,"onUpdate:modelValue":n=>e.cant=n,type:"number",min:"0",suffix:" Entradas",label:"Cantidad a asignar",max:m(e),onInput:n=>y(e)},null,8,["modelValue","onUpdate:modelValue","max","onInput"]),e.cant>0?(d(),c("div",Q," Se asignarán "+i(e.cant)+" tickets de "+i(e.name),1)):g("",!0)])]))),128)),b(p(C),{onClick:v,severity:"success",class:"w-full",disabled:!_.value},{default:N(()=>[...t[5]||(t[5]=[A(" Guardar y Asignar Tickets ",-1)])]),_:1},8,["disabled"])]))}};export{kt as default};
