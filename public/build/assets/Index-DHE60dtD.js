import{d,C as Z,x as ee,W as D,q as U,y as le,c as p,w as $,o as u,a as i,b as r,u as a,g,t as T,f as h,h as oe,F as te,i as ae,k as se,T as re}from"./app-BgLvWl0T.js";import{s as ne}from"./index-CzmRhpnN.js";import{_ as ie}from"./Datatable-Dmk6xSeQ.js";import{_ as n,a as de}from"./Modal-DVO1YWmA.js";import{_ as ue}from"./AppLayout-5mn8oCtc.js";import{s as ce}from"./index-CwhZDAqO.js";import{S as A,a as me}from"./toasts-CuGasqAw.js";import{_ as pe}from"./viewBooking-s-UX-5qK.js";import"./index-DOYu5x2t.js";import"./index-BwvaOCmd.js";import"./index-C5iWD2vE.js";import"./index-CpNQ_w2W.js";import"./index-DnrvTrqK.js";import"./index-n6gg82GD.js";import"./index-D7vtmUbR.js";import"./index-Bih92YMk.js";import"./postcss-BqPgeWJs.js";import"./index-CMB-Jnv6.js";import"./index-CYPv6LPy.js";import"./index-C7QX-4IK.js";import"./index-CEnBIXDR.js";import"./useCommonUtilities-DO03hYfs.js";import"./moment-Cijl8gKs.js";import"./index-CbSoSe5P.js";import"./index-a-5SHS9n.js";import"./index-BBAcYKbe.js";import"./index-B8Km-od9.js";const ve={class:"h-[99vh]"},fe={class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-center",novalidate:""},be={class:"w-full col-span-1 md:col-span-4 flex justify-between gap-x-2 items-center"},ge={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},Ve={class:"text-lg font-mono font-semibold"},ye={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},_e={class:"text-lg font-mono font-semibold"},xe={key:4,class:"mt-4 w-full col-span-1 md:col-span-4 rounded-lg"},we={class:"flex gap-x-2"},he={key:5,class:"mt-4 w-full col-span-1 md:col-span-4 border rounded-lg"},Ce={class:"text-2xl font-mono font-semibold text-center bg-black rounded-t-lg text-white gap-x-3 p-2"},ke={class:"flex justify-between gap-x-4 px-2"},Se={class:"flex justify-end gap-x-2 mt-4 w-full"},ll={__name:"Index",props:{bookingServices:Array},setup(N){const{toast:V}=me(),C=d(!1),w=d(null),j=d(!1),P=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),v=d(!1),R={action:()=>{e.reset(),v.value=!0}},E=d([]),e=Z({id:"",service_id:null,date:"",adults:1,time_service:"",boys:0,cliente_name:"",cliente_phone:"",cliente_city:"",cliente_building:"",mascota:0,persona_adicional:0,cobre_transaccion:0,cobro_extra_cliente:0,reserva:0,abono:0,method_id:"",channel_id:"9d99a95f-6c3d-48fd-aa7d-6ef4e6860123",percent_descuento:0,proveedors:[],total:0,total_real:0,percent_channel:0,observations:""}),f=d([{proveedor:null,costo:""}]),k=d([]),M=()=>{axios.get(route("get.services")).then(o=>{k.value=o.data.services})},O=()=>{f.value.push({proveedor:null,costo:""})},H=o=>{o!=0&&f.value.splice(o,1)},y=d([]),_=d([]),F=()=>{axios.get(route("proveedors.index")).then(o=>{y.value=o.data.proveedors}).catch(o=>{console.log(o)})},I=o=>{var l;o.costo=y.value.find(s=>s.id==o.proveedor).services.find(s=>s.id==e.service_id)===void 0?0:((l=y.value.find(s=>s.id==o.proveedor).services.find(s=>s.id==e.service_id))==null?void 0:l.pivot.value)*e.adults,console.log(o)},L=()=>{axios.get(route("channels.index")).then(o=>{_.value=o.data}).catch(o=>{console.log(o)})};M(),L(),F();const z=d(null);d([]),d("");const W=[{label:"Detalles",action:o=>{w.value=o,C.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:o=>{e.id=o.id;const l=(s,b)=>{const[t,m,c]=s.split("-"),[X,Y]=b.split(":");return`${t}-${m}-${c},${X}:${Y}`};e.date=l(o.date,o.hour),e.service_id=o.service_id,e.cliente_name=o.cliente_name,e.cliente_phone=o.cliente_phone,e.cliente_city=o.cliente_city,e.cliente_building=o.cliente_building,e.adults=o.adults,e.total=o.total,e.method_id=o.method_id,e.channel_id=o.channel_id,e.percent_descuento=o.percent_descuento,e.proveedors=o.proveedors,f.value=o.proveedors.map(s=>({proveedor:s.proveedor_id,costo:s.cost})),e.observations=o.observations,w.value=o,v.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Notas",action:o=>{z.value=o,j.value=!0},icon:"fa-solid fa-note-sticky text-sm"},{label:"Problematica",show:ee().props.auth.user.rol=="admin",action:o=>{var l=o.problematic?"Desmarcar":"Marcar";A.fire({title:"Estas Seguro?",text:`${l} como problematica esta reservación!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${l}!`}).then(s=>{s.isConfirmed&&D.post(route("booking.problematic",o.id),{onSuccess:()=>{V("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"},{label:"Eliminar",icon:"fa-solid fa-trash text-sm",severity:"danger",action:o=>{A.fire({title:"Estas Seguro?",text:`Eliminar la reservación de ${o.cliente_name}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, Eliminar!"}).then(l=>{l.isConfirmed&&D.delete(route("BookingServices.destroy",o.id),{onSuccess:()=>{V("success","Reserva Eliminada")}})})}}],q=[{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"adults",header:"Pasajeros",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service.title",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!0,sortable:!0},{field:"channel.name",header:"Canal de venta",filter:!0,sortable:!0},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"COMPLETADA",severity:"success",class:""},{text:"DISEÑO",severity:"info",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"SERVICIO POSTVENTA",severity:"success",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"}]}],Q=U(()=>e.total/e.adults),S=U(()=>{let o=_.value.find(s=>s.id==e.channel_id),l=o?o.percent/100:0;return e.total-e.total*l}),x=d(!1),G=o=>{o.preventDefault(),e.total_real=S.value,e.percent_channel=_.value.find(l=>l.id==e.channel_id).percent,x.value=!0,e.proveedors=f.value,e.post(route("reservar"),{onSuccess:()=>{e.reset(),x.value=!1,v.value=!1,V("success","Reserva creada con exito")},onError:()=>{x.value=!1,V("error","Error al crear la reserva")}})},J=()=>{e.total_real=S.value,e.percent_channel=_.value.find(o=>o.id==e.channel_id).percent,e.proveedors=f.value,e.put(route("BookingServices.update",e.id),{onSuccess:()=>{v.value=!1,V("success","Reserva actualizada con exito")}})};(()=>{axios.get(route("paymentMethods.index")).then(o=>{E.value=o.data}).catch(o=>{console.log(o)})})();const B=o=>{const[l,s,b]=o.split("-");return new Date(l,s-1,b)},K=U(()=>{var o=[],l=k.value.find(c=>c.id==e.service_id);if(!l)return[];for(var s of l.locks)for(var b=B(s.start_date),t=B(s.end_date),m=b;m<=t;m.setDate(m.getDate()+1))o.push(new Date(m));return o});return le(e.adults,o=>{for(var l of f.value)l.proveedor&&(l.costo=y.value.find(s=>s.id==l.proveedor).pivot.value*o)}),(o,l)=>{const s=ne,b=re;return u(),p(ue,{title:"Reservas"},{default:$(()=>[i("div",ve,[r(ie,{actions:W,add:R,columnas:q,data:N.bookingServices,routecreate:"services.create",title:"Reservas",rowClass:!0},null,8,["data"])]),r(de,{modelValue:v.value,"onUpdate:modelValue":l[18]||(l[18]=t=>v.value=t),title:"Añadir Reserva",width:"70vw"},{footer:$(()=>[i("div",Se,[r(s,{onClick:l[17]||(l[17]=t=>v.value=!1),severity:"danger",label:"Cancelar",loading:x.value},null,8,["loading"]),a(e).id?(u(),p(s,{key:0,type:"submit",label:"Actualizar",severity:"warn",onClick:J})):(u(),p(s,{key:1,type:"submit",severity:"success",label:"Guardar",loading:x.value,onClick:G},null,8,["loading"]))])]),default:$(()=>[i("form",fe,[r(n,{type:"dropdown",modelValue:a(e).service_id,"onUpdate:modelValue":l[0]||(l[0]=t=>a(e).service_id=t),"error-message":a(e).errors.service_id,label:"Servicio","option-label":"title","option-value":"id",options:k.value},null,8,["modelValue","error-message","options"]),r(n,{label:"Fecha de Reserva",enableTimePicker:!0,"disabled-dates":K.value,modelValue:a(e).date,"onUpdate:modelValue":l[1]||(l[1]=t=>a(e).date=t),required:"",class:"w-full",type:"datetime"},null,8,["disabled-dates","modelValue"]),r(n,{label:"Valor Total",type:"number",mode:"currency",modelValue:a(e).total,"onUpdate:modelValue":l[2]||(l[2]=t=>a(e).total=t)},null,8,["modelValue"]),r(n,{label:"Tiempo del Servicio",type:"dropdown",modelValue:a(e).time_service,"onUpdate:modelValue":l[3]||(l[3]=t=>a(e).time_service=t),options:["20 Minutos","30 Minutos","40 Minutos","1 Hora","2 Horas","6 Horas","12 Horas","24 Horas"]},null,8,["modelValue"]),r(n,{label:"Pasajeros",type:"number",modelValue:a(e).adults,"onUpdate:modelValue":l[4]||(l[4]=t=>a(e).adults=t)},null,8,["modelValue"]),r(n,{label:"Niños",type:"number",modelValue:a(e).boys,"onUpdate:modelValue":l[5]||(l[5]=t=>a(e).boys=t)},null,8,["modelValue"]),r(n,{label:"Nombre del Pasajero",modelValue:a(e).cliente_name,"onUpdate:modelValue":l[6]||(l[6]=t=>a(e).cliente_name=t),"error-message":a(e).errors.cliente_name,class:"w-full"},null,8,["modelValue","error-message"]),r(n,{label:"Telefono",modelValue:a(e).cliente_phone,"onUpdate:modelValue":l[7]||(l[7]=t=>a(e).cliente_phone=t),"error-message":a(e).errors.cliente_phone,class:"w-full",type:"number"},null,8,["modelValue","error-message"]),r(n,{label:"Ciudad de donde Proviene",modelValue:a(e).cliente_city,"onUpdate:modelValue":l[8]||(l[8]=t=>a(e).cliente_city=t),"error-message":a(e).errors.city,class:"w-full"},null,8,["modelValue","error-message"]),r(n,{label:"Edificio u Hotel",class:"w-full",modelValue:a(e).cliente_building,"onUpdate:modelValue":l[9]||(l[9]=t=>a(e).cliente_building=t),"error-message":a(e).errors.cliente_building},null,8,["modelValue","error-message"]),o.$page.props.auth.user.rol=="admin"?(u(),p(n,{key:0,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:E.value,modelValue:a(e).method_id,"onUpdate:modelValue":l[10]||(l[10]=t=>a(e).method_id=t),label:"Medio de Pago"},null,8,["options","modelValue"])):g("",!0),o.$page.props.auth.user.rol=="admin"?(u(),p(n,{key:1,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:_.value,modelValue:a(e).channel_id,"onUpdate:modelValue":l[11]||(l[11]=t=>a(e).channel_id=t),label:"Canal de Venta"},null,8,["options","modelValue"])):g("",!0),o.$page.props.auth.user.rol=="admin"?(u(),p(n,{key:2,class:"w-full",label:"Descuento",modelValue:a(e).percent_descuento,"onUpdate:modelValue":l[12]||(l[12]=t=>a(e).percent_descuento=t),"error-message":a(e).errors.percent_descuento,min:"0",max:"100",type:"number",suffix:" %"},null,8,["modelValue","error-message"])):g("",!0),o.$page.props.auth.user.rol=="admin"?(u(),p(n,{key:3,class:"w-full col-span-1 md:col-span-4","rows-textarea":2,label:"Observaciones",modelValue:a(e).observations,"onUpdate:modelValue":l[13]||(l[13]=t=>a(e).observations=t),"error-message":a(e).errors.observations,type:"textarea"},null,8,["modelValue","error-message"])):g("",!0),i("div",be,[i("div",ge,[i("p",Ve,T(a(P).format(Q.value)),1),l[20]||(l[20]=i("p",{class:"italic text-md"},"Valor Pasajero",-1))]),i("div",ye,[i("p",_e,T(a(P).format(S.value)),1),l[21]||(l[21]=i("p",{class:"italic text-md"},"Valor Real",-1))])]),a(e).service_id?(u(),h("div",xe,[i("div",we,[r(n,{label:"Placa del Vehiculo",modelValue:a(e).vehicle_plate,"onUpdate:modelValue":l[14]||(l[14]=t=>a(e).vehicle_plate=t),class:"w-full"},null,8,["modelValue"]),r(n,{label:"Nombre del Conductor",modelValue:a(e).driver_name,"onUpdate:modelValue":l[15]||(l[15]=t=>a(e).driver_name=t),class:"w-full"},null,8,["modelValue"])])])):g("",!0),o.$page.props.auth.user.rol=="admin"?(u(),h("div",he,[i("h1",Ce,[l[22]||(l[22]=oe(" Proveedores ")),r(s,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:l[16]||(l[16]=t=>O())})]),l[23]||(l[23]=i("div",{class:"flex justify-between w-full font-bold px-2"},[i("label",{for:""},"Proveedor"),i("label",{for:""},"Costo"),i("label",{for:""},".")],-1)),(u(!0),h(te,null,ae(f.value,(t,m)=>(u(),h("div",ke,[r(n,{type:"dropdown",modelValue:t.proveedor,"onUpdate:modelValue":c=>t.proveedor=c,onValueChange:c=>I(t),"option-label":"nombre","option-value":"id",class:"w-full",options:y.value},null,8,["modelValue","onUpdate:modelValue","onValueChange","options"]),r(n,{type:"number",mode:"currency",class:"w-full",modelValue:t.costo,"onUpdate:modelValue":c=>t.costo=c},null,8,["modelValue","onUpdate:modelValue"]),se(r(s,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:c=>H(m)},null,8,["onClick"]),[[b,"Quitar"]])]))),256))])):g("",!0)])]),_:1},8,["modelValue"]),r(a(ce)),w.value?(u(),p(pe,{key:0,modelValue:C.value,"onUpdate:modelValue":l[19]||(l[19]=t=>C.value=t),service:w.value},null,8,["modelValue","service"])):g("",!0)]),_:1})}}};export{ll as default};
