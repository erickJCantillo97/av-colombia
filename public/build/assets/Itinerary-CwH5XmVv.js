import{s as N}from"./index-Jn2FMzny.js";import{s as S}from"./index-AR5vWrp5.js";import{s as U}from"./index-CkA6duaC.js";import{s as $}from"./index-8C_LkaZk.js";import{s as j}from"./index-CN0zJt87.js";import{d as g,fa as q,q as D,f as _,o as y,a as s,b as l,k as L,w as d,h as c,g as I,c as T,t as z,F as O,x as G}from"./app-CKO7PXoh.js";import M from"./ItineraryView-4NY7mAJK.js";import"./index-BWTtMGpG.js";import"./index-CMUsRkf2.js";import"./index-DydIIazq.js";import"./index-C4UMY9fk.js";import"./index-CB9elVlb.js";const R={class:"sm:grid sm:grid-cols-3 gap-4 mt-6"},H={class:"flex flex-col gap-2"},J={class:"flex flex-col gap-2"},K={class:"card flex flex-col gap-6"},P=["src"],Q={class:"flex gap-7"},W={class:"flex justify-center p-5"},de={__name:"Itinerary",props:{service:Object,itineraries:Array},setup(E){const u=E,n=g(!1),p=g(-1),t=q({id:"",title:"",description:"",image:null,service_id:u.service.id,option:"create"}),a=g(u.itineraries.map(i=>({...i,image:i.images&&i.images.length>0?i.images[0].filepath:null,option:null}))),m=D(()=>a.value.filter(i=>i.option!=="delete"));function V(i){const e=i.files[0];if(!e)return;const r=new FileReader;r.onload=async o=>{t.image=o.target.result},r.readAsDataURL(e)}function h(){return!t.title||!t.title.trim()?(alert("El título es obligatorio"),!1):!t.description||!t.description.trim()?(alert("La descripción es obligatoria"),!1):t.image?!0:(alert("La imagen es obligatoria"),!1)}const k=()=>{if(h())if(n.value){const i=p.value;i>=0&&i<a.value.length&&(a.value[i].id&&(a.value[i].option="edit"),a.value[i].title=t.title,a.value[i].description=t.description,a.value[i].image=t.image,b())}else a.value.push({id:"",title:t.title,description:t.description,image:t.image,service_id:u.service.id,option:"create"}),x()};function x(){t.id="",t.title="",t.description="",t.image=null,t.option="create"}function b(){n.value=!1,p.value=-1,x()}function w(){const i=a.value.filter(r=>r.option!==null).map(r=>({id:r.id,title:r.title,description:r.description,image:r.image,service_id:r.service_id,option:r.option}));if(i.length===0){alert("No hay cambios para guardar");return}console.log("Itinerarios modificados:",i),G({itineraries:i}).post(route("itinerary.store"),{onSuccess:r=>{console.log("Guardado exitoso:",r),a.value=a.value.filter(o=>o.option!=="delete"),a.value.forEach(o=>o.option=null)},onError:r=>{console.error("Error al guardar:",r),alert("Ocurrió un error al guardar los cambios")}})}function F(i){const e=m.value[i];if(!e)return;const r=a.value.findIndex(o=>o.id===e.id&&o.title===e.title&&o.description===e.description);r>=0&&(n.value=!0,p.value=r,t.id=e.id||"",t.title=e.title,t.description=e.description,t.image=e.image)}function A(i){const e=m.value[i];if(!e)return;const r=a.value.findIndex(o=>o.id===e.id&&o.title===e.title&&o.description===e.description);r>=0&&(a.value[r].id?a.value[r].option="delete":a.value.splice(r,1))}return(i,e)=>{const r=j,o=$,B=U,C=S,f=N;return y(),_(O,null,[e[7]||(e[7]=s("div",{class:"flex flex-col gap-y-2"},[s("h4",{class:"text-2xl font-semibold text-green-800"},"Itinerario"),s("span",{class:"italic"},"Estos son los servicios que se incluirán en la reserva")],-1)),s("div",R,[s("form",{onSubmit:L(k,["prevent"]),class:"space-y-7 h-[600px] flex flex-col items-center justify-center"},[s("div",H,[e[3]||(e[3]=s("label",{for:"title"},"Título a mostrar",-1)),l(r,{id:"title",modelValue:t.title,"onUpdate:modelValue":e[0]||(e[0]=v=>t.title=v),"aria-describedby":"title-help",required:""},null,8,["modelValue"]),l(o,{size:"small",severity:"secondary",variant:"simple"},{default:d(()=>e[2]||(e[2]=[c(" El título a mostrar se mostrará en la página de detalle del servicio ")])),_:1})]),s("div",J,[e[5]||(e[5]=s("label",{for:"description"},"Descripción a mostrar",-1)),l(B,{id:"description",modelValue:t.description,"onUpdate:modelValue":e[1]||(e[1]=v=>t.description=v),required:"","aria-describedby":"description-help"},null,8,["modelValue"]),l(o,{size:"small",severity:"secondary",variant:"simple"},{default:d(()=>e[4]||(e[4]=[c(" La descripción a mostrar se mostrará en la página de detalle del servicio ")])),_:1})]),s("div",K,[l(C,{mode:"basic","choose-label":"Agrega una imagen del itinerario",onSelect:V,customUpload:"",auto:"",severity:"secondary",class:"p-button-outlined w-full"}),t.image?(y(),_("img",{key:0,src:t.image,alt:"Image",class:"shadow-md rounded-xl w-full h-40 object-cover",style:{filter:"grayscale(100%)"}},null,8,P)):I("",!0)]),s("div",Q,[l(f,{type:"submit",severity:"primary"},{default:d(()=>[c(z(n.value?"Actualizar":"Agregar"),1)]),_:1}),n.value?(y(),T(f,{key:0,type:"button",onClick:b,severity:"secondary"},{default:d(()=>e[6]||(e[6]=[c("Cancelar")])),_:1})):I("",!0)])],32),l(M,{itineraries:m.value,readOnly:!1,onDeleteItem:A,onEdit:F},null,8,["itineraries"])]),s("div",W,[l(f,{type:"button",onClick:w,icon:"fa-solid fa-save",label:"Guardar todo",severity:"primary"})])],64)}}};export{de as default};
