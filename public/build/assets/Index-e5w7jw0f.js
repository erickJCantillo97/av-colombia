import{s as W}from"./index-DQaLxZtP.js";import{s as q}from"./index-DwF2jQio.js";import{_ as M}from"./Datatable-BYs1Tief.js";import{a as J,_ as $}from"./Modal-B1qhhPFN.js";import{_ as K}from"./AppLayout-CnFDucdM.js";import{d as i,C as Q,f as n,b as c,w as P,F as x,o as r,a as t,i as b,n as T,t as s,u as v,g as w,A}from"./app-DSV3a4Mf.js";import{a as X}from"./toasts-CuGasqAw.js";import"./index-DoR8FHIR.js";import"./postcss-CTfSBAE9.js";import"./index-CJfya7PU.js";import"./index-_55OzENV.js";import"./index-H6Jm5dfk.js";import"./index-D9KDt4du.js";import"./index-DoV5KBr6.js";import"./index-pAGyskJ9.js";import"./index-BRvPqcNK.js";import"./index-c8RYfVk7.js";import"./index-D1gkzDOJ.js";import"./index-BJiZxFQM.js";import"./index-D_8lAIMw.js";import"./index-CgUvMyPM.js";import"./index-DG-B2G1d.js";import"./index-CUeomUk3.js";import"./useCommonUtilities-DO03hYfs.js";import"./moment-Cijl8gKs.js";import"./index-CC7iQq45.js";import"./index-BqinzsEp.js";import"./index-jMGaodHO.js";import"./index-C17eHkSp.js";const Y={class:"h-[99vh]"},Z={class:"gap-y-2 flex flex-col"},ee={class:"flex flex-col w-full justify-between font-bold"},te={key:0,class:"flex flex-col gap-y-2"},oe={class:"flex justify-between gap-x-4"},ae=["onClick"],le={class:"flex gap-2 divide-x-4 divide-white items-center"},se={class:"p-1"},ne={class:"p-1 pl-3"},re={class:"flex flex-col w-full justify-between font-bold"},de={class:"flex justify-end gap-x-2"},ie=["loading"],ue={class:"flex flex-col gap-4"},pe={class:"font-medium block mb-2"},ce={class:"w-full bg-gray-200 rounded-md p-2 grid grid-cols-2 divide-y-2 md:flex space-x-2"},me=["onClick"],ve={class:"flex flex-col gap-y-2 h-64 overflow-auto"},fe={key:0},_e={class:"flex items-center gap-x-8 border-b shadow-md justify-between p-3 rounded-md hover:bg-gray-300"},ge={class:"flex flex-col"},he={class:"font-bold flex items-center gap-x-2"},xe={class:"text-xs"},ye={class:"flex flex-col"},be={class:"text-sm"},we={class:"font-bold"},Ce={key:1},De={class:"flex items-center gap-x-8 border-b shadow-md justify-between p-3 rounded-md hover:bg-gray-300"},Ve={class:"flex flex-col"},ke={class:"font-bold flex items-center gap-x-2"},Pe={class:"text-xs"},Fe={class:"text-xs"},Se={class:"flex flex-col"},je={class:"text-sm"},Ie={class:"font-bold"},rt={__name:"Index",props:{payments:Array},setup(N){const g=i(!1),{toast:R}=X(),y=i(1),U=[{name:"Agrupados",value:1},{name:"Detalles",value:2}],C=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),D=i(!1),u=Q({date:new Date,startDate:new Date,endDate:new Date,amount:0,proveedor_id:"",file:"",description:""}),F=i([]),f=i([new Date,new Date]),h=i(),S=i([]),p=i(),B={action:()=>{g.value=!0}},z=[{header:"Proveedor",field:"proveedor.nombre",filter:!0},{header:"Fecha de Pago",field:"date",type:"date",filter:!0},{header:"Valor",field:"amount",type:"currency"},{header:"Fecha Inicio",field:"startDate",field:"date",type:"date",filter:!0},{header:"Fecha Fin",field:"endDate",field:"date",type:"date",filter:!0},{header:"Comprobante",field:"comprobante",type:"html-custom",renderer:a=>`<a href="${a.comprobante}" class="text-sky-600 underline" target="_blank">Ver Comprobante</a>`}],j=()=>{A.get(route("get.booking.time.range"),{params:{start_date:new Date(f.value[0]).toISOString().split("T")[0],end_date:new Date(f.value[1]).toISOString().split("T")[0]}}).then(a=>{F.value=a.data.proveedores,h.value=a.data.bookingTimeRange.filter(o=>{let d=p.value;return o.proveedors.map(e=>e.proveedor_id).includes(d)}),S.value=[{name:"Reservado",value:h.value.filter(o=>o.status=="reservado"),color:"bg-blue-200"},{name:"Completado",value:h.value.filter(o=>o.status=="completado"),color:"bg-green-200"},{name:"Cancelado",value:h.value.filter(o=>o.status=="CANCELADA"),color:"bg-red-200"},{name:"NO SHOW",value:h.value.filter(o=>o.status=="NO SHOW"),color:"bg-yellow-200"}]})},I=i(),V=i([]),O=i([]),E=(a,o)=>{O.value=o.value.reduce((d,_)=>{const e=_.title;return d[e]||(d[e]={count:0,pasajeros:0,total:0}),d[e].count+=1,d[e].pasajeros+=_.adults,d[e].total+=_.proveedors.filter(l=>l.proveedor_id==p.value).reduce((l,m)=>l+m.cost,0),d},{}),V.value=o,I.value.toggle(a)};function G(a){u.file=a.target.files[0]}const H=()=>{D.value=!0;let a=new FormData;a.append("proveedor_id",p.value),a.append("amount",u.amount),a.append("comprobante",u.file),a.append("date",new Date(u.date).toISOString().split("T")[0]),a.append("startDate",new Date(f.value[0]).toISOString().split("T")[0]),a.append("endDate",new Date(f.value[1]).toISOString().split("T")[0]),a.append("description",u.description),A.post(route("paymentProveedors.store"),a,{headers:{"Content-Type":"multipart/form-data"}}).then(o=>{R("success","Pago Guardado con exito"),D.value=!1,g.value=!1})};return(a,o)=>{const d=q,_=W;return r(),n(x,null,[c(K,{title:"Pagos"},{default:P(()=>[t("div",Y,[c(M,{add:B,columnas:z,data:N.payments,title:"Pagos"},null,8,["data"])]),c(J,{modelValue:g.value,"onUpdate:modelValue":o[5]||(o[5]=e=>g.value=e),title:"Añadir Pagos"},{default:P(()=>[t("div",Z,[t("div",ee,[o[6]||(o[6]=t("p",null,"Fechas",-1)),c(d,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=e=>f.value=e),selectionMode:"range",dateFormat:"dd/mm/yy",class:"w-full",manualInput:!1,onValueChange:j},null,8,["modelValue"])]),c($,{label:"Proveedor",type:"dropdown","option-label":"proveedor","option-value":"proveedor_id",onValueChange:j,modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=e=>p.value=e),options:F.value},null,8,["modelValue","options"]),p.value?(r(),n("div",te,[t("div",oe,[(r(!0),n(x,null,b(S.value,e=>(r(),n("div",{class:T([`${e.color} ${e.value.length>0?"cursor-pointer":"hidden"} `,"rounded-lg py-2 border w-full flex flex-col gap-y-1 items-center font-bold cursor-pointer scale-90 hover:scale-100 shadow-sm hover:shadow-lg transition-all duration-300"]),onClick:l=>E(l,e)},[t("h1",null,s(e.name),1),t("div",le,[t("p",se,s(e.value.length)+" Reservas",1),t("p",ne,s(e.value.reduce((l,m)=>l+m.adults,0))+" Pasajeros ",1)]),t("p",null,s(v(C).format(e.value.reduce((l,m)=>l+m.proveedors.filter(k=>k.proveedor_id==p.value).reduce((k,L)=>k+L.cost,0),0))),1)],10,ae))),256))]),t("div",re,[o[7]||(o[7]=t("p",null,"Fecha en que realizó el pago",-1)),c(d,{modelValue:v(u).date,"onUpdate:modelValue":o[2]||(o[2]=e=>v(u).date=e),dateFormat:"dd/mm/yy",class:"w-full",manualInput:!1},null,8,["modelValue"])]),c($,{label:"Valor",type:"number",mode:"currency",modelValue:v(u).amount,"onUpdate:modelValue":o[3]||(o[3]=e=>v(u).amount=e)},null,8,["modelValue"]),t("input",{type:"file",onChange:G,label:"Comprobante"},null,32)])):w("",!0),t("div",de,[t("button",{onClick:o[4]||(o[4]=e=>g.value=!1),class:"bg-red-500 text-white px-4 py-2 rounded-md"}," Cancelar "),p.value?(r(),n("button",{key:0,loading:D.value,onClick:H,class:"bg-green-500 text-white px-4 py-2 rounded-md"}," Guardar ",8,ie)):w("",!0)])])]),_:1},8,["modelValue"])]),_:1}),c(_,{ref_key:"op",ref:I},{default:P(()=>[t("div",ue,[t("div",null,[t("span",pe,s(V.value.name),1),t("div",ce,[(r(),n(x,null,b(U,e=>t("div",{onClick:l=>y.value=e.value,class:T(["w-full rounded-lg text-center py-2 text-sm md:text-md cursor-pointer",y.value==e.value?"bg-white":"hover:bg-white/30"])},s(e.name),11,me)),64))]),t("div",ve,[y.value==1?(r(),n("div",fe,[(r(!0),n(x,null,b(O.value,(e,l)=>(r(),n("div",_e,[t("div",ge,[t("span",he,[t("p",null,s(l),1)]),t("span",xe,s(e.count)+" Reservas",1)]),t("div",ye,[t("span",be,s(e.pasajeros)+" Pasajeros",1),t("span",we,s(v(C).format(e.total)),1)])]))),256))])):w("",!0),y.value==2?(r(),n("div",Ce,[(r(!0),n(x,null,b(V.value.value,e=>(r(),n("div",De,[t("div",Ve,[t("span",ke,[t("p",null,s(e.title),1)]),t("span",Pe,s(e.cliente_name),1),t("span",Fe,s(e.fecha),1)]),t("div",Se,[t("span",je,s(e.adults)+" Pasajeros",1),t("span",Ie,s(v(C).format(e.proveedors.filter(l=>l.proveedor_id==p.value).reduce((l,m)=>l+m.cost,0))),1)])]))),256))])):w("",!0)])])])]),_:1},512)],64)}}};export{rt as default};
