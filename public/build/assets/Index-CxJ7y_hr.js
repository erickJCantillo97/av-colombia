import{d,C as re,x as O,W as H,q as B,y as ne,e as ie,f,b as r,w as S,F as A,o as u,a as n,u as a,c as N,t as w,g as T,h as de,i as F,k as ue,T as ce}from"./app-DwqqtyMR.js";import{s as me}from"./index-DxeCpvp0.js";import{_ as ve}from"./Datatable-iHgaA9p8.js";import{_ as L,a as i}from"./Modal-B7CSa-y7.js";import{_ as pe}from"./AppLayout-xNoFpcEx.js";import{s as fe}from"./index-Bzl_GUst.js";import{S as I,a as be}from"./toasts-CuGasqAw.js";import{_ as _e}from"./viewBooking-Dy814twG.js";import"./index-B9QSEolM.js";import"./index-D3DCZgQl.js";import"./index-DFwuQHfs.js";import"./index-CWFNQs0x.js";import"./index-DYBhcO5g.js";import"./index-DmHQ19TR.js";import"./index-B3tJbL3D.js";import"./index-B4DgsdHn.js";import"./postcss-YlB0mr_a.js";import"./index-_Ym5zPGC.js";import"./index-DCzWc5LC.js";import"./index-DWLPV4fG.js";import"./index-DTw52Aik.js";import"./useCommonUtilities-DO03hYfs.js";import"./moment-Cijl8gKs.js";import"./index-BppHTCFZ.js";import"./index-BdJhOALo.js";import"./index--o5mtSWx.js";import"./index-D4mBzCi8.js";const ge={class:"h-[99vh]"},xe={class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-center",novalidate:""},Ve={class:"w-full col-span-1 md:col-span-4 flex justify-between gap-x-2 items-center"},ye={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},we={class:"text-lg font-mono font-semibold"},he={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},Ce={class:"text-lg font-mono font-semibold"},ke={key:0,class:"mt-4 w-full col-span-1 md:col-span-4 rounded-lg"},Se={class:"flex gap-x-2"},Ue={class:"mt-4 w-full col-span-1 md:col-span-4 border rounded-lg"},Pe={class:"text-2xl font-mono font-semibold text-center bg-black rounded-t-lg text-white gap-x-3 p-2"},De={class:"flex justify-between gap-x-4 px-2"},Ee={class:"flex justify-end gap-x-2 mt-4 w-full"},$e={class:"w-full flex flex-col gap-y-5 p-2"},Be={class:"h-[30vh] overflow-y-auto flex flex-col gap-y-2"},Ae=["src"],Ne={class:"ml-4 flex flex-col gap-y-2 w-full"},Te={class:"font-bold text-2xl"},je={class:"w-full flex justify-between"},Re={key:0,class:"flex justify-center flex-col items-center"},Me={class:"flex gap-x-2"},vl={__name:"Index",props:{bookingServices:Array},setup(z){const{toast:b}=be(),U=d(!1),h=d(null),P=d(!1),j=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),c=d(!1),W={action:()=>{l.reset(),c.value=!0}},R=d([]),l=re({id:"",service_id:null,date:"",adults:1,time_service:"",boys:0,cliente_name:"",cliente_phone:"",cliente_city:"",cliente_building:"",mascota:0,persona_adicional:0,cobre_transaccion:0,cobro_extra_cliente:0,reserva:0,abono:0,method_id:"",channel_id:"9d99a95f-6c3d-48fd-aa7d-6ef4e6860123",percent_descuento:0,proveedors:[],total:0,total_real:0,percent_channel:0,observations:""}),m=d([{proveedor:null,costo:""}]),D=d([]),q=()=>{axios.get(route("get.services")).then(o=>{D.value=o.data.services})},G=()=>{m.value.push({proveedor:null,costo:""})},Q=o=>{o!=0&&m.value.splice(o,1)},_=d([]),g=d([]),J=()=>{axios.get(route("proveedors.index")).then(o=>{_.value=o.data.proveedors}).catch(o=>{console.log(o)})},K=o=>{var e;o.costo=_.value.find(s=>s.id==o.proveedor).services.find(s=>s.id==l.service_id)===void 0?0:((e=_.value.find(s=>s.id==o.proveedor).services.find(s=>s.id==l.service_id))==null?void 0:e.pivot.value)*l.adults,console.log(o)},X=()=>{axios.get(route("channels.index")).then(o=>{g.value=o.data}).catch(o=>{console.log(o)})};q(),X(),J();const E=d(null),C=d([]),k=d(""),Y=[{label:"Detalles",action:o=>{h.value=o,U.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:o=>{l.id=o.id;const e=(s,v)=>{const[V,t,y]=s.split("-"),[p,se]=v.split(":");return`${V}-${t}-${y},${p}:${se}`};l.date=e(o.date,o.hour),l.service_id=o.service_id,l.cliente_name=o.cliente_name,l.cliente_phone=o.cliente_phone,l.cliente_city=o.cliente_city,l.cliente_building=o.cliente_building,l.adults=o.adults,l.total=o.total,l.method_id=o.method_id,l.channel_id=o.channel_id,l.percent_descuento=o.percent_descuento,l.proveedors=o.proveedors,m.value=o.proveedors.map(s=>({proveedor:s.proveedor_id,costo:s.cost})),l.observations=o.observations,h.value=o,c.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Notas",action:o=>{E.value=o,axios.get(route("notes.index",{booking_service_id:o.id})).then(e=>{C.value=e.data.notes,P.value=!0})},icon:"fa-solid fa-note-sticky text-sm"},{label:"Problematica",show:O().props.auth.user.rol=="admin",action:o=>{var e=o.problematic?"Desmarcar":"Marcar";I.fire({title:"Estas Seguro?",text:`${e} como problematica esta reservaci칩n!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${e}!`}).then(s=>{s.isConfirmed&&H.post(route("booking.problematic",o.id),{onSuccess:()=>{b("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"},{label:"Eliminar",icon:"fa-solid fa-trash text-sm",severity:"danger",show:O().props.auth.user.rol=="SUPER ADMINISTRADOR",action:o=>{I.fire({title:"Estas Seguro?",text:`Eliminar la reservaci칩n de ${o.cliente_name}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, Eliminar!"}).then(e=>{e.isConfirmed&&H.delete(route("BookingServices.destroy",o.id),{onSuccess:()=>{b("success","Reserva Eliminada")}})})}}],Z=[{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"adults",header:"Pasajeros",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service.title",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!0,type:"date",sortable:!0},{field:"channel.name",header:"Canal de venta",filter:!0,sortable:!0},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"COMPLETADA",severity:"success",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"}]}],ee=B(()=>l.total/l.adults),$=B(()=>{let o=g.value.find(s=>s.id==l.channel_id),e=o?o.percent/100:0;return l.total-l.total*e}),x=d(!1),le=o=>{o.preventDefault(),l.total_real=$.value,l.percent_channel=g.value.find(e=>e.id==l.channel_id).percent,x.value=!0,l.proveedors=m.value,l.post(route("reservar"),{onSuccess:()=>{l.reset(),x.value=!1,c.value=!1,b("success","Reserva creada con exito")},onError:()=>{x.value=!1,b("error","Error al crear la reserva")}})},oe=()=>{l.total_real=$.value,l.percent_channel=g.value.find(o=>o.id==l.channel_id).percent,l.proveedors=m.value,l.put(route("BookingServices.update",l.id),{onSuccess:()=>{c.value=!1,b("success","Reserva actualizada con exito")}})};(()=>{axios.get(route("paymentMethods.index")).then(o=>{R.value=o.data}).catch(o=>{console.log(o)})})();const M=o=>{const[e,s,v]=o.split("-");return new Date(e,s-1,v)},te=B(()=>{var o=[],e=D.value.find(y=>y.id==l.service_id);if(!e)return[];for(var s of e.locks)for(var v=M(s.start_date),V=M(s.end_date),t=v;t<=V;t.setDate(t.getDate()+1))o.push(new Date(t));return o});ne(l.adults,o=>{for(var e of m.value)e.proveedor&&(e.costo=_.value.find(s=>s.id==e.proveedor).pivot.value*o)});const ae=()=>{axios.post(route("notes.store"),{note:k.value,booking_service_id:E.value.id}).then(o=>{axios.get(route("notes.index",{booking_service_id:E.value.id})).then(e=>{C.value=e.data.notes,k.value=""})})};return(o,e)=>{const s=me,v=ie("Logo"),V=ce;return u(),f(A,null,[r(pe,{title:"Reservas"},{default:S(()=>[n("div",ge,[r(ve,{actions:Y,add:W,columnas:Z,data:z.bookingServices,routecreate:"services.create",title:"Reservas",rowClass:!0},null,8,["data"])]),r(L,{modelValue:c.value,"onUpdate:modelValue":e[18]||(e[18]=t=>c.value=t),title:"A침adir Reserva",width:"70vw"},{footer:S(()=>[n("div",Ee,[r(s,{onClick:e[17]||(e[17]=t=>c.value=!1),severity:"danger",label:"Cancelar",loading:x.value},null,8,["loading"]),a(l).id?(u(),N(s,{key:0,type:"submit",label:"Actualizar",severity:"warn",onClick:oe})):(u(),N(s,{key:1,type:"submit",severity:"success",label:"Guardar",loading:x.value,onClick:le},null,8,["loading"]))])]),default:S(()=>[n("form",xe,[r(i,{type:"dropdown",modelValue:a(l).service_id,"onUpdate:modelValue":e[0]||(e[0]=t=>a(l).service_id=t),"error-message":a(l).errors.service_id,label:"Servicio","option-label":"title","option-value":"id",options:D.value},null,8,["modelValue","error-message","options"]),r(i,{label:"Fecha de Reserva",enableTimePicker:!0,"disabled-dates":te.value,modelValue:a(l).date,"onUpdate:modelValue":e[1]||(e[1]=t=>a(l).date=t),required:"",class:"w-full",type:"datetime"},null,8,["disabled-dates","modelValue"]),r(i,{label:"Valor Total",type:"number",mode:"currency",modelValue:a(l).total,"onUpdate:modelValue":e[2]||(e[2]=t=>a(l).total=t)},null,8,["modelValue"]),r(i,{label:"Tiempo del Servicio",type:"dropdown",modelValue:a(l).time_service,"onUpdate:modelValue":e[3]||(e[3]=t=>a(l).time_service=t),options:["20 Minutos","30 Minutos","40 Minutos","1 Hora","2 Horas","6 Horas","12 Horas","24 Horas"]},null,8,["modelValue"]),r(i,{label:"Pasajeros",type:"number",modelValue:a(l).adults,"onUpdate:modelValue":e[4]||(e[4]=t=>a(l).adults=t)},null,8,["modelValue"]),r(i,{label:"Ni침os",type:"number",modelValue:a(l).boys,"onUpdate:modelValue":e[5]||(e[5]=t=>a(l).boys=t)},null,8,["modelValue"]),r(i,{label:"Nombre del Pasajero",modelValue:a(l).cliente_name,"onUpdate:modelValue":e[6]||(e[6]=t=>a(l).cliente_name=t),"error-message":a(l).errors.cliente_name,class:"w-full"},null,8,["modelValue","error-message"]),r(i,{label:"Telefono",modelValue:a(l).cliente_phone,"onUpdate:modelValue":e[7]||(e[7]=t=>a(l).cliente_phone=t),"error-message":a(l).errors.cliente_phone,class:"w-full",type:"number"},null,8,["modelValue","error-message"]),r(i,{label:"Ciudad de donde Proviene",modelValue:a(l).cliente_city,"onUpdate:modelValue":e[8]||(e[8]=t=>a(l).cliente_city=t),"error-message":a(l).errors.city,class:"w-full"},null,8,["modelValue","error-message"]),r(i,{label:"Edificio u Hotel",class:"w-full",modelValue:a(l).cliente_building,"onUpdate:modelValue":e[9]||(e[9]=t=>a(l).cliente_building=t),"error-message":a(l).errors.cliente_building},null,8,["modelValue","error-message"]),r(i,{class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:R.value,modelValue:a(l).method_id,"onUpdate:modelValue":e[10]||(e[10]=t=>a(l).method_id=t),label:"Medio de Pago"},null,8,["options","modelValue"]),r(i,{class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:g.value,modelValue:a(l).channel_id,"onUpdate:modelValue":e[11]||(e[11]=t=>a(l).channel_id=t),label:"Canal de Venta"},null,8,["options","modelValue"]),r(i,{class:"w-full",label:"Descuento",modelValue:a(l).percent_descuento,"onUpdate:modelValue":e[12]||(e[12]=t=>a(l).percent_descuento=t),"error-message":a(l).errors.percent_descuento,min:"0",max:"100",type:"number",suffix:" %"},null,8,["modelValue","error-message"]),r(i,{class:"w-full col-span-1 md:col-span-4","rows-textarea":2,label:"Observaciones",modelValue:a(l).observations,"onUpdate:modelValue":e[13]||(e[13]=t=>a(l).observations=t),"error-message":a(l).errors.observations,type:"textarea"},null,8,["modelValue","error-message"]),n("div",Ve,[n("div",ye,[n("p",we,w(a(j).format(ee.value)),1),e[22]||(e[22]=n("p",{class:"italic text-md"},"Valor Pasajero",-1))]),n("div",he,[n("p",Ce,w(a(j).format($.value)),1),e[23]||(e[23]=n("p",{class:"italic text-md"},"Valor Real",-1))])]),a(l).service_id?(u(),f("div",ke,[n("div",Se,[r(i,{label:"Placa del Vehiculo",modelValue:a(l).vehicle_plate,"onUpdate:modelValue":e[14]||(e[14]=t=>a(l).vehicle_plate=t),class:"w-full"},null,8,["modelValue"]),r(i,{label:"Nombre del Conductor",modelValue:a(l).driver_name,"onUpdate:modelValue":e[15]||(e[15]=t=>a(l).driver_name=t),class:"w-full"},null,8,["modelValue"])])])):T("",!0),n("div",Ue,[n("h1",Pe,[e[24]||(e[24]=de(" Proveedores ")),r(s,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:e[16]||(e[16]=t=>G())})]),e[25]||(e[25]=n("div",{class:"flex justify-between w-full font-bold px-2"},[n("label",{for:""},"Proveedor"),n("label",{for:""},"Costo"),n("label",{for:""},".")],-1)),(u(!0),f(A,null,F(m.value,(t,y)=>(u(),f("div",De,[r(i,{type:"dropdown",modelValue:t.proveedor,"onUpdate:modelValue":p=>t.proveedor=p,onValueChange:p=>K(t),"option-label":"nombre","option-value":"id",class:"w-full",options:_.value},null,8,["modelValue","onUpdate:modelValue","onValueChange","options"]),r(i,{type:"number",mode:"currency",class:"w-full",modelValue:t.costo,"onUpdate:modelValue":p=>t.costo=p},null,8,["modelValue","onUpdate:modelValue"]),ue(r(s,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:p=>Q(y)},null,8,["onClick"]),[[V,"Quitar"]])]))),256))])])]),_:1},8,["modelValue"]),r(a(fe)),h.value?(u(),N(_e,{key:0,modelValue:U.value,"onUpdate:modelValue":e[19]||(e[19]=t=>U.value=t),service:h.value},null,8,["modelValue","service"])):T("",!0)]),_:1}),r(L,{modelValue:P.value,"onUpdate:modelValue":e[21]||(e[21]=t=>P.value=t),"close-on-escape":"true",title:"Notas",width:"90vw"},{default:S(()=>[n("div",$e,[e[27]||(e[27]=n("h3",{class:"text-xl font-bold"},"Notas de la Actividad",-1)),n("div",Be,[(u(!0),f(A,null,F(C.value,t=>(u(),f("div",{class:"flex border shadow-md p-2 rounded-md",key:t.id},[n("img",{src:t.user.profile_photo_url,class:"size-12 rounded-full",alt:""},null,8,Ae),n("div",Ne,[n("h2",Te,w(t.user.name),1),n("div",je,[n("p",null,w(t.note),1),n("p",null,w(new Date(t.created_at).toISOString().split("T")[0]),1)])])]))),128)),C.value.length==0?(u(),f("div",Re,[r(v),e[26]||(e[26]=n("p",{class:"font-semibold text-xl"},"Serivicio sin notas",-1))])):T("",!0)]),n("div",Me,[r(i,{type:"textarea",class:"w-full shadow-xl",modelValue:k.value,"onUpdate:modelValue":e[20]||(e[20]=t=>k.value=t)},null,8,["modelValue"]),r(s,{label:"Guardar",severity:"info",icon:"pi pi-send",onClick:ae})])])]),_:1},8,["modelValue"])],64)}}};export{vl as default};
