import{d as f,x as we,y as _,z as J,A as L,q as K,o as g,c as Ve,w as D,a as e,b as a,B as p,u as s,C as v,t as i,h as X,f as V,i as Y,k as P,F as Z,j as Ce,g as ee,n as Ae,D as I,E as Se}from"./app-DJA2TGwp.js";import{_ as De,s as Pe}from"./AppLayout-CRApBevq.js";import{s as je}from"./index-DWa5oVMb.js";import{_ as Ee}from"./Datatable-B2vdFScb.js";import{_ as u}from"./Input-CATyXCL_.js";import{_ as ke}from"./Modal-CbeNnUAi.js";import{s as $e}from"./index-Bi0VTjmQ.js";import{S as H,a as Ue}from"./toasts-DRkOXQyQ.js";import{u as Be}from"./vee-validate-Cb4VPryu.js";import"./index-YU1siHk9.js";import"./index-t_B80u0p.js";import"./index-C7SmbnOm.js";import"./index-QqnVWqsX.js";import"./postcss-DHWiM0x1.js";const Ne={class:"h-[99vh]"},Oe={class:""},qe={class:"text-xl font-mono font-semibold"},Fe={class:"mt-4 w-full col-sapn-1 md:col-span-3"},Te={class:"text-xl font-mono font-semibold text-center"},Me=e("div",{class:"flex justify-between w-full font-bold"},[e("label",{for:""},"Proveedor"),e("label",{for:""},"Costo"),e("label",{for:""},".")],-1),Re={class:"flex justify-between gap-x-4"},ze={class:"flex justify-end mt-4 w-full col-sapn-1 md:col-span-3"},Le={class:"flex items-center gap-2"},Ie={class:"font-bold text-lg"},He={class:"flex flex-col gap-y-1.5 text-sm"},Qe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},We=e("strong",null,"Fecha del Servicio:",-1),Ge={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Je=e("strong",null,"Hora del Servicio:",-1),Ke={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Xe=e("strong",null,"Cliente:",-1),Ye={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ze=e("strong",null,"Ciudad:",-1),et={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},tt=e("strong",null,"Telelfono:",-1),ot=["href"],lt={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},st=e("strong",null,"Edificio:",-1),at={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},rt=e("strong",null,"Adultos:",-1),it={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},nt=e("strong",null,"Niños:",-1),dt={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},ut=e("strong",null,"Valor:",-1),ct={key:0,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},vt=e("strong",null,"Vendedor:",-1),mt={key:1,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},pt=e("strong",null,"Fecha de reserva:",-1),ft={class:"flex flex-col gap-y-2 mt-2"},bt={class:"flex justify-between"},_t=e("h2",{class:"text-xl font-bold"},"Pagos Realizados ",-1),gt={class:"bg-blue-600 text-white p-1 rounded-lg"},ht={class:"flex items-center text-xs justify-between border shadow-xl rounded-md p-1 bg-white"},xt={class:"uppercase font-bold"},yt=e("div",null,null,-1),wt={class:"flex flex-col items-center gap-2"},Vt={class:"font-bold text-center"},Ct={class:"flex gap-x-2"},It={__name:"Index",props:{bookingServices:Array},setup(te){const{toast:T}=Ue(),j=f(!1),r=f({}),C=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),A=f(!1),oe={action:()=>{A.value=!0}},Q=f([]),le=we({service_id:_().required(),date:J().required(),adults:L().required(),date:J().required(),adults:L().required(),cliente_name:_().required(),cliente_phone:_().required(),cliente_city:_().required(),cliente_building:_().required(),hour:_().required(),abono:L().required(),method:_().required()}),{values:se,defineField:c,errors:m,meta:At}=Be({validationSchema:le}),[h,ae]=c("service_id"),[E,re]=c("date"),[x,St]=c("boys"),[y,Dt]=c("adults"),[k,ie]=c("cliente_name"),[$,ne]=c("cliente_phone"),[U,de]=c("cliente_city"),[B,ue]=c("cliente_building"),[N,ce]=c("hour"),[M,ve]=c("abono"),[R,me]=c("method");x.value=0,y.value=1;const O=f([{proveedor:null,costo:""}]),q=f([]),pe=()=>{axios.get(route("get.services")).then(o=>{q.value=o.data.services.slice(0,5)})},fe=()=>{O.value.push({proveedor:null,costo:""})},be=o=>{o!=0&&O.value.splice(o,1)},W=f([]);(()=>{axios.get(route("proveedors.index")).then(o=>{W.value=o.data.proveedors}).catch(o=>{console.log(o)})})(),pe();const _e=[{label:"Detalles",action:o=>{r.value=o,j.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:o=>{E.value=o.date,h.value=o.service_id,y.value=o.adults,x.value=o.boys,k.value=o.cliente_name,$.value=o.cliente_phone,U.value=o.cliente_city,B.value=o.cliente_building,N.value=o.hour,r.value=o,A.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Problematica",action:o=>{var t=o.problematic?"Desmarcar":"Marcar";H.fire({title:"Estas Seguro?",text:`${t} como problematica esta reservación!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${t}!`}).then(n=>{n.isConfirmed&&I.post(route("booking.problematic",o.id),{onSuccess:()=>{T("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"}],ge=[{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service.title",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!0,sortable:!0,type:"date"},{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"problematic",header:"Problematica",filter:!0,sortable:!0,type:"boolean"},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"COMPLETADA",severity:"success",class:""},{text:"DISEÑO",severity:"info",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"SERVICIO POSTVENTA",severity:"success",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"}]}],he=K(()=>{let o=q.value.find(t=>t.id==h.value);return o?o.adult_tarifa*y.value+o.boy_tarifa*x.value:0}),z=f(!1),xe=o=>{o.preventDefault(),z.value=!0,I.post(route("reservar",{proveedors:O.value}),se,{onSuccess:()=>{z.value=!1,A.value=!1,T("success","Reserva creada con exito")}})};(()=>{axios.get(route("paymentMethods.index")).then(o=>{Q.value=o.data}).catch(o=>{console.log(o)})})();const G=o=>{const[t,n,S]=o.split("-");return new Date(t,n-1,S)},ye=K(()=>{var o=[],t=q.value.find(d=>d.id==h.value);if(!t)return[];for(var n of t.locks)for(var S=G(n.start_date),b=G(n.end_date),l=S;l<=b;l.setDate(l.getDate()+1))o.push(new Date(l));return o}),F=(o,t)=>{H.fire({title:o,text:"Estas seguro de realizar esta acción?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si"}).then(n=>{n.isConfirmed&&(H.fire({title:o,text:"Esta reserva ha sido "+o+".",icon:"success"}),I.post(route("set.states"),{service:r.value.id,state:o,terminated:t},{onSuccess:()=>{j.value=!1,T("success","Reserva "+o)}}))})};return(o,t)=>{const n=je,S=Pe,b=Se;return g(),Ve(De,{title:"Services"},{default:D(()=>[e("div",Ne,[a(Ee,{actions:_e,add:oe,columnas:ge,data:te.bookingServices,routecreate:"services.create",title:"Reservas"},null,8,["data"])]),a(ke,{modelValue:A.value,"onUpdate:modelValue":t[12]||(t[12]=l=>A.value=l),title:"Añadir Reserva",width:"70vw"},{default:D(()=>[e("form",{onSubmit:Ce(xe,["prevent"]),class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",novalidate:""},[a(u,p({type:"dropdown",modelValue:s(h),"onUpdate:modelValue":t[0]||(t[0]=l=>v(h)?h.value=l:null),"error-message":s(m).service_id,label:"Servicio","option-label":"title","option-value":"id",options:q.value},s(ae)),null,16,["modelValue","error-message","options"]),a(u,p({label:"Fecha de Reserva","disabled-dates":ye.value,modelValue:s(E),"onUpdate:modelValue":t[1]||(t[1]=l=>v(E)?E.value=l:null),required:"","min-date":new Date,class:"w-full",type:"date","error-message":o.errorDate},s(re)),null,16,["disabled-dates","modelValue","min-date","error-message"]),a(u,{label:"Pasajeros",type:"number",modelValue:s(y),"onUpdate:modelValue":t[2]||(t[2]=l=>v(y)?y.value=l:null)},null,8,["modelValue"]),a(u,{label:"Niños",type:"number",modelValue:s(x),"onUpdate:modelValue":t[3]||(t[3]=l=>v(x)?x.value=l:null)},null,8,["modelValue"]),a(u,p({label:"Nombre del Pasajero"},s(ie),{modelValue:s(k),"onUpdate:modelValue":t[4]||(t[4]=l=>v(k)?k.value=l:null),"error-message":s(m).cliente_name,class:"w-full"}),null,16,["modelValue","error-message"]),a(u,p({label:"Telefono",modelValue:s($),"onUpdate:modelValue":t[5]||(t[5]=l=>v($)?$.value=l:null)},s(ne),{"error-message":s(m).cliente_phone,class:"w-full",type:"number"}),null,16,["modelValue","error-message"]),a(u,p({label:"Ciudad de donde Proviene"},s(de),{modelValue:s(U),"onUpdate:modelValue":t[6]||(t[6]=l=>v(U)?U.value=l:null),"error-message":s(m).city,class:"w-full"}),null,16,["modelValue","error-message"]),a(u,p({label:"Edificio u Hotel",class:"w-full"},s(ue),{modelValue:s(B),"onUpdate:modelValue":t[7]||(t[7]=l=>v(B)?B.value=l:null),"error-message":s(m).cliente_building}),null,16,["modelValue","error-message"]),a(u,p({type:"time",label:"Hora de Actividad",class:"w-full"},s(ce),{modelValue:s(N),"onUpdate:modelValue":t[8]||(t[8]=l=>v(N)?N.value=l:null),"error-message":s(m).hour}),null,16,["modelValue","error-message"]),a(u,p({class:"w-full",label:"Abono"},s(ve),{modelValue:s(M),"onUpdate:modelValue":t[9]||(t[9]=l=>v(M)?M.value=l:null),"error-message":s(m).abono,min:"1",type:"number"}),null,16,["modelValue","error-message"]),a(u,p({class:"w-full",min:"0"},s(me),{type:"dropdown","option-label":"name","option-value":"id",options:Q.value,modelValue:s(R),"onUpdate:modelValue":t[10]||(t[10]=l=>v(R)?R.value=l:null),label:"Medio de Pago"}),null,16,["options","modelValue"]),e("div",Oe,[e("h1",qe," Precio total: "+i(s(C).format(he.value)),1)]),e("div",Fe,[e("h1",Te,[X(" Proveedores "),a(n,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:t[11]||(t[11]=l=>fe())})]),Me,(g(!0),V(Z,null,Y(O.value,(l,d)=>(g(),V("div",Re,[a(u,{type:"dropdown",modelValue:l.proveedor,"onUpdate:modelValue":w=>l.proveedor=w,"error-message":s(m).proveedor,"option-label":"nombre","option-value":"id",class:"w-full",options:W.value},null,8,["modelValue","onUpdate:modelValue","error-message","options"]),a(u,{type:"number",mode:"currency",class:"w-full",modelValue:l.costo,"onUpdate:modelValue":w=>l.costo=w,"error-message":s(m).costo},null,8,["modelValue","onUpdate:modelValue","error-message"]),P(a(n,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:w=>be(d)},null,8,["onClick"]),[[b,"Quitar"]])]))),256))]),e("div",ze,[a(n,{type:"submit",severity:"success",label:"Guardar",loading:z.value},null,8,["loading"])])],32)]),_:1},8,["modelValue"]),a(s($e)),a(S,{visible:j.value,"onUpdate:visible":t[17]||(t[17]=l=>j.value=l),"pt:root:class":"!bg-blue-100",header:"Detalles de la actividad",position:"right"},{header:D(()=>[e("div",Le,[e("span",Ie,i(r.value.service.title),1)])]),footer:D(()=>[e("div",wt,[e("h1",Vt,"Saldo: "+i(s(C).format(r.value.total_price-r.value.payments.reduce((l,d)=>l+d.amount,0))),1),e("div",Ct,[P(a(n,{onClick:t[13]||(t[13]=l=>F("COMPLETADA",!0)),icon:"fa-solid fa-circle-check",text:"",size:"large",class:"flex-auto",severity:"success"},null,512),[[b,"Completar Servicio",void 0,{top:!0}]]),P(a(n,{onClick:t[14]||(t[14]=l=>F("NO SHOW",!0)),icon:"fa-solid fa-eye-slash",text:"",size:"large",class:"flex-auto",severity:"warn"},null,512),[[b,"Servicio No show",void 0,{top:!0}]]),P(a(n,{onClick:t[15]||(t[15]=l=>F("CANCELADA",!0)),icon:"fa-solid fa-xmark-circle",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[b,"Cancelar Servicio",void 0,{top:!0}]]),P(a(n,{onClick:t[16]||(t[16]=l=>F("PROBLEMATICA",!1)),icon:"fa-solid fa-person-dress-burst",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[b,"Servicio Problematico",void 0,{top:!0}]])])])]),default:D(()=>{var l;return[e("div",He,[e("div",Qe,[We,e("p",null,i(r.value.date),1)]),e("div",Ge,[Je,e("p",null,i(r.value.hour),1)]),e("div",Ke,[Xe,e("p",null,i(r.value.cliente_name),1)]),e("div",Ye,[Ze,e("p",null,i(r.value.cliente_city),1)]),e("div",et,[tt,e("a",{href:`tel://${r.value.cliente_phone}`},i(r.value.cliente_phone),9,ot)]),e("div",lt,[st,e("p",null,i(r.value.cliente_building),1)]),e("div",at,[rt,e("p",null,i(r.value.adults),1)]),e("div",it,[nt,e("p",null,i(r.value.boys),1)]),e("div",dt,[ut,e("p",null,i(s(C).format(r.value.total_price)),1)]),r.value.user?(g(),V("div",ct,[vt,e("p",null,i((l=r.value.user)==null?void 0:l.name),1)])):ee("",!0),r.value.user?(g(),V("div",mt,[pt,e("p",null,i(new Date(r.value.created_at).toLocaleDateString("es-CO")),1)])):ee("",!0),e("div",ft,[e("div",bt,[_t,e("div",gt,i(s(C).format(r.value.payments.reduce((d,w)=>d+w.amount,0))),1)]),(g(!0),V(Z,null,Y(r.value.payments,d=>(g(),V("div",ht,[e("div",null,[e("div",xt,i(d.type)+" "+i(s(C).format(d.amount)),1),e("div",null,i(new Date(d.created_at).toLocaleDateString("es-CO"))+" "+i(d.metohd_payment.name),1)]),e("div",{class:Ae(["uppercase",d.status=="pendiente"?"bg-red-500 p-1 text-white rounded-lg shadow-md shadow-red-500":""])},[X(i(d.status)+" ",1),yt],2)]))),256))])])]}),_:1},8,["visible"])]),_:1})}}};export{It as default};
