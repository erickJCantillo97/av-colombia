import{d as u,q as D,C as ve,x as W,W as q,y as pe,e as fe,f as b,b as r,w as P,F as B,o as v,a,t as p,i as I,n as be,k as G,u as s,c as M,g as F,h as ge,T as xe}from"./app-CWIvCjRq.js";import{s as _e}from"./index-Djb4ZFEO.js";import{s as ye}from"./index-DHK-3gpG.js";import{_ as Ve}from"./Datatable-CXXFFwwr.js";import{_ as Q,a as i}from"./Modal-BtoIk3HB.js";import{_ as we}from"./AppLayout-5nnkj0KX.js";import{s as he}from"./index-jTl6MLTj.js";import{S as J,a as Ce}from"./toasts-CuGasqAw.js";import{_ as Se}from"./viewBooking-LL0tyM3d.js";import"./index-D9lRb12N.js";import"./index-DY3_5TdG.js";import"./index-CtuWgu6t.js";import"./index-DerohJex.js";import"./index-BrEl0sKn.js";import"./index-BPfSfjJB.js";import"./index-CbZh8BqQ.js";import"./index-smy8B99X.js";import"./postcss-BJySBN3z.js";import"./index-_GRINPEU.js";import"./index-CP2gGUgP.js";import"./index-Cifu-4tu.js";import"./index-CXivyjy_.js";import"./index-BzvhyBCg.js";import"./index-Kq2wTTnl.js";import"./useCommonUtilities-DO03hYfs.js";import"./moment-Cijl8gKs.js";import"./index-CRwVOuTI.js";import"./index-Di4gsrlr.js";import"./index-CAWDQSkq.js";import"./index-vriVsCM5.js";const ke={class:"h-[92vh]"},De={class:"flex py-2 px-4 justify-between items-center"},Ue={class:"flex gap-x-2"},Ae={class:"text-xs italic"},Ee=["onClick"],Pe={class:"text-sm font-bold uppercase"},Be={class:"text-xs italic"},$e={class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-center",novalidate:""},Te={class:"w-full col-span-1 md:col-span-4 flex justify-between gap-x-2 items-center"},Oe={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},Ne={class:"text-lg font-mono font-semibold"},Re={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},je={class:"text-lg font-mono font-semibold"},Ie={key:0,class:"mt-4 w-full col-span-1 md:col-span-4 rounded-lg"},Me={class:"flex gap-x-2"},Fe={class:"mt-4 w-full col-span-1 md:col-span-4 border rounded-lg"},He={class:"text-2xl font-mono font-semibold text-center bg-black rounded-t-lg text-white gap-x-3 p-2"},Le={class:"flex justify-between gap-x-4 px-2"},ze={class:"flex justify-end gap-x-2 mt-4 w-full"},We={class:"w-full flex flex-col gap-y-5 p-2"},qe={class:"h-[30vh] overflow-y-auto flex flex-col gap-y-2"},Ge=["src"],Qe={class:"ml-4 flex flex-col gap-y-2 w-full"},Je={class:"font-bold text-2xl"},Ke={class:"w-full flex justify-between"},Xe={key:0,class:"flex justify-center flex-col items-center"},Ye={class:"flex gap-x-2"},Et={__name:"Index",props:{bookingServices:Array},setup(K){const $=K,{toast:h}=Ce(),T=u(!1),U=u(null),g=u([]),x=u(null),X=D(()=>$.bookingServices.filter(l=>{if(g.value[0]==null)return x.value==null||l.status==x.value;var e=new Date(l.date).toISOString().split("T")[0];return e>=new Date(g.value[0]).toISOString().split("T")[0]&&e<=new Date(g.value[1]).toISOString().split("T")[0]&&(x.value==null||l.status==x.value)})),V=D(()=>{if(!g.value[0])return $.bookingServices;const[l,e]=g.value.map(n=>new Date(n).toISOString().split("T")[0]);return $.bookingServices.filter(n=>{const d=new Date(n.date).toISOString().split("T")[0];return d>=l&&d<=e})}),O=u(!1),H=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),_=u(!1),Y={action:()=>{t.reset(),_.value=!0}},L=u([]),t=ve({id:"",service_id:null,date:"",adults:1,time_service:"",boys:0,cliente_name:"",cliente_phone:"",cliente_city:"",cliente_building:"",mascota:0,persona_adicional:0,cobre_transaccion:0,cobro_extra_cliente:0,reserva:0,abono:0,method_id:"",channel_id:"9d99a95f-6c3d-48fd-aa7d-6ef4e6860123",percent_descuento:0,proveedors:[],total:0,total_real:0,percent_channel:0,observations:""}),y=u([{proveedor:null,costo:""}]),N=u([]),Z=()=>{axios.get(route("get.services")).then(l=>{N.value=l.data.services})},ee=()=>{y.value.push({proveedor:null,costo:""})},te=l=>{l!=0&&y.value.splice(l,1)},w=u([]),C=u([]),le=()=>{axios.get(route("proveedors.index")).then(l=>{w.value=l.data.proveedors}).catch(l=>{console.log(l)})},oe=l=>{var e;l.costo=w.value.find(n=>n.id==l.proveedor).services.find(n=>n.id==t.service_id)===void 0?0:((e=w.value.find(n=>n.id==l.proveedor).services.find(n=>n.id==t.service_id))==null?void 0:e.pivot.value)*t.adults,console.log(l)},se=()=>{axios.get(route("channels.index")).then(l=>{C.value=l.data}).catch(l=>{console.log(l)})};Z(),se(),le();const R=u(null),A=u([]),E=u(""),ae=[{label:"Detalles",action:l=>{U.value=l,T.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:l=>{t.id=l.id;const e=(n,d)=>{const[k,f,o]=n.split("-"),[c,m]=d.split(":");return`${k}-${f}-${o},${c}:${m}`};t.date=e(l.date,l.hour),t.service_id=l.service_id,t.cliente_name=l.cliente_name,t.cliente_phone=l.cliente_phone,t.cliente_city=l.cliente_city,t.cliente_building=l.cliente_building,t.adults=l.adults,t.total=l.total,t.method_id=l.method_id,t.channel_id=l.channel_id,t.percent_descuento=l.percent_descuento,t.proveedors=l.proveedors,t.time_service=l.time_service,y.value=l.proveedors.map(n=>({proveedor:n.proveedor_id,costo:n.cost})),t.observations=l.observations,U.value=l,_.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Notas",action:l=>{R.value=l,axios.get(route("notes.index",{booking_service_id:l.id})).then(e=>{A.value=e.data.notes,O.value=!0})},icon:"fa-solid fa-note-sticky text-sm"},{label:"Problematica",show:W().props.auth.user.rol=="admin",action:l=>{var e=l.problematic?"Desmarcar":"Marcar";J.fire({title:"Estas Seguro?",text:`${e} como problematica esta reservaci칩n!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${e}!`}).then(n=>{n.isConfirmed&&q.post(route("booking.problematic",l.id),{onSuccess:()=>{h("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"},{label:"Eliminar",icon:"fa-solid fa-trash text-sm",severity:"danger",show:W().props.auth.user.rol=="SUPER ADMINISTRADOR",action:l=>{J.fire({title:"Estas Seguro?",text:`Eliminar la reservaci칩n de ${l.cliente_name}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, Eliminar!"}).then(e=>{e.isConfirmed&&q.delete(route("BookingServices.destroy",l.id),{onSuccess:()=>{h("success","Reserva Eliminada")}})})}}],re=[{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"adults",header:"Pasajeros",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!1,type:"date",sortable:!0},{field:"channel.name",header:"Canal de venta",filter:!0,sortable:!0},{field:"proveedors_names",header:"proveedores",class:"text-center font-semibold text-sm",filter:!0},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"CAMBIO DE FECHA",class:"bg-gray-200 font-bold"},{text:"COMPLETADA",severity:"success",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"REUBICADO",severity:"warn",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"}]}],ne=[{text:"reservado",color:"blue"},{text:"CAMBIO DE FECHA",color:"gray"},{text:"NO SHOW",color:"amber"},{text:"REUBICADO",color:"orange"},{text:"CANCELADA",color:"green"}],ie=D(()=>t.total/t.adults),j=D(()=>{let l=C.value.find(n=>n.id==t.channel_id),e=l?l.percent/100:0;return t.total-t.total*e}),S=u(!1),de=l=>{l.preventDefault(),t.total_real=j.value,t.percent_channel=C.value.find(e=>e.id==t.channel_id).percent,S.value=!0,t.proveedors=y.value,t.post(route("reservar"),{onSuccess:()=>{t.reset(),S.value=!1,_.value=!1,h("success","Reserva creada con exito")},onError:()=>{S.value=!1,h("error","Error al crear la reserva")}})},ue=()=>{t.total_real=j.value,t.percent_channel=C.value.find(l=>l.id==t.channel_id).percent,t.proveedors=y.value,t.put(route("BookingServices.update",t.id),{onSuccess:()=>{_.value=!1,h("success","Reserva actualizada con exito")}})};(()=>{axios.get(route("paymentMethods.index")).then(l=>{L.value=l.data}).catch(l=>{console.log(l)})})();const z=l=>{const[e,n,d]=l.split("-");return new Date(e,n-1,d)},ce=D(()=>{var l=[],e=N.value.find(o=>o.id==t.service_id);if(!e)return[];for(var n of e.locks)for(var d=z(n.start_date),k=z(n.end_date),f=d;f<=k;f.setDate(f.getDate()+1))l.push(new Date(f));return l});pe(t.adults,l=>{for(var e of y.value)e.proveedor&&(e.costo=w.value.find(n=>n.id==e.proveedor).pivot.value*l)});const me=()=>{axios.post(route("notes.store"),{note:E.value,booking_service_id:R.value.id}).then(l=>{axios.get(route("notes.index",{booking_service_id:R.value.id})).then(e=>{A.value=e.data.notes,E.value=""})})};return(l,e)=>{const n=ye,d=_e,k=fe("Logo"),f=xe;return v(),b(B,null,[r(we,{title:"Reservas"},{default:P(()=>[e[30]||(e[30]=a("div",{class:"hidden bg-amber-200 bg-orange-200"},null,-1)),a("div",ke,[a("div",De,[e[25]||(e[25]=a("h1",{class:"text-2xl font-bold"},"Reservas",-1)),a("div",Ue,[a("div",{class:"p-2 bg-black text-white text-center rounded-lg cursor-pointer transition-all duration-300 scale-95 hover:scale-100",onClick:e[0]||(e[0]=o=>x.value=null)},[e[24]||(e[24]=a("p",{class:"text-sm font-bold uppercase"},"Todos",-1)),a("p",Ae,p(V.value.length)+" Reservas | "+p(V.value.reduce((o,c)=>o+c.adults,0))+" Pasajeros ",1)]),(v(),b(B,null,I(ne,o=>a("div",{onClick:c=>V.value.filter(m=>m.status==o.text).length!=0?x.value=o.text:null,class:be(["flex flex-col items-center transition-all duration-300",[`bg-${o.color}-200 p-2 rounded-lg`,x.value==o.text?"border-2 border-gray-500 scale-105":"border-2 border-transparent scale-95",V.value.filter(c=>c.status==o.text).length==0?"cursor-not-allowed opacity-55":"cursor-pointer hover:scale-105 hover:border-2 hover:border-gray-500"]])},[a("p",Pe,p(o.text),1),a("p",Be,p(V.value.filter(c=>c.status==o.text).length)+" Reservas | "+p(V.value.filter(c=>c.status==o.text).reduce((c,m)=>c+m.adults,0))+" Pasajeros ",1)],10,Ee)),64))]),G(r(n,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=o=>g.value=o),selectionMode:"range",dateFormat:"dd/mm/yy",manualInput:!1,butt:""},null,8,["modelValue"]),[[f,"Filtrar fecha de Actividad",void 0,{bottom:!0}]])]),r(Ve,{actions:ae,add:Y,showButtonBar:"",columnas:re,data:X.value,routecreate:"services.create",rowClass:!0},null,8,["data"])]),r(Q,{modelValue:_.value,"onUpdate:modelValue":e[20]||(e[20]=o=>_.value=o),title:"A침adir Reserva",width:"70vw"},{footer:P(()=>[a("div",ze,[r(d,{onClick:e[19]||(e[19]=o=>_.value=!1),severity:"danger",label:"Cancelar",loading:S.value},null,8,["loading"]),s(t).id?(v(),M(d,{key:0,type:"submit",label:"Actualizar",severity:"warn",onClick:ue})):(v(),M(d,{key:1,type:"submit",severity:"success",label:"Guardar",loading:S.value,onClick:de},null,8,["loading"]))])]),default:P(()=>[a("form",$e,[r(i,{type:"dropdown",modelValue:s(t).service_id,"onUpdate:modelValue":e[2]||(e[2]=o=>s(t).service_id=o),"error-message":s(t).errors.service_id,label:"Servicio","option-label":"title","option-value":"id",options:N.value},null,8,["modelValue","error-message","options"]),r(i,{label:"Fecha de Reserva",enableTimePicker:!0,"disabled-dates":ce.value,modelValue:s(t).date,"onUpdate:modelValue":e[3]||(e[3]=o=>s(t).date=o),required:"",class:"w-full",type:"datetime"},null,8,["disabled-dates","modelValue"]),r(i,{label:"Valor Total",type:"number",mode:"currency",modelValue:s(t).total,"onUpdate:modelValue":e[4]||(e[4]=o=>s(t).total=o)},null,8,["modelValue"]),r(i,{label:"Tiempo del Servicio",type:"dropdown",modelValue:s(t).time_service,"onUpdate:modelValue":e[5]||(e[5]=o=>s(t).time_service=o),options:["20 Minutos","30 Minutos","40 Minutos","1 Hora","2 Horas","6 Horas","12 Horas","24 Horas"]},null,8,["modelValue"]),r(i,{label:"Pasajeros",type:"number",modelValue:s(t).adults,"onUpdate:modelValue":e[6]||(e[6]=o=>s(t).adults=o)},null,8,["modelValue"]),r(i,{label:"Ni침os",type:"number",modelValue:s(t).boys,"onUpdate:modelValue":e[7]||(e[7]=o=>s(t).boys=o)},null,8,["modelValue"]),r(i,{label:"Nombre del Pasajero",modelValue:s(t).cliente_name,"onUpdate:modelValue":e[8]||(e[8]=o=>s(t).cliente_name=o),"error-message":s(t).errors.cliente_name,class:"w-full"},null,8,["modelValue","error-message"]),r(i,{label:"Telefono",modelValue:s(t).cliente_phone,"onUpdate:modelValue":e[9]||(e[9]=o=>s(t).cliente_phone=o),"error-message":s(t).errors.cliente_phone,class:"w-full",type:"number"},null,8,["modelValue","error-message"]),r(i,{label:"Ciudad de donde Proviene",modelValue:s(t).cliente_city,"onUpdate:modelValue":e[10]||(e[10]=o=>s(t).cliente_city=o),"error-message":s(t).errors.city,class:"w-full"},null,8,["modelValue","error-message"]),r(i,{label:"Edificio u Hotel",class:"w-full",modelValue:s(t).cliente_building,"onUpdate:modelValue":e[11]||(e[11]=o=>s(t).cliente_building=o),"error-message":s(t).errors.cliente_building},null,8,["modelValue","error-message"]),r(i,{class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:L.value,modelValue:s(t).method_id,"onUpdate:modelValue":e[12]||(e[12]=o=>s(t).method_id=o),label:"Medio de Pago"},null,8,["options","modelValue"]),r(i,{class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:C.value,modelValue:s(t).channel_id,"onUpdate:modelValue":e[13]||(e[13]=o=>s(t).channel_id=o),label:"Canal de Venta"},null,8,["options","modelValue"]),r(i,{class:"w-full",label:"Descuento",modelValue:s(t).percent_descuento,"onUpdate:modelValue":e[14]||(e[14]=o=>s(t).percent_descuento=o),"error-message":s(t).errors.percent_descuento,min:"0",max:"100",type:"number",suffix:" %"},null,8,["modelValue","error-message"]),r(i,{class:"w-full col-span-1 md:col-span-4","rows-textarea":2,label:"Observaciones",modelValue:s(t).observations,"onUpdate:modelValue":e[15]||(e[15]=o=>s(t).observations=o),"error-message":s(t).errors.observations,type:"textarea"},null,8,["modelValue","error-message"]),a("div",Te,[a("div",Oe,[a("p",Ne,p(s(H).format(ie.value)),1),e[26]||(e[26]=a("p",{class:"italic text-md"},"Valor Pasajero",-1))]),a("div",Re,[a("p",je,p(s(H).format(j.value)),1),e[27]||(e[27]=a("p",{class:"italic text-md"},"Valor Real",-1))])]),s(t).service_id?(v(),b("div",Ie,[a("div",Me,[r(i,{label:"Placa del Vehiculo",modelValue:s(t).vehicle_plate,"onUpdate:modelValue":e[16]||(e[16]=o=>s(t).vehicle_plate=o),class:"w-full"},null,8,["modelValue"]),r(i,{label:"Nombre del Conductor",modelValue:s(t).driver_name,"onUpdate:modelValue":e[17]||(e[17]=o=>s(t).driver_name=o),class:"w-full"},null,8,["modelValue"])])])):F("",!0),a("div",Fe,[a("h1",He,[e[28]||(e[28]=ge(" Proveedores ")),r(d,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:e[18]||(e[18]=o=>ee())})]),e[29]||(e[29]=a("div",{class:"flex justify-between w-full font-bold px-2"},[a("label",{for:""},"Proveedor"),a("label",{for:""},"Costo"),a("label",{for:""},".")],-1)),(v(!0),b(B,null,I(y.value,(o,c)=>(v(),b("div",Le,[r(i,{type:"dropdown",modelValue:o.proveedor,"onUpdate:modelValue":m=>o.proveedor=m,onValueChange:m=>oe(o),"option-label":"nombre","option-value":"id",class:"w-full",options:w.value},null,8,["modelValue","onUpdate:modelValue","onValueChange","options"]),r(i,{type:"number",mode:"currency",class:"w-full",modelValue:o.costo,"onUpdate:modelValue":m=>o.costo=m},null,8,["modelValue","onUpdate:modelValue"]),G(r(d,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:m=>te(c)},null,8,["onClick"]),[[f,"Quitar"]])]))),256))])])]),_:1},8,["modelValue"]),r(s(he)),U.value?(v(),M(Se,{key:0,modelValue:T.value,"onUpdate:modelValue":e[21]||(e[21]=o=>T.value=o),service:U.value,proveedors:w.value},null,8,["modelValue","service","proveedors"])):F("",!0)]),_:1}),r(Q,{modelValue:O.value,"onUpdate:modelValue":e[23]||(e[23]=o=>O.value=o),"close-on-escape":"true",title:"Notas",width:"90vw"},{default:P(()=>[a("div",We,[e[32]||(e[32]=a("h3",{class:"text-xl font-bold"},"Notas de la Actividad",-1)),a("div",qe,[(v(!0),b(B,null,I(A.value,o=>(v(),b("div",{class:"flex border shadow-md p-2 rounded-md",key:o.id},[a("img",{src:o.user.profile_photo_url,class:"size-12 rounded-full",alt:""},null,8,Ge),a("div",Qe,[a("h2",Je,p(o.user.name),1),a("div",Ke,[a("p",null,p(o.note),1),a("p",null,p(new Date(o.created_at).toISOString().split("T")[0]),1)])])]))),128)),A.value.length==0?(v(),b("div",Xe,[r(k),e[31]||(e[31]=a("p",{class:"font-semibold text-xl"},"Serivicio sin notas",-1))])):F("",!0)]),a("div",Ye,[r(i,{type:"textarea",class:"w-full shadow-xl",modelValue:E.value,"onUpdate:modelValue":e[22]||(e[22]=o=>E.value=o)},null,8,["modelValue"]),r(d,{label:"Guardar",severity:"info",icon:"pi pi-send",onClick:me})])])]),_:1},8,["modelValue"])],64)}}};export{Et as default};
