import{d as f,C as ee,x as te,G as B,q as A,y as le,c as k,w as _,o as c,a as t,b as d,u as r,h as T,t as n,g as v,f as p,F as N,i as O,l as j,n as oe,T as se}from"./app-CcWlJynz.js";import{_ as re,s as ae}from"./AppLayout-C_Lh3XrI.js";import{s as ne}from"./index-C8SJYMnC.js";import{_ as ie}from"./Datatable-DW3DAVQx.js";import{_ as m}from"./Input-Cs5B5Qmm.js";import{_ as de}from"./Modal-BQ1u7edG.js";import{s as ue}from"./index-DcCXX39H.js";import{a as ce}from"./toasts-Bx7BVBCF.js";import{S as D}from"./sweetalert2.esm.all-IRYXxR_Z.js";import"./index-CwHWDJ53.js";import"./index-Sp9MdNAa.js";import"./index-DwZNkmyh.js";import"./index-DExqT8Hy.js";import"./index-B0qUVfR1.js";import"./index-D88Ouol4.js";import"./index-DY86PA4l.js";import"./index-CdscicWW.js";import"./index-CtF_6HG7.js";import"./index-Qy4nC0ax.js";import"./useCommonUtilities-NbiuDOAU.js";import"./postcss-DSyr27o-.js";const me={class:"h-[99vh]"},pe={class:"grid grid-cols-1 md:grid-cols-4 gap-4 items-center",novalidate:""},ve={class:"w-full col-span-1 md:col-span-4 flex justify-between gap-x-2 items-center"},fe={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},be={class:"text-lg font-mono font-semibold"},ge={class:"w-full flex flex-col justify-center items-center p-2 shadow-lg border"},xe={class:"text-lg font-mono font-semibold"},ye={key:4,class:"mt-4 w-full col-span-1 md:col-span-4 rounded-lg"},we={class:"flex gap-x-2"},_e={key:5,class:"mt-4 w-full col-span-1 md:col-span-4 border rounded-lg"},he={class:"text-2xl font-mono font-semibold text-center bg-black rounded-t-lg text-white gap-x-3 p-2"},Ve={class:"flex justify-between gap-x-4 px-2"},Ce={class:"flex justify-end gap-x-2 mt-4 w-full"},Se={class:"flex items-center gap-2"},ke={class:"font-bold text-lg"},je={class:"flex flex-col gap-y-1.5 text-sm"},Ee={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Pe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},$e={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},De={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ue={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Be={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ae=["href"],Te={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ne={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Oe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Re={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Me={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Fe={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Le={key:0,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},ze={key:1,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ie={key:2,class:"text-lg flex w-full justify-between mt-2"},He={class:"rounded-full bg-black text-white px-2"},Ge={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},qe={class:"flex flex-col gap-y-2 mt-2"},Qe={class:"flex justify-between"},We={class:"bg-blue-600 text-white p-1 rounded-lg"},Je={class:"flex items-center text-xs justify-between border shadow-xl rounded-md p-1 bg-white"},Ke={class:"uppercase font-bold"},Xe={class:"flex flex-col items-center gap-2"},Ye={class:"font-bold text-center"},Ze={key:0,class:"flex gap-x-2"},ht={__name:"Index",props:{bookingServices:Array},setup(L){const{toast:h}=ce(),E=f(!1),i=f({}),b=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),y=f(!1),z={action:()=>{o.reset(),y.value=!0}},R=f([]),o=ee({service_id:null,date:"",adults:1,boys:0,cliente_name:"",cliente_phone:"",cliente_city:"",cliente_building:"",mascota:0,persona_adicional:0,cobre_transaccion:0,cobro_extra_cliente:0,reserva:0,abono:0,method_id:"",channel_id:"9d99a95f-6c3d-48fd-aa7d-6ef4e6860123",percent_descuento:0,proveedors:[],total:0,total_real:0,percent_channel:0,observations:""}),w=f([{proveedor:null,costo:""}]),U=f([]),I=()=>{axios.get(route("get.services")).then(l=>{U.value=l.data.services})},H=()=>{w.value.push({proveedor:null,costo:""})},G=l=>{l!=0&&w.value.splice(l,1)},V=f([]),P=f([]),q=()=>{axios.get(route("proveedors.index")).then(l=>{V.value=l.data.proveedors}).catch(l=>{console.log(l)})},Q=l=>{var e;l.costo=V.value.find(a=>a.id==l.proveedor).services.find(a=>a.id==o.service_id)===void 0?0:((e=V.value.find(a=>a.id==l.proveedor).services.find(a=>a.id==o.service_id))==null?void 0:e.pivot.value)*o.adults,console.log(l)},W=()=>{axios.get(route("channels.index")).then(l=>{P.value=l.data}).catch(l=>{console.log(l)})};I(),W(),q();const J=[{label:"Detalles",action:l=>{i.value=l,E.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:l=>{o.service_id=l.service_id,o.cliente_name=l.cliente_name,o.cliente_phone=l.cliente_phone,o.cliente_city=l.cliente_city,o.cliente_building=l.cliente_building,o.adults=l.adults,o.total=l.total,o.method_id=l.method_id,o.channel_id=l.channel_id,o.percent_descuento=l.percent_descuento,o.proveedors=l.proveedors,w.value=l.proveedors,o.observations=l.observations,i.value=l,y.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Problematica",show:te().props.auth.user.rol=="admin",action:l=>{var e=l.problematic?"Desmarcar":"Marcar";D.fire({title:"Estas Seguro?",text:`${e} como problematica esta reservación!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${e}!`}).then(a=>{a.isConfirmed&&B.post(route("booking.problematic",l.id),{onSuccess:()=>{h("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"},{label:"Eliminar",icon:"fa-solid fa-trash text-sm",severity:"danger",action:l=>{D.fire({title:"Estas Seguro?",text:`Eliminar la reservación de ${l.cliente_name}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, Eliminar!"}).then(e=>{e.isConfirmed&&B.delete(route("BookingServices.destroy",l.id),{onSuccess:()=>{h("success","Reserva Eliminada")}})})}}],K=[{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service.title",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!0,sortable:!0,type:"date"},{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"problematic",header:"Problematica",filter:!0,sortable:!0,type:"boolean"},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"COMPLETADA",severity:"success",class:""},{text:"DISEÑO",severity:"info",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"SERVICIO POSTVENTA",severity:"success",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"}]}],X=A(()=>o.total/o.adults),M=A(()=>{let l=P.value.find(a=>a.id==o.channel_id),e=l?l.percent/100:0;return o.total-o.total*e}),C=f(!1),Y=l=>{l.preventDefault(),o.total_real=M.value,o.percent_channel=P.value.find(e=>e.id==o.channel_id).percent,C.value=!0,o.proveedors=w.value,o.post(route("reservar"),{onSuccess:()=>{C.value=!1,y.value=!1,h("success","Reserva creada con exito")},onError:()=>{C.value=!1,h("error","Error al crear la reserva")}})};(()=>{axios.get(route("paymentMethods.index")).then(l=>{R.value=l.data}).catch(l=>{console.log(l)})})();const F=l=>{const[e,a,S]=l.split("-");return new Date(e,a-1,S)},Z=A(()=>{var l=[],e=U.value.find(u=>u.id==o.service_id);if(!e)return[];for(var a of e.locks)for(var S=F(a.start_date),g=F(a.end_date),s=S;s<=g;s.setDate(s.getDate()+1))l.push(new Date(s));return l}),$=(l,e)=>{D.fire({title:l,text:"Estas seguro de realizar esta acción?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si"}).then(a=>{a.isConfirmed&&(D.fire({title:l,text:"Esta reserva ha sido "+l+".",icon:"success"}),B.post(route("set.states"),{service:i.value.id,state:l,terminated:e},{onSuccess:()=>{E.value=!1,h("success","Reserva "+l)}}))})};return le(o.adults,l=>{for(var e of w.value)e.proveedor&&(e.costo=V.value.find(a=>a.id==e.proveedor).pivot.value*l)}),(l,e)=>{const a=ne,S=ae,g=se;return c(),k(re,{title:"Services"},{default:_(()=>[t("div",me,[d(ie,{actions:J,add:z,columnas:K,data:L.bookingServices,routecreate:"services.create",title:"Reservas"},null,8,["data"])]),d(de,{modelValue:y.value,"onUpdate:modelValue":e[17]||(e[17]=s=>y.value=s),title:"Añadir Reserva",width:"70vw"},{footer:_(()=>[t("div",Ce,[d(a,{onClick:e[16]||(e[16]=s=>y.value=!1),severity:"danger",label:"Cancelar",loading:C.value},null,8,["loading"]),d(a,{type:"submit",severity:"success",label:"Guardar",loading:C.value,onClick:Y},null,8,["loading"])])]),default:_(()=>[t("form",pe,[d(m,{type:"dropdown",modelValue:r(o).service_id,"onUpdate:modelValue":e[0]||(e[0]=s=>r(o).service_id=s),"error-message":r(o).errors.service_id,label:"Servicio","option-label":"title","option-value":"id",options:U.value},null,8,["modelValue","error-message","options"]),d(m,{label:"Fecha de Reserva",enableTimePicker:!0,"disabled-dates":Z.value,modelValue:r(o).date,"onUpdate:modelValue":e[1]||(e[1]=s=>r(o).date=s),required:"","min-date":new Date,class:"w-full",type:"datetime"},null,8,["disabled-dates","modelValue","min-date"]),d(m,{label:"Valor Total",type:"number",mode:"currency",modelValue:r(o).total,"onUpdate:modelValue":e[2]||(e[2]=s=>r(o).total=s)},null,8,["modelValue"]),d(m,{label:"Pasajeros",type:"number",modelValue:r(o).adults,"onUpdate:modelValue":e[3]||(e[3]=s=>r(o).adults=s)},null,8,["modelValue"]),d(m,{label:"Niños",type:"number",modelValue:r(o).boys,"onUpdate:modelValue":e[4]||(e[4]=s=>r(o).boys=s)},null,8,["modelValue"]),d(m,{label:"Nombre del Pasajero",modelValue:r(o).cliente_name,"onUpdate:modelValue":e[5]||(e[5]=s=>r(o).cliente_name=s),"error-message":r(o).errors.cliente_name,class:"w-full"},null,8,["modelValue","error-message"]),d(m,{label:"Telefono",modelValue:r(o).cliente_phone,"onUpdate:modelValue":e[6]||(e[6]=s=>r(o).cliente_phone=s),"error-message":r(o).errors.cliente_phone,class:"w-full",type:"number"},null,8,["modelValue","error-message"]),d(m,{label:"Ciudad de donde Proviene",modelValue:r(o).cliente_city,"onUpdate:modelValue":e[7]||(e[7]=s=>r(o).cliente_city=s),"error-message":r(o).errors.city,class:"w-full"},null,8,["modelValue","error-message"]),d(m,{label:"Edificio u Hotel",class:"w-full",modelValue:r(o).cliente_building,"onUpdate:modelValue":e[8]||(e[8]=s=>r(o).cliente_building=s),"error-message":r(o).errors.cliente_building},null,8,["modelValue","error-message"]),T(" "+n(r(o).method)+" ",1),l.$page.props.auth.user.rol=="admin"?(c(),k(m,{key:0,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:R.value,modelValue:r(o).method_id,"onUpdate:modelValue":e[9]||(e[9]=s=>r(o).method_id=s),label:"Medio de Pago"},null,8,["options","modelValue"])):v("",!0),l.$page.props.auth.user.rol=="admin"?(c(),k(m,{key:1,class:"w-full",min:"0",type:"dropdown","option-label":"name","option-value":"id",options:P.value,modelValue:r(o).channel_id,"onUpdate:modelValue":e[10]||(e[10]=s=>r(o).channel_id=s),label:"Canal de Venta"},null,8,["options","modelValue"])):v("",!0),l.$page.props.auth.user.rol=="admin"?(c(),k(m,{key:2,class:"w-full",label:"Descuento",modelValue:r(o).percent_descuento,"onUpdate:modelValue":e[11]||(e[11]=s=>r(o).percent_descuento=s),"error-message":r(o).errors.percent_descuento,min:"0",max:"100",type:"number",suffix:" %"},null,8,["modelValue","error-message"])):v("",!0),l.$page.props.auth.user.rol=="admin"?(c(),k(m,{key:3,class:"w-full col-span-1 md:col-span-4","rows-textarea":2,label:"Observaciones",modelValue:r(o).observations,"onUpdate:modelValue":e[12]||(e[12]=s=>r(o).observations=s),"error-message":r(o).errors.observations,type:"textarea"},null,8,["modelValue","error-message"])):v("",!0),t("div",ve,[t("div",fe,[t("p",be,n(r(b).format(X.value)),1),e[23]||(e[23]=t("p",{class:"italic text-md"}," Valor Pasajero ",-1))]),t("div",ge,[t("p",xe,n(r(b).format(M.value)),1),e[24]||(e[24]=t("p",{class:"italic text-md"}," Valor Real ",-1))])]),r(o).service_id?(c(),p("div",ye,[t("div",we,[d(m,{label:"Placa del Vehiculo",modelValue:r(o).vehicle_plate,"onUpdate:modelValue":e[13]||(e[13]=s=>r(o).vehicle_plate=s),class:"w-full"},null,8,["modelValue"]),d(m,{label:"Nombre del Conductor",modelValue:r(o).driver_name,"onUpdate:modelValue":e[14]||(e[14]=s=>r(o).driver_name=s),class:"w-full"},null,8,["modelValue"])])])):v("",!0),l.$page.props.auth.user.rol=="admin"?(c(),p("div",_e,[t("h1",he,[e[25]||(e[25]=T(" Proveedores ")),d(a,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:e[15]||(e[15]=s=>H())})]),e[26]||(e[26]=t("div",{class:"flex justify-between w-full font-bold px-2"},[t("label",{for:""},"Proveedor"),t("label",{for:""},"Costo"),t("label",{for:""},".")],-1)),(c(!0),p(N,null,O(w.value,(s,u)=>(c(),p("div",Ve,[d(m,{type:"dropdown",modelValue:s.proveedor,"onUpdate:modelValue":x=>s.proveedor=x,onValueChange:x=>Q(s),"option-label":"nombre","option-value":"id",class:"w-full",options:V.value},null,8,["modelValue","onUpdate:modelValue","onValueChange","options"]),d(m,{type:"number",mode:"currency",class:"w-full",modelValue:s.costo,"onUpdate:modelValue":x=>s.costo=x},null,8,["modelValue","onUpdate:modelValue"]),j(d(a,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:x=>G(u)},null,8,["onClick"]),[[g,"Quitar"]])]))),256))])):v("",!0)])]),_:1},8,["modelValue"]),d(r(ue)),d(S,{visible:E.value,"onUpdate:visible":e[22]||(e[22]=s=>E.value=s),"pt:root:class":"!bg-blue-100",header:"Detalles de la actividad",position:"right"},{header:_(()=>[t("div",Se,[t("span",ke,n(i.value.service.title),1)])]),footer:_(()=>[t("div",Xe,[t("h1",Ye,"Saldo: "+n(r(b).format(i.value.total_price-i.value.payments.reduce((s,u)=>s+u.amount,0))),1),l.$page.props.auth.user.rol=="admin"?(c(),p("div",Ze,[j(d(a,{onClick:e[18]||(e[18]=s=>$("COMPLETADA",!0)),icon:"fa-solid fa-circle-check",text:"",size:"large",class:"flex-auto",severity:"success"},null,512),[[g,"Completar Servicio",void 0,{top:!0}]]),j(d(a,{onClick:e[19]||(e[19]=s=>$("NO SHOW",!0)),icon:"fa-solid fa-eye-slash",text:"",size:"large",class:"flex-auto",severity:"warn"},null,512),[[g,"Servicio No show",void 0,{top:!0}]]),j(d(a,{onClick:e[20]||(e[20]=s=>$("CANCELADA",!0)),icon:"fa-solid fa-xmark-circle",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[g,"Cancelar Servicio",void 0,{top:!0}]]),j(d(a,{onClick:e[21]||(e[21]=s=>$("PROBLEMATICA",!1)),icon:"fa-solid fa-person-dress-burst",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[g,"Servicio Problematico",void 0,{top:!0}]])])):v("",!0)])]),default:_(()=>{var s;return[t("div",je,[t("div",Ee,[e[27]||(e[27]=t("strong",null,"Fecha del Servicio:",-1)),t("p",null,n(i.value.date),1)]),t("div",Pe,[e[28]||(e[28]=t("strong",null,"Hora del Servicio:",-1)),t("p",null,n(i.value.hour),1)]),t("div",$e,[e[29]||(e[29]=t("strong",null,"Canal de Venta:",-1)),t("p",null,n(i.value.channel.name),1)]),t("div",De,[e[30]||(e[30]=t("strong",null,"Cliente:",-1)),t("p",null,n(i.value.cliente_name),1)]),t("div",Ue,[e[31]||(e[31]=t("strong",null,"Ciudad:",-1)),t("p",null,n(i.value.cliente_city),1)]),t("div",Be,[e[32]||(e[32]=t("strong",null,"Telelfono:",-1)),t("a",{href:`tel://${i.value.cliente_phone}`},n(i.value.cliente_phone),9,Ae)]),t("div",Te,[e[33]||(e[33]=t("strong",null,"Edificio:",-1)),t("p",null,n(i.value.cliente_building),1)]),t("div",Ne,[e[34]||(e[34]=t("strong",null,"Adultos:",-1)),t("p",null,n(i.value.adults),1)]),t("div",Oe,[e[35]||(e[35]=t("strong",null,"Niños:",-1)),t("p",null,n(i.value.boys),1)]),t("div",Re,[e[36]||(e[36]=t("strong",null,"Mascota:",-1)),t("p",null,n(i.value.mascota),1)]),t("div",Me,[e[37]||(e[37]=t("strong",null,"Total:",-1)),t("p",null,n(r(b).format(i.value.total)),1)]),t("div",Fe,[e[38]||(e[38]=t("strong",null,"Total Real:",-1)),t("p",null,n(r(b).format(i.value.total_real)),1)]),i.value.user?(c(),p("div",Le,[e[39]||(e[39]=t("strong",null,"Vendedor:",-1)),t("p",null,n((s=i.value.user)==null?void 0:s.name),1)])):v("",!0),i.value.user?(c(),p("div",ze,[e[40]||(e[40]=t("strong",null,"Fecha de reserva:",-1)),t("p",null,n(new Date(i.value.created_at).toLocaleDateString("es-CO")),1)])):v("",!0),l.$page.props.auth.user.rol=="admin"?(c(),p("div",Ie,[e[41]||(e[41]=t("p",{class:"font-bold"}," Proveedores ",-1)),t("p",He,n(i.value.proveedors.length),1)])):v("",!0),l.$page.props.auth.user.rol=="admin"?(c(!0),p(N,{key:3},O(i.value.proveedors,u=>(c(),p("div",Ge,[t("p",null,n(u.proveedor.nombre),1),t("p",null,n(r(b).format(u.cost)),1)]))),256)):v("",!0),t("div",qe,[t("div",Qe,[e[42]||(e[42]=t("h2",{class:"text-xl font-bold"},"Pagos Realizados ",-1)),t("div",We,n(r(b).format(i.value.payments.reduce((u,x)=>u+x.amount,0))),1)]),(c(!0),p(N,null,O(i.value.payments,u=>(c(),p("div",Je,[t("div",null,[t("div",Ke,n(u.type)+" "+n(r(b).format(u.amount)),1),t("div",null,n(new Date(u.created_at).toLocaleDateString("es-CO"))+" "+n(u.metohd_payment.name),1)]),t("div",{class:oe(["uppercase",u.status=="pendiente"?"bg-red-500 p-1 text-white rounded-lg shadow-md shadow-red-500":""])},[T(n(u.status)+" ",1),e[43]||(e[43]=t("div",null,null,-1))],2)]))),256))])])]}),_:1},8,["visible"])]),_:1})}}};export{ht as default};
