import{d as g,x as De,y as _,z as te,A as Q,Q as $e,B as W,q as oe,o as u,c as M,w as D,a as e,b as n,C as f,u as s,D as v,g as h,t as r,f as p,h as le,F as G,i as J,k as $,j as je,n as Pe,E as Ee}from"./app-DDnvXF-g.js";import{_ as Ue,s as Be}from"./AppLayout-X9Du6k4R.js";import{s as qe}from"./index-7z-yZVJb.js";import{_ as Ne}from"./Datatable-Dwq3zyeP.js";import{_ as c}from"./Input-D9x_tR3L.js";import{_ as Oe}from"./Modal-CxGCLqDr.js";import{s as Fe}from"./index-Bq_y9bhO.js";import{S as K,a as Te}from"./toasts-DRkOXQyQ.js";import{u as Me}from"./vee-validate-wd1G4qFV.js";import"./index-DMNjLcAD.js";import"./index-BUFtMpNe.js";import"./index-Bzs_oWgK.js";import"./index-xa-MpC6I.js";import"./postcss-CxGY_dGM.js";const Re={class:"h-[99vh]"},ze={class:""},Le={class:"text-xl font-mono font-semibold"},Ie={key:3,class:"mt-4 w-full col-sapn-1 md:col-span-3 border rounded-lg"},He={class:"text-2xl font-mono font-semibold text-center bg-black rounded-t-lg text-white gap-x-3 p-2"},Qe=e("div",{class:"flex justify-between w-full font-bold px-2"},[e("label",{for:""},"Proveedor"),e("label",{for:""},"Costo"),e("label",{for:""},".")],-1),We={class:"flex justify-between gap-x-4 px-2"},Ge={class:"flex justify-end mt-4 w-full col-sapn-1 md:col-span-3"},Je={class:"flex items-center gap-2"},Ke={class:"font-bold text-lg"},Xe={class:"flex flex-col gap-y-1.5 text-sm"},Ye={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},Ze=e("strong",null,"Fecha del Servicio:",-1),et={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},tt=e("strong",null,"Hora del Servicio:",-1),ot={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},lt=e("strong",null,"Canal de Venta:",-1),st={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},at=e("strong",null,"Cliente:",-1),rt={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},nt=e("strong",null,"Ciudad:",-1),it={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},dt=e("strong",null,"Telelfono:",-1),ut=["href"],ct={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},mt=e("strong",null,"Edificio:",-1),vt={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},pt=e("strong",null,"Adultos:",-1),ft={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},bt=e("strong",null,"Niños:",-1),gt={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},ht=e("strong",null,"Valor:",-1),_t={key:0,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},yt=e("strong",null,"Vendedor:",-1),xt={key:1,class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},wt=e("strong",null,"Fecha de reserva:",-1),Vt={key:2,class:"text-lg flex w-full justify-between mt-2"},Ct=e("p",{class:"font-bold"}," Proveedores ",-1),At={class:"rounded-full bg-black text-white px-2"},St={class:"flex justify-between border py-1 bg-white/30 rounded-md px-2"},kt={class:"flex flex-col gap-y-2 mt-2"},Dt={class:"flex justify-between"},$t=e("h2",{class:"text-xl font-bold"},"Pagos Realizados ",-1),jt={class:"bg-blue-600 text-white p-1 rounded-lg"},Pt={class:"flex items-center text-xs justify-between border shadow-xl rounded-md p-1 bg-white"},Et={class:"uppercase font-bold"},Ut=e("div",null,null,-1),Bt={class:"flex flex-col items-center gap-2"},qt={class:"font-bold text-center"},Nt={key:0,class:"flex gap-x-2"},to={__name:"Index",props:{bookingServices:Array},setup(se){const{toast:R}=Te(),j=g(!1),a=g({}),x=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),S=g(!1),ae={action:()=>{S.value=!0}},X=g([]),re=De({service_id:_().required(),date:te().required(),adults:Q().required(),date:te().required(),adults:Q().required(),cliente_name:_().required(),cliente_phone:_().required(),cliente_city:_().required(),cliente_building:_().required(),hour:_().required(),abono:Q().required(),method:_().required(),channel_id:_().required()}),{values:ne,defineField:m,errors:b,meta:Ot}=Me({validationSchema:re}),[w,ie]=m("service_id"),[P,de]=m("date"),[V,Ft]=m("boys"),[C,Tt]=m("adults"),[E,ue]=m("cliente_name"),[U,ce]=m("cliente_phone"),[B,me]=m("cliente_city"),[q,ve]=m("cliente_building"),[N,pe]=m("hour"),[z,fe]=m("abono"),[L,be]=m("channel_id"),[I,ge]=m("method");V.value=0,C.value=1;const O=g([{proveedor:null,costo:""}]),F=g([]),he=()=>{axios.get(route("get.services")).then(t=>{F.value=t.data.services})},_e=()=>{O.value.push({proveedor:null,costo:""})},ye=t=>{t!=0&&O.value.splice(t,1)},Y=g([]),Z=g([]),xe=()=>{axios.get(route("proveedors.index")).then(t=>{Y.value=t.data.proveedors}).catch(t=>{console.log(t)})},we=()=>{axios.get(route("channels.index")).then(t=>{Z.value=t.data}).catch(t=>{console.log(t)})};xe(),he(),we();const Ve=[{label:"Detalles",action:t=>{a.value=t,j.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:t=>{P.value=t.date,w.value=t.service_id,C.value=t.adults,V.value=t.boys,E.value=t.cliente_name,U.value=t.cliente_phone,B.value=t.cliente_city,q.value=t.cliente_building,N.value=t.hour,a.value=t,S.value=!0},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Problematica",show:$e().props.auth.user.rol=="admin",action:t=>{var o=t.problematic?"Desmarcar":"Marcar";K.fire({title:"Estas Seguro?",text:`${o} como problematica esta reservación!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:`Si, ${o}!`}).then(d=>{d.isConfirmed&&W.post(route("booking.problematic",t.id),{onSuccess:()=>{R("success","Reserva Marcada como problematica")}})})},icon:"fa-solid fa-person-dress-burst text-sm",severity:"danger"}],Ce=[{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service.title",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!0,sortable:!0,type:"date"},{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"problematic",header:"Problematica",filter:!0,sortable:!0,type:"boolean"},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"tag",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"reservado",severity:"info",class:""},{text:"COMPLETADA",severity:"success",class:""},{text:"DISEÑO",severity:"info",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"SERVICIO POSTVENTA",severity:"success",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"}]}],Ae=oe(()=>{let t=F.value.find(o=>o.id==w.value);return t?t.adult_tarifa*C.value+t.boy_tarifa*V.value:0}),H=g(!1),Se=t=>{t.preventDefault(),H.value=!0,W.post(route("reservar",{proveedors:O.value}),ne,{onSuccess:()=>{H.value=!1,S.value=!1,R("success","Reserva creada con exito")}})};(()=>{axios.get(route("paymentMethods.index")).then(t=>{X.value=t.data}).catch(t=>{console.log(t)})})();const ee=t=>{const[o,d,k]=t.split("-");return new Date(o,d-1,k)},ke=oe(()=>{var t=[],o=F.value.find(i=>i.id==w.value);if(!o)return[];for(var d of o.locks)for(var k=ee(d.start_date),y=ee(d.end_date),l=k;l<=y;l.setDate(l.getDate()+1))t.push(new Date(l));return t}),T=(t,o)=>{K.fire({title:t,text:"Estas seguro de realizar esta acción?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si"}).then(d=>{d.isConfirmed&&(K.fire({title:t,text:"Esta reserva ha sido "+t+".",icon:"success"}),W.post(route("set.states"),{service:a.value.id,state:t,terminated:o},{onSuccess:()=>{j.value=!1,R("success","Reserva "+t)}}))})};return(t,o)=>{const d=qe,k=Be,y=Ee;return u(),M(Ue,{title:"Services"},{default:D(()=>[e("div",Re,[n(Ne,{actions:Ve,add:ae,columnas:Ce,data:se.bookingServices,routecreate:"services.create",title:"Reservas"},null,8,["data"])]),n(Oe,{modelValue:S.value,"onUpdate:modelValue":o[13]||(o[13]=l=>S.value=l),title:"Añadir Reserva",width:"70vw"},{default:D(()=>[e("form",{onSubmit:je(Se,["prevent"]),class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",novalidate:""},[n(c,f({type:"dropdown",modelValue:s(w),"onUpdate:modelValue":o[0]||(o[0]=l=>v(w)?w.value=l:null),"error-message":s(b).service_id,label:"Servicio","option-label":"title","option-value":"id",options:F.value},s(ie)),null,16,["modelValue","error-message","options"]),n(c,f({label:"Fecha de Reserva","disabled-dates":ke.value,modelValue:s(P),"onUpdate:modelValue":o[1]||(o[1]=l=>v(P)?P.value=l:null),required:"","min-date":new Date,class:"w-full",type:"date","error-message":t.errorDate},s(de)),null,16,["disabled-dates","modelValue","min-date","error-message"]),n(c,{label:"Pasajeros",type:"number",modelValue:s(C),"onUpdate:modelValue":o[2]||(o[2]=l=>v(C)?C.value=l:null)},null,8,["modelValue"]),n(c,{label:"Niños",type:"number",modelValue:s(V),"onUpdate:modelValue":o[3]||(o[3]=l=>v(V)?V.value=l:null)},null,8,["modelValue"]),n(c,f({label:"Nombre del Pasajero"},s(ue),{modelValue:s(E),"onUpdate:modelValue":o[4]||(o[4]=l=>v(E)?E.value=l:null),"error-message":s(b).cliente_name,class:"w-full"}),null,16,["modelValue","error-message"]),n(c,f({label:"Telefono",modelValue:s(U),"onUpdate:modelValue":o[5]||(o[5]=l=>v(U)?U.value=l:null)},s(ce),{"error-message":s(b).cliente_phone,class:"w-full",type:"number"}),null,16,["modelValue","error-message"]),n(c,f({label:"Ciudad de donde Proviene"},s(me),{modelValue:s(B),"onUpdate:modelValue":o[6]||(o[6]=l=>v(B)?B.value=l:null),"error-message":s(b).city,class:"w-full"}),null,16,["modelValue","error-message"]),n(c,f({label:"Edificio u Hotel",class:"w-full"},s(ve),{modelValue:s(q),"onUpdate:modelValue":o[7]||(o[7]=l=>v(q)?q.value=l:null),"error-message":s(b).cliente_building}),null,16,["modelValue","error-message"]),n(c,f({type:"time",label:"Hora de Actividad",class:"w-full"},s(pe),{modelValue:s(N),"onUpdate:modelValue":o[8]||(o[8]=l=>v(N)?N.value=l:null),"error-message":s(b).hour}),null,16,["modelValue","error-message"]),t.$page.props.auth.user.rol=="admin"?(u(),M(c,f({key:0,class:"w-full",label:"Saldo"},s(fe),{modelValue:s(z),"onUpdate:modelValue":o[9]||(o[9]=l=>v(z)?z.value=l:null),"error-message":s(b).abono,min:"1",type:"number"}),null,16,["modelValue","error-message"])):h("",!0),t.$page.props.auth.user.rol=="admin"?(u(),M(c,f({key:1,class:"w-full",min:"0"},s(ge),{type:"dropdown","option-label":"name","option-value":"id",options:X.value,modelValue:s(I),"onUpdate:modelValue":o[10]||(o[10]=l=>v(I)?I.value=l:null),label:"Medio de Pago"}),null,16,["options","modelValue"])):h("",!0),t.$page.props.auth.user.rol=="admin"?(u(),M(c,f({key:2,class:"w-full",min:"0"},s(be),{type:"dropdown","option-label":"name","option-value":"id",options:Z.value,modelValue:s(L),"onUpdate:modelValue":o[11]||(o[11]=l=>v(L)?L.value=l:null),label:"Canal de Venta"}),null,16,["options","modelValue"])):h("",!0),e("div",ze,[e("h1",Le," Precio total: "+r(s(x).format(Ae.value)),1)]),t.$page.props.auth.user.rol=="admin"?(u(),p("div",Ie,[e("h1",He,[le(" Proveedores "),n(d,{icon:"fa-solid fa-plus",outlined:"",severity:"success",class:"size-6",onClick:o[12]||(o[12]=l=>_e())})]),Qe,(u(!0),p(G,null,J(O.value,(l,i)=>(u(),p("div",We,[n(c,{type:"dropdown",modelValue:l.proveedor,"onUpdate:modelValue":A=>l.proveedor=A,"error-message":s(b).proveedor,"option-label":"nombre","option-value":"id",class:"w-full",options:Y.value},null,8,["modelValue","onUpdate:modelValue","error-message","options"]),n(c,{type:"number",mode:"currency",class:"w-full",modelValue:l.costo,"onUpdate:modelValue":A=>l.costo=A,"error-message":s(b).costo},null,8,["modelValue","onUpdate:modelValue","error-message"]),$(n(d,{icon:"fa-solid fa-xmark-circle",class:"w-full",text:"",severity:"danger",onClick:A=>ye(i)},null,8,["onClick"]),[[y,"Quitar"]])]))),256))])):h("",!0),e("div",Ge,[n(d,{type:"submit",severity:"success",label:"Guardar",loading:H.value},null,8,["loading"])])],32)]),_:1},8,["modelValue"]),n(s(Fe)),n(k,{visible:j.value,"onUpdate:visible":o[18]||(o[18]=l=>j.value=l),"pt:root:class":"!bg-blue-100",header:"Detalles de la actividad",position:"right"},{header:D(()=>[e("div",Je,[e("span",Ke,r(a.value.service.title),1)])]),footer:D(()=>[e("div",Bt,[e("h1",qt,"Saldo: "+r(s(x).format(a.value.total_price-a.value.payments.reduce((l,i)=>l+i.amount,0))),1),t.$page.props.auth.user.rol=="admin"?(u(),p("div",Nt,[$(n(d,{onClick:o[14]||(o[14]=l=>T("COMPLETADA",!0)),icon:"fa-solid fa-circle-check",text:"",size:"large",class:"flex-auto",severity:"success"},null,512),[[y,"Completar Servicio",void 0,{top:!0}]]),$(n(d,{onClick:o[15]||(o[15]=l=>T("NO SHOW",!0)),icon:"fa-solid fa-eye-slash",text:"",size:"large",class:"flex-auto",severity:"warn"},null,512),[[y,"Servicio No show",void 0,{top:!0}]]),$(n(d,{onClick:o[16]||(o[16]=l=>T("CANCELADA",!0)),icon:"fa-solid fa-xmark-circle",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[y,"Cancelar Servicio",void 0,{top:!0}]]),$(n(d,{onClick:o[17]||(o[17]=l=>T("PROBLEMATICA",!1)),icon:"fa-solid fa-person-dress-burst",text:"",size:"large",class:"flex-auto",severity:"danger"},null,512),[[y,"Servicio Problematico",void 0,{top:!0}]])])):h("",!0)])]),default:D(()=>{var l;return[e("div",Xe,[e("div",Ye,[Ze,e("p",null,r(a.value.date),1)]),e("div",et,[tt,e("p",null,r(a.value.hour),1)]),e("div",ot,[lt,e("p",null,r(a.value.channel.name),1)]),e("div",st,[at,e("p",null,r(a.value.cliente_name),1)]),e("div",rt,[nt,e("p",null,r(a.value.cliente_city),1)]),e("div",it,[dt,e("a",{href:`tel://${a.value.cliente_phone}`},r(a.value.cliente_phone),9,ut)]),e("div",ct,[mt,e("p",null,r(a.value.cliente_building),1)]),e("div",vt,[pt,e("p",null,r(a.value.adults),1)]),e("div",ft,[bt,e("p",null,r(a.value.boys),1)]),e("div",gt,[ht,e("p",null,r(s(x).format(a.value.total_price)),1)]),a.value.user?(u(),p("div",_t,[yt,e("p",null,r((l=a.value.user)==null?void 0:l.name),1)])):h("",!0),a.value.user?(u(),p("div",xt,[wt,e("p",null,r(new Date(a.value.created_at).toLocaleDateString("es-CO")),1)])):h("",!0),t.$page.props.auth.user.rol=="admin"?(u(),p("div",Vt,[Ct,e("p",At,r(a.value.proveedors.length),1)])):h("",!0),t.$page.props.auth.user.rol=="admin"?(u(!0),p(G,{key:3},J(a.value.proveedors,i=>(u(),p("div",St,[e("p",null,r(i.proveedor.nombre),1),e("p",null,r(s(x).format(i.cost)),1)]))),256)):h("",!0),e("div",kt,[e("div",Dt,[$t,e("div",jt,r(s(x).format(a.value.payments.reduce((i,A)=>i+A.amount,0))),1)]),(u(!0),p(G,null,J(a.value.payments,i=>(u(),p("div",Pt,[e("div",null,[e("div",Et,r(i.type)+" "+r(s(x).format(i.amount)),1),e("div",null,r(new Date(i.created_at).toLocaleDateString("es-CO"))+" "+r(i.metohd_payment.name),1)]),e("div",{class:Pe(["uppercase",i.status=="pendiente"?"bg-red-500 p-1 text-white rounded-lg shadow-md shadow-red-500":""])},[le(r(i.status)+" ",1),Ut],2)]))),256))])])]}),_:1},8,["visible"])]),_:1})}}};export{to as default};
