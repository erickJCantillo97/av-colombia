import{s as J}from"./index-DQUrGo9Q.js";import{s as K}from"./index-CAlfGdlQ.js";import{_ as Q}from"./Datatable-DeiQTmyW.js";import{a as X,_ as N}from"./Modal-BpUhSUfw.js";import{_ as Y}from"./AppLayout-DlGV2GCl.js";import{d as r,C as Z,f as d,b as m,w as O,F as h,o as i,a as t,i as C,n as R,t as s,u as _,g as V,A as ee,W as z}from"./app-DJJIxlAZ.js";import{a as te}from"./toasts-CuGasqAw.js";import"./index-BGwNugaw.js";import"./index-C2MrJpDS.js";import"./index-HPNVxdkK.js";import"./index-D7zNPHbP.js";import"./index-CSCnZTai.js";import"./index-0wiUcmqN.js";import"./index-QNvKpi-V.js";import"./index-DK9Dzvhg.js";import"./index-BBUF3bcV.js";import"./index-DwGUoyRN.js";import"./index-CyGhltqH.js";import"./index-BKkqRoZK.js";import"./index-BmQqbpNc.js";import"./index-PFF00N3c.js";import"./index-DRS31x3F.js";import"./useCommonUtilities-DO03hYfs.js";import"./moment-Cijl8gKs.js";import"./filepond-plugin-image-preview.min-BG10xqQy.js";import"./postcss-B7n_B0ag.js";import"./index-DJ6uTU93.js";import"./index-DtsJ3PO6.js";import"./index-DYOMcJMK.js";import"./index-B-aPhKPZ.js";const oe={class:"h-[99vh]"},ae={class:"gap-y-2 flex flex-col"},le={class:"flex flex-col w-full justify-between font-bold"},se={key:0,class:"flex flex-col gap-y-2"},ne={class:"flex justify-between gap-x-4"},re=["onClick"],de={class:"flex gap-2 divide-x-4 divide-white items-center"},ie={class:"p-1"},ue={class:"p-1 pl-3"},pe={class:"flex flex-col w-full justify-between font-bold"},ce={class:"flex justify-end gap-x-2"},me=["loading"],ve={class:"flex flex-col gap-4"},fe={class:"font-medium block mb-2"},_e={class:"w-full bg-gray-200 rounded-md p-2 grid grid-cols-2 divide-y-2 md:flex space-x-2"},ge=["onClick"],xe={class:"flex flex-col gap-y-2 h-64 overflow-auto"},he={key:0},ye={class:"flex items-center gap-x-8 border-b shadow-md justify-between p-3 rounded-md hover:bg-gray-300"},be={class:"flex flex-col"},we={class:"font-bold flex items-center gap-x-2"},De={class:"text-xs"},Ce={class:"flex flex-col"},Ve={class:"text-sm"},Se={class:"font-bold"},ke={key:1},Pe={class:"flex items-center gap-x-8 border-b shadow-md justify-between p-3 rounded-md hover:bg-gray-300"},Oe={class:"flex flex-col"},Fe={class:"font-bold flex items-center gap-x-2"},Ie={class:"text-xs"},je={class:"text-xs"},Te={class:"flex flex-col"},$e={class:"text-sm"},Ae={class:"font-bold"},ct={__name:"Index",props:{payments:Array},setup(U){const v=r(!1),{toast:F}=te(),y=r(1),W=[{name:"Agrupados",value:1},{name:"Detalles",value:2}],S=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),I=o=>{if(o==null||o==null)return"Sin definir";var a=new Date(new Date(o).getTime()+new Date(o).getTimezoneOffset()*6e4);return a},b=r(!1),n=Z({date:new Date,startDate:new Date,endDate:new Date,amount:0,proveedor_id:"",file:"",description:""}),j=r([]),p=r([new Date,new Date]),x=r(),T=r([]),c=r(),w=r(null),B={action:()=>{w.value=null,p.value=[new Date,new Date],n.reset(),D(),v.value=!0}},E=[{name:"Ver",icon:"fa-solid fa-pencil",severity:"info",action:o=>{v.value=!0,w.value=o.id,n.date=o.date,p.value=[I(o.startDate),I(o.endDate)],n.amount=o.amount,c.value=o.proveedor_id,D()}}],H=[{header:"Proveedor",field:"proveedor.nombre",filter:!0},{header:"Fecha de Pago",field:"date",type:"date",filter:!0},{header:"Valor",field:"amount",type:"currency"},{header:"Fecha Inicio",field:"startDate",type:"date",filter:!0},{header:"Fecha Fin",field:"endDate",type:"date",filter:!0},{header:"Comprobante",field:"comprobante",type:"html-custom",renderer:o=>`<a href="${o.comprobante}" class="text-sky-600 underline" target="_blank">Ver Comprobante</a>`}],D=()=>{ee.get(route("get.booking.time.range"),{params:{start_date:new Date(p.value[0]).toISOString().split("T")[0],end_date:new Date(p.value[1]).toISOString().split("T")[0]}}).then(o=>{j.value=o.data.proveedores,x.value=o.data.bookingTimeRange.filter(a=>{let u=c.value;return a.proveedors.map(e=>e.proveedor_id).includes(u)}),T.value=[{name:"Reservado",value:x.value.filter(a=>a.status=="reservado"),color:"bg-blue-200"},{name:"Completado",value:x.value.filter(a=>a.status=="completado"),color:"bg-green-200"},{name:"Cancelado",value:x.value.filter(a=>a.status=="CANCELADA"),color:"bg-red-200"},{name:"NO SHOW",value:x.value.filter(a=>a.status=="NO SHOW"),color:"bg-yellow-200"}]})},$=r(),k=r([]),A=r([]),L=(o,a)=>{A.value=a.value.reduce((u,g)=>{const e=g.title;return u[e]||(u[e]={count:0,pasajeros:0,total:0}),u[e].count+=1,u[e].pasajeros+=g.adults,u[e].total+=g.proveedors.filter(l=>l.proveedor_id==c.value).reduce((l,f)=>l+f.cost,0),u},{}),k.value=a,$.value.toggle(o)};function q(o){n.file=o.target.files[0]}const G=()=>{b.value=!0;let o=new FormData;if(o.append("proveedor_id",c.value),o.append("amount",n.amount),o.append("comprobante",n.file),o.append("date",new Date(n.date).toISOString().split("T")[0]),console.log(new Date(p.value[0]).toISOString().split("T")[0],new Date(p.value[1]).toISOString().split("T")[0]),o.append("startDate",new Date(p.value[0]).toISOString().split("T")[0]),o.append("endDate",new Date(p.value[1]).toISOString().split("T")[0]),o.append("description",n.description),w.value){z.post(route("paymentProveedors.update",w.value),o,{onSuccess:()=>{F("success","Pago Actualizado con exito"),b.value=!1,v.value=!1}});return}z.post(route("paymentProveedors.store"),o,{onSuccess:()=>{F("success","Pago Actualizado con exito"),b.value=!1,v.value=!1}})};return(o,a)=>{const u=K,g=J;return i(),d(h,null,[m(Y,{title:"Pagos"},{default:O(()=>[t("div",oe,[m(Q,{add:B,columnas:H,data:U.payments,actions:E,title:"Pagos"},null,8,["data"])]),m(X,{modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=e=>v.value=e),title:"Añadir Pagos"},{default:O(()=>[t("div",ae,[t("div",le,[a[6]||(a[6]=t("p",null,"Fechas",-1)),m(u,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),selectionMode:"range",dateFormat:"dd/mm/yy",class:"w-full",manualInput:!1,onValueChange:D},null,8,["modelValue"])]),m(N,{label:"Proveedor",type:"dropdown","option-label":"proveedor","option-value":"proveedor_id",onValueChange:D,modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=e=>c.value=e),options:j.value},null,8,["modelValue","options"]),c.value?(i(),d("div",se,[t("div",ne,[(i(!0),d(h,null,C(T.value,e=>(i(),d("div",{class:R([`${e.color} ${e.value.length>0?"cursor-pointer":"hidden"} `,"rounded-lg py-2 border w-full flex flex-col gap-y-1 items-center font-bold cursor-pointer scale-90 hover:scale-100 shadow-sm hover:shadow-lg transition-all duration-300"]),onClick:l=>L(l,e)},[t("h1",null,s(e.name),1),t("div",de,[t("p",ie,s(e.value.length)+" Reservas",1),t("p",ue,s(e.value.reduce((l,f)=>l+f.adults,0))+" Pasajeros ",1)]),t("p",null,s(_(S).format(e.value.reduce((l,f)=>l+f.proveedors.filter(P=>P.proveedor_id==c.value).reduce((P,M)=>P+M.cost,0),0))),1)],10,re))),256))]),t("div",pe,[a[7]||(a[7]=t("p",null,"Fecha en que realizó el pago",-1)),m(u,{modelValue:_(n).date,"onUpdate:modelValue":a[2]||(a[2]=e=>_(n).date=e),dateFormat:"dd/mm/yy",class:"w-full",manualInput:!1},null,8,["modelValue"])]),m(N,{label:"Valor",type:"number",mode:"currency",modelValue:_(n).amount,"onUpdate:modelValue":a[3]||(a[3]=e=>_(n).amount=e)},null,8,["modelValue"]),t("input",{type:"file",onChange:q,label:"Comprobante"},null,32)])):V("",!0),t("div",ce,[t("button",{onClick:a[4]||(a[4]=e=>v.value=!1),class:"bg-red-500 text-white px-4 py-2 rounded-md"}," Cancelar "),c.value?(i(),d("button",{key:0,loading:b.value,onClick:G,class:"bg-green-500 text-white px-4 py-2 rounded-md"}," Guardar ",8,me)):V("",!0)])])]),_:1},8,["modelValue"])]),_:1}),m(g,{ref_key:"op",ref:$},{default:O(()=>[t("div",ve,[t("div",null,[t("span",fe,s(k.value.name),1),t("div",_e,[(i(),d(h,null,C(W,e=>t("div",{onClick:l=>y.value=e.value,class:R(["w-full rounded-lg text-center py-2 text-sm md:text-md cursor-pointer",y.value==e.value?"bg-white":"hover:bg-white/30"])},s(e.name),11,ge)),64))]),t("div",xe,[y.value==1?(i(),d("div",he,[(i(!0),d(h,null,C(A.value,(e,l)=>(i(),d("div",ye,[t("div",be,[t("span",we,[t("p",null,s(l),1)]),t("span",De,s(e.count)+" Reservas",1)]),t("div",Ce,[t("span",Ve,s(e.pasajeros)+" Pasajeros",1),t("span",Se,s(_(S).format(e.total)),1)])]))),256))])):V("",!0),y.value==2?(i(),d("div",ke,[(i(!0),d(h,null,C(k.value.value,e=>(i(),d("div",Pe,[t("div",Oe,[t("span",Fe,[t("p",null,s(e.title),1)]),t("span",Ie,s(e.cliente_name),1),t("span",je,s(e.fecha),1)]),t("div",Te,[t("span",$e,s(e.adults)+" Pasajeros",1),t("span",Ae,s(_(S).format(e.proveedors.filter(l=>l.proveedor_id==c.value).reduce((l,f)=>l+f.cost,0))),1)])]))),256))])):V("",!0)])])])]),_:1},512)],64)}}};export{ct as default};
