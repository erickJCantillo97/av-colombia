import{a1 as se,a2 as X,d,a3 as pe,A as M,f as i,o as l,a as s,b as $,w as re,g as B,h as w,F as b,j as D,n as _,t as g,a0 as ge,a4 as fe,a5 as ve,I as F,B as Y,R as ee,e as me,c as te,E as J,G as ye,i as I,a6 as be,Y as xe}from"./app-BiCF3IzH.js";import"./postcss-BukFbVIB.js";import{_ as he}from"./AppLayout-89fjQc8K.js";import{a as _e}from"./toasts-CAnEIL5D.js";import{S as Ce}from"./sweetalert2.esm.all-Y6IUEg8t.js";import{_ as we,a as Se}from"./Notas-BjqdTMu2.js";import{_ as Ae}from"./Modal-gW7mGChE.js";import{_ as ke}from"./Input-DHZbvPRG.js";import{_ as Ee}from"./logo-CS-2_ydv.js";import"./postcss-BJzvnunT.js";import"./marked.esm-BPgSS2IS.js";import"./Auth-IMRpKWpn.js";import"./index-C8Nh8EeO.js";import"./index-BC3nQaCs.js";import"./index-C-LyeXV0.js";import"./index-Cz5bFCyd.js";import"./index-DFgbQRVa.js";import"./index-DcAouQmH.js";import"./index-hL0THrXB.js";import"./index-DlN_eDmy.js";import"./index-DGVZPgZm.js";import"./index-D5RxAoYb.js";import"./index-CigoOZpX.js";import"./index-uGbqV2Si.js";import"./index-BlifwGZk.js";import"./index-BjmJuzYW.js";import"./Service-iewSzXLA.js";import"./GeneralService-oJXag7in.js";import"./Toats-CRqRGqmn.js";import"./searchStore-DitXpblf.js";import"./Loading-ZTmdO_B0.js";import"./index-CLqKA1_4.js";import"./index-BV4TzN7J.js";import"./index-DPRclsah.js";import"./index-jrtRsRMf.js";import"./index-B2Y2a3Rk.js";import"./index-uE2vJuxC.js";import"./index-CQAAOPPm.js";import"./index-Cc48GKKg.js";import"./useCommonUtilities-BgDhORlD.js";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Oe=()=>{};function Re(S,a,x){let m;se(x)?m={evaluating:x}:m={};const{lazy:A=!1,evaluating:f=void 0,shallow:p=!0,onError:u=Oe}=m,k=X(!A),h=p?X(a):d(a);let C=0;return pe(async v=>{if(!k.value)return;C++;const P=C;let y=!1;f&&Promise.resolve().then(()=>{f.value=!0});try{const E=await S(L=>{v(()=>{f&&(f.value=!1),y||L()})});P===C&&(h.value=E)}catch(E){u(E)}finally{f&&P===C&&(f.value=!1),y=!0}}),A?M(()=>(k.value=!0,h.value)):h}const Be={key:0,class:"items-center justify-center flex flex-col"},De={class:"flex flex-col gap-y-3 h-[60vh] overflow-y-auto"},$e={class:"shadow-lg pr-4 rounded-md flex items-center justify-between"},Te={class:"text-xl font-bold"},Ne={class:"font-bold text-sm"},Ve={__name:"Changes",setup(S){const a=d(!1),x=d(),m=Re(async()=>{var{data:f}=await ge.get(route("get.states.change",{date:x.value}));return f.status}),A={reservado:"blue","CAMBIO DE FECHA":"gray","NO SHOW":"amber",REUBICADO:"orange",CANCELADA:"green",PROBLEMATICA:"red"};return(f,p)=>(l(),i(b,null,[s("span",{onClick:p[0]||(p[0]=u=>a.value=!0),class:"text-xs font-bold text-blue-800 cursor-pointer"},"Listado de Cambios"),$(Ae,{title:"Historial de Cambios",modelValue:a.value,"onUpdate:modelValue":p[2]||(p[2]=u=>a.value=u),"close-on-escape":""},{default:re(()=>[$(ke,{"max-date":new Date,type:"date",class:"my-2",modelValue:x.value,"onUpdate:modelValue":p[1]||(p[1]=u=>x.value=u),dateFormat:"dd/mm/yy"},null,8,["max-date","modelValue"]),w(m)&&w(m).length==0?(l(),i("div",Be,[$(Ee),p[3]||(p[3]=s("p",null,"Sin Cambio Registrados",-1))])):B("",!0),s("div",De,[(l(!0),i(b,null,D(w(m),u=>(l(),i("div",$e,[s("div",{class:_(["rounded-l-md text-lg font-bold uppercase",`bg-${A[u.state]}-200 p-2`])},g(u.state),3),s("div",null,[s("p",Te,g(u.statable.service),1),s("span",Ne,g(u.user.name),1)])]))),256))])]),_:1},8,["modelValue"])],64))}},Fe=fe("bookingService",()=>{const S=d([]),a=d(null);return{selectDate:S,statusFilter:a}},{persist:{storage:sessionStorage,paths:["selectDate","statusFilter"]}}),Q=[{field:"created_at",header:"Fecha Entrada",filter:!0,sortable:!0,type:"date"},{field:"cliente_name",header:"Nombre del pasajero",filter:!0,sortable:!0},{field:"adults",header:"Pasajeros",filter:!0,sortable:!0},{field:"cliente_building",header:"Edificio u Hotel",filter:!0,sortable:!0},{field:"service",header:"Actividad",filter:!0,sortable:!0},{field:"date",header:"Fecha de la Actividad",filter:!1,type:"date",sortable:!0},{field:"channel.name",header:"Canal de venta",filter:!0,sortable:!0},{field:"proveedors_names",header:"proveedores",class:"text-center font-semibold text-sm",filter:!0},{field:"status",header:"Estado",filter:!0,sortable:!0,type:"text",filtertype:"EQUALS",class:"text-center uppercase",severitys:[{text:"RESERVADO",severity:"info",class:""},{text:"CAMBIO DE FECHA",class:"bg-gray-200 font-bold"},{text:"COMPLETADA",severity:"success",class:""},{text:"NO SHOW",severity:"warn",class:""},{text:"REUBICADO",severity:"warn",class:""},{text:"CANCELADA",severity:"danger",class:"animate-pulse"},{text:"PROBLEMATICA",severity:"danger",class:"animate-pulse"},{text:"SIN CONFIRMAR",severity:"danger"}]}],Ie={class:"h-[92vh]"},Me={class:"flex py-2 px-4 justify-between items-center"},Pe={class:"italic flex flex-col"},Le={class:"text-2xl font-bold"},Ue={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},je={class:"p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-gray-200"},He={class:"flex flex-col md:flex-row gap-3 items-center justify-between"},We={class:"flex-1 w-full md:w-auto"},ze={class:"relative"},Ge={class:"flex items-center gap-2"},Ye={class:"overflow-x-auto"},Je={class:"min-w-full divide-y divide-gray-200"},Qe={class:"bg-gray-50"},Ke={class:"bg-white divide-y divide-gray-200"},Ze={key:0},qe=["colspan"],Xe={key:0},et={key:2,class:"text-gray-900"},tt={class:"px-4 py-3"},st={class:"flex items-center justify-center gap-1"},rt=["onClick","title"],ot={key:0,class:"px-4 py-3 bg-gray-50 border-t border-gray-200"},at={class:"flex flex-col sm:flex-row items-center justify-between gap-3"},lt={class:"text-sm text-gray-700"},it={class:"font-semibold text-gray-900"},nt={class:"font-semibold text-gray-900"},dt={class:"font-semibold text-gray-900"},ut={class:"inline-flex rounded-md shadow-sm -space-x-px"},ct=["disabled"],pt=["disabled"],gt=["onClick"],ft={key:1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700"},vt=["disabled"],mt=["disabled"],os={__name:"Index",props:{bookingServices:Object,serviceType:String,filters:Object},setup(S){const a=S,{toast:x}=_e(),m=d([]),A=d([]),f=d(""),p=d([]),u=d(!1),k=d(null),h=d(!1),C=M(()=>a.bookingServices.data||[]),v=M(()=>({current_page:a.bookingServices.current_page,last_page:a.bookingServices.last_page,per_page:a.bookingServices.per_page,total:a.bookingServices.total,from:a.bookingServices.from,to:a.bookingServices.to})),P=Fe(),{selectDate:y,statusFilter:E}=ve(P),L=t=>`booking_${a.serviceType||"all"}_${t}`,H=(t,e)=>{try{const n=localStorage.getItem(L(t));return n?JSON.parse(n):e}catch{return e}},O=(t,e)=>{try{localStorage.setItem(L(t),JSON.stringify(e))}catch(n){console.warn("Error guardando en cache:",n)}},W=H("search",""),z=H("page",1),G=H("perPage",10),T=d(a.filters?.search||W),c=d(a.bookingServices.current_page||z),N=d(a.filters?.per_page||G),oe=(t,e)=>{let n;return function(...o){const R=()=>{clearTimeout(n),t(...o)};clearTimeout(n),n=setTimeout(R,e)}};if(!a.filters?.search&&!a.filters?.page&&(W||z!==1||G!==100)){const t={type:a.serviceType,search:W||void 0,dates:y.value||void 0,per_page:G,page:z};F.get(route("BookingServices.index"),t,{preserveState:!0,preserveScroll:!0,only:["bookingServices"],replace:!0})}const K=M(()=>({TOUR:"Reservas de Tours",EMBARCACION:"Reservas de Embarcaciones",TRANSFER:"Reservas de Transportes"})[a.serviceType]||"Reservas"),Z={action:()=>{F.get(route("BookingServices.create"))}},U=oe(()=>{O("search",T.value),O("page",c.value),O("perPage",N.value);const t={type:a.serviceType,search:T.value||void 0,dates:y.value||void 0,per_page:N.value,page:c.value};F.get(route("BookingServices.index"),t,{preserveState:!0,preserveScroll:!0,only:["bookingServices"]})},500);Y([y],()=>{c.value=1,O("page",1),U()}),Y(T,()=>{c.value=1,O("page",1),U()}),Y(N,()=>{c.value=1,O("page",1),U()});const q=M(()=>E.value?C.value.filter(t=>t.status===E.value):C.value),V=t=>{c.value=t,U()},ae=[{label:"Detalles",action:async t=>{k.value=t,u.value=!0},icon:"fa-solid fa-circle-info text-sm",severity:"info"},{label:"Editar",action:async t=>{F.get(route("BookingServices.edit",t.id))},icon:"fa-solid fa-pencil text-sm",severity:"warn"},{label:"Notas",severity:"secondary",action:t=>{p.value=t,h.value=!0},icon:"fa-solid fa-note-sticky text-sm"},{label:"Eliminar",icon:"fa-solid fa-trash text-sm",severity:"danger",show:ee().props.auth.user.rol=="admin"||ee().props.auth.user.rol=="superadmin",action:t=>{Ce.fire({title:"Estas Seguro?",text:`Eliminar la reservación de ${t.cliente_name}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, Eliminar!"}).then(e=>{e.isConfirmed&&F.delete(route("BookingServices.destroy",t.id),{onSuccess:()=>{x("success","Reserva Eliminada")}})})}}];d([]);const le=t=>{const e=t[0].getDate(),n=t[0].getMonth()+1,r=t[0].getFullYear(),o=R=>R<10?`0${R}`:R;return`${o(e)}/${o(n)}/${r} - ${o(t[1].getDate())}/${o(t[1].getMonth()+1)}/${t[1].getFullYear()}`},ie=()=>{const t=[],e=v.value.last_page,n=c.value;if(e<=7)for(let r=1;r<=e;r++)t.push(r);else if(n<=3){for(let r=1;r<=5;r++)t.push(r);t.push("..."),t.push(e)}else if(n>=e-2){t.push(1),t.push("...");for(let r=e-4;r<=e;r++)t.push(r)}else{t.push(1),t.push("...");for(let r=n-1;r<=n+1;r++)t.push(r);t.push("..."),t.push(e)}return t},j=(t,e)=>e.split(".").reduce((n,r)=>n?.[r],t),ne=t=>t?new Date(new Date(t).getTime()+new Date(t).getTimezoneOffset()*6e4).toLocaleString("es-CO",{day:"2-digit",month:"2-digit",year:"numeric"}):"Sin definir",de=t=>t.problematic?"bg-red-100":{"CAMBIO DE FECHA":"bg-gray-50",CANCELADA:"bg-green-50","NO SHOW":"bg-yellow-50",REUBICADO:"bg-orange-50",PROBLEMATICA:"bg-red-100","SIN CONFIRMAR":"bg-purple-50",RESERVADO:"bg-blue-50"}[t.status]||"",ue=t=>({RESERVADO:"bg-blue-100 text-blue-800","CAMBIO DE FECHA":"bg-gray-100 text-gray-800",COMPLETADA:"bg-green-100 text-green-800","NO SHOW":"bg-yellow-100 text-yellow-800",REUBICADO:"bg-orange-100 text-orange-800",CANCELADA:"bg-red-100 text-red-800",PROBLEMATICA:"bg-red-200 text-red-900 animate-pulse","SIN CONFIRMAR":"bg-purple-100 text-purple-800"})[t]||"bg-gray-100 text-gray-800",ce=t=>({info:"text-blue-600 hover:bg-blue-100",warn:"text-yellow-600 hover:bg-yellow-100",secondary:"text-gray-600 hover:bg-gray-100",danger:"text-red-600 hover:bg-red-100"})[t]||"text-gray-600 hover:bg-gray-100";return(t,e)=>{const n=me("VueDatePicker");return l(),i(b,null,[$(he,{title:K.value},{default:re(()=>[s("div",Ie,[s("div",Me,[s("div",Pe,[s("h1",Le,g(K.value),1),$(Ve)]),s("div",null,[$(n,{"hide-offset-dates":"",modelValue:w(y),"onUpdate:modelValue":e[0]||(e[0]=r=>se(y)?y.value=r:null),teleport:!0,format:le,"model-type":"yyyy-MM-dd",range:"","enable-time-picker":!1,locale:"es","multi-calendars":{solo:!0},timezone:"America/Bogota"},null,8,["modelValue"])])]),s("div",Ue,[s("div",je,[s("div",He,[s("div",We,[s("div",ze,[e[10]||(e[10]=s("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[s("i",{class:"fa-solid fa-magnifying-glass text-gray-400"})],-1)),J(s("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>T.value=r),type:"text",placeholder:"Buscar por nombre, teléfono, servicio, estado...",class:"w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"},null,512),[[ye,T.value]])])]),s("div",Ge,[Z?(l(),i("button",{key:0,onClick:e[2]||(e[2]=r=>Z.action()),class:"inline-flex items-center px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200 shadow-sm"},[...e[11]||(e[11]=[s("i",{class:"fa-solid fa-plus mr-2"},null,-1),I(" Nueva Reserva ",-1)])])):B("",!0),J(s("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>N.value=r),class:"px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all duration-200"},[...e[12]||(e[12]=[s("option",{value:10},"10",-1),s("option",{value:50},"50",-1),s("option",{value:100},"100",-1),s("option",{value:200},"200",-1),s("option",{value:500},"500",-1)])],512),[[be,N.value]])])])]),s("div",Ye,[s("table",Je,[s("thead",Qe,[s("tr",null,[(l(!0),i(b,null,D(w(Q),r=>(l(),i("th",{key:r.field,class:_(["px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",r.class])},g(r.header),3))),128)),e[13]||(e[13]=s("th",{class:"px-4 py-3 text-center text-xs font-bold text-gray-700 uppercase tracking-wider"}," Acciones ",-1))])]),s("tbody",Ke,[q.value.length===0?(l(),i("tr",Ze,[s("td",{colspan:w(Q).length+1,class:"px-4 py-8 text-center text-gray-500"},[...e[14]||(e[14]=[s("i",{class:"fa-solid fa-inbox text-4xl mb-2 text-gray-300"},null,-1),s("p",{class:"font-medium"},"No se encontraron resultados",-1)])],8,qe)])):B("",!0),(l(!0),i(b,null,D(q.value,r=>(l(),i("tr",{key:r.id,class:_([de(r),"hover:bg-gray-50 transition-colors duration-150"])},[(l(!0),i(b,null,D(w(Q),o=>(l(),i("td",{key:o.field,class:_(["px-4 py-3 text-sm",o.class])},[o.type==="date"?(l(),i("span",Xe,g(ne(j(r,o.field))),1)):o.type==="tag"||o.type==="customtag"?(l(),i("span",{key:1,class:_([ue(j(r,o.field)),"inline-flex px-2 py-1 text-xs font-semibold rounded-full"])},g(j(r,o.field)),3)):(l(),i("span",et,g(j(r,o.field)),1))],2))),128)),s("td",tt,[s("div",st,[(l(),i(b,null,D(ae,o=>J(s("button",{key:o.label,onClick:R=>o.action(r),class:_([ce(o.severity),"p-2 rounded-md transition-all duration-200 hover:scale-110"]),title:o.label},[s("i",{class:_(o.icon)},null,2)],10,rt),[[xe,typeof o.show=="function"?o.show(r):o.show!==!1]])),64))])])],2))),128))])])]),v.value.total>0?(l(),i("div",ot,[s("div",at,[s("div",lt,[e[15]||(e[15]=I(" Mostrando ",-1)),s("span",it,g(v.value.from),1),e[16]||(e[16]=I(" a ",-1)),s("span",nt,g(v.value.to),1),e[17]||(e[17]=I(" de ",-1)),s("span",dt,g(v.value.total),1),e[18]||(e[18]=I(" resultados ",-1))]),s("nav",ut,[s("button",{onClick:e[4]||(e[4]=r=>V(1)),disabled:c.value===1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[...e[19]||(e[19]=[s("i",{class:"fa-solid fa-angles-left"},null,-1)])],8,ct),s("button",{onClick:e[5]||(e[5]=r=>V(c.value-1)),disabled:c.value===1,class:"relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[...e[20]||(e[20]=[s("i",{class:"fa-solid fa-angle-left"},null,-1)])],8,pt),(l(!0),i(b,null,D(ie(),r=>(l(),i(b,{key:r},[r!=="..."?(l(),i("button",{key:0,onClick:o=>V(r),class:_([r===c.value?"z-10 bg-blue-600 border-blue-600 text-white":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50","relative inline-flex items-center px-4 py-2 border text-sm font-medium transition-colors duration-200"])},g(r),11,gt)):(l(),i("span",ft," ... "))],64))),128)),s("button",{onClick:e[6]||(e[6]=r=>V(c.value+1)),disabled:c.value===v.value.last_page,class:"relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[...e[21]||(e[21]=[s("i",{class:"fa-solid fa-angle-right"},null,-1)])],8,vt),s("button",{onClick:e[7]||(e[7]=r=>V(v.value.last_page)),disabled:c.value===v.value.last_page,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[...e[22]||(e[22]=[s("i",{class:"fa-solid fa-angles-right"},null,-1)])],8,mt)])])])):B("",!0)])]),k.value?(l(),te(we,{key:0,modelValue:u.value,"onUpdate:modelValue":e[8]||(e[8]=r=>u.value=r),service:k.value,proveedors:m.value},null,8,["modelValue","service","proveedors"])):B("",!0)]),_:1},8,["title"]),h.value?(l(),te(Se,{key:0,modelValue:h.value,"onUpdate:modelValue":e[9]||(e[9]=r=>h.value=r),notes:A.value,note:f.value,service:p.value},null,8,["modelValue","notes","note","service"])):B("",!0)],64)}}};export{os as default};
